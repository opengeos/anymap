
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A Python package for creating interactive maps with anywidget and JavaScript mapping libraries">
      
      
        <meta name="author" content="giswqs">
      
      
        <link rel="canonical" href="https://anymap.dev/maplibre/">
      
      
        <link rel="prev" href="../mapbox/">
      
      
        <link rel="next" href="../maplibre_widgets/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>maplibre module - anymap</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Google+Sans:300,300i,400,400i,700,700i%7CRegular:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Google Sans";--md-code-font:"Regular"}</style>
      
    
    
      <link rel="stylesheet" href="../css/timeago.css">
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#maplibre-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="anymap" class="md-header__button md-logo" aria-label="anymap" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            anymap
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              maplibre module
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/opengeos/anymap" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="anymap" class="md-nav__button md-logo" aria-label="anymap" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    anymap
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/opengeos/anymap" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Usage
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/opengeos/anymap/releases" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/opengeos/anymap/issues" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Report Issues
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cesium
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cesium
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/cesium/cesium_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cesium example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    DeckGL
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    DeckGL
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/deckgl/deckgl_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deckgl example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    KeplerGL
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    KeplerGL
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/keplergl/keplergl_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Keplergl example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Leaflet
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Leaflet
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/leaflet/leaflet_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Leaflet example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    MapLibre
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    MapLibre
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/maplibre/basic_usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basic usage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/maplibre/maplibre_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Maplibre example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/maplibre/infobox_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Infobox example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/maplibre/pmtiles_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pmtiles example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/maplibre/draw_control_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Draw control example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/maplibre/add_draw_data_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Add draw data example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/maplibre/save_draw_data_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Save draw data example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/maplibre/layer_control_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Layer control example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/maplibre/geocoder_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Geocoder example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/maplibre/terrain_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Terrain example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/maplibre/streetview_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Streetview example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/maplibre/clicked_attribute_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Clicked attribute example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/maplibre/map_click_polygon_intersection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Map click polygon intersection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/maplibre/custom_draw_styles_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Custom draw styles example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Mapbox
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Mapbox
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/mapbox/mapbox_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mapbox example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    OpenLayers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    OpenLayers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/openlayers/openlayers_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Openlayers example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Potree
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    Potree
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/potree/potree_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Potree example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" checked>
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../anymap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    anymap module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    base module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cesium/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cesium module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    compare module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deckgl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    deckgl module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../draw_styles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    draw_styles module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../keplergl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    keplergl module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../leaflet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    leaflet module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mapbox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    mapbox module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    maplibre module
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    maplibre module
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#anymap.maplibre" class="md-nav__link">
    <span class="md-ellipsis">
      
        anymap.maplibre
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap" class="md-nav__link">
    <span class="md-ellipsis">
      
        MapLibreMap
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MapLibreMap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.current_bounds" class="md-nav__link">
    <span class="md-ellipsis">
      
        current_bounds
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.current_center" class="md-nav__link">
    <span class="md-ellipsis">
      
        current_center
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.current_zoom" class="md-nav__link">
    <span class="md-ellipsis">
      
        current_zoom
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        draw_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.first_symbol_layer_id" class="md-nav__link">
    <span class="md-ellipsis">
      
        first_symbol_layer_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.sidebar_widgets" class="md-nav__link">
    <span class="md-ellipsis">
      
        sidebar_widgets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.viewstate" class="md-nav__link">
    <span class="md-ellipsis">
      
        viewstate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.activate_geoman_button" class="md-nav__link">
    <span class="md-ellipsis">
      
        activate_geoman_button()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_basemap" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_basemap()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_basemap_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_basemap_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_cog_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_cog_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_deckgl_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_deckgl_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_draw_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_draw_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_draw_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_export_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_export_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_flatgeobuf_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_flatgeobuf_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_geocoder_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_geocoder_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_geogrid_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_geogrid_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_geojson" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_geojson()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_geojson_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_geojson_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_geoman_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_geoman_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_google_streetview" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_google_streetview()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_gradientbox_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_gradientbox_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_html" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_html()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_image_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_image_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_infobox_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_infobox_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_layer_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_layer_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_legend" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_legend()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_legend_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_legend_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_maplibre_geocoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_maplibre_geocoder()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_marker" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_marker()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_marker_group" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_marker_group()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_measures_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_measures_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_pmtiles" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_pmtiles()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_popup" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_popup()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_raster" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_raster()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_source" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_source()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_temporal_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_temporal_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_terra_draw" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_terra_draw()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_three_light" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_three_light()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_three_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_three_model()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_three_tileset" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_three_tileset()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_tile_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_tile_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_to_sidebar" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_to_sidebar()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_vector" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_vector()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_vector_editor" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_vector_editor()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_vector_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_vector_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_widget_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_widget_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.clear_deckgl_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        clear_deckgl_layers()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.clear_draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        clear_draw_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.clear_geoman_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        clear_geoman_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.clear_terra_draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        clear_terra_draw_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.collapse_geoman_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        collapse_geoman_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.create_container" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_container()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.deactivate_geoman_button" class="md-nav__link">
    <span class="md-ellipsis">
      
        deactivate_geoman_button()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.delete_draw_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete_draw_features()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.disable_feature_popup" class="md-nav__link">
    <span class="md-ellipsis">
      
        disable_feature_popup()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.disable_geoman_split_mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        disable_geoman_split_mode()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.disable_geoman_union_mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        disable_geoman_union_mode()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.enable_feature_popup" class="md-nav__link">
    <span class="md-ellipsis">
      
        enable_feature_popup()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.enable_geoman_split_mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        enable_geoman_split_mode()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.enable_geoman_union_mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        enable_geoman_union_mode()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.expand_geoman_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        expand_geoman_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.find_first_symbol_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_first_symbol_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.find_style_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_style_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.fit_bounds" class="md-nav__link">
    <span class="md-ellipsis">
      
        fit_bounds()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.fly_to_three_tileset" class="md-nav__link">
    <span class="md-ellipsis">
      
        fly_to_three_tileset()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_cog_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_cog_metadata()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_deckgl_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_deckgl_layers()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_draw_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_geoman_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_geoman_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_geoman_data_as_gdf" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_geoman_data_as_gdf()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_geoman_status" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_geoman_status()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_layer_type" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_layer_type()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_style" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_style()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_style_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_style_layers()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_terra_draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_terra_draw_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.init_three_scene" class="md-nav__link">
    <span class="md-ellipsis">
      
        init_three_scene()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.load_draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_draw_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.load_osm_transport_to_geoman" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_osm_transport_to_geoman()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.load_terra_draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_terra_draw_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.off_interaction" class="md-nav__link">
    <span class="md-ellipsis">
      
        off_interaction()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.on_interaction" class="md-nav__link">
    <span class="md-ellipsis">
      
        on_interaction()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.refresh_geoman_status" class="md-nav__link">
    <span class="md-ellipsis">
      
        refresh_geoman_status()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_deckgl_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_deckgl_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_from_sidebar" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_from_sidebar()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_geogrid_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_geogrid_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_geoman_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_geoman_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_html" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_html()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_measures_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_measures_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_three_light" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_three_light()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_three_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_three_model()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_three_tileset" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_three_tileset()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_widget_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_widget_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.save_draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        save_draw_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_bearing" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_bearing()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_center" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_center()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_deckgl_layer_visibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_deckgl_layer_visibility()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_draw_mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_draw_mode()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_geoman_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_geoman_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_geoman_info_box_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_geoman_info_box_enabled()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_layout_property" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_layout_property()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_opacity" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_opacity()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_paint_property" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_paint_property()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_pitch" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_pitch()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_projection" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_projection()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_sidebar_content" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_sidebar_content()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_sidebar_width" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_sidebar_width()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_style" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_style()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_terrain" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_terrain()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_three_tileset_height" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_three_tileset_height()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_visibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_visibility()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_zoom" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_zoom()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.show" class="md-nav__link">
    <span class="md-ellipsis">
      
        show()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.to_html" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_html()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.toggle_geoman_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        toggle_geoman_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.update_deckgl_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_deckgl_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.update_html" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_html()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.update_three_light" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_three_light()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.update_three_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_three_model()
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../maplibre_widgets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    maplibre_widgets module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openlayers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    openlayers module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../potree/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    potree module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    stac module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    utils module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#anymap.maplibre" class="md-nav__link">
    <span class="md-ellipsis">
      
        anymap.maplibre
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap" class="md-nav__link">
    <span class="md-ellipsis">
      
        MapLibreMap
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MapLibreMap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.current_bounds" class="md-nav__link">
    <span class="md-ellipsis">
      
        current_bounds
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.current_center" class="md-nav__link">
    <span class="md-ellipsis">
      
        current_center
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.current_zoom" class="md-nav__link">
    <span class="md-ellipsis">
      
        current_zoom
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        draw_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.first_symbol_layer_id" class="md-nav__link">
    <span class="md-ellipsis">
      
        first_symbol_layer_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.sidebar_widgets" class="md-nav__link">
    <span class="md-ellipsis">
      
        sidebar_widgets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.viewstate" class="md-nav__link">
    <span class="md-ellipsis">
      
        viewstate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.activate_geoman_button" class="md-nav__link">
    <span class="md-ellipsis">
      
        activate_geoman_button()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_basemap" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_basemap()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_basemap_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_basemap_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_cog_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_cog_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_deckgl_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_deckgl_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_draw_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_draw_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_draw_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_export_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_export_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_flatgeobuf_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_flatgeobuf_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_geocoder_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_geocoder_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_geogrid_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_geogrid_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_geojson" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_geojson()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_geojson_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_geojson_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_geoman_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_geoman_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_google_streetview" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_google_streetview()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_gradientbox_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_gradientbox_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_html" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_html()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_image_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_image_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_infobox_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_infobox_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_layer_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_layer_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_legend" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_legend()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_legend_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_legend_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_maplibre_geocoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_maplibre_geocoder()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_marker" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_marker()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_marker_group" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_marker_group()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_measures_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_measures_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_pmtiles" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_pmtiles()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_popup" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_popup()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_raster" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_raster()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_source" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_source()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_temporal_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_temporal_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_terra_draw" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_terra_draw()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_three_light" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_three_light()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_three_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_three_model()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_three_tileset" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_three_tileset()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_tile_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_tile_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_to_sidebar" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_to_sidebar()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_vector" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_vector()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_vector_editor" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_vector_editor()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_vector_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_vector_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.add_widget_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_widget_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.clear_deckgl_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        clear_deckgl_layers()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.clear_draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        clear_draw_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.clear_geoman_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        clear_geoman_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.clear_terra_draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        clear_terra_draw_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.collapse_geoman_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        collapse_geoman_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.create_container" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_container()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.deactivate_geoman_button" class="md-nav__link">
    <span class="md-ellipsis">
      
        deactivate_geoman_button()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.delete_draw_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete_draw_features()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.disable_feature_popup" class="md-nav__link">
    <span class="md-ellipsis">
      
        disable_feature_popup()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.disable_geoman_split_mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        disable_geoman_split_mode()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.disable_geoman_union_mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        disable_geoman_union_mode()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.enable_feature_popup" class="md-nav__link">
    <span class="md-ellipsis">
      
        enable_feature_popup()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.enable_geoman_split_mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        enable_geoman_split_mode()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.enable_geoman_union_mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        enable_geoman_union_mode()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.expand_geoman_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        expand_geoman_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.find_first_symbol_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_first_symbol_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.find_style_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_style_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.fit_bounds" class="md-nav__link">
    <span class="md-ellipsis">
      
        fit_bounds()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.fly_to_three_tileset" class="md-nav__link">
    <span class="md-ellipsis">
      
        fly_to_three_tileset()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_cog_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_cog_metadata()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_deckgl_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_deckgl_layers()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_draw_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_geoman_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_geoman_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_geoman_data_as_gdf" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_geoman_data_as_gdf()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_geoman_status" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_geoman_status()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_layer_type" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_layer_type()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_style" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_style()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_style_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_style_layers()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.get_terra_draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_terra_draw_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.init_three_scene" class="md-nav__link">
    <span class="md-ellipsis">
      
        init_three_scene()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.load_draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_draw_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.load_osm_transport_to_geoman" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_osm_transport_to_geoman()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.load_terra_draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_terra_draw_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.off_interaction" class="md-nav__link">
    <span class="md-ellipsis">
      
        off_interaction()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.on_interaction" class="md-nav__link">
    <span class="md-ellipsis">
      
        on_interaction()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.refresh_geoman_status" class="md-nav__link">
    <span class="md-ellipsis">
      
        refresh_geoman_status()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_deckgl_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_deckgl_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_from_sidebar" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_from_sidebar()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_geogrid_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_geogrid_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_geoman_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_geoman_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_html" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_html()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_measures_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_measures_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_three_light" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_three_light()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_three_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_three_model()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_three_tileset" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_three_tileset()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.remove_widget_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_widget_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.save_draw_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        save_draw_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_bearing" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_bearing()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_center" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_center()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_deckgl_layer_visibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_deckgl_layer_visibility()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_draw_mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_draw_mode()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_geoman_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_geoman_data()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_geoman_info_box_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_geoman_info_box_enabled()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_layout_property" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_layout_property()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_opacity" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_opacity()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_paint_property" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_paint_property()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_pitch" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_pitch()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_projection" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_projection()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_sidebar_content" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_sidebar_content()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_sidebar_width" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_sidebar_width()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_style" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_style()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_terrain" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_terrain()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_three_tileset_height" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_three_tileset_height()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_visibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_visibility()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.set_zoom" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_zoom()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.show" class="md-nav__link">
    <span class="md-ellipsis">
      
        show()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.to_html" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_html()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.toggle_geoman_control" class="md-nav__link">
    <span class="md-ellipsis">
      
        toggle_geoman_control()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.update_deckgl_layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_deckgl_layer()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.update_html" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_html()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.update_three_light" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_three_light()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anymap.maplibre.MapLibreMap.update_three_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_three_model()
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                



                  


  
  


<h1 id="maplibre-module">maplibre module<a class="headerlink" href="#maplibre-module" title="Permanent link">&para;</a></h1>


  <div class="doc doc-object doc-module">

<a id="anymap.maplibre"></a>
    <div class="doc doc-contents first">

      <p>MapLibre GL JS implementation of the map widget.</p>
<p>This module provides the MapLibreMap class which implements an interactive map
widget using the MapLibre GL JS library. MapLibre GL JS is an open-source fork
of Mapbox GL JS, providing fast vector map rendering with WebGL.</p>
<div class="admonition classes">
<p class="admonition-title">Classes</p>
<p>MapLibreMap: Main map widget class for MapLibre GL JS.</p>
</div>

<p><strong>Examples:</strong></p>
    <p>Basic usage of MapLibreMap:</p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">anymap.maplibre</span><span class="w"> </span><span class="kn">import</span> <span class="n">MapLibreMap</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">MapLibreMap</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">74.0</span><span class="p">,</span> <span class="mf">40.7</span><span class="p">],</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="s2">&quot;OpenStreetMap.Mapnik&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span>
</code></pre></div>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h2 id="anymap.maplibre.MapLibreMap" class="doc doc-heading">
        <code>
MapLibreMap            (<a class="autorefs autorefs-internal" title="
MapWidget            (AnyWidget)
         (anymap.base.MapWidget)" href="../base/#anymap.base.MapWidget">MapWidget</a>)
        </code>



<a href="#anymap.maplibre.MapLibreMap" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>MapLibre GL JS implementation of the map widget.</p>
<p>This class provides an interactive map widget using MapLibre GL JS,
an open-source WebGL-based vector map renderer. It supports various
data sources, custom styling, and interactive features.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>style</code></td>
        <td></td>
        <td><p>Map style configuration (URL string or style object).</p></td>
      </tr>
      <tr>
        <td><code>bearing</code></td>
        <td></td>
        <td><p>Map rotation in degrees (0-360).</p></td>
      </tr>
      <tr>
        <td><code>pitch</code></td>
        <td></td>
        <td><p>Map tilt in degrees (0-60).</p></td>
      </tr>
      <tr>
        <td><code>antialias</code></td>
        <td></td>
        <td><p>Whether to enable antialiasing for better rendering quality.</p></td>
      </tr>
      <tr>
        <td><code>double_click_zoom</code></td>
        <td></td>
        <td><p>Whether to enable double-click to zoom interaction (default: False).</p></td>
      </tr>
      <tr>
        <td><code>request_headers</code></td>
        <td></td>
        <td><p>Custom HTTP headers to include in tile requests (e.g., {"Authorization": "Bearer token"}).</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <p>Creating a basic MapLibre map:</p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">MapLibreMap</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">40.7749</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.4194</span><span class="p">],</span>
<span class="o">...</span>     <span class="n">zoom</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">style</span><span class="o">=</span><span class="s2">&quot;3d-satellite&quot;</span>
<span class="o">...</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="s2">&quot;OpenStreetMap.Mapnik&quot;</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MapLibreMap</span><span class="p">(</span><span class="n">MapWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MapLibre GL JS implementation of the map widget.</span>

<span class="sd">    This class provides an interactive map widget using MapLibre GL JS,</span>
<span class="sd">    an open-source WebGL-based vector map renderer. It supports various</span>
<span class="sd">    data sources, custom styling, and interactive features.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        style: Map style configuration (URL string or style object).</span>
<span class="sd">        bearing: Map rotation in degrees (0-360).</span>
<span class="sd">        pitch: Map tilt in degrees (0-60).</span>
<span class="sd">        antialias: Whether to enable antialiasing for better rendering quality.</span>
<span class="sd">        double_click_zoom: Whether to enable double-click to zoom interaction (default: False).</span>
<span class="sd">        request_headers: Custom HTTP headers to include in tile requests (e.g., {&quot;Authorization&quot;: &quot;Bearer token&quot;}).</span>

<span class="sd">    Example:</span>
<span class="sd">        Creating a basic MapLibre map:</span>

<span class="sd">        &gt;&gt;&gt; m = MapLibreMap(</span>
<span class="sd">        ...     center=[40.7749, -122.4194],</span>
<span class="sd">        ...     zoom=12,</span>
<span class="sd">        ...     style=&quot;3d-satellite&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; m.add_basemap(&quot;OpenStreetMap.Mapnik&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># MapLibre-specific traits</span>
    <span class="n">style</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Union</span><span class="p">(</span>
        <span class="p">[</span><span class="n">traitlets</span><span class="o">.</span><span class="n">Unicode</span><span class="p">(),</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Dict</span><span class="p">()],</span>
        <span class="n">default_value</span><span class="o">=</span><span class="s2">&quot;dark-matter&quot;</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">bearing</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pitch</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">antialias</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Bool</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">double_click_zoom</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">request_headers</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Dict</span><span class="p">({})</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_draw_data</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_terra_draw_data</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_terra_draw_enabled</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_layer_dict</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">clicked</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_deckgl_layers</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">flatgeobuf_layers</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Dict</span><span class="p">({})</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">geoman_data</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Dict</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]})</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span>
        <span class="n">sync</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">geoman_status</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Dict</span><span class="p">({})</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Define the JavaScript module path</span>
    <span class="n">_esm</span> <span class="o">=</span> <span class="n">_esm_maplibre</span>
    <span class="n">_css</span> <span class="o">=</span> <span class="n">_css_maplibre</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">center</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
        <span class="n">zoom</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">style</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;dark-matter&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;100%&quot;</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;680px&quot;</span><span class="p">,</span>
        <span class="n">bearing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">pitch</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">controls</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;navigation&quot;</span><span class="p">:</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fullscreen&quot;</span><span class="p">:</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
            <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="s2">&quot;bottom-left&quot;</span><span class="p">,</span>
            <span class="s2">&quot;globe&quot;</span><span class="p">:</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
            <span class="s2">&quot;layers&quot;</span><span class="p">:</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">projection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mercator&quot;</span><span class="p">,</span>
        <span class="n">add_sidebar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">sidebar_visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">sidebar_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">360</span><span class="p">,</span>
        <span class="n">sidebar_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">layer_manager_expanded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize MapLibre map widget.</span>

<span class="sd">        Args:</span>
<span class="sd">            center: Map center coordinates as [longitude, latitude]. Default is [0, 20].</span>
<span class="sd">            zoom: Initial zoom level (typically 0-20). Default is 1.0.</span>
<span class="sd">            style: MapLibre style URL string or style object dictionary.</span>
<span class="sd">            width: Widget width as CSS string (e.g., &quot;100%&quot;, &quot;800px&quot;).</span>
<span class="sd">            height: Widget height as CSS string (e.g., &quot;680px&quot;, &quot;50vh&quot;).</span>
<span class="sd">            bearing: Map bearing (rotation) in degrees (0-360).</span>
<span class="sd">            pitch: Map pitch (tilt) in degrees (0-60).</span>
<span class="sd">            controls: Dictionary of control names and their positions. Default is {</span>
<span class="sd">                &quot;navigation&quot;: &quot;top-right&quot;,</span>
<span class="sd">                &quot;fullscreen&quot;: &quot;top-right&quot;,</span>
<span class="sd">                &quot;scale&quot;: &quot;bottom-left&quot;,</span>
<span class="sd">                &quot;globe&quot;: &quot;top-right&quot;,</span>
<span class="sd">                &quot;layers&quot;: &quot;top-right&quot;,</span>
<span class="sd">            }.</span>
<span class="sd">            projection: Map projection type. Can be &quot;mercator&quot; or &quot;globe&quot;. Default is &quot;mercator&quot;.</span>
<span class="sd">            add_sidebar: Whether to add a sidebar to the map. Default is False.</span>
<span class="sd">            sidebar_visible: Whether the sidebar is visible. Default is False.</span>
<span class="sd">            sidebar_width: Width of the sidebar in pixels. Default is 360.</span>
<span class="sd">            sidebar_args: Additional keyword arguments for the sidebar. Default is None.</span>
<span class="sd">            layer_manager_expanded: Whether the layer manager is expanded. Default is True.</span>
<span class="sd">            **kwargs: Additional keyword arguments passed to parent class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">style</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">construct_maplibre_style</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
            <span class="n">center</span> <span class="o">=</span> <span class="n">center</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
            <span class="n">zoom</span><span class="o">=</span><span class="n">zoom</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
            <span class="n">bearing</span><span class="o">=</span><span class="n">bearing</span><span class="p">,</span>
            <span class="n">pitch</span><span class="o">=</span><span class="n">pitch</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="s2">&quot;Background&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;Background&quot;</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;background&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;background&quot;</span><span class="p">,</span>
            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Initialize the _layer_dict trait with the layer_dict content</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layer_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">)</span>

        <span class="c1"># Initialize current state attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_center</span> <span class="o">=</span> <span class="n">center</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_zoom</span> <span class="o">=</span> <span class="n">zoom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_bearing</span> <span class="o">=</span> <span class="n">bearing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_pitch</span> <span class="o">=</span> <span class="n">pitch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_bounds</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Will be set after map loads</span>

        <span class="c1"># Register event handler to update current state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_map_event</span><span class="p">(</span><span class="s2">&quot;moveend&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_current_state</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="n">style</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_style_layers</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">style_dict</span><span class="p">[</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">projection</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;globe&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_projection</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;interpolate&quot;</span><span class="p">,</span>
                        <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">],</span>
                        <span class="p">[</span><span class="s2">&quot;zoom&quot;</span><span class="p">],</span>
                        <span class="mi">10</span><span class="p">,</span>
                        <span class="s2">&quot;vertical-perspective&quot;</span><span class="p">,</span>
                        <span class="mi">12</span><span class="p">,</span>
                        <span class="s2">&quot;mercator&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">controls</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">control</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">controls</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">control</span> <span class="o">==</span> <span class="s2">&quot;layers&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_layer_control</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">control</span> <span class="o">==</span> <span class="s2">&quot;geoman&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_geoman_control</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="n">control</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>
            <span class="k">elif</span> <span class="n">control</span> <span class="o">==</span> <span class="s2">&quot;export&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_export_control</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="n">control</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_control</span><span class="p">(</span><span class="n">control</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="n">control</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>

        <span class="k">if</span> <span class="n">sidebar_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sidebar_args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s2">&quot;sidebar_visible&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sidebar_args</span><span class="p">:</span>
            <span class="n">sidebar_args</span><span class="p">[</span><span class="s2">&quot;sidebar_visible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sidebar_visible</span>
        <span class="k">if</span> <span class="s2">&quot;sidebar_width&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sidebar_args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sidebar_width</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">sidebar_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sidebar_width</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;px&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">sidebar_args</span><span class="p">[</span><span class="s2">&quot;min_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sidebar_width</span>
            <span class="n">sidebar_args</span><span class="p">[</span><span class="s2">&quot;max_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sidebar_width</span>
        <span class="k">if</span> <span class="s2">&quot;expanded&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sidebar_args</span><span class="p">:</span>
            <span class="n">sidebar_args</span><span class="p">[</span><span class="s2">&quot;expanded&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_manager_expanded</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sidebar_args</span> <span class="o">=</span> <span class="n">sidebar_args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_widget_control_widgets</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flatgeobuf_defaults</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">add_sidebar</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ipython_display_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_patched_display</span>
        <span class="c1"># Listen for union toggle events coming from the toolbar button in JS</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_map_event</span><span class="p">(</span><span class="s2">&quot;geoman_union_toggled&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_geoman_union_toggle</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># Listen for split mode events coming from the toolbar button/drawing in JS</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_map_event</span><span class="p">(</span><span class="s2">&quot;geoman_split_toggled&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_geoman_split_toggle</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_map_event</span><span class="p">(</span><span class="s2">&quot;geoman_split_line&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_geoman_split_line</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_style</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the style of the map.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict: The style of the map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">style</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">style</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_style_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">sorted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the names of the basemap layers.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[str]: The names of the basemap layers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_style</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;layers&quot;</span> <span class="ow">in</span> <span class="n">style</span><span class="p">:</span>
            <span class="n">layers</span> <span class="o">=</span> <span class="n">style</span><span class="p">[</span><span class="s2">&quot;layers&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">return_ids</span><span class="p">:</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">sorted</span><span class="p">:</span>
                    <span class="n">ids</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

                <span class="k">return</span> <span class="n">ids</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">layers</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_style_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Searches for a style layer in the map&#39;s current style by its ID and returns it if found.</span>

<span class="sd">        Args:</span>
<span class="sd">            id (str): The ID of the style layer to find.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[Dict]: The style layer as a dictionary if found, otherwise None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_style_layers</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">id</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">layer</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_first_symbol_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the first symbol layer in the map&#39;s current style.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[Dict]: The first symbol layer as a dictionary if found, otherwise None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_style_layers</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;symbol&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">layer</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">first_symbol_layer_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the ID of the first symbol layer in the map&#39;s current style.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_first_symbol_layer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">layer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">sidebar_visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">min_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">360</span><span class="p">,</span>
        <span class="n">max_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">360</span><span class="p">,</span>
        <span class="n">sidebar_content</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays the map with an optional sidebar.</span>

<span class="sd">        Args:</span>
<span class="sd">            sidebar_visible (bool): Whether the sidebar is visible. Defaults to False.</span>
<span class="sd">            min_width (int): Minimum width of the sidebar in pixels. Defaults to 250.</span>
<span class="sd">            max_width (int): Maximum width of the sidebar in pixels. Defaults to 300.</span>
<span class="sd">            sidebar_content (Optional[Any]): Content to display in the sidebar. Defaults to None.</span>
<span class="sd">            **kwargs (Any): Additional keyword arguments.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Container</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">sidebar_visible</span><span class="o">=</span><span class="n">sidebar_visible</span><span class="p">,</span>
            <span class="n">min_width</span><span class="o">=</span><span class="n">min_width</span><span class="p">,</span>
            <span class="n">max_width</span><span class="o">=</span><span class="n">max_width</span><span class="p">,</span>
            <span class="n">sidebar_content</span><span class="o">=</span><span class="n">sidebar_content</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_container</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">sidebar_visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">min_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">expanded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a container widget for the map with an optional sidebar.</span>

<span class="sd">        This method initializes a `LayerManagerWidget` and a `Container` widget to display the map</span>
<span class="sd">        alongside a sidebar. The sidebar can be customized with visibility, width, and additional content.</span>

<span class="sd">        Args:</span>
<span class="sd">            sidebar_visible (bool): Whether the sidebar is visible. Defaults to False.</span>
<span class="sd">            min_width (int): Minimum width of the sidebar in pixels. Defaults to 360.</span>
<span class="sd">            max_width (int): Maximum width of the sidebar in pixels. Defaults to 360.</span>
<span class="sd">            expanded (bool): Whether the `LayerManagerWidget` is expanded by default. Defaults to True.</span>
<span class="sd">            **kwargs (Any): Additional keyword arguments passed to the `Container` widget.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Container: The created container widget with the map and sidebar.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">sidebar_visible</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sidebar_visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sidebar_visible&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">min_width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">min_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;min_width&quot;</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">max_width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_width&quot;</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">expanded</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expanded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;expanded&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span> <span class="o">=</span> <span class="n">LayerManagerWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expanded</span><span class="o">=</span><span class="n">expanded</span><span class="p">)</span>

        <span class="n">container</span> <span class="o">=</span> <span class="n">Container</span><span class="p">(</span>
            <span class="n">host_map</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">sidebar_visible</span><span class="o">=</span><span class="n">sidebar_visible</span><span class="p">,</span>
            <span class="n">min_width</span><span class="o">=</span><span class="n">min_width</span><span class="p">,</span>
            <span class="n">max_width</span><span class="o">=</span><span class="n">max_width</span><span class="p">,</span>
            <span class="n">sidebar_content</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span><span class="p">],</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="n">container</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">sidebar_widgets</span><span class="p">[</span><span class="s2">&quot;Layers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span>
        <span class="k">return</span> <span class="n">container</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_interaction</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register a unified interaction callback similar to ipyleaflet&#39;s on_interaction.</span>

<span class="sd">        The callback will be invoked with keyword arguments like:</span>
<span class="sd">            - event: &#39;interaction&#39;</span>
<span class="sd">            - type: event type (e.g., &#39;mousemove&#39;, &#39;mousedown&#39;, &#39;mouseup&#39;, &#39;click&#39;, &#39;dblclick&#39;, &#39;contextmenu&#39;)</span>
<span class="sd">            - coordinates: [lng, lat] when available</span>

<span class="sd">        Example:</span>
<span class="sd">            def handle_map_interaction(**kwargs):</span>
<span class="sd">                print(kwargs)</span>

<span class="sd">            m.on_interaction(handle_map_interaction)</span>

<span class="sd">        Args:</span>
<span class="sd">            callback: Function that accepts **kwargs for interaction events.</span>
<span class="sd">            types: Optional list of event types to subscribe to. If None, subscribes</span>
<span class="sd">                   to common pointer events.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default_types</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;mousemove&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mousedown&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mouseup&quot;</span><span class="p">,</span>
            <span class="s2">&quot;click&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dblclick&quot;</span><span class="p">,</span>
            <span class="s2">&quot;contextmenu&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">event_types</span> <span class="o">=</span> <span class="n">types</span> <span class="k">if</span> <span class="n">types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">default_types</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_make_wrapper</span><span class="p">(</span><span class="n">expected_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">_wrapper</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">event_type</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">expected_type</span><span class="p">)</span>
                <span class="c1"># Normalize coordinates to [lng, lat] to match MapLibre</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lat&quot;</span><span class="p">)</span>
                <span class="n">lng</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lng&quot;</span><span class="p">)</span>
                <span class="n">coordinates</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">lat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lng</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[</span><span class="n">lng</span><span class="p">,</span> <span class="n">lat</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lnglat</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lngLat&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="nb">isinstance</span><span class="p">(</span><span class="n">lnglat</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
                        <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">lnglat</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
                        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lnglat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
                        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lnglat</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
                    <span class="p">):</span>
                        <span class="c1"># lngLat is already [lng, lat] from JS</span>
                        <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[</span><span class="n">lnglat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lnglat</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

                <span class="n">payload</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;interaction&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">event_type</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">coordinates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coordinates</span>

                <span class="c1"># Prefer kwargs-style callback like ipyleaflet; fallback to single dict</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">callback</span><span class="p">(</span><span class="o">**</span><span class="n">payload</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">callback</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">_wrapper</span>

        <span class="c1"># Keep track of wrapper functions to allow unobserve later</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_interaction_wrappers&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_wrappers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span>
                <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span><span class="p">]]</span>
            <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">wrapper_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">etype</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
            <span class="n">wrapper</span> <span class="o">=</span> <span class="n">_make_wrapper</span><span class="p">(</span><span class="n">etype</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_map_event</span><span class="p">(</span><span class="n">etype</span><span class="p">,</span> <span class="n">wrapper</span><span class="p">)</span>
            <span class="n">wrapper_map</span><span class="p">[</span><span class="n">etype</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrapper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_wrappers</span><span class="p">[</span><span class="n">callback</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_interaction_wrappers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="o">**</span><span class="n">wrapper_map</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">off_interaction</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unregister a previously registered interaction callback.</span>

<span class="sd">        Args:</span>
<span class="sd">            callback: The callback originally passed to on_interaction.</span>
<span class="sd">            types: Optional list of event types to stop observing. If None, all types for this callback are removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_interaction_wrappers&quot;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">wrapper_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_wrappers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">wrapper_map</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">target_types</span> <span class="o">=</span> <span class="n">types</span> <span class="k">if</span> <span class="n">types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">wrapper_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">etype</span> <span class="ow">in</span> <span class="n">target_types</span><span class="p">:</span>
            <span class="n">wrapper</span> <span class="o">=</span> <span class="n">wrapper_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">etype</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">wrapper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">off_map_event</span><span class="p">(</span><span class="n">etype</span><span class="p">,</span> <span class="n">wrapper</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">wrapper_map</span><span class="p">[</span><span class="n">etype</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">wrapper_map</span><span class="p">:</span>
            <span class="c1"># Remove the callback entry entirely when no wrappers remain</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_wrappers</span><span class="p">[</span><span class="n">callback</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_geoman_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the current Geoman toolbar status synced from the frontend.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Any]: Status including keys like &#39;activeButtons&#39;, &#39;isCollapsed&#39;, &#39;globalEditMode&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geoman_status</span> <span class="ow">or</span> <span class="p">{})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_geoman_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Request the frontend to refresh and sync the current Geoman toolbar status.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;getGeomanStatus&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">activate_geoman_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Programmatically activate/click a Geoman toolbar button by name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Button name or a unique substring of its label/title (case-insensitive).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;activateGeomanButton&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">deactivate_geoman_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Programmatically deactivate a Geoman toolbar button by name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Button name or a unique substring of its label/title (case-insensitive).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;deactivateGeomanButton&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="c1"># ---------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_geoman_info_box_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable or disable the Geoman info box at runtime.</span>

<span class="sd">        Args:</span>
<span class="sd">            enabled: True to show the info box when selecting/editing features;</span>
<span class="sd">                     False to hide it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setGeomanInfoBoxEnabled&quot;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">enabled</span><span class="p">))</span>

    <span class="c1"># ---------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_osm_transport_to_geoman</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bbox</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">keys</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search OSM transportation data (node, way, relation) within a bbox and import</span>
<span class="sd">        the results into the Geoman control for editing.</span>

<span class="sd">        This triggers a frontend Overpass API query and **replaces** the current Geoman</span>
<span class="sd">        editable features with the fetched GeoJSON. **This is a destructive operation:**</span>
<span class="sd">        any existing editable features will be permanently removed and replaced.</span>

<span class="sd">        Note:</span>
<span class="sd">            There is currently no way to append features; this method always replaces</span>
<span class="sd">            all existing Geoman editable features. If you wish to preserve your current</span>
<span class="sd">            work, please save or export it before calling this method.</span>
<span class="sd">        Args:</span>
<span class="sd">            bbox: Optional [west, south, east, north] (WGS84). If None, uses map bounds.</span>
<span class="sd">            keys: Optional list of OSM keys to include, default [&#39;highway&#39;, &#39;railway&#39;].</span>
<span class="sd">            timeout: Overpass API timeout in seconds (default 25).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">bbox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;bbox must be [west, south, east, north].&quot;</span><span class="p">)</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;bbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;keys&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;timeout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;loadOsmTransportToGeoman&quot;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

    <span class="c1"># ---------------------------------------------------------------------</span>
    <span class="c1"># Geoman &quot;Union&quot; Mode (free implementation using GeoPandas/Shapely)</span>
    <span class="c1"># ---------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_union_geoman_features_by_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal helper to union/merge two Geoman features by their IDs and update geoman_data.</span>
<span class="sd">        Supports polygons and lines. Polygons are dissolved via unary_union.</span>
<span class="sd">        Lines are merged via linemerge(unary_union(...)).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_GEOPANDAS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;GeoPandas is required for union operations.&quot;</span><span class="p">)</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">shape</span><span class="p">,</span> <span class="n">mapping</span>  <span class="c1"># type: ignore</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">shapely.ops</span><span class="w"> </span><span class="kn">import</span> <span class="n">unary_union</span><span class="p">,</span> <span class="n">linemerge</span>  <span class="c1"># type: ignore</span>

        <span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Build ID -&gt; index map (fallback to index if &#39;id&#39; missing)</span>
        <span class="n">id_to_index</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">feat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
            <span class="n">fid</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="n">id_to_index</span><span class="p">[</span><span class="n">fid</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>

        <span class="c1"># Resolve indices and geometries</span>
        <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fid</span> <span class="ow">in</span> <span class="n">feature_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fid</span> <span class="ow">in</span> <span class="n">id_to_index</span><span class="p">:</span>
                <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">id_to_index</span><span class="p">[</span><span class="n">fid</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Collect geometries to union/merge</span>
        <span class="n">geoms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">props</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">geom_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">feat</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">geom</span> <span class="o">=</span> <span class="n">shape</span><span class="p">(</span><span class="n">feat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">))</span>
                <span class="n">geoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
                <span class="n">props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">feat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">,</span> <span class="p">{})))</span>
                <span class="n">geom_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">geom_type</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># Skip invalid geometry</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">geoms</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Determine operation based on geometry type (use first as reference)</span>
        <span class="n">primary_type</span> <span class="o">=</span> <span class="n">geom_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">secondary_type</span> <span class="o">=</span> <span class="n">geom_types</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="c1"># If types mismatch (e.g., line vs polygon), skip to avoid odd GeometryCollection</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;line&quot;</span> <span class="ow">in</span> <span class="n">primary_type</span> <span class="ow">and</span> <span class="s2">&quot;line&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">secondary_type</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="s2">&quot;polygon&quot;</span> <span class="ow">in</span> <span class="n">primary_type</span> <span class="ow">and</span> <span class="s2">&quot;polygon&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">secondary_type</span>
        <span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># Merge geometries</span>
        <span class="k">if</span> <span class="s2">&quot;line&quot;</span> <span class="ow">in</span> <span class="n">primary_type</span><span class="p">:</span>
            <span class="n">merged</span> <span class="o">=</span> <span class="n">linemerge</span><span class="p">(</span><span class="n">unary_union</span><span class="p">(</span><span class="n">geoms</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">merged</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">geoms</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">merged</span><span class="o">.</span><span class="n">is_empty</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Create new feature; keep properties from the first feature</span>
        <span class="n">new_feature</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span>
            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">props</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">props</span> <span class="k">else</span> <span class="p">{},</span>
            <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">mapping</span><span class="p">(</span><span class="n">merged</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># Remove original features and append merged</span>
        <span class="n">keep</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">[:</span><span class="mi">2</span><span class="p">]]</span>
        <span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_feature</span><span class="p">)</span>

        <span class="c1"># Sync back to widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">keep</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">enable_geoman_union_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance_tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable a simple &#39;union mode&#39; without Geoman Pro that works for polygons and lines.</span>

<span class="sd">        Behavior:</span>
<span class="sd">            - On each map click, finds the first Geoman polygon under the click.</span>
<span class="sd">            - For lines, selects the closest line within distance_tolerance degrees.</span>
<span class="sd">            - When two features of the same type have been clicked, merges them into a single feature,</span>
<span class="sd">              removes the originals, and adds the merged polygon back.</span>
<span class="sd">        Args:</span>
<span class="sd">            distance_tolerance: Max angular distance (degrees) to consider a line selected</span>
<span class="sd">                                when clicking near it. Default ~1e-4 (~11 m at equator).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_GEOPANDAS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;GeoPandas is required for union mode.&quot;</span><span class="p">)</span>

        <span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>  <span class="c1"># type: ignore</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">Point</span>  <span class="c1"># type: ignore</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_union_mode_enabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_union_selected_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_union_expected_geom_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_union_distance_tolerance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">distance_tolerance</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_union_click_handler</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;click&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_union_mode_enabled</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;coordinates&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">coords</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">lng</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">coords</span>  <span class="c1"># coordinates are [lng, lat]</span>

            <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">features</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="n">gdf</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="k">return</span>

            <span class="n">pt</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">lng</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
            <span class="c1"># Prefer polygon hit-testing first</span>
            <span class="n">cand</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">geom_type</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;Polygon&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiPolygon&quot;</span><span class="p">])]</span>
            <span class="n">poly_mask</span> <span class="o">=</span> <span class="n">cand</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span> <span class="o">|</span> <span class="n">cand</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
            <span class="n">cand</span> <span class="o">=</span> <span class="n">cand</span><span class="p">[</span><span class="n">poly_mask</span><span class="p">]</span>
            <span class="n">selected_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">selected_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cand</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">selected_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cand</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">selected_type</span> <span class="o">=</span> <span class="s2">&quot;polygon&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># For lines, pick the nearest within tolerance</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span>
                    <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">geom_type</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;LineString&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiLineString&quot;</span><span class="p">])</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">lines</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="c1"># Compute distance to point; choose min</span>
                    <span class="n">distances</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
                    <span class="n">min_dist</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">distances</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">min_dist</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_union_distance_tolerance</span><span class="p">:</span>
                        <span class="n">selected_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">distances</span><span class="o">.</span><span class="n">idxmin</span><span class="p">())</span>
                        <span class="n">selected_type</span> <span class="o">=</span> <span class="s2">&quot;line&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span>

            <span class="c1"># Respect expected type: first selection sets it, subsequent must match</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_union_expected_geom_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_union_expected_geom_type</span> <span class="o">=</span> <span class="n">selected_type</span>
            <span class="k">elif</span> <span class="n">selected_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_union_expected_geom_type</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="n">idx</span> <span class="o">=</span> <span class="n">selected_idx</span>
            <span class="n">fid</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
            <span class="k">if</span> <span class="n">fid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_union_selected_ids</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_union_selected_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
            <span class="c1"># Update visual highlight</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setUnionSelection&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_union_selected_ids</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_union_selected_ids</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_union_geoman_features_by_ids</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_union_selected_ids</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_union_selected_ids</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_union_expected_geom_type</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;clearUnionSelection&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">pass</span>

        <span class="c1"># Store and register the interaction handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_union_click_callback</span> <span class="o">=</span> <span class="n">_union_click_handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_interaction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_union_click_callback</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;click&quot;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">disable_geoman_union_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable the simple &#39;union mode&#39; and unregister the click handler.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_union_click_callback&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">off_interaction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_union_click_callback</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;click&quot;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_union_mode_enabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_union_selected_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_union_expected_geom_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;clearUnionSelection&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1"># Event bridge from JS button to Python toggle</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_geoman_union_toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">enabled</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_geoman_union_mode</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_geoman_union_mode</span><span class="p">()</span>

    <span class="c1"># ---------------------------------------------------------------------</span>
    <span class="c1"># Geoman &quot;Split&quot; Mode (free implementation using GeoPandas/Shapely)</span>
    <span class="c1"># ---------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_split_geoman_features_by_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Split polygons and lines by a user-drawn line and replace originals with parts.</span>

<span class="sd">        Args:</span>
<span class="sd">            coordinates: List of [lng, lat] pairs defining the split LineString in EPSG:4326.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_GEOPANDAS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;GeoPandas is required for split operations.&quot;</span><span class="p">)</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">shape</span><span class="p">,</span> <span class="n">mapping</span><span class="p">,</span> <span class="n">LineString</span>  <span class="c1"># type: ignore</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">shapely.ops</span><span class="w"> </span><span class="kn">import</span> <span class="n">split</span> <span class="k">as</span> <span class="n">split_geom</span>  <span class="c1"># type: ignore</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">coordinates</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">splitter</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">new_features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">feat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">geom</span> <span class="o">=</span> <span class="n">shape</span><span class="p">(</span><span class="n">feat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">new_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">geom_type</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">geom_type</span>
            <span class="c1"># Only split polygons and lines</span>
            <span class="k">if</span> <span class="n">geom_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="s2">&quot;Polygon&quot;</span><span class="p">,</span>
                <span class="s2">&quot;MultiPolygon&quot;</span><span class="p">,</span>
                <span class="s2">&quot;LineString&quot;</span><span class="p">,</span>
                <span class="s2">&quot;MultiLineString&quot;</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">new_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">geom</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">splitter</span><span class="p">):</span>
                    <span class="n">new_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">split_geom</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">splitter</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># If splitting fails, keep original</span>
                <span class="n">new_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Collect pieces of same dimensionality as original</span>
            <span class="n">pieces</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;geoms&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">geom_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Polygon&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiPolygon&quot;</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">g</span><span class="o">.</span><span class="n">geom_type</span> <span class="o">==</span> <span class="s2">&quot;Polygon&quot;</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">is_empty</span> <span class="ow">and</span> <span class="n">g</span><span class="o">.</span><span class="n">area</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">pieces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">geom_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;LineString&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiLineString&quot;</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">g</span><span class="o">.</span><span class="n">geom_type</span> <span class="o">==</span> <span class="s2">&quot;LineString&quot;</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">is_empty</span> <span class="ow">and</span> <span class="n">g</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">pieces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">props</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">or</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">pieces</span><span class="p">:</span>
                    <span class="n">new_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span>
                            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">props</span><span class="p">),</span>
                            <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">mapping</span><span class="p">(</span><span class="n">part</span><span class="p">),</span>
                        <span class="p">}</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Not effectively split; keep original</span>
                <span class="n">new_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>

        <span class="c1"># Sync back to widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">new_features</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">enable_geoman_split_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable free split mode.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_GEOPANDAS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;GeoPandas is required for split mode.&quot;</span><span class="p">)</span>
        <span class="c1"># Turning on split mode; union off to avoid conflicts</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_geoman_union_mode</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_split_mode_enabled</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">disable_geoman_split_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Disable free split mode.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_split_mode_enabled</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_geoman_split_toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">enabled</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_geoman_split_mode</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_geoman_split_mode</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_geoman_split_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_split_mode_enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;coordinates&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># Basic validation of coordinate pairs</span>
        <span class="n">cleaned</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">lng</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">cleaned</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lng</span><span class="p">,</span> <span class="n">lat</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_split_geoman_features_by_line</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays the map in an IPython environment.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs (Any): Additional keyword arguments.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MAPLIBRE_OUTPUT&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">replace_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MAPTILER_REPLACE_KEY&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">replace_key</span><span class="o">=</span><span class="n">replace_key</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_patched_display</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays the map in an IPython environment with a patched display method.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs (Any): Additional keyword arguments.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sidebar_visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sidebar_visible&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">min_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;min_width&quot;</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
            <span class="n">max_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_width&quot;</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
            <span class="n">expanded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;expanded&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span> <span class="o">=</span> <span class="n">LayerManagerWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expanded</span><span class="o">=</span><span class="n">expanded</span><span class="p">)</span>
            <span class="n">container</span> <span class="o">=</span> <span class="n">Container</span><span class="p">(</span>
                <span class="n">host_map</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">sidebar_visible</span><span class="o">=</span><span class="n">sidebar_visible</span><span class="p">,</span>
                <span class="n">min_width</span><span class="o">=</span><span class="n">min_width</span><span class="p">,</span>
                <span class="n">max_width</span><span class="o">=</span><span class="n">max_width</span><span class="p">,</span>
                <span class="n">sidebar_content</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span><span class="p">],</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">container</span><span class="o">.</span><span class="n">sidebar_widgets</span><span class="p">[</span><span class="s2">&quot;Layers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="n">container</span>

        <span class="k">if</span> <span class="s2">&quot;google.colab&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">ipyvue</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">vue</span>

            <span class="n">display</span><span class="p">(</span><span class="n">vue</span><span class="o">.</span><span class="n">Html</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="p">[]),</span> <span class="n">container</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_layer_manager</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">expanded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;40px&quot;</span><span class="p">,</span>
        <span class="n">layer_icon</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mdi-layers&quot;</span><span class="p">,</span>
        <span class="n">close_icon</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mdi-close&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Layers&quot;</span><span class="p">,</span>
        <span class="n">background_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;#f5f5f5&quot;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span> <span class="o">=</span> <span class="n">LayerManagerWidget</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">expanded</span><span class="o">=</span><span class="n">expanded</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                <span class="n">layer_icon</span><span class="o">=</span><span class="n">layer_icon</span><span class="p">,</span>
                <span class="n">close_icon</span><span class="o">=</span><span class="n">close_icon</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                <span class="n">background_color</span><span class="o">=</span><span class="n">background_color</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_sidebar_content</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replaces all content in the sidebar (except the toggle button).</span>

<span class="sd">        Args:</span>
<span class="sd">            content (Union[widgets.VBox, List[widgets.Widget]]): The new content for the sidebar.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">set_sidebar_content</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_to_sidebar</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">widget</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span><span class="p">]],</span>
        <span class="n">add_header</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">widget_icon</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mdi-tools&quot;</span><span class="p">,</span>
        <span class="n">close_icon</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mdi-close&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;My Tools&quot;</span><span class="p">,</span>
        <span class="n">background_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;#f5f5f5&quot;</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;40px&quot;</span><span class="p">,</span>
        <span class="n">expanded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Appends a widget to the sidebar content.</span>

<span class="sd">        Args:</span>
<span class="sd">            widget (Optional[Union[widgets.Widget, List[widgets.Widget]]]): Initial widget(s) to display in the content box.</span>
<span class="sd">            widget_icon (str): Icon for the header. See https://pictogrammers.github.io/@mdi/font/2.0.46/ for available icons.</span>
<span class="sd">            close_icon (str): Icon for the close button. See https://pictogrammers.github.io/@mdi/font/2.0.46/ for available icons.</span>
<span class="sd">            background_color (str): Background color of the header. Defaults to &quot;#f5f5f5&quot;.</span>
<span class="sd">            label (str): Text label for the header. Defaults to &quot;My Tools&quot;.</span>
<span class="sd">            height (str): Height of the header. Defaults to &quot;40px&quot;.</span>
<span class="sd">            expanded (bool): Whether the panel is expanded by default. Defaults to True.</span>
<span class="sd">            **kwargs (Any): Additional keyword arguments for the parent class.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_container</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">sidebar_args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">add_to_sidebar</span><span class="p">(</span>
            <span class="n">widget</span><span class="p">,</span>
            <span class="n">add_header</span><span class="o">=</span><span class="n">add_header</span><span class="p">,</span>
            <span class="n">widget_icon</span><span class="o">=</span><span class="n">widget_icon</span><span class="p">,</span>
            <span class="n">close_icon</span><span class="o">=</span><span class="n">close_icon</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
            <span class="n">background_color</span><span class="o">=</span><span class="n">background_color</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
            <span class="n">expanded</span><span class="o">=</span><span class="n">expanded</span><span class="p">,</span>
            <span class="n">host_map</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_flatgeobuf_layer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">layer_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
        <span class="n">source_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">layout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bbox</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">promote_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">minzoom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">maxzoom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a vector layer from a FlatGeobuf dataset.</span>

<span class="sd">        The FlatGeobuf file is streamed in the browser and converted to GeoJSON</span>
<span class="sd">        before being added to the map. Rendering happens entirely client-side,</span>
<span class="sd">        so very large datasets may still impact browser performance.</span>

<span class="sd">        Args:</span>
<span class="sd">            url: URL pointing to the FlatGeobuf resource.</span>
<span class="sd">            layer_id: Unique identifier for the map layer.</span>
<span class="sd">            layer_type: MapLibre layer type (e.g., ``&#39;fill&#39;``, ``&#39;line&#39;``, ``&#39;circle&#39;``).</span>
<span class="sd">            source_id: Optional custom source identifier. Defaults to ``{layer_id}_source``.</span>
<span class="sd">            paint: Optional paint properties dictionary.</span>
<span class="sd">            layout: Optional layout properties dictionary.</span>
<span class="sd">            filter: Optional MapLibre expression used to filter features.</span>
<span class="sd">            bbox: Optional bounding box ``[minX, minY, maxX, maxY]`` used to limit</span>
<span class="sd">                features retrieved from the dataset.</span>
<span class="sd">            promote_id: Optional feature identifier promotion configuration.</span>
<span class="sd">            minzoom: Optional minimum zoom level for the layer.</span>
<span class="sd">            maxzoom: Optional maximum zoom level for the layer.</span>
<span class="sd">            before_id: Optional layer id to insert the new layer before.</span>
<span class="sd">            metadata: Optional metadata dictionary attached to the layer configuration.</span>
<span class="sd">            name: Optional friendly name used in the layer manager. Defaults to ``layer_id``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The identifier of the layer that was registered.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">source_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_source&quot;</span>

        <span class="n">layer_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">layer_type</span><span class="p">,</span>
            <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">paint</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paint</span>
        <span class="k">if</span> <span class="n">layout</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layout</span>
        <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span>
        <span class="k">if</span> <span class="n">promote_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;promoteId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">promote_id</span>
        <span class="k">if</span> <span class="n">minzoom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;minzoom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minzoom</span>
        <span class="k">if</span> <span class="n">maxzoom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;maxzoom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxzoom</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span>

        <span class="c1"># Track the layer locally so the layer manager can interact with it.</span>
        <span class="n">current_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="p">)</span>
        <span class="n">current_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span> <span class="o">=</span> <span class="n">current_layers</span>

        <span class="n">display_name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">layer_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="n">layer_config</span><span class="p">,</span>
            <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;flatgeobuf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">display_name</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>

        <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;layerId&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span>
            <span class="s2">&quot;sourceId&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
            <span class="s2">&quot;layerType&quot;</span><span class="p">:</span> <span class="n">layer_type</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">paint</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paint</span>
        <span class="k">if</span> <span class="n">layout</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layout</span>
        <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span>
        <span class="k">if</span> <span class="n">bbox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;bbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bbox</span>
        <span class="k">if</span> <span class="n">promote_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;promoteId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">promote_id</span>
        <span class="k">if</span> <span class="n">minzoom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;minzoom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minzoom</span>
        <span class="k">if</span> <span class="n">maxzoom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;maxzoom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxzoom</span>
        <span class="k">if</span> <span class="n">before_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;beforeId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">before_id</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">display_name</span>

        <span class="n">flatgeobuf_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flatgeobuf_layers</span><span class="p">)</span>
        <span class="n">flatgeobuf_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flatgeobuf_layers</span> <span class="o">=</span> <span class="n">flatgeobuf_layers</span>

        <span class="k">return</span> <span class="n">layer_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">enable_feature_popup</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">aliases</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">title_field</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_properties</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
        <span class="n">close_button</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">max_width</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;320px&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable attribute popups for a layer when users click its features.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Identifier of the target layer.</span>
<span class="sd">            fields: Optional ordered list of attribute keys to display. When omitted,</span>
<span class="sd">                up to ``max_properties`` properties are shown.</span>
<span class="sd">            aliases: Optional mapping from attribute key to display label. Only applies</span>
<span class="sd">                when ``fields`` is provided.</span>
<span class="sd">            title: Optional static string rendered above the attribute table.</span>
<span class="sd">            title_field: Optional property key whose value should be used as the popup</span>
<span class="sd">                title. Ignored when ``title`` is provided.</span>
<span class="sd">            max_properties: Maximum number of properties displayed when ``fields`` is</span>
<span class="sd">                not supplied. Defaults to 25.</span>
<span class="sd">            close_button: Whether the popup shows a close button. Defaults to True.</span>
<span class="sd">            max_width: CSS max-width applied to the popup container. Defaults to 320px.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">alias_lookup</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">aliases</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="n">field_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">field_config</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)}</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">field_config</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                    <span class="n">field_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">label_source</span> <span class="o">=</span> <span class="n">alias_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="n">name</span><span class="p">,</span> <span class="n">alias_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">field_config</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">field_name</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">label_source</span><span class="p">)}</span>
                    <span class="p">)</span>

        <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;layerId&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span>
            <span class="s2">&quot;maxProperties&quot;</span><span class="p">:</span> <span class="n">max_properties</span><span class="p">,</span>
            <span class="s2">&quot;closeButton&quot;</span><span class="p">:</span> <span class="n">close_button</span><span class="p">,</span>
            <span class="s2">&quot;maxWidth&quot;</span><span class="p">:</span> <span class="n">max_width</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">field_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_config</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span>
        <span class="k">if</span> <span class="n">title_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;titleField&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title_field</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;enableFeaturePopup&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">disable_feature_popup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable attribute popups for the specified layer.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Identifier of the target layer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;disableFeaturePopup&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;layerId&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_popup</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">prop</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">template</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">trigger</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;click&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a popup to a layer.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: The layer to which the popup is added.</span>
<span class="sd">            prop: The property of the source to be displayed. If None, all properties are displayed.</span>
<span class="sd">            template: A simple template with mustache-style variable interpolation. Only</span>
<span class="sd">                     `{{property_name}}` substitution is supported; sections, conditionals,</span>
<span class="sd">                     and iteration are not. Example: &quot;Name: {{name}}&lt;br&gt;Value: {{value}}&quot;</span>
<span class="sd">            trigger: Event that triggers the popup. Either &quot;click&quot; or &quot;hover&quot;. Defaults to &quot;click&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">trigger</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;hover&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;trigger must be either &#39;click&#39; or &#39;hover&#39;&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;layerId&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="n">trigger</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">template</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Use template for custom formatting</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;template&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">template</span>
        <span class="k">elif</span> <span class="n">prop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Show only specific property</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">prop</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">prop</span><span class="p">}]</span>
        <span class="c1"># If both are None, show all properties (default behavior)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;enableFeaturePopup&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_widget_control</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">widget</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Tools&quot;</span><span class="p">,</span>
        <span class="n">icon</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
        <span class="n">collapsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">panel_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>
        <span class="n">panel_min_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">220</span><span class="p">,</span>
        <span class="n">panel_max_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">420</span><span class="p">,</span>
        <span class="n">panel_max_height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">auto_panel_width</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">header_bg</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">header_text_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">control_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a collapsible widget control anchored to the map viewport.</span>

<span class="sd">        The control displays as a button alongside other MapLibre controls. Clicking</span>
<span class="sd">        the button expands a sidebar-style panel that renders the supplied</span>
<span class="sd">        ipywidget content.</span>

<span class="sd">        Args:</span>
<span class="sd">            widget: The ipywidget instance to embed inside the collapsible panel.</span>
<span class="sd">            label: Title shown at the top of the expanded panel.</span>
<span class="sd">            icon: Text or icon hint shown on the toggle button. Defaults to a vertical ellipsis.</span>
<span class="sd">            position: Map control corner (``&#39;top-left&#39;``, ``&#39;top-right&#39;``,</span>
<span class="sd">                ``&#39;bottom-left&#39;``, or ``&#39;bottom-right&#39;``).</span>
<span class="sd">            collapsed: Whether the panel starts collapsed.</span>
<span class="sd">            panel_width: Default panel width in pixels.</span>
<span class="sd">            panel_min_width: Minimum panel width in pixels when resized on the front-end.</span>
<span class="sd">            panel_max_width: Maximum panel width in pixels when resized on the front-end.</span>
<span class="sd">            panel_max_height: Maximum panel height. Can be an int (pixels) or a CSS string (e.g., &#39;70vh&#39;, &#39;500px&#39;).</span>
<span class="sd">                Defaults to None, which uses the JavaScript default of &#39;70vh&#39;.</span>
<span class="sd">            auto_panel_width: Whether the panel width should be automatically adjusted to the content width. Defaults to False.</span>
<span class="sd">            header_bg: The background color of the header, like &quot;linear-gradient(135deg,#444,#888)&quot;. Defaults to None.</span>
<span class="sd">            header_text_color: The text color of the header, like &quot;#fff&quot;. Defaults to None.</span>
<span class="sd">            control_id: Optional identifier used for duplicate detection and later removal.</span>
<span class="sd">                If omitted, a unique identifier is generated from the label.</span>
<span class="sd">            description: Optional tooltip description for the toggle button.</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: The unique identifier assigned to the widget control.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If ``widget`` is not an ipywidget instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;widget must be an ipywidgets.Widget instance&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">control_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">base_slug</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">char</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;-&quot;</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">label</span>
            <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">base_slug</span><span class="p">:</span>
                <span class="n">base_slug</span> <span class="o">=</span> <span class="s2">&quot;widget&quot;</span>
            <span class="n">control_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_slug</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Ensure uniqueness when callers supply their own identifier</span>
        <span class="k">if</span> <span class="n">control_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_widget_control_widgets</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Widget control &#39;</span><span class="si">{</span><span class="n">control_id</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span><span class="p">)</span>

        <span class="n">widget_id</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="s2">&quot;model_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">widget_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The supplied widget does not have a model_id. Ensure it is an ipywidget &quot;</span>
                <span class="s2">&quot;instance created within the current notebook session.&quot;</span>
            <span class="p">)</span>

        <span class="n">control_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">label</span><span class="p">,</span>
            <span class="s2">&quot;icon&quot;</span><span class="p">:</span> <span class="n">icon</span><span class="p">,</span>
            <span class="s2">&quot;collapsed&quot;</span><span class="p">:</span> <span class="n">collapsed</span><span class="p">,</span>
            <span class="s2">&quot;panelWidth&quot;</span><span class="p">:</span> <span class="n">panel_width</span><span class="p">,</span>
            <span class="s2">&quot;panelMinWidth&quot;</span><span class="p">:</span> <span class="n">panel_min_width</span><span class="p">,</span>
            <span class="s2">&quot;panelMaxWidth&quot;</span><span class="p">:</span> <span class="n">panel_max_width</span><span class="p">,</span>
            <span class="s2">&quot;autoWidth&quot;</span><span class="p">:</span> <span class="n">auto_panel_width</span><span class="p">,</span>
            <span class="s2">&quot;headerBg&quot;</span><span class="p">:</span> <span class="n">header_bg</span><span class="p">,</span>
            <span class="s2">&quot;headerTextColor&quot;</span><span class="p">:</span> <span class="n">header_text_color</span><span class="p">,</span>
            <span class="s2">&quot;control_id&quot;</span><span class="p">:</span> <span class="n">control_id</span><span class="p">,</span>
            <span class="s2">&quot;widget_model_id&quot;</span><span class="p">:</span> <span class="n">widget_id</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">panel_max_height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;maxHeight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">panel_max_height</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">panel_max_height</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
                <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">panel_max_height</span><span class="si">}</span><span class="s2">px&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">description</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span>

        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;widget_panel_</span><span class="si">{</span><span class="n">control_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;widget_panel&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_widget_control_widgets</span><span class="p">[</span><span class="n">control_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;widget_panel&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">control_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_widget_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a previously registered widget control.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">control_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;control_id is required&quot;</span><span class="p">)</span>

        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">target_key</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">current_controls</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;widget_panel&quot;</span>
                <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;control_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">control_id</span>
            <span class="p">):</span>
                <span class="n">target_key</span> <span class="o">=</span> <span class="n">key</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">target_key</span><span class="p">:</span>
            <span class="n">current_controls</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">target_key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="k">if</span> <span class="n">control_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_widget_control_widgets</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_widget_control_widgets</span><span class="p">[</span><span class="n">control_id</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeWidgetControl&quot;</span><span class="p">,</span> <span class="n">control_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_from_sidebar</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a widget from the sidebar content.</span>

<span class="sd">        Args:</span>
<span class="sd">            widget (widgets.Widget): The widget to remove from the sidebar.</span>
<span class="sd">            name (str): The name of the widget to remove from the sidebar.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">remove_from_sidebar</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_sidebar_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamically updates the sidebar&#39;s minimum and maximum width.</span>

<span class="sd">        Args:</span>
<span class="sd">            min_width (int, optional): New minimum width in pixels. If None, keep current.</span>
<span class="sd">            max_width (int, optional): New maximum width in pixels. If None, keep current.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_container</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">set_sidebar_width</span><span class="p">(</span><span class="n">min_width</span><span class="p">,</span> <span class="n">max_width</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sidebar_widgets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dictionary of widgets currently in the sidebar.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, widgets.Widget]: A dictionary where keys are the labels of the widgets and values are the widgets themselves.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">sidebar_widgets</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the map style.</span>

<span class="sd">        Args:</span>
<span class="sd">            style: Map style as URL string or style object dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">style</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setStyle&quot;</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_bearing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bearing</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the map bearing (rotation).</span>

<span class="sd">        Args:</span>
<span class="sd">            bearing: Map rotation in degrees (0-360).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">=</span> <span class="n">bearing</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_pitch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the map pitch (tilt).</span>

<span class="sd">        Args:</span>
<span class="sd">            pitch: Map tilt in degrees (0-60).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">pitch</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_layout_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a layout property for a layer.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Unique identifier of the layer.</span>
<span class="sd">            name: Name of the layout property to set.</span>
<span class="sd">            value: Value to set for the property.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setLayoutProperty&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_paint_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a paint property for a layer.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Unique identifier of the layer.</span>
<span class="sd">            name: Name of the paint property to set.</span>
<span class="sd">            value: Value to set for the property.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setPaintProperty&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the visibility of a layer.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Unique identifier of the layer.</span>
<span class="sd">            visible: Whether the layer should be visible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if this is a marker group</span>
        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">:</span>
            <span class="n">layer_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">layer_type</span> <span class="o">==</span> <span class="s2">&quot;marker-group&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">][</span><span class="s2">&quot;visible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">visible</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setMarkerGroupVisibility&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="n">visible</span><span class="p">:</span>
            <span class="n">visibility</span> <span class="o">=</span> <span class="s2">&quot;visible&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">visibility</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>

        <span class="k">if</span> <span class="n">layer_id</span> <span class="o">==</span> <span class="s2">&quot;Background&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_style_layers</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_layout_property</span><span class="p">(</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="s2">&quot;visibility&quot;</span><span class="p">,</span> <span class="n">visibility</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_layout_property</span><span class="p">(</span><span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;visibility&quot;</span><span class="p">,</span> <span class="n">visibility</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">][</span><span class="s2">&quot;visible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">visible</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">opacity</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the opacity of a layer.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Unique identifier of the layer.</span>
<span class="sd">            opacity: Opacity value between 0.0 (transparent) and 1.0 (opaque).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if this is a marker group</span>
        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">:</span>
            <span class="n">layer_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">layer_type</span> <span class="o">==</span> <span class="s2">&quot;marker-group&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">][</span><span class="s2">&quot;opacity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opacity</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setMarkerGroupOpacity&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>
                <span class="k">return</span>

        <span class="n">layer_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_layer_type</span><span class="p">(</span><span class="n">layer_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">layer_id</span> <span class="o">==</span> <span class="s2">&quot;Background&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_style_layers</span><span class="p">():</span>
                <span class="n">layer_type</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">layer_type</span> <span class="o">!=</span> <span class="s2">&quot;symbol&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_paint_property</span><span class="p">(</span>
                        <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_type</span><span class="si">}</span><span class="s2">-opacity&quot;</span><span class="p">,</span> <span class="n">opacity</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_paint_property</span><span class="p">(</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="s2">&quot;icon-opacity&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_paint_property</span><span class="p">(</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="s2">&quot;text-opacity&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">:</span>
            <span class="n">layer_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">][</span><span class="s2">&quot;layer&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
            <span class="n">prop_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_type</span><span class="si">}</span><span class="s2">-opacity&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">][</span><span class="s2">&quot;opacity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opacity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">style_dict</span><span class="p">:</span>
            <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">style_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span>
            <span class="n">layer_type</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
            <span class="n">prop_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_type</span><span class="si">}</span><span class="s2">-opacity&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;paint&quot;</span> <span class="ow">in</span> <span class="n">layer</span><span class="p">:</span>
                <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">][</span><span class="n">prop_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">opacity</span>

        <span class="k">if</span> <span class="n">layer_type</span> <span class="o">!=</span> <span class="s2">&quot;symbol&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_paint_property</span><span class="p">(</span><span class="n">layer_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_type</span><span class="si">}</span><span class="s2">-opacity&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_paint_property</span><span class="p">(</span><span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;icon-opacity&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_paint_property</span><span class="p">(</span><span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;text-opacity&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">projection</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the map projection.</span>

<span class="sd">        Args:</span>
<span class="sd">            projection: Projection configuration dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Store projection in persistent state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_projection</span> <span class="o">=</span> <span class="n">projection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setProjection&quot;</span><span class="p">,</span> <span class="n">projection</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_terrain</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://elevation-tiles-prod.s3.amazonaws.com/terrarium/</span><span class="si">{z}</span><span class="s2">/</span><span class="si">{x}</span><span class="s2">/</span><span class="si">{y}</span><span class="s2">.png&quot;</span><span class="p">,</span>
        <span class="n">exaggeration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">tile_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;terrarium&quot;</span><span class="p">,</span>
        <span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;terrain-dem&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add terrain visualization to the map.</span>

<span class="sd">        Args:</span>
<span class="sd">            source: URL template for terrain tiles. Defaults to AWS elevation tiles.</span>
<span class="sd">            exaggeration: Terrain exaggeration factor. Defaults to 1.0.</span>
<span class="sd">            tile_size: Tile size in pixels. Defaults to 256.</span>
<span class="sd">            encoding: Encoding for the terrain tiles. Defaults to &quot;terrarium&quot;.</span>
<span class="sd">            source_id: Unique identifier for the terrain source. Defaults to &quot;terrain-dem&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Add terrain source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span>
            <span class="n">source_id</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;raster-dem&quot;</span><span class="p">,</span>
                <span class="s2">&quot;tiles&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">source</span><span class="p">],</span>
                <span class="s2">&quot;tileSize&quot;</span><span class="p">:</span> <span class="n">tile_size</span><span class="p">,</span>
                <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="n">encoding</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

        <span class="c1"># Set terrain on the map</span>
        <span class="n">terrain_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span> <span class="s2">&quot;exaggeration&quot;</span><span class="p">:</span> <span class="n">exaggeration</span><span class="p">}</span>

        <span class="c1"># Store terrain configuration in persistent state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_terrain</span> <span class="o">=</span> <span class="n">terrain_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setTerrain&quot;</span><span class="p">,</span> <span class="n">terrain_config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_layer_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the type of a layer.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Unique identifier of the layer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Layer type string, or None if layer doesn&#39;t exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_layer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">layer</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">opacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">visible</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a layer to the map.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Unique identifier for the layer.</span>
<span class="sd">            layer_config: Layer configuration dictionary containing</span>
<span class="sd">                         properties like type, source, paint, and layout.</span>
<span class="sd">            before_id: Optional layer ID to insert this layer before.</span>
<span class="sd">                      If None, layer is added on top.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;minzoom&quot;</span> <span class="ow">in</span> <span class="n">layer</span><span class="p">:</span>
                <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;min-zoom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;minzoom&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;maxzoom&quot;</span> <span class="ow">in</span> <span class="n">layer</span><span class="p">:</span>
                <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;max-zoom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;maxzoom&quot;</span><span class="p">)</span>
            <span class="c1"># MapLibre expects hyphenated keys like &#39;source-layer&#39;, &#39;text-field&#39;, etc.</span>
            <span class="c1"># Convert any underscore_keys to hyphen-keys recursively for JS compatibility.</span>
            <span class="n">layer</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">replace_underscores_in_keys</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">layer_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">layer_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">layer_id</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_unique_name</span><span class="p">(</span>
                <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">overwrite</span>
            <span class="p">)</span>

        <span class="c1"># Store before_id in layer metadata for restoration when displaying in multiple cells</span>
        <span class="k">if</span> <span class="n">before_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;metadata&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="p">:</span>
                <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;beforeId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">before_id</span>

        <span class="c1"># Store layer in local state for persistence</span>
        <span class="n">current_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="p">)</span>
        <span class="n">current_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span> <span class="o">=</span> <span class="n">current_layers</span>

        <span class="c1"># Call JavaScript method with before_id if provided</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addLayer&quot;</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">before_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_visibility</span><span class="p">(</span><span class="n">layer_id</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_opacity</span><span class="p">(</span><span class="n">layer_id</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="n">layer</span><span class="p">,</span>
            <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="n">opacity</span><span class="p">,</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">visible</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
            <span class="c1"># &quot;color&quot;: color,</span>
        <span class="p">}</span>

        <span class="c1"># Update the _layer_dict trait to trigger JavaScript sync</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layer_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

        <span class="c1"># Update layer controls if they exist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">source_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a data source to the map.</span>

<span class="sd">        This method adds a data source and tracks it in the source_dict attribute</span>
<span class="sd">        for easy reference. The source can then be used by layers.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_id: Unique identifier for the data source.</span>
<span class="sd">            source_config: Dictionary containing source configuration.</span>
<span class="sd">                          Must include a &#39;type&#39; field (e.g., &#39;geojson&#39;, &#39;vector&#39;, &#39;raster&#39;).</span>
<span class="sd">                          Additional fields depend on the source type.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; m = MapLibreMap()</span>
<span class="sd">            &gt;&gt;&gt; m.add_source(&#39;my-source&#39;, {</span>
<span class="sd">            ...     &#39;type&#39;: &#39;geojson&#39;,</span>
<span class="sd">            ...     &#39;data&#39;: {</span>
<span class="sd">            ...         &#39;type&#39;: &#39;Feature&#39;,</span>
<span class="sd">            ...         &#39;geometry&#39;: {&#39;type&#39;: &#39;Point&#39;, &#39;coordinates&#39;: [0, 0]}</span>
<span class="sd">            ...     }</span>
<span class="sd">            ... })</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Store source in source_dict for local tracking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_dict</span><span class="p">[</span><span class="n">source_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">source_config</span>

        <span class="c1"># Call parent class method to handle JavaScript synchronization</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">source_id</span><span class="p">,</span> <span class="n">source_config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_geojson_layer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">geojson_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">layer_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
        <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a GeoJSON layer to the map.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Unique identifier for the layer.</span>
<span class="sd">            geojson_data: GeoJSON data as a dictionary.</span>
<span class="sd">            layer_type: Type of layer (e.g., &#39;fill&#39;, &#39;line&#39;, &#39;circle&#39;, &#39;symbol&#39;).</span>
<span class="sd">            paint: Optional paint properties for styling the layer.</span>
<span class="sd">            before_id: Optional layer ID to insert this layer before.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_source&quot;</span>

        <span class="c1"># Add source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">source_id</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;geojson&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">geojson_data</span><span class="p">})</span>

        <span class="c1"># Add layer</span>
        <span class="n">layer_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">layer_type</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">paint</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paint</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="o">=</span><span class="n">layer_config</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span> <span class="n">layer_id</span><span class="o">=</span><span class="n">layer_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_marker</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">lng</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">lat</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">popup</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a marker to the map.</span>

<span class="sd">        Args:</span>
<span class="sd">            lng: Longitude coordinate for the marker.</span>
<span class="sd">            lat: Latitude coordinate for the marker.</span>
<span class="sd">            popup: Optional popup HTML to display when marker is clicked.</span>
<span class="sd">                Supports HTML content including images.</span>
<span class="sd">            tooltip: Optional tooltip HTML to display when hovering over marker.</span>
<span class="sd">                Supports HTML content including images.</span>
<span class="sd">            options: Optional marker options forwarded to MapLibre GL JS.</span>
<span class="sd">                This supports properties like color, draggable, and opacity.</span>
<span class="sd">            scale: Scale factor for marker size (default: 1.0, range: 0.1 to 3.0).</span>
<span class="sd">                For example, 0.5 makes the marker half size, 2.0 makes it double size.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">marker_options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="k">if</span> <span class="n">options</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s2">&quot;scale&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">marker_options</span><span class="p">:</span>
            <span class="n">marker_options</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span>

        <span class="n">marker_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">lng</span><span class="p">,</span> <span class="n">lat</span><span class="p">],</span>
            <span class="s2">&quot;popup&quot;</span><span class="p">:</span> <span class="n">popup</span><span class="p">,</span>
            <span class="s2">&quot;tooltip&quot;</span><span class="p">:</span> <span class="n">tooltip</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">marker_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addMarker&quot;</span><span class="p">,</span> <span class="n">marker_data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_marker_group</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">markers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a group of markers as a controllable layer.</span>

<span class="sd">        This method adds multiple markers as a single layer that can be controlled</span>
<span class="sd">        through the layer control panel. All markers in the group share the same</span>
<span class="sd">        visibility and opacity settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Unique identifier for the marker group layer.</span>
<span class="sd">            markers: List of marker definitions. Each marker should be a dictionary with:</span>
<span class="sd">                - lng (float): Longitude coordinate</span>
<span class="sd">                - lat (float): Latitude coordinate</span>
<span class="sd">                - popup (str, optional): Popup HTML content</span>
<span class="sd">                - tooltip (str, optional): Tooltip HTML content</span>
<span class="sd">                - options (dict, optional): Marker options (color, draggable, etc.)</span>
<span class="sd">                - scale (float, optional): Marker scale factor (default: 1.0)</span>
<span class="sd">            name: Display name for the layer in the layer control.</span>
<span class="sd">                If None, uses layer_id.</span>
<span class="sd">            visible: Whether the marker group should be visible initially.</span>
<span class="sd">            opacity: Initial opacity for all markers in the group (0.0 to 1.0).</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; m = MapLibreMap()</span>
<span class="sd">            &gt;&gt;&gt; markers = [</span>
<span class="sd">            ...     {&quot;lng&quot;: -122.4, &quot;lat&quot;: 37.8, &quot;popup&quot;: &quot;San Francisco&quot;},</span>
<span class="sd">            ...     {&quot;lng&quot;: -118.2, &quot;lat&quot;: 34.0, &quot;popup&quot;: &quot;Los Angeles&quot;},</span>
<span class="sd">            ...     {&quot;lng&quot;: -122.3, &quot;lat&quot;: 47.6, &quot;popup&quot;: &quot;Seattle&quot;}</span>
<span class="sd">            ... ]</span>
<span class="sd">            &gt;&gt;&gt; m.add_marker_group(&quot;cities&quot;, markers, name=&quot;West Coast Cities&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">display_name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="n">layer_id</span>

        <span class="c1"># Validate markers</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">markers</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;lng&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">marker</span> <span class="ow">or</span> <span class="s2">&quot;lat&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">marker</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Marker at index </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> missing required &#39;lng&#39; or &#39;lat&#39; coordinate&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Store in layer_dict for layer control integration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;marker-group&quot;</span><span class="p">},</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">visible</span><span class="p">,</span>
            <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="n">opacity</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">display_name</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;marker-group&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Update layer controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>

        <span class="c1"># Send to JavaScript</span>
        <span class="n">marker_group_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;layerId&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span>
            <span class="s2">&quot;markers&quot;</span><span class="p">:</span> <span class="n">markers</span><span class="p">,</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">visible</span><span class="p">,</span>
            <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="n">opacity</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addMarkerGroup&quot;</span><span class="p">,</span> <span class="n">marker_group_data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bounds</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span> <span class="n">padding</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit the map to given bounds.</span>

<span class="sd">        Args:</span>
<span class="sd">            bounds: Bounding box as [[south, west], [north, east]].</span>
<span class="sd">            padding: Padding around the bounds in pixels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;fitBounds&quot;</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;padding&quot;</span><span class="p">:</span> <span class="n">padding</span><span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_geojson</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">],</span>
        <span class="n">layer_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fit_bounds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">source_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a GeoJSON layer to the map.</span>

<span class="sd">        This method adds a GeoJSON layer to the map. The GeoJSON data can be a</span>
<span class="sd">        URL to a GeoJSON file or a GeoJSON dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: The GeoJSON data. This can be a URL to a GeoJSON file or a</span>
<span class="sd">                GeoJSON dictionary.</span>
<span class="sd">            layer_type: The type of the layer. It can be one of the following:</span>
<span class="sd">                &#39;circle&#39;, &#39;fill&#39;, &#39;fill-extrusion&#39;, &#39;line&#39;, &#39;symbol&#39;. If None,</span>
<span class="sd">                the type is inferred from the GeoJSON data.</span>
<span class="sd">            filter: The filter to apply to the layer. If None, no filter is applied.</span>
<span class="sd">            paint: The paint properties to apply to the layer. If None, default</span>
<span class="sd">                paint properties are applied based on geometry type.</span>
<span class="sd">            name: The name of the layer. If None, &#39;GeoJSON&#39; is used.</span>
<span class="sd">            fit_bounds: Whether to adjust the viewport of the map to fit the</span>
<span class="sd">                bounds of the GeoJSON data. Defaults to True.</span>
<span class="sd">            visible: Whether the layer is visible or not. Defaults to True.</span>
<span class="sd">            opacity: The opacity of the layer. Defaults to 1.0.</span>
<span class="sd">            before_id: The ID of an existing layer before which the new layer</span>
<span class="sd">                should be inserted.</span>
<span class="sd">            source_args: Additional keyword arguments that are passed to the</span>
<span class="sd">                GeoJSON source.</span>
<span class="sd">            **kwargs: Additional keyword arguments that are passed to the layer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>

        <span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">geom_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">source_args</span> <span class="o">=</span> <span class="n">source_args</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="c1"># Load data from file or URL if necessary</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">):</span>
                <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">__geo_interface__</span>
                <span class="k">if</span> <span class="n">fit_bounds</span><span class="p">:</span>
                    <span class="n">bounds</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">total_bounds</span>  <span class="c1"># [minx, miny, maxx, maxy]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;The data must be a URL, file path, or GeoJSON dictionary.&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fit_bounds</span><span class="p">:</span>
                <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">bounds</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">total_bounds</span>  <span class="c1"># [minx, miny, maxx, maxy]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The data must be a URL, file path, or GeoJSON dictionary.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Generate layer name if not provided</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;GeoJSON&quot;</span>

        <span class="c1"># Infer geometry type and set default paint if not provided</span>
        <span class="k">if</span> <span class="n">paint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;features&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">geom_type</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;geometry&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;geometry&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">geom_type</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">geom_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Point&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiPoint&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">layer_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">layer_type</span> <span class="o">=</span> <span class="s2">&quot;circle&quot;</span>
                <span class="n">paint</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;circle-radius&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                    <span class="s2">&quot;circle-color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3388ff&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;circle-stroke-color&quot;</span><span class="p">:</span> <span class="s2">&quot;#ffffff&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;circle-stroke-width&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">geom_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;LineString&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiLineString&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">layer_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">layer_type</span> <span class="o">=</span> <span class="s2">&quot;line&quot;</span>
                <span class="n">paint</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;line-color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3388ff&quot;</span><span class="p">,</span> <span class="s2">&quot;line-width&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
            <span class="k">elif</span> <span class="n">geom_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Polygon&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiPolygon&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">layer_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">layer_type</span> <span class="o">=</span> <span class="s2">&quot;fill&quot;</span>
                <span class="n">paint</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;fill-color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3388ff&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;fill-opacity&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
                <span class="p">}</span>

        <span class="c1"># Add source</span>
        <span class="n">source_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_source&quot;</span>
        <span class="n">source_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;geojson&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">}</span>
        <span class="n">source_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">source_args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">source_id</span><span class="p">,</span> <span class="n">source_config</span><span class="p">)</span>

        <span class="c1"># Prepare layer configuration</span>
        <span class="n">layer_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">layer_type</span> <span class="ow">or</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
            <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span>

        <span class="k">if</span> <span class="n">paint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paint</span>

        <span class="n">layer_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Add layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="o">=</span><span class="n">layer_config</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span> <span class="n">layer_id</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Set visibility</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">visible</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_visibility</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Set opacity</span>
        <span class="k">if</span> <span class="n">opacity</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_opacity</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>

        <span class="c1"># Fit bounds if requested</span>
        <span class="k">if</span> <span class="n">fit_bounds</span> <span class="ow">and</span> <span class="n">bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Convert from [minx, miny, maxx, maxy] to [[west, south], [east, north]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_bounds</span><span class="p">([[</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]]])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_vector</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;gpd.GeoDataFrame&quot;</span><span class="p">],</span>
        <span class="n">layer_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fit_bounds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">source_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a vector layer to the map.</span>

<span class="sd">        This method adds a vector layer to the map. The vector data can be a</span>
<span class="sd">        URL or local file path to a vector file (e.g., shapefile, GeoJSON,</span>
<span class="sd">        GeoPackage) or a GeoDataFrame.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: The vector data. This can be a URL, local file path to a</span>
<span class="sd">                vector file, or a GeoDataFrame.</span>
<span class="sd">            layer_type: The type of the layer. If None, the type is inferred</span>
<span class="sd">                from the GeoJSON data.</span>
<span class="sd">            filter: The filter to apply to the layer. If None, no filter is applied.</span>
<span class="sd">            paint: The paint properties to apply to the layer. If None, default</span>
<span class="sd">                paint properties are applied.</span>
<span class="sd">            name: The name of the layer. If None, a default name is generated.</span>
<span class="sd">            fit_bounds: Whether to adjust the viewport of the map to fit the</span>
<span class="sd">                bounds of the data. Defaults to True.</span>
<span class="sd">            visible: Whether the layer is visible or not. Defaults to True.</span>
<span class="sd">            opacity: The opacity of the layer. Defaults to 1.0.</span>
<span class="sd">            before_id: The ID of an existing layer before which the new layer</span>
<span class="sd">                should be inserted.</span>
<span class="sd">            source_args: Additional keyword arguments that are passed to the</span>
<span class="sd">                GeoJSON source.</span>
<span class="sd">            **kwargs: Additional keyword arguments that are passed to the layer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.parquet&quot;</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">__geo_interface__</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">__geo_interface__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">__geo_interface__</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_geojson</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">layer_type</span><span class="o">=</span><span class="n">layer_type</span><span class="p">,</span>
            <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
            <span class="n">paint</span><span class="o">=</span><span class="n">paint</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">fit_bounds</span><span class="o">=</span><span class="n">fit_bounds</span><span class="p">,</span>
            <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span>
            <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
            <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span>
            <span class="n">source_args</span><span class="o">=</span><span class="n">source_args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_raster</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source</span><span class="p">,</span>
        <span class="n">indexes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">colormap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nodata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Raster&quot;</span><span class="p">,</span>
        <span class="n">before_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fit_bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">array_args</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">client_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cors_all&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a local raster dataset to the map.</span>
<span class="sd">            If you are using this function in JupyterHub on a remote server</span>
<span class="sd">            (e.g., Binder, Microsoft Planetary Computer) and if the raster</span>
<span class="sd">            does not render properly, try installing jupyter-server-proxy using</span>
<span class="sd">            `pip install jupyter-server-proxy`, then running the following code</span>
<span class="sd">            before calling this function. For more info, see https://bit.ly/3JbmF93.</span>

<span class="sd">            import os</span>
<span class="sd">            os.environ[&#39;LOCALTILESERVER_CLIENT_PREFIX&#39;] = &#39;proxy/{port}&#39;</span>

<span class="sd">        Args:</span>
<span class="sd">            source (str): The path to the GeoTIFF file or the URL of the Cloud</span>
<span class="sd">                Optimized GeoTIFF.</span>
<span class="sd">            indexes (int, optional): The band(s) to use. Band indexing starts</span>
<span class="sd">                at 1. Defaults to None.</span>
<span class="sd">            colormap (str, optional): The name of the colormap from `matplotlib`</span>
<span class="sd">                to use when plotting a single band.</span>
<span class="sd">                See https://matplotlib.org/stable/gallery/color/colormap_reference.html.</span>
<span class="sd">                Default is greyscale.</span>
<span class="sd">            vmin (float, optional): The minimum value to use when colormapping</span>
<span class="sd">                the palette when plotting a single band. Defaults to None.</span>
<span class="sd">            vmax (float, optional): The maximum value to use when colormapping</span>
<span class="sd">                the palette when plotting a single band. Defaults to None.</span>
<span class="sd">            nodata (float, optional): The value from the band to use to interpret</span>
<span class="sd">                as not valid data. Defaults to None.</span>
<span class="sd">            name (str, optional): The layer name to use. Defaults to &#39;Raster&#39;.</span>
<span class="sd">            before_id (str, optional): The layer id to insert the layer before. Defaults to None.</span>
<span class="sd">            fit_bounds (bool, optional): Whether to zoom to the extent of the</span>
<span class="sd">                layer. Defaults to True.</span>
<span class="sd">            visible (bool, optional): Whether the layer is visible. Defaults to True.</span>
<span class="sd">            opacity (float, optional): The opacity of the layer. Defaults to 1.0.</span>
<span class="sd">            array_args (dict, optional): Additional arguments to pass to</span>
<span class="sd">                `array_to_memory_file` when reading the raster. Defaults to {}.</span>
<span class="sd">            client_args (dict, optional): Additional arguments to pass to</span>
<span class="sd">                localtileserver.TileClient. Defaults to { &quot;cors_all&quot;: False }.</span>
<span class="sd">            overwrite (bool, optional): Whether to overwrite an existing layer with the same name.</span>
<span class="sd">                Defaults to True.</span>
<span class="sd">            **kwargs: Additional keyword arguments to be passed to the underlying</span>
<span class="sd">                `add_tile_layer` method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>

        <span class="k">if</span> <span class="s2">&quot;zoom_to_layer&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">fit_bounds</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;zoom_to_layer&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;layer_name&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;layer_name&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">):</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">array_to_image</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="o">**</span><span class="n">array_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;colormap_name&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">colormap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;colormap_name&quot;</span><span class="p">)</span>

        <span class="n">url</span><span class="p">,</span> <span class="n">tile_client</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_local_tile_url</span><span class="p">(</span>
            <span class="n">source</span><span class="p">,</span>
            <span class="n">indexes</span><span class="o">=</span><span class="n">indexes</span><span class="p">,</span>
            <span class="n">colormap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span>
            <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
            <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
            <span class="n">nodata</span><span class="o">=</span><span class="n">nodata</span><span class="p">,</span>
            <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
            <span class="n">client_args</span><span class="o">=</span><span class="n">client_args</span><span class="p">,</span>
            <span class="n">return_client</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_tile_layer</span><span class="p">(</span>
            <span class="n">layer_id</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">source_url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
            <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span>
            <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">bounds</span> <span class="o">=</span> <span class="n">tile_client</span><span class="o">.</span><span class="n">bounds</span><span class="p">()</span>  <span class="c1"># [ymin, ymax, xmin, xmax]</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
        <span class="c1"># [minx, miny, maxx, maxy]</span>
        <span class="k">if</span> <span class="n">fit_bounds</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_bounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_tile_layer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">source_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">attribution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">opacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">visible</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">minzoom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">maxzoom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">layout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a raster tile layer to the map.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Unique identifier for the layer.</span>
<span class="sd">            source_url: URL template for the tile source (e.g., &#39;https://example.com/{z}/{x}/{y}.png&#39;).</span>
<span class="sd">            attribution: Optional attribution text for the tile source.</span>
<span class="sd">            opacity: Layer opacity between 0.0 and 1.0.</span>
<span class="sd">            visible: Whether the layer should be visible initially.</span>
<span class="sd">            minzoom: Minimum zoom level for the layer.</span>
<span class="sd">            maxzoom: Maximum zoom level for the layer.</span>
<span class="sd">            paint: Optional paint properties for the layer.</span>
<span class="sd">            layout: Optional layout properties for the layer.</span>
<span class="sd">            before_id: Optional layer ID to insert this layer before.</span>
<span class="sd">            **kwargs: Additional source configuration options.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_source&quot;</span>

        <span class="c1"># Build source configuration</span>
        <span class="n">source_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;raster&quot;</span><span class="p">,</span> <span class="s2">&quot;tiles&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">source_url</span><span class="p">],</span> <span class="s2">&quot;tileSize&quot;</span><span class="p">:</span> <span class="mi">256</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">attribution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source_config</span><span class="p">[</span><span class="s2">&quot;attribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attribution</span>

        <span class="c1"># Add any additional source options from kwargs</span>
        <span class="n">source_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Add raster source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">source_id</span><span class="p">,</span> <span class="n">source_config</span><span class="p">)</span>

        <span class="c1"># Add raster layer</span>
        <span class="n">layer_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;raster&quot;</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">}</span>

        <span class="c1"># Add minzoom/maxzoom if specified</span>
        <span class="k">if</span> <span class="n">minzoom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;minzoom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minzoom</span>
        <span class="k">if</span> <span class="n">maxzoom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;maxzoom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxzoom</span>

        <span class="k">if</span> <span class="n">paint</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paint</span>
        <span class="k">if</span> <span class="n">layout</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layout</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span>
            <span class="n">layer</span><span class="o">=</span><span class="n">layer_config</span><span class="p">,</span>
            <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span>
            <span class="n">layer_id</span><span class="o">=</span><span class="n">layer_id</span><span class="p">,</span>
            <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
            <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_vector_layer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">source_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">source_layer</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">layer_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
        <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">layout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a vector tile layer to the map.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Unique identifier for the layer.</span>
<span class="sd">            source_url: URL for the vector tile source.</span>
<span class="sd">            source_layer: Name of the source layer within the vector tiles.</span>
<span class="sd">            layer_type: Type of layer (e.g., &#39;fill&#39;, &#39;line&#39;, &#39;circle&#39;, &#39;symbol&#39;).</span>
<span class="sd">            paint: Optional paint properties for styling the layer.</span>
<span class="sd">            layout: Optional layout properties for the layer.</span>
<span class="sd">            before_id: Optional layer ID to insert this layer before.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_source&quot;</span>

        <span class="c1"># Add vector source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">source_id</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;vector&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">source_url</span><span class="p">})</span>

        <span class="c1"># Add vector layer</span>
        <span class="n">layer_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">layer_type</span><span class="p">,</span>
            <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
            <span class="s2">&quot;source-layer&quot;</span><span class="p">:</span> <span class="n">source_layer</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">paint</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paint</span>
        <span class="k">if</span> <span class="n">layout</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layout</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="o">=</span><span class="n">layer_config</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span> <span class="n">layer_id</span><span class="o">=</span><span class="n">layer_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_image_layer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">image_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">coordinates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
        <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an image layer to the map.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Unique identifier for the layer.</span>
<span class="sd">            image_url: URL of the image to display.</span>
<span class="sd">            coordinates: Corner coordinates of the image as [[top-left], [top-right], [bottom-right], [bottom-left]].</span>
<span class="sd">                        Each coordinate should be [longitude, latitude].</span>
<span class="sd">            paint: Optional paint properties for the image layer.</span>
<span class="sd">            before_id: Optional layer ID to insert this layer before.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_source&quot;</span>

        <span class="c1"># Add image source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span>
            <span class="n">source_id</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">image_url</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="n">coordinates</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Add raster layer for the image</span>
        <span class="n">layer_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;raster&quot;</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">paint</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paint</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="o">=</span><span class="n">layer_config</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span> <span class="n">layer_id</span><span class="o">=</span><span class="n">layer_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_control</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">control_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a control to the map.</span>

<span class="sd">        Args:</span>
<span class="sd">            control_type: Type of control (&#39;navigation&#39;, &#39;scale&#39;, &#39;fullscreen&#39;, &#39;geolocate&#39;, &#39;attribution&#39;, &#39;globe&#39;)</span>
<span class="sd">            position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">            options: Additional options for the control</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">control_options</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>

        <span class="c1"># Store control in persistent state</span>
        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">control_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">control_type</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="n">control_type</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_html</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">html</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">bg_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bottom-right&quot;</span><span class="p">,</span>
        <span class="n">control_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an HTML element to the map.</span>

<span class="sd">        Args:</span>
<span class="sd">            html: HTML string to display</span>
<span class="sd">            bg_color: Background color for the HTML container (default: &#39;white&#39;)</span>
<span class="sd">            position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">            control_id: Optional unique identifier for the control. If not provided, one will be generated.</span>
<span class="sd">            **kwargs: Additional options passed to the control</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Generate control_id if not provided</span>
        <span class="k">if</span> <span class="n">control_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">control_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;html_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Check if control already exists and remove it first</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;html_</span><span class="si">{</span><span class="n">control_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">control_key</span> <span class="ow">in</span> <span class="n">current_controls</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_html</span><span class="p">(</span><span class="n">control_id</span><span class="p">)</span>
            <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>

        <span class="n">control_options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="n">html</span><span class="p">,</span>
                <span class="s2">&quot;bgColor&quot;</span><span class="p">:</span> <span class="n">bg_color</span><span class="p">,</span>
                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
                <span class="s2">&quot;control_id&quot;</span><span class="p">:</span> <span class="n">control_id</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Store control in persistent state</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_html</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">control_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">html</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">bg_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update an existing HTML control.</span>

<span class="sd">        Args:</span>
<span class="sd">            control_id: The control ID used when adding the HTML control</span>
<span class="sd">            html: New HTML string to display</span>
<span class="sd">            bg_color: Optional new background color for the HTML container</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Update persistent state</span>
        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;html_</span><span class="si">{</span><span class="n">control_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">control_key</span> <span class="ow">in</span> <span class="n">current_controls</span><span class="p">:</span>
            <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">][</span><span class="s2">&quot;options&quot;</span><span class="p">][</span><span class="s2">&quot;html&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">html</span>
            <span class="k">if</span> <span class="n">bg_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">][</span><span class="s2">&quot;options&quot;</span><span class="p">][</span><span class="s2">&quot;bgColor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bg_color</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;updateHTML&quot;</span><span class="p">,</span> <span class="n">control_key</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">bg_color</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_html</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">control_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove an HTML control from the map.</span>

<span class="sd">        Args:</span>
<span class="sd">            control_id: The control ID used when adding the HTML control</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Remove from persistent state</span>
        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;html_</span><span class="si">{</span><span class="n">control_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">control_key</span> <span class="ow">in</span> <span class="n">current_controls</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeHTML&quot;</span><span class="p">,</span> <span class="n">control_key</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_control</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">control_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a control from the map.</span>

<span class="sd">        Args:</span>
<span class="sd">            control_type: Type of control to remove (&#39;navigation&#39;, &#39;scale&#39;, &#39;fullscreen&#39;, &#39;geolocate&#39;, &#39;attribution&#39;, &#39;globe&#39;)</span>
<span class="sd">            position: Position where the control was added (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Remove control from persistent state</span>
        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">control_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">control_key</span> <span class="ow">in</span> <span class="n">current_controls</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeControl&quot;</span><span class="p">,</span> <span class="n">control_type</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_layer_control</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
        <span class="n">collapsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">layers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a collapsible layer control panel to the map.</span>

<span class="sd">        The layer control is a collapsible panel that allows users to toggle</span>
<span class="sd">        visibility and adjust opacity of map layers. It displays as an icon</span>
<span class="sd">        similar to other controls, and expands when clicked.</span>

<span class="sd">        Args:</span>
<span class="sd">            position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">            collapsed: Whether the control starts collapsed</span>
<span class="sd">            layers: List of layer IDs to include. If None, includes all layers</span>
<span class="sd">            options: Additional options for the control</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">control_options</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
                <span class="s2">&quot;collapsed&quot;</span><span class="p">:</span> <span class="n">collapsed</span><span class="p">,</span>
                <span class="s2">&quot;layers&quot;</span><span class="p">:</span> <span class="n">layers</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Get current layer states for initialization</span>
        <span class="n">layer_states</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">target_layers</span> <span class="o">=</span> <span class="n">layers</span> <span class="k">if</span> <span class="n">layers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Always include Background layer for controlling map style layers</span>
        <span class="k">if</span> <span class="n">layers</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s2">&quot;Background&quot;</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
            <span class="n">layer_states</span><span class="p">[</span><span class="s2">&quot;Background&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Background&quot;</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">for</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="n">target_layers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span> <span class="ow">and</span> <span class="n">layer_id</span> <span class="o">!=</span> <span class="s2">&quot;Background&quot;</span><span class="p">:</span>
                <span class="n">layer_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span>
                <span class="n">layer_states</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">layer_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;visible&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                    <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="n">layer_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span>  <span class="c1"># Use layer_id as display name by default</span>
                <span class="p">}</span>

        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;layerStates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_states</span>

        <span class="c1"># Store control in persistent state</span>
        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;layer_control_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;layer_control&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;layer_control&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_geocoder_control</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
        <span class="n">api_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">collapsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a geocoder control to the map for searching locations.</span>

<span class="sd">        The geocoder control allows users to search for locations using a geocoding service.</span>
<span class="sd">        By default, it uses the Nominatim (OpenStreetMap) geocoding API.</span>

<span class="sd">        Args:</span>
<span class="sd">            position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">            api_config: Configuration for the geocoding API. If None, uses default Nominatim config</span>
<span class="sd">            options: Additional options for the geocoder control</span>
<span class="sd">            collapsed: If True, shows only search icon initially. Click to expand input box.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">api_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Default configuration using Nominatim API</span>
            <span class="n">api_config</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;forwardGeocode&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;reverseGeocode&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;placeholder&quot;</span><span class="p">:</span> <span class="s2">&quot;Search for places...&quot;</span><span class="p">,</span>
                <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                <span class="s2">&quot;api_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://nominatim.openstreetmap.org/search&quot;</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="n">control_options</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
                <span class="s2">&quot;api_config&quot;</span><span class="p">:</span> <span class="n">api_config</span><span class="p">,</span>
                <span class="s2">&quot;collapsed&quot;</span><span class="p">:</span> <span class="n">collapsed</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Store control in persistent state</span>
        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;geocoder_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;geocoder&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;geocoder&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_maplibre_geocoder</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
        <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">maplibre_api</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;maptiler&quot;</span><span class="p">,</span>
        <span class="n">language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">placeholder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Search&quot;</span><span class="p">,</span>
        <span class="n">proximity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bbox</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">country</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">marker</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">show_result_markers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">collapsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">clear_on_blur</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">clear_and_blur_on_esc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">enable_event_logging</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">min_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add MapLibre GL Geocoder control to the map.</span>

<span class="sd">        The MapLibre GL Geocoder is a geocoder control for MapLibre GL that supports</span>
<span class="sd">        various geocoding APIs including Maptiler, Mapbox, and others. It provides a</span>
<span class="sd">        search interface for finding locations and can display markers for search results.</span>

<span class="sd">        See: https://github.com/maplibre/maplibre-gl-geocoder</span>

<span class="sd">        Args:</span>
<span class="sd">            position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">            api_key: API key for the geocoding service (required for most services)</span>
<span class="sd">            maplibre_api: Geocoding API to use (&#39;maptiler&#39;, &#39;mapbox&#39;, or custom)</span>
<span class="sd">            language: Language code for results (e.g., &#39;en&#39;, &#39;es&#39;, &#39;fr&#39;)</span>
<span class="sd">            placeholder: Placeholder text in the search input</span>
<span class="sd">            proximity: [lng, lat] to bias results towards this location</span>
<span class="sd">            bbox: [minLng, minLat, maxLng, maxLat] to limit results to this bounding box</span>
<span class="sd">            country: Country code(s) to limit results (e.g., &#39;us&#39; or &#39;us,ca&#39;)</span>
<span class="sd">            types: Comma-separated types to filter results (e.g., &#39;country,region,place&#39;)</span>
<span class="sd">            limit: Maximum number of results to return</span>
<span class="sd">            marker: Whether to add a marker at the geocoded location</span>
<span class="sd">            show_result_markers: Whether to show markers for all search results</span>
<span class="sd">            collapsed: Whether the control should start collapsed</span>
<span class="sd">            clear_on_blur: Clear the input when it loses focus</span>
<span class="sd">            clear_and_blur_on_esc: Clear input and remove focus when ESC is pressed</span>
<span class="sd">            enable_event_logging: Enable console logging of geocoder events</span>
<span class="sd">            min_length: Minimum number of characters to trigger search</span>
<span class="sd">            options: Additional options passed to the MaplibreGeocoder constructor</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            m = MapLibreMap(center=[-87.61694, 41.86625], zoom=10)</span>
<span class="sd">            m.add_maplibre_geocoder(</span>
<span class="sd">                position=&quot;top-left&quot;,</span>
<span class="sd">                api_key=&quot;your_api_key&quot;,</span>
<span class="sd">                maplibre_api=&quot;maptiler&quot;,</span>
<span class="sd">                language=&quot;en&quot;,</span>
<span class="sd">                country=&quot;us&quot;</span>
<span class="sd">            )</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">geocoder_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="c1"># Build configuration</span>
        <span class="n">geocoder_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
                <span class="s2">&quot;maplibregl&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Signal to use maplibregl</span>
                <span class="s2">&quot;placeholder&quot;</span><span class="p">:</span> <span class="n">placeholder</span><span class="p">,</span>
                <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="s2">&quot;marker&quot;</span><span class="p">:</span> <span class="n">marker</span><span class="p">,</span>
                <span class="s2">&quot;showResultMarkers&quot;</span><span class="p">:</span> <span class="n">show_result_markers</span><span class="p">,</span>
                <span class="s2">&quot;collapsed&quot;</span><span class="p">:</span> <span class="n">collapsed</span><span class="p">,</span>
                <span class="s2">&quot;clearOnBlur&quot;</span><span class="p">:</span> <span class="n">clear_on_blur</span><span class="p">,</span>
                <span class="s2">&quot;clearAndBlurOnEsc&quot;</span><span class="p">:</span> <span class="n">clear_and_blur_on_esc</span><span class="p">,</span>
                <span class="s2">&quot;enableEventLogging&quot;</span><span class="p">:</span> <span class="n">enable_event_logging</span><span class="p">,</span>
                <span class="s2">&quot;minLength&quot;</span><span class="p">:</span> <span class="n">min_length</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">api_key</span><span class="p">:</span>
            <span class="n">geocoder_config</span><span class="p">[</span><span class="s2">&quot;apiKey&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">api_key</span>

        <span class="k">if</span> <span class="n">maplibre_api</span><span class="p">:</span>
            <span class="n">geocoder_config</span><span class="p">[</span><span class="s2">&quot;maplibreApi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maplibre_api</span>

        <span class="k">if</span> <span class="n">language</span><span class="p">:</span>
            <span class="n">geocoder_config</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">language</span>

        <span class="k">if</span> <span class="n">proximity</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">proximity</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;proximity must be a list of two floats: [longitude, latitude]&quot;</span>
                <span class="p">)</span>
            <span class="n">geocoder_config</span><span class="p">[</span><span class="s2">&quot;proximity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proximity</span>

        <span class="k">if</span> <span class="n">bbox</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;bbox must be a list of four floats: [minLng, minLat, maxLng, maxLat]&quot;</span>
                <span class="p">)</span>
            <span class="n">geocoder_config</span><span class="p">[</span><span class="s2">&quot;bbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bbox</span>

        <span class="k">if</span> <span class="n">country</span><span class="p">:</span>
            <span class="n">geocoder_config</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">country</span>

        <span class="k">if</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">geocoder_config</span><span class="p">[</span><span class="s2">&quot;types&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">types</span>

        <span class="c1"># Store control state</span>
        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;maplibre_geocoder_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;maplibre_geocoder&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">geocoder_config</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;maplibre_geocoder&quot;</span><span class="p">,</span> <span class="n">geocoder_config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_export_control</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;map&quot;</span><span class="p">,</span>
        <span class="n">page_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_orientation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;landscape&quot;</span><span class="p">,</span>
        <span class="n">default_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pdf&quot;</span><span class="p">,</span>
        <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
        <span class="n">allowed_sizes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">crosshair</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">printable_area</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">locale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">collapsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an export control for saving the map as images or PDF.</span>

<span class="sd">        This control leverages the `@watergis/maplibre-gl-export` plugin to provide an</span>
<span class="sd">        interactive, collapsible button that lets users export the current map view as</span>
<span class="sd">        PNG, JPEG, PDF, or SVG files. The control appears alongside other MapLibre</span>
<span class="sd">        controls and opens a small panel when toggled.</span>

<span class="sd">        Args:</span>
<span class="sd">            position: Placement of the control on the map container.</span>
<span class="sd">            filename: Default filename (without extension) suggested for exports.</span>
<span class="sd">            page_size: Size of the export page in millimetres as [width, height]. If</span>
<span class="sd">                omitted, the plugin defaults to A4.</span>
<span class="sd">            page_orientation: Page orientation, either ``&quot;landscape&quot;`` or ``&quot;portrait&quot;``.</span>
<span class="sd">            default_format: Default export format (``&quot;pdf&quot;``, ``&quot;png&quot;``, ``&quot;jpg&quot;``, ``&quot;svg&quot;``).</span>
<span class="sd">            dpi: Dots per inch used when rendering the export.</span>
<span class="sd">            allowed_sizes: Optional whitelist of page sizes (e.g. ``[&quot;A4&quot;, &quot;LETTER&quot;]``).</span>
<span class="sd">            crosshair: Whether to show the crosshair overlay when the panel is open.</span>
<span class="sd">            printable_area: Whether to show the printable area overlay when the panel is open.</span>
<span class="sd">            locale: Two-letter locale code for the control&#39;s UI language.</span>
<span class="sd">            options: Extra keyword arguments forwarded to the export plugin.</span>
<span class="sd">            collapsed: Whether the control should start collapsed (button only).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">orientation_value</span> <span class="o">=</span> <span class="n">page_orientation</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">orientation_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;landscape&quot;</span><span class="p">,</span> <span class="s2">&quot;portrait&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;page_orientation must be &#39;landscape&#39; or &#39;portrait&#39;&quot;</span><span class="p">)</span>

        <span class="n">format_value</span> <span class="o">=</span> <span class="n">default_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">format_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="s2">&quot;jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;svg&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;default_format must be one of {&#39;png&#39;, &#39;jpg&#39;, &#39;jpeg&#39;, &#39;pdf&#39;, &#39;svg&#39;}&quot;</span>
            <span class="p">)</span>
        <span class="c1"># Normalise JPEG alias</span>
        <span class="k">if</span> <span class="n">format_value</span> <span class="o">==</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">:</span>
            <span class="n">format_value</span> <span class="o">=</span> <span class="s2">&quot;jpg&quot;</span>

        <span class="n">control_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">clean_filename</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">filename</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">clean_locale</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">locale</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">locale</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;Filename&quot;</span><span class="p">,</span> <span class="n">clean_filename</span> <span class="ow">or</span> <span class="s2">&quot;map&quot;</span><span class="p">)</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;PageOrientation&quot;</span><span class="p">,</span> <span class="n">orientation_value</span><span class="p">)</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;Format&quot;</span><span class="p">,</span> <span class="n">format_value</span><span class="p">)</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;DPI&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">dpi</span><span class="p">))</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;Crosshair&quot;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">crosshair</span><span class="p">))</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;PrintableArea&quot;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">printable_area</span><span class="p">))</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;Locale&quot;</span><span class="p">,</span> <span class="n">clean_locale</span> <span class="ow">or</span> <span class="s2">&quot;en&quot;</span><span class="p">)</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;collapsed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collapsed</span>

        <span class="k">if</span> <span class="n">page_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">page_size_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">page_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">page_size_values</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;page_size must contain exactly two values [width, height]&quot;</span>
                <span class="p">)</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;PageSize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">page_size_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">page_size_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="p">]</span>

        <span class="k">if</span> <span class="n">allowed_sizes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;AllowedSizes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">size</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">allowed_sizes</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="p">]</span>

        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;export_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;export&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;export&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_geogrid_control</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
        <span class="n">before_layer_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">zoom_level_range</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">grid_style</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">label_style</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a geographic grid (graticule) with labeled coordinates to the map.</span>

<span class="sd">        This control uses the `geogrid-maplibre-gl` plugin to display latitude/longitude</span>
<span class="sd">        grid lines with customizable styling and formatting. The grid dynamically adjusts</span>
<span class="sd">        based on zoom level and supports globe projection (MapLibre GL 5.x).</span>

<span class="sd">        Args:</span>
<span class="sd">            position: Placement of the control on the map container (not applicable</span>
<span class="sd">                for this plugin, but kept for API consistency).</span>
<span class="sd">            before_layer_id: ID of the layer to insert the grid beneath. If None,</span>
<span class="sd">                the grid is added as the top layer.</span>
<span class="sd">            zoom_level_range: Tuple of [min_zoom, max_zoom] defining visibility range.</span>
<span class="sd">                If None, the grid is visible at all zoom levels.</span>
<span class="sd">            grid_style: Styling options for grid lines. Supports both MapLibre paint</span>
<span class="sd">                properties (``line-color``, ``line-width``, ``line-dasharray``,</span>
<span class="sd">                ``line-opacity``) and GeoGrid native properties (``color``, ``width``,</span>
<span class="sd">                ``dasharray``, ``opacity``). MapLibre properties are automatically</span>
<span class="sd">                converted to GeoGrid format.</span>
<span class="sd">            label_style: Styling options for coordinate labels. Supports CSS properties</span>
<span class="sd">                like ``color``, ``fontSize``, ``textShadow``, etc.</span>
<span class="sd">            options: Additional configuration options passed directly to the GeoGrid</span>
<span class="sd">                constructor. Can include custom ``gridDensity`` or ``formatLabels`` functions.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; m = MapLibreMap(center=[0, 20], zoom=2)</span>
<span class="sd">            &gt;&gt;&gt; # Using MapLibre paint properties</span>
<span class="sd">            &gt;&gt;&gt; m.add_geogrid_control(grid_style={&#39;line-color&#39;: &#39;#ff0000&#39;, &#39;line-width&#39;: 2})</span>
<span class="sd">            &gt;&gt;&gt; # Using GeoGrid native properties</span>
<span class="sd">            &gt;&gt;&gt; m.add_geogrid_control(grid_style={&#39;color&#39;: &#39;red&#39;, &#39;width&#39;: 2})</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">control_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>

        <span class="k">if</span> <span class="n">before_layer_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;beforeLayerId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">before_layer_id</span>

        <span class="k">if</span> <span class="n">zoom_level_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">zoom_range</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">zoom_level_range</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zoom_range</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;zoom_level_range must contain exactly two values [min_zoom, max_zoom]&quot;</span>
                <span class="p">)</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;zoomLevelRange&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">zoom_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">zoom_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="p">]</span>

        <span class="k">if</span> <span class="n">grid_style</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;gridStyle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">grid_style</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">label_style</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;labelStyle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label_style</span><span class="p">)</span>

        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;geogrid_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;geogrid&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;geogrid&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_geogrid_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the GeoGrid control from the map.&quot;&quot;&quot;</span>

        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;geogrid_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">control_key</span> <span class="ow">in</span> <span class="n">current_controls</span><span class="p">:</span>
            <span class="n">current_controls</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">control_key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeControl&quot;</span><span class="p">,</span> <span class="s2">&quot;geogrid&quot;</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_geoman_control</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
        <span class="n">geoman_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">controls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">collapsed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">show_info_box</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">info_box_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;click&quot;</span><span class="p">,</span>
        <span class="n">info_box_tolerance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">paint_above_geoman</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add the MapLibre-Geoman drawing and editing toolkit.</span>

<span class="sd">        Args:</span>
<span class="sd">            position: Where to dock the Geoman toolbar on the map.</span>
<span class="sd">            geoman_options: Raw configuration dictionary passed directly to the</span>
<span class="sd">                ``Geoman`` constructor.</span>
<span class="sd">            settings: Optional convenience overrides merged into</span>
<span class="sd">                ``geoman_options[&#39;settings&#39;]``.</span>
<span class="sd">            controls: Optional overrides for toolbar sections such as ``draw``,</span>
<span class="sd">                ``edit``, or ``helper``. Each key should map to a dictionary of</span>
<span class="sd">                button configuration overrides.</span>
<span class="sd">            collapsed: Whether the toolbar UI should start collapsed. Use</span>
<span class="sd">                ``None`` to defer to the underlying configuration.</span>
<span class="sd">            show_info_box: If True, show an info box that displays the properties</span>
<span class="sd">                of the currently selected feature when clicking or hovering over any feature</span>
<span class="sd">                in the Geoman layer, not just during editing. Defaults to None (no change in frontend default).</span>
<span class="sd">            info_box_mode: &#39;click&#39; to show info only after clicking a feature (default),</span>
<span class="sd">                or &#39;hover&#39; to show on mouse hover.</span>
<span class="sd">            info_box_tolerance: Pixel search tolerance when detecting a feature</span>
<span class="sd">                under the pointer. Larger values make selection easier (default 8 for</span>
<span class="sd">                click, 6 for hover if not specified).</span>
<span class="sd">            paint: Optional styling config for a mirrored, read-only GeoJSON layer</span>
<span class="sd">                that reflects the current ``geoman_data`` for visualization. All keys</span>
<span class="sd">                are optional. Structure:</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;line&quot;: { ... MapLibre line paint ... },     # For LineString/MultiLineString</span>
<span class="sd">                    &quot;fill&quot;: { ... MapLibre fill paint ... },     # For Polygon/MultiPolygon</span>
<span class="sd">                    &quot;point&quot;: { ... MapLibre circle paint ... }   # For Point/MultiPoint</span>
<span class="sd">                }</span>
<span class="sd">                The mirrored layer shows the final saved geometry, not intermediate</span>
<span class="sd">                editing states. You can use data-driven expressions here, e.g.</span>
<span class="sd">                line color by [&quot;get&quot;,&quot;highway&quot;]. Note: If your paint styles are too</span>
<span class="sd">                similar to Geoman&#39;s default editing styles, features may be visually</span>
<span class="sd">                difficult to distinguish during editing.</span>
<span class="sd">            paint_above_geoman: If True (default), place the mirrored style layers</span>
<span class="sd">                above Geomans edit layers; set False to draw beneath them.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">geoman_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">geoman_options</span> <span class="ow">or</span> <span class="p">{})</span>

        <span class="k">if</span> <span class="n">settings</span><span class="p">:</span>
            <span class="n">geoman_settings</span> <span class="o">=</span> <span class="n">geoman_config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;settings&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">geoman_settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>

        <span class="c1"># Enable snapping by default</span>
        <span class="n">geoman_controls</span> <span class="o">=</span> <span class="n">geoman_config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;controls&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">helper_controls</span> <span class="o">=</span> <span class="n">geoman_controls</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;helper&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">snapping_config</span> <span class="o">=</span> <span class="n">helper_controls</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;snapping&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="s2">&quot;active&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">snapping_config</span><span class="p">:</span>
            <span class="n">snapping_config</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">controls</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">section</span><span class="p">,</span> <span class="n">section_options</span> <span class="ow">in</span> <span class="n">controls</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">section_options</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">section_config</span> <span class="o">=</span> <span class="n">geoman_controls</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="n">section_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">section_options</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">geoman_controls</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="o">=</span> <span class="n">section_options</span>

        <span class="n">control_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">geoman_config</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;geoman_options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geoman_config</span>
        <span class="k">if</span> <span class="n">show_info_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;show_info_box&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">show_info_box</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">info_box_mode</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;info_box_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">info_box_mode</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">info_box_tolerance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;info_box_tolerance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info_box_tolerance</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">paint</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;geoman_paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">paint</span><span class="p">)</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;geoman_paint_above&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">paint_above_geoman</span><span class="p">)</span>

        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;geoman_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;geoman&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="s2">&quot;geoman&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;geoman&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>

        <span class="c1"># If Geoman is already initialized, ensure the info box setting is applied at runtime</span>
        <span class="k">if</span> <span class="n">show_info_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setGeomanInfoBoxEnabled&quot;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">show_info_box</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">collapsed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">collapsed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">collapse_geoman_control</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If an explicit method to uncollapse exists, call it here.</span>
                <span class="c1"># For now, this is a placeholder for future logic.</span>
                <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_geoman_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the Geoman control toolbar.&quot;&quot;&quot;</span>

        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;geoman_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">control_key</span> <span class="ow">in</span> <span class="n">current_controls</span><span class="p">:</span>
            <span class="n">current_controls</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">control_key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;geoman&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeControl&quot;</span><span class="p">,</span> <span class="s2">&quot;geoman&quot;</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_geoman_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replace the current Geoman feature collection.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span> <span class="o">=</span> <span class="n">data</span> <span class="ow">or</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_geoman_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all Geoman-managed features.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_geoman_data</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_geoman_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the current Geoman feature collection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A GeoJSON FeatureCollection containing all Geoman-managed features.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_geoman_data_as_gdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the current Geoman feature collection as a GeoDataFrame.</span>

<span class="sd">        Args:</span>
<span class="sd">            crs: The CRS of the GeoDataFrame. Defaults to &quot;EPSG:4326&quot;.</span>
<span class="sd">        Returns:</span>
<span class="sd">            A GeoDataFrame containing the current Geoman feature collection.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">collapse_geoman_control</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Collapse the Geoman draw control toolbar.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;collapseGeomanControl&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">expand_geoman_control</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Expand the Geoman draw control toolbar.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;expandGeomanControl&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">toggle_geoman_control</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Toggle the Geoman draw control toolbar between collapsed and expanded states.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;toggleGeomanControl&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_vector_editor</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="s2">&quot;gpd.GeoDataFrame&quot;</span><span class="p">],</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">out_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filename_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">time_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">T%H%M%S&quot;</span><span class="p">,</span>
        <span class="n">file_ext</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;geojson&quot;</span><span class="p">,</span>
        <span class="n">controls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">geoman_position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
        <span class="n">widget_position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
        <span class="n">widget_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Vector Editor&quot;</span><span class="p">,</span>
        <span class="n">widget_icon</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">fit_bounds_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an interactive vector editor with property assignment capabilities.</span>

<span class="sd">        This method creates an interactive interface for editing vector features and</span>
<span class="sd">        assigning properties to them. It loads existing vector data, adds a Geoman</span>
<span class="sd">        drawing control, and provides a widget panel for editing feature properties.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: Vector data source - can be:</span>
<span class="sd">                - File path (GeoJSON, shapefile, etc.)</span>
<span class="sd">                - URL to remote GeoJSON</span>
<span class="sd">                - GeoJSON dictionary</span>
<span class="sd">                - GeoDataFrame</span>
<span class="sd">            properties: Dictionary defining editable properties where keys are property</span>
<span class="sd">                names and values define the input type:</span>
<span class="sd">                - List/tuple: Creates dropdown with these options</span>
<span class="sd">                - int: Creates integer input with this default value</span>
<span class="sd">                - float: Creates float input with this default value</span>
<span class="sd">                - str: Creates text input with this default value</span>
<span class="sd">                If None, properties are inferred from the data.</span>
<span class="sd">            out_dir: Directory for exported files. Defaults to current directory.</span>
<span class="sd">            filename_prefix: Prefix for exported filenames.</span>
<span class="sd">            time_format: Format string for timestamp in exported filenames.</span>
<span class="sd">            file_ext: File extension for exports (default: &quot;geojson&quot;).</span>
<span class="sd">            controls: Dictionary specifying Geoman drawing controls to enable. The dictionary should have keys such as &quot;draw&quot;, &quot;edit&quot;, and &quot;helper&quot;, each mapping to a list of control names to enable.</span>
<span class="sd">                Defaults to:</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;draw&quot;: [&quot;point&quot;, &quot;polygon&quot;, &quot;line_string&quot;],</span>
<span class="sd">                        &quot;edit&quot;: [&quot;edit&quot;, &quot;cut&quot;, &quot;copy&quot;, &quot;merge&quot;, &quot;split&quot;],</span>
<span class="sd">                        &quot;helper&quot;: [&quot;trash&quot;]</span>
<span class="sd">                    }</span>
<span class="sd">                Example:</span>
<span class="sd">                    controls = {</span>
<span class="sd">                        &quot;draw&quot;: [&quot;point&quot;, &quot;polygon&quot;, &quot;line_string&quot;],</span>
<span class="sd">                        &quot;edit&quot;: [&quot;edit&quot;, &quot;cut&quot;, &quot;copy&quot;, &quot;merge&quot;, &quot;split&quot;],</span>
<span class="sd">                        &quot;helper&quot;: [&quot;trash&quot;]</span>
<span class="sd">                    }</span>
<span class="sd">            geoman_position: Position of Geoman control on map.</span>
<span class="sd">            widget_position: Position of property editor widget on map.</span>
<span class="sd">            widget_label: Label for the property editor widget panel.</span>
<span class="sd">            widget_icon: Icon for the property editor toggle button.</span>
<span class="sd">            fit_bounds_options: Options passed to fit_bounds().</span>
<span class="sd">            **kwargs: Additional arguments passed to add_geoman_control().</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The control ID of the added widget control.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; m = MapLibreMap()</span>
<span class="sd">            &gt;&gt;&gt; m.add_basemap(&quot;Esri.WorldImagery&quot;)</span>
<span class="sd">            &gt;&gt;&gt; url = &quot;https://example.com/buildings.geojson&quot;</span>
<span class="sd">            &gt;&gt;&gt; properties = {</span>
<span class="sd">            ...     &quot;class&quot;: [&quot;residential&quot;, &quot;commercial&quot;, &quot;industrial&quot;],</span>
<span class="sd">            ...     &quot;height&quot;: 0.0,</span>
<span class="sd">            ...     &quot;floors&quot;: 1</span>
<span class="sd">            ... }</span>
<span class="sd">            &gt;&gt;&gt; control_id = m.add_vector_editor(url, properties=properties)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_GEOPANDAS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;geopandas is required for add_vector_editor. &quot;</span>
                <span class="s2">&quot;Install it with: pip install geopandas&quot;</span>
            <span class="p">)</span>

        <span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>

        <span class="c1"># Load vector data</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># Check if it&#39;s a URL or file path</span>
            <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;http://&quot;</span><span class="p">,</span> <span class="s2">&quot;https://&quot;</span><span class="p">)):</span>
                <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;.pq&quot;</span><span class="p">,</span> <span class="s2">&quot;.geoparquet&quot;</span><span class="p">]:</span>
                    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;filename must be a string (path/URL), dict (GeoJSON), or GeoDataFrame&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Ensure WGS84</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>

        <span class="c1"># Set output directory</span>
        <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

        <span class="c1"># Infer properties from GeoDataFrame if not provided</span>
        <span class="k">if</span> <span class="n">properties</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">dtypes</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">gdf</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                            <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;int32&quot;</span><span class="p">,</span> <span class="s2">&quot;int64&quot;</span><span class="p">]:</span>
                        <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;float32&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">]:</span>
                        <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;bool&quot;</span><span class="p">:</span>
                        <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Select only property columns plus geometry</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">properties</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">columns</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]]</span>
        <span class="n">geojson</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">__geo_interface__</span>

        <span class="c1"># Get bounds and fit map</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">geojson_bounds</span><span class="p">(</span><span class="n">geojson</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Transform flat bounds [minx, miny, maxx, maxy] to [[minx, miny], [maxx, maxy]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_bounds</span><span class="p">([[</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]]])</span>
        <span class="c1"># else: bounds is None, skip fitting bounds</span>
        <span class="c1"># Prepare GeoJSON features for Geoman with proper IDs</span>
        <span class="n">geoman_geojson</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">feature</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">geojson</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]):</span>
            <span class="c1"># Create a unique ID for each feature</span>
            <span class="n">feature_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;feature-</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="c1"># Determine the Geoman shape type from geometry</span>
            <span class="n">geom_type</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">geom_type</span> <span class="o">==</span> <span class="s2">&quot;Point&quot;</span><span class="p">:</span>
                <span class="n">gm_shape</span> <span class="o">=</span> <span class="s2">&quot;marker&quot;</span>
            <span class="k">elif</span> <span class="n">geom_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Polygon&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiPolygon&quot;</span><span class="p">]:</span>
                <span class="n">gm_shape</span> <span class="o">=</span> <span class="s2">&quot;polygon&quot;</span>
            <span class="k">elif</span> <span class="n">geom_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;LineString&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiLineString&quot;</span><span class="p">]:</span>
                <span class="n">gm_shape</span> <span class="o">=</span> <span class="s2">&quot;line&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gm_shape</span> <span class="o">=</span> <span class="s2">&quot;polygon&quot;</span>

            <span class="c1"># Create Geoman-compatible feature with preserved properties</span>
            <span class="c1"># Start with original properties, then add Geoman-specific ones</span>
            <span class="n">feature_properties</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">feature_properties</span><span class="p">[</span><span class="s2">&quot;__gm_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_id</span>
            <span class="n">feature_properties</span><span class="p">[</span><span class="s2">&quot;__gm_shape&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gm_shape</span>

            <span class="n">geoman_feature</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">feature_id</span><span class="p">,</span>
                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">feature_properties</span><span class="p">,</span>
                <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">],</span>
            <span class="p">}</span>

            <span class="n">geoman_geojson</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geoman_feature</span><span class="p">)</span>

        <span class="c1"># Set default controls if not provided</span>
        <span class="k">if</span> <span class="n">controls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">controls</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;draw&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                    <span class="s2">&quot;polygon&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                    <span class="s2">&quot;line_string&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                <span class="p">},</span>
                <span class="s2">&quot;edit&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;change&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>  <span class="c1"># Disable edit mode button</span>
                    <span class="s2">&quot;trash&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>  <span class="c1"># Keep delete button</span>
                <span class="p">},</span>
                <span class="s2">&quot;helper&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;click_to_edit&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>  <span class="c1"># Enable click-to-edit mode</span>
                <span class="p">},</span>
            <span class="p">}</span>

        <span class="c1"># Add Geoman control first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_geoman_control</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">geoman_position</span><span class="p">,</span> <span class="n">controls</span><span class="o">=</span><span class="n">controls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Now load the features into Geoman (will be editable with JS fix)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_geoman_data</span><span class="p">(</span><span class="n">geoman_geojson</span><span class="p">)</span>

        <span class="c1"># Initialize feature properties storage</span>
        <span class="c1"># Map Geoman feature IDs to properties from GeoDataFrame</span>
        <span class="n">draw_features</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">row_idx</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>
            <span class="c1"># Get the corresponding Geoman feature ID</span>
            <span class="n">feature_id</span> <span class="o">=</span> <span class="n">geoman_geojson</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

            <span class="n">feature_props</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span>
                    <span class="c1"># Convert numpy/pandas types to Python native types</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">):</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                    <span class="n">feature_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Use default value from properties</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">properties</span><span class="p">[</span><span class="n">prop</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                        <span class="n">feature_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="n">prop</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">feature_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span>
            <span class="n">draw_features</span><span class="p">[</span><span class="n">feature_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_props</span>

        <span class="c1"># Store on map instance</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;draw_features&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">draw_features</span><span class="p">)</span>

        <span class="c1"># Expand dropdown options to include values from loaded GeoDataFrame</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="c1"># Get unique values from the loaded data</span>
                <span class="n">existing_values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

                <span class="c1"># Merge with provided options</span>
                <span class="n">options_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                <span class="n">merged_options</span> <span class="o">=</span> <span class="n">options_set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">existing_values</span><span class="p">)</span>
                <span class="n">merged_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">values</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">merged_options</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">existing_values</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options_set</span><span class="p">:</span>
                        <span class="n">merged_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_list</span>

        <span class="c1"># Create property editing widgets</span>
        <span class="n">prop_widgets</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>

        <span class="c1"># Add a label to show which feature is selected</span>
        <span class="n">feature_label</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&lt;p style=&#39;margin:5px 0; color:#666; font-size:12px;&#39;&gt;No feature selected&lt;/p&gt;&quot;</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">prop_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                    <span class="n">options</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                    <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;initial&quot;</span><span class="p">},</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">prop_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntText</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                    <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;initial&quot;</span><span class="p">},</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                <span class="n">prop_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                    <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;initial&quot;</span><span class="p">},</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prop_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                    <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;initial&quot;</span><span class="p">},</span>
                <span class="p">)</span>
            <span class="n">prop_widgets</span><span class="o">.</span><span class="n">children</span> <span class="o">+=</span> <span class="p">(</span><span class="n">prop_widget</span><span class="p">,)</span>

        <span class="c1"># Create buttons</span>
        <span class="n">button_layout</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;100px&quot;</span><span class="p">)</span>
        <span class="n">save_btn</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Save&quot;</span><span class="p">,</span>
            <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">button_layout</span><span class="p">,</span>
            <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Save current feature properties&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">export_btn</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Export&quot;</span><span class="p">,</span>
            <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">button_layout</span><span class="p">,</span>
            <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Export all features to file&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">reset_btn</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Reset&quot;</span><span class="p">,</span>
            <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">button_layout</span><span class="p">,</span>
            <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Reset to default values&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Track currently selected feature for property editing</span>
        <span class="n">current_feature_id</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

        <span class="c1"># Create a dropdown to select features</span>
        <span class="n">feature_selector</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Select Feature:&quot;</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;initial&quot;</span><span class="p">},</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="s2">&quot;5px 0&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Update feature selector when geoman_data changes</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">update_feature_list</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Update the feature dropdown when features change.&quot;&quot;&quot;</span>
            <span class="n">geoman_data</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">geoman_data</span> <span class="ow">and</span> <span class="s2">&quot;features&quot;</span> <span class="ow">in</span> <span class="n">geoman_data</span><span class="p">:</span>
                <span class="n">features</span> <span class="o">=</span> <span class="n">geoman_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Create options: (label, feature_id)</span>
                    <span class="n">options</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feature </span><span class="si">{</span><span class="n">idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="n">feature_selector</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>

                    <span class="c1"># If no feature selected yet, select the first one</span>
                    <span class="k">if</span> <span class="n">current_feature_id</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">feature_selector</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">feature_selector</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">current_feature_id</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">feature_label</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&lt;p style=&#39;margin:5px 0; color:#666; font-size:12px;&#39;&gt;No features available&lt;/p&gt;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">feature_selector</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">current_feature_id</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">feature_label</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&lt;p style=&#39;margin:5px 0; color:#666; font-size:12px;&#39;&gt;No features available&lt;/p&gt;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">update_feature_list</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;geoman_data&quot;</span><span class="p">)</span>

        <span class="c1"># When user selects a feature from dropdown</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">on_feature_selected</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Update property widgets when user selects a feature.&quot;&quot;&quot;</span>
            <span class="n">feature_id</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">feature_id</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="n">current_feature_id</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_id</span>
            <span class="n">feature_label</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;p style=&#39;margin:5px 0; color:#0066cc; font-size:12px;&#39;&gt;&lt;b&gt;Editing:&lt;/b&gt; </span><span class="si">{</span><span class="n">feature_id</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>

            <span class="c1"># Initialize properties for new features</span>
            <span class="k">if</span> <span class="n">feature_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="p">[</span><span class="n">feature_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="p">[</span><span class="n">feature_id</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="p">[</span><span class="n">feature_id</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>

            <span class="c1"># Update widgets with feature&#39;s current properties</span>
            <span class="n">feature_props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="p">[</span><span class="n">feature_id</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">prop_widget</span> <span class="ow">in</span> <span class="n">prop_widgets</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">prop_widget</span><span class="o">.</span><span class="n">description</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">feature_props</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">feature_props</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="c1"># For dropdowns, only set if value is in options</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">prop_widget</span><span class="p">,</span> <span class="s2">&quot;options&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">prop_widget</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                            <span class="n">prop_widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop_widget</span><span class="o">.</span><span class="n">options</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">prop_widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">prop_widget</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">prop_widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">feature_selector</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">on_feature_selected</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>

        <span class="c1"># Trigger initial update</span>
        <span class="n">update_feature_list</span><span class="p">({</span><span class="s2">&quot;new&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span><span class="p">})</span>

        <span class="c1"># Save button handler</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">on_save_click</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
            <span class="n">feature_id</span> <span class="o">=</span> <span class="n">current_feature_id</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">feature_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Save widget values to feature properties</span>
                <span class="k">for</span> <span class="n">prop_widget</span> <span class="ow">in</span> <span class="n">prop_widgets</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">prop_widget</span><span class="o">.</span><span class="n">description</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="p">[</span><span class="n">feature_id</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop_widget</span><span class="o">.</span><span class="n">value</span>
                <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Feature properties saved&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot; No feature selected. Click on a feature to edit it or draw a new one.&quot;</span>
                    <span class="p">)</span>

        <span class="n">save_btn</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">on_save_click</span><span class="p">)</span>

        <span class="c1"># Export button handler</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">on_export_click</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
            <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">time_format</span><span class="p">)</span>
            <span class="n">export_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename_prefix</span><span class="si">}{</span><span class="n">current_time</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">file_ext</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Update feature collection with saved properties</span>
            <span class="n">geoman_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span>
            <span class="k">if</span> <span class="n">geoman_data</span> <span class="ow">and</span> <span class="s2">&quot;features&quot;</span> <span class="ow">in</span> <span class="n">geoman_data</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">feature</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">geoman_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]):</span>
                    <span class="n">feature_id</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">feature_id</span> <span class="ow">and</span> <span class="n">feature_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="p">:</span>
                        <span class="c1"># Merge Geoman properties with our custom properties</span>
                        <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">,</span> <span class="p">{}))</span>
                        <span class="n">props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="p">[</span><span class="n">feature_id</span><span class="p">])</span>
                        <span class="n">geoman_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">][</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">props</span>

                <span class="c1"># Export to file</span>
                <span class="n">export_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span>
                    <span class="n">geoman_data</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span>
                <span class="p">)</span>
                <span class="n">export_gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">export_filename</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GeoJSON&quot;</span><span class="p">)</span>

                <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Exported: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">export_filename</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; No features to export&quot;</span><span class="p">)</span>

        <span class="n">export_btn</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">on_export_click</span><span class="p">)</span>

        <span class="c1"># Reset button handler</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">on_reset_click</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">prop_widget</span> <span class="ow">in</span> <span class="n">prop_widgets</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">prop_widget</span><span class="o">.</span><span class="n">description</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                        <span class="n">prop_widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">prop_widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Reset to defaults&quot;</span><span class="p">)</span>

        <span class="n">reset_btn</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">on_reset_click</span><span class="p">)</span>

        <span class="c1"># Create main widget container</span>
        <span class="n">info_label</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&lt;i&gt;Select a feature from the dropdown to edit its properties&lt;/i&gt;&quot;</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="s2">&quot;0 0 5px 0&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">button_box</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span>
            <span class="p">[</span><span class="n">save_btn</span><span class="p">,</span> <span class="n">export_btn</span><span class="p">,</span> <span class="n">reset_btn</span><span class="p">],</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="s2">&quot;10px 0&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">main_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">info_label</span><span class="p">,</span>
                <span class="n">feature_selector</span><span class="p">,</span>
                <span class="n">feature_label</span><span class="p">,</span>
                <span class="n">prop_widgets</span><span class="p">,</span>
                <span class="n">button_box</span><span class="p">,</span>
                <span class="n">output</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">padding</span><span class="o">=</span><span class="s2">&quot;10px&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Add widget control to map</span>
        <span class="n">control_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_widget_control</span><span class="p">(</span>
            <span class="n">main_widget</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">widget_label</span><span class="p">,</span>
            <span class="n">icon</span><span class="o">=</span><span class="n">widget_icon</span><span class="p">,</span>
            <span class="n">position</span><span class="o">=</span><span class="n">widget_position</span><span class="p">,</span>
            <span class="n">collapsed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">panel_width</span><span class="o">=</span><span class="mi">320</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">control_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_measures_control</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;metric&quot;</span><span class="p">,</span>
        <span class="n">area_button_title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">length_button_title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">clear_button_title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add the MapLibre GL Measures control for distance and area measurement.</span>

<span class="sd">        This control allows users to measure distances along lines and calculate areas</span>
<span class="sd">        within polygons on the map.</span>

<span class="sd">        Args:</span>
<span class="sd">            position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">            units: Unit system for measurements, either &#39;metric&#39; or &#39;imperial&#39;</span>
<span class="sd">            area_button_title: Custom title for the area measurement button</span>
<span class="sd">            length_button_title: Custom title for the length measurement button</span>
<span class="sd">            clear_button_title: Custom title for the clear measurements button</span>
<span class="sd">            options: Additional options for the measures control (styling, callbacks, etc.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">,</span> <span class="s2">&quot;imperial&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;units must be either &#39;metric&#39; or &#39;imperial&#39;&quot;</span><span class="p">)</span>

        <span class="n">measures_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span> <span class="ow">or</span> <span class="p">{})</span>

        <span class="c1"># Set unit system</span>
        <span class="n">measures_config</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">units</span>

        <span class="c1"># Set custom button titles if provided</span>
        <span class="k">if</span> <span class="n">area_button_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">measures_config</span><span class="p">[</span><span class="s2">&quot;areaMeasurementButtonTitle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">area_button_title</span>
        <span class="k">if</span> <span class="n">length_button_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">measures_config</span><span class="p">[</span><span class="s2">&quot;lengthMeasurementButtonTitle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">length_button_title</span>
        <span class="k">if</span> <span class="n">clear_button_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">measures_config</span><span class="p">[</span><span class="s2">&quot;clearMeasurementsButtonTitle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clear_button_title</span>

        <span class="n">control_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;measures_options&quot;</span><span class="p">:</span> <span class="n">measures_config</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;measures_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;measures&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="s2">&quot;measures&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;measures&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_measures_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the Measures control.&quot;&quot;&quot;</span>

        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;measures_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">control_key</span> <span class="ow">in</span> <span class="n">current_controls</span><span class="p">:</span>
            <span class="n">current_controls</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">control_key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;measures&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeControl&quot;</span><span class="p">,</span> <span class="s2">&quot;measures&quot;</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_google_streetview</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
        <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a Google Street View control to the map.</span>

<span class="sd">        This method adds a Google Street View control that allows users to view</span>
<span class="sd">        street-level imagery at clicked locations on the map.</span>

<span class="sd">        Args:</span>
<span class="sd">            position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">            api_key: Google Maps API key. If None, retrieves from GOOGLE_MAPS_API_KEY environment variable</span>
<span class="sd">            options: Additional options for the Street View control</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no API key is provided and none can be found in environment variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">api_key</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_env_var</span><span class="p">(</span><span class="s2">&quot;GOOGLE_MAPS_API_KEY&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Google Maps API key is required. Please provide it as a parameter &quot;</span>
                    <span class="s2">&quot;or set the GOOGLE_MAPS_API_KEY environment variable.&quot;</span>
                <span class="p">)</span>

        <span class="n">control_options</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
                <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Store control in persistent state</span>
        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;google_streetview_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;google_streetview&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;google_streetview&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_layer_controls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update all existing layer controls with the current layer state.&quot;&quot;&quot;</span>
        <span class="c1"># Find all layer controls in the _controls dictionary</span>
        <span class="k">for</span> <span class="n">control_key</span><span class="p">,</span> <span class="n">control_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">control_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;layer_control&quot;</span><span class="p">:</span>
                <span class="c1"># Update the layerStates in the control options</span>
                <span class="n">control_options</span> <span class="o">=</span> <span class="n">control_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">,</span> <span class="p">{})</span>
                <span class="n">layers_filter</span> <span class="o">=</span> <span class="n">control_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layers&quot;</span><span class="p">)</span>

                <span class="c1"># Get current layer states for this control</span>
                <span class="n">layer_states</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">target_layers</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">layers_filter</span>
                    <span class="k">if</span> <span class="n">layers_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="p">)</span>

                <span class="c1"># Always include Background layer for controlling map style layers</span>
                <span class="k">if</span> <span class="n">layers_filter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s2">&quot;Background&quot;</span> <span class="ow">in</span> <span class="n">layers_filter</span><span class="p">:</span>
                    <span class="n">layer_states</span><span class="p">[</span><span class="s2">&quot;Background&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Background&quot;</span><span class="p">,</span>
                    <span class="p">}</span>

                <span class="k">for</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="n">target_layers</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span> <span class="ow">and</span> <span class="n">layer_id</span> <span class="o">!=</span> <span class="s2">&quot;Background&quot;</span><span class="p">:</span>
                        <span class="n">layer_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span>
                        <span class="n">layer_states</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">layer_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;visible&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                            <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="n">layer_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span>
                        <span class="p">}</span>

                <span class="c1"># Update the control options with new layer states</span>
                <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;layerStates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_states</span>

                <span class="c1"># Update the control configuration</span>
                <span class="n">control_config</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">control_options</span>

        <span class="c1"># Trigger the JavaScript layer control to check for new layers</span>
        <span class="c1"># by updating the _layer_dict trait that the JS listens to</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layer_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a layer from the map.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Unique identifier for the layer to remove.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if this is a marker group</span>
        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">:</span>
            <span class="n">layer_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">layer_type</span> <span class="o">==</span> <span class="s2">&quot;marker-group&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeMarkerGroup&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">)</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>
                <span class="k">return</span>

        <span class="c1"># Remove from JavaScript map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeLayer&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">)</span>

        <span class="c1"># Remove from local state</span>
        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="p">:</span>
            <span class="n">current_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">current_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span> <span class="o">=</span> <span class="n">current_layers</span>

        <span class="c1"># Remove FlatGeobuf metadata if present</span>
        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatgeobuf_layers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeFlatGeobufLayer&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">)</span>
            <span class="n">flatgeobuf_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flatgeobuf_layers</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">flatgeobuf_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flatgeobuf_layers</span> <span class="o">=</span> <span class="n">flatgeobuf_layers</span>

        <span class="c1"># Remove from layer_dict</span>
        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span>

        <span class="c1"># Update layer controls if they exist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_cog_layer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cog_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">opacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">visible</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">titiler_endpoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fit_bounds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a Cloud Optimized GeoTIFF (COG) layer to the map.</span>

<span class="sd">        This method supports COGs in any coordinate reference system (CRS). For COGs</span>
<span class="sd">        in EPSG:3857, it uses the maplibre-cog-protocol for direct rendering. For COGs</span>
<span class="sd">        in other CRS, it uses TiTiler to reproject on-the-fly.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Unique identifier for the COG layer.</span>
<span class="sd">            cog_url: URL to the COG file.</span>
<span class="sd">            opacity: Layer opacity between 0.0 and 1.0.</span>
<span class="sd">            visible: Whether the layer should be visible initially.</span>
<span class="sd">            paint: Optional paint properties for the layer.</span>
<span class="sd">            before_id: Optional layer ID to insert this layer before.</span>
<span class="sd">            titiler_endpoint: Optional TiTiler endpoint URL. If None, checks COG CRS</span>
<span class="sd">                and uses TiTiler automatically for non-EPSG:3857 COGs. Set to a TiTiler</span>
<span class="sd">                URL (e.g., &quot;https://giswqs-titiler-endpoint.hf.space&quot;) to force using TiTiler.</span>
<span class="sd">            fit_bounds: If True, automatically fit map bounds to COG extent.</span>
<span class="sd">            **kwargs: Additional parameters passed to TiTiler (e.g., rescale, colormap,</span>
<span class="sd">                bidx for band selection).</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; m = MapLibreMap()</span>
<span class="sd">            &gt;&gt;&gt; # COG in EPSG:3857 (uses cog:// protocol)</span>
<span class="sd">            &gt;&gt;&gt; m.add_cog_layer(&quot;cog1&quot;, &quot;https://example.com/data_3857.tif&quot;)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # COG in any other CRS (uses TiTiler)</span>
<span class="sd">            &gt;&gt;&gt; m.add_cog_layer(&quot;cog2&quot;, &quot;https://example.com/data_4326.tif&quot;)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Force TiTiler with custom endpoint</span>
<span class="sd">            &gt;&gt;&gt; m.add_cog_layer(</span>
<span class="sd">            ...     &quot;cog3&quot;,</span>
<span class="sd">            ...     &quot;https://example.com/data.tif&quot;,</span>
<span class="sd">            ...     titiler_endpoint=&quot;https://giswqs-titiler-endpoint.hf.space&quot;,</span>
<span class="sd">            ...     rescale=&quot;0,255&quot;,</span>
<span class="sd">            ...     colormap=&quot;viridis&quot;</span>
<span class="sd">            ... )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_source&quot;</span>

        <span class="c1"># Check if we should use TiTiler</span>
        <span class="n">use_titiler</span> <span class="o">=</span> <span class="n">titiler_endpoint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_titiler</span><span class="p">:</span>
            <span class="c1"># Auto-detect if TiTiler is needed by checking COG CRS</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cog_metadata</span><span class="p">(</span><span class="n">cog_url</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">metadata</span> <span class="ow">and</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;crs&quot;</span><span class="p">):</span>
                    <span class="n">cog_crs</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;crs&quot;</span><span class="p">]</span>
                    <span class="c1"># Use TiTiler if COG is not in EPSG:3857</span>
                    <span class="k">if</span> <span class="n">cog_crs</span> <span class="o">!=</span> <span class="s2">&quot;EPSG:3857&quot;</span><span class="p">:</span>
                        <span class="n">use_titiler</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;COG is in </span><span class="si">{</span><span class="n">cog_crs</span><span class="si">}</span><span class="s2">, using TiTiler for reprojection&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not determine COG CRS, trying cog:// protocol: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">use_titiler</span><span class="p">:</span>
            <span class="c1"># Use TiTiler for on-the-fly reprojection</span>
            <span class="k">if</span> <span class="n">titiler_endpoint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">titiler_endpoint</span> <span class="o">=</span> <span class="s2">&quot;https://giswqs-titiler-endpoint.hf.space&quot;</span>

            <span class="c1"># Build TiTiler tile URL</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlencode</span><span class="p">,</span> <span class="n">quote</span>

            <span class="c1"># Encode the COG URL</span>
            <span class="n">encoded_url</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="n">cog_url</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="c1"># Build query parameters</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">cog_url</span><span class="p">,</span>
                <span class="s2">&quot;TileMatrixSetId&quot;</span><span class="p">:</span> <span class="s2">&quot;WebMercatorQuad&quot;</span><span class="p">,</span>  <span class="c1"># Reproject to Web Mercator</span>
            <span class="p">}</span>

            <span class="c1"># Add any additional TiTiler parameters</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="n">query_string</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;url&quot;</span><span class="p">})</span>

            <span class="c1"># TiTiler tile URL format: {endpoint}/cog/tiles/WebMercatorQuad/{z}/{x}/{y}</span>
            <span class="n">tile_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">titiler_endpoint</span><span class="si">}</span><span class="s2">/cog/tiles/WebMercatorQuad/</span><span class="se">{{</span><span class="s2">z</span><span class="se">}}</span><span class="s2">/</span><span class="se">{{</span><span class="s2">x</span><span class="se">}}</span><span class="s2">/</span><span class="se">{{</span><span class="s2">y</span><span class="se">}}</span><span class="s2">?url=</span><span class="si">{</span><span class="n">encoded_url</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">query_string</span><span class="p">:</span>
                <span class="n">tile_url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&amp;</span><span class="si">{</span><span class="n">query_string</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="c1"># print(f&quot;Using TiTiler: {titiler_endpoint}&quot;)</span>
            <span class="c1"># print(f&quot;Tile URL pattern: {tile_url[:100]}...&quot;)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span>
                <span class="n">source_id</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;raster&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;tiles&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">tile_url</span><span class="p">],</span>
                    <span class="s2">&quot;tileSize&quot;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
                    <span class="s2">&quot;attribution&quot;</span><span class="p">:</span> <span class="s2">&quot;TiTiler&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Use cog:// protocol for EPSG:3857 COGs</span>
            <span class="n">cog_source_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;cog://</span><span class="si">{</span><span class="n">cog_url</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span>
                <span class="n">source_id</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;raster&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">cog_source_url</span><span class="p">,</span>
                    <span class="s2">&quot;tileSize&quot;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>

        <span class="c1"># Add raster layer</span>
        <span class="n">layer_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;raster&quot;</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">paint</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paint</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span>
            <span class="n">layer</span><span class="o">=</span><span class="n">layer_config</span><span class="p">,</span>
            <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span>
            <span class="n">layer_id</span><span class="o">=</span><span class="n">layer_id</span><span class="p">,</span>
            <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
            <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Optionally fit bounds to COG extent</span>
        <span class="k">if</span> <span class="n">fit_bounds</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cog_metadata</span><span class="p">(</span><span class="n">cog_url</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">metadata</span> <span class="ow">and</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bbox&quot;</span><span class="p">):</span>
                    <span class="n">bbox</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;bbox&quot;</span><span class="p">]</span>
                    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fit_bounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
                    <span class="c1"># print(f&quot;Map fitted to COG bounds: {bounds}&quot;)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not fit bounds to COG extent: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_pmtiles</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pmtiles_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">layers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">opacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">visible</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add PMTiles vector tiles to the map.</span>

<span class="sd">        Args:</span>
<span class="sd">            pmtiles_url: URL to the PMTiles file.</span>
<span class="sd">            layer_id: Optional unique identifier for the layer. If None, uses filename.</span>
<span class="sd">            layers: Optional list of layer configurations for rendering. If None, creates default layers.</span>
<span class="sd">            opacity: Layer opacity between 0.0 and 1.0.</span>
<span class="sd">            visible: Whether the layer should be visible initially.</span>
<span class="sd">            before_id: Optional layer ID to insert this layer before.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">layer_id</span> <span class="o">=</span> <span class="n">pmtiles_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.pmtiles&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">source_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_source&quot;</span>

        <span class="c1"># Add PMTiles source using pmtiles:// protocol</span>
        <span class="n">pmtiles_source_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;pmtiles://</span><span class="si">{</span><span class="n">pmtiles_url</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span>
            <span class="n">source_id</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;vector&quot;</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">pmtiles_source_url</span><span class="p">,</span>
                <span class="s2">&quot;attribution&quot;</span><span class="p">:</span> <span class="s2">&quot;PMTiles&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

        <span class="c1"># Add default layers if none provided</span>
        <span class="k">if</span> <span class="n">layers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">url_lower</span> <span class="o">=</span> <span class="n">pmtiles_url</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="c1"># Heuristic defaults:</span>
            <span class="c1"># - If this looks like an Overture Buildings dataset, add only the buildings layer.</span>
            <span class="c1"># - Otherwise, fall back to a simple protomaps-style set.</span>
            <span class="k">if</span> <span class="s2">&quot;buildings&quot;</span> <span class="ow">in</span> <span class="n">url_lower</span><span class="p">:</span>
                <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_buildings&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
                        <span class="s2">&quot;source-layer&quot;</span><span class="p">:</span> <span class="s2">&quot;buildings&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;paint&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;fill-color&quot;</span><span class="p">:</span> <span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="s2">&quot;fill-opacity&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">},</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_landuse&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
                        <span class="s2">&quot;source-layer&quot;</span><span class="p">:</span> <span class="s2">&quot;landuse&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;paint&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;fill-color&quot;</span><span class="p">:</span> <span class="s2">&quot;steelblue&quot;</span><span class="p">,</span> <span class="s2">&quot;fill-opacity&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_roads&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
                        <span class="s2">&quot;source-layer&quot;</span><span class="p">:</span> <span class="s2">&quot;roads&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;line&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;paint&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;line-color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;line-width&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_buildings&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
                        <span class="s2">&quot;source-layer&quot;</span><span class="p">:</span> <span class="s2">&quot;buildings&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;paint&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;fill-color&quot;</span><span class="p">:</span> <span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="s2">&quot;fill-opacity&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">},</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_water&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
                        <span class="s2">&quot;source-layer&quot;</span><span class="p">:</span> <span class="s2">&quot;water&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;paint&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;fill-color&quot;</span><span class="p">:</span> <span class="s2">&quot;lightblue&quot;</span><span class="p">,</span> <span class="s2">&quot;fill-opacity&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">},</span>
                    <span class="p">},</span>
                <span class="p">]</span>

        <span class="c1"># Add all layers</span>
        <span class="k">for</span> <span class="n">layer_config</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer_config</span><span class="p">,</span>
                <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span>
                <span class="n">layer_id</span><span class="o">=</span><span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
                <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_basemap</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">basemap</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">visible</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a basemap to the map using xyzservices providers.</span>

<span class="sd">        Args:</span>
<span class="sd">            basemap: Name of the basemap from xyzservices (e.g., &quot;Esri.WorldImagery&quot;).</span>
<span class="sd">                    Use available_basemaps to see all available options.</span>
<span class="sd">            layer_id: Optional ID for the basemap layer. If None, uses basemap name.</span>
<span class="sd">            before_id: Optional layer ID to insert this layer before.</span>
<span class="sd">                      If None, layer is added on top.</span>
<span class="sd">            visible: Whether the layer should be visible initially.</span>
<span class="sd">            **kwargs: Additional parameters passed to the basemap layer.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the specified basemap is not available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.basemaps</span><span class="w"> </span><span class="kn">import</span> <span class="n">available_basemaps</span>

        <span class="k">if</span> <span class="n">basemap</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_basemaps</span><span class="p">:</span>
            <span class="n">available_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">available_basemaps</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Basemap &#39;</span><span class="si">{</span><span class="n">basemap</span><span class="si">}</span><span class="s2">&#39; not found. Available basemaps: </span><span class="si">{</span><span class="n">available_names</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">basemap_config</span> <span class="o">=</span> <span class="n">available_basemaps</span><span class="p">[</span><span class="n">basemap</span><span class="p">]</span>

        <span class="c1"># Convert xyzservices URL template to tile URL</span>
        <span class="n">tile_url</span> <span class="o">=</span> <span class="n">basemap_config</span><span class="o">.</span><span class="n">build_url</span><span class="p">()</span>

        <span class="c1"># Get attribution if available</span>
        <span class="n">attribution</span> <span class="o">=</span> <span class="n">basemap_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attribution&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">layer_id</span> <span class="o">=</span> <span class="n">basemap</span>

        <span class="c1"># Add as raster layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_tile_layer</span><span class="p">(</span>
            <span class="n">layer_id</span><span class="o">=</span><span class="n">layer_id</span><span class="p">,</span>
            <span class="n">source_url</span><span class="o">=</span><span class="n">tile_url</span><span class="p">,</span>
            <span class="n">paint</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;raster-opacity&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
            <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span>
            <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_draw_control</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
        <span class="n">controls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">default_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;simple_select&quot;</span><span class="p">,</span>
        <span class="n">keybindings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">touch_enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">preserve_selection_on_edit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">styles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a draw control to the map for drawing and editing geometries.</span>

<span class="sd">        Args:</span>
<span class="sd">            position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">            controls: Dictionary specifying which drawing tools to show.</span>
<span class="sd">                     Defaults to {&#39;point&#39;: True, &#39;line_string&#39;: True, &#39;polygon&#39;: True, &#39;trash&#39;: True}</span>
<span class="sd">            default_mode: Initial interaction mode (&#39;simple_select&#39;, &#39;direct_select&#39;, &#39;draw_point&#39;, etc.)</span>
<span class="sd">            keybindings: Whether to enable keyboard shortcuts</span>
<span class="sd">            touch_enabled: Whether to enable touch interactions</span>
<span class="sd">            preserve_selection_on_edit: Whether to keep features selected during vertex editing/moving.</span>
<span class="sd">                                       If True, features remain selected after editing. If False, uses</span>
<span class="sd">                                       default MapboxDraw behavior (deselection after edit).</span>
<span class="sd">            styles: Optional list of custom MapboxDraw style objects. If None, uses default styles.</span>
<span class="sd">                   Each style should be a dict with &#39;id&#39;, &#39;type&#39;, &#39;filter&#39;, and &#39;paint&#39;/&#39;layout&#39; properties.</span>
<span class="sd">                   See MapboxDraw documentation for style object format.</span>
<span class="sd">            **kwargs: Additional options to pass to MapboxDraw constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">controls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">controls</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;line_string&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;polygon&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;trash&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="n">draw_options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;displayControlsDefault&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;controls&quot;</span><span class="p">:</span> <span class="n">controls</span><span class="p">,</span>
            <span class="s2">&quot;defaultMode&quot;</span><span class="p">:</span> <span class="n">default_mode</span><span class="p">,</span>
            <span class="s2">&quot;keybindings&quot;</span><span class="p">:</span> <span class="n">keybindings</span><span class="p">,</span>
            <span class="s2">&quot;touchEnabled&quot;</span><span class="p">:</span> <span class="n">touch_enabled</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;preserveSelectionOnEdit&quot;</span><span class="p">:</span> <span class="n">preserve_selection_on_edit</span><span class="p">,</span>
            <span class="s2">&quot;customStyles&quot;</span><span class="p">:</span> <span class="n">styles</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Store draw control configuration</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">draw_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;draw_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">draw_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;draw&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">draw_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addDrawControl&quot;</span><span class="p">,</span> <span class="n">draw_options</span><span class="p">)</span>

    <span class="c1"># Draw styles moved to draw_styles.py module</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geojson_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load GeoJSON data into the draw control.</span>

<span class="sd">        Args:</span>
<span class="sd">            geojson_data: GeoJSON data as dictionary or JSON string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geojson_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">geojson_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">geojson_data</span><span class="p">)</span>

        <span class="c1"># Update the trait immediately to ensure consistency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_data</span> <span class="o">=</span> <span class="n">geojson_data</span>

        <span class="c1"># Send to JavaScript</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;loadDrawData&quot;</span><span class="p">,</span> <span class="n">geojson_data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geojson_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add GeoJSON features to the existing draw control data.</span>

<span class="sd">        This method appends new features to the draw control without clearing</span>
<span class="sd">        existing drawn features, unlike load_draw_data which replaces all data.</span>

<span class="sd">        Args:</span>
<span class="sd">            geojson_data: GeoJSON data as dictionary or JSON string. Can be a</span>
<span class="sd">                         FeatureCollection or a single Feature.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geojson_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">geojson_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">geojson_data</span><span class="p">)</span>

        <span class="c1"># Normalize input to FeatureCollection if it&#39;s a single Feature</span>
        <span class="k">if</span> <span class="n">geojson_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Feature&quot;</span><span class="p">:</span>
            <span class="n">geojson_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">geojson_data</span><span class="p">]}</span>

        <span class="c1"># Send to JavaScript - it will handle adding features and syncing back the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addDrawData&quot;</span><span class="p">,</span> <span class="n">geojson_data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all drawn features as GeoJSON.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict containing GeoJSON FeatureCollection with drawn features</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Try to get current data first</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_data</span>

        <span class="c1"># If no data in trait, call JavaScript to get fresh data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;getDrawData&quot;</span><span class="p">)</span>
        <span class="c1"># Give JavaScript time to execute and sync data</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="c1"># Return the synced data or empty FeatureCollection if nothing</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_data</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_data</span>
            <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current draw data as GeoJSON.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_draw_data</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all drawn features from the draw control.&quot;&quot;&quot;</span>
        <span class="c1"># Clear the trait data immediately</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="c1"># Clear in JavaScript</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;clearDrawData&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_draw_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete specific features from the draw control.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature_ids: List of feature IDs to delete</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;deleteDrawFeatures&quot;</span><span class="p">,</span> <span class="n">feature_ids</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_draw_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the draw control mode.</span>

<span class="sd">        Args:</span>
<span class="sd">            mode: Draw mode (&#39;simple_select&#39;, &#39;direct_select&#39;, &#39;draw_point&#39;,</span>
<span class="sd">                 &#39;draw_line_string&#39;, &#39;draw_polygon&#39;, &#39;static&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setDrawMode&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">driver</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save drawn features to a file in various formats.</span>

<span class="sd">        Args:</span>
<span class="sd">            filepath: Path where to save the file. The file extension determines</span>
<span class="sd">                     the output format if driver is not specified.</span>
<span class="sd">            driver: GeoPandas driver name (e.g., &#39;GeoJSON&#39;, &#39;ESRI Shapefile&#39;, &#39;GPKG&#39;).</span>
<span class="sd">                   If None, inferred from file extension.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ImportError: If geopandas is not installed.</span>
<span class="sd">            ValueError: If no drawn features exist or invalid driver/format.</span>

<span class="sd">        Note:</span>
<span class="sd">            For shapefiles, all features must have the same geometry type.</span>
<span class="sd">            Use GeoJSON or GPKG formats for mixed geometry types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_GEOPANDAS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;geopandas is required for save_draw_data. &quot;</span>
                <span class="s2">&quot;Install it with: pip install geopandas&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Get the drawn features</span>
        <span class="n">draw_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_draw_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">draw_data</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">draw_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No drawn features to save&quot;</span><span class="p">)</span>

        <span class="c1"># Convert to GeoDataFrame</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="n">draw_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">])</span>

        <span class="c1"># Set a default CRS if not present</span>
        <span class="k">if</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gdf</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Save to file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Provide helpful error message for common shapefile issues</span>
            <span class="k">if</span> <span class="s2">&quot;shapefile&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">driver</span> <span class="ow">and</span> <span class="s2">&quot;shapefile&quot;</span> <span class="ow">in</span> <span class="n">driver</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="n">geometry_types</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">geom_type</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">geometry_types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Cannot save mixed geometry types </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">geometry_types</span><span class="p">)</span><span class="si">}</span><span class="s2"> to shapefile. &quot;</span>
                        <span class="s2">&quot;Use GeoJSON (.geojson) or GeoPackage (.gpkg) format instead.&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_terra_draw</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
        <span class="n">modes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">open</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a Terra Draw control to the map for drawing and editing geometries.</span>

<span class="sd">        Args:</span>
<span class="sd">            position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">            modes: List of drawing modes to enable. Available modes:</span>
<span class="sd">                  [&#39;render&#39;, &#39;point&#39;, &#39;linestring&#39;, &#39;polygon&#39;, &#39;rectangle&#39;, &#39;circle&#39;,</span>
<span class="sd">                   &#39;freehand&#39;, &#39;angled-rectangle&#39;, &#39;sensor&#39;, &#39;sector&#39;, &#39;select&#39;,</span>
<span class="sd">                   &#39;delete-selection&#39;, &#39;delete&#39;, &#39;download&#39;]</span>
<span class="sd">                  Defaults to all modes except &#39;render&#39;</span>
<span class="sd">            open: Whether the draw control panel should be open by default</span>
<span class="sd">            **kwargs: Additional options to pass to Terra Draw constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">modes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">modes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="c1"># &#39;render&#39;,  # Commented out to always show drawing tool</span>
                <span class="s2">&quot;point&quot;</span><span class="p">,</span>
                <span class="s2">&quot;linestring&quot;</span><span class="p">,</span>
                <span class="s2">&quot;polygon&quot;</span><span class="p">,</span>
                <span class="s2">&quot;rectangle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;circle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;freehand&quot;</span><span class="p">,</span>
                <span class="s2">&quot;angled-rectangle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sensor&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sector&quot;</span><span class="p">,</span>
                <span class="s2">&quot;select&quot;</span><span class="p">,</span>
                <span class="s2">&quot;delete-selection&quot;</span><span class="p">,</span>
                <span class="s2">&quot;delete&quot;</span><span class="p">,</span>
                <span class="s2">&quot;download&quot;</span><span class="p">,</span>
            <span class="p">]</span>

        <span class="n">terra_draw_options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="n">modes</span><span class="p">,</span>
            <span class="s2">&quot;open&quot;</span><span class="p">:</span> <span class="nb">open</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Mark that Terra Draw is enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_terra_draw_enabled</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Store Terra Draw control configuration</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">terra_draw_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;terra_draw_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">terra_draw_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;terra_draw&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">terra_draw_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addTerraDrawControl&quot;</span><span class="p">,</span> <span class="n">terra_draw_options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_terra_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all Terra Draw features as GeoJSON.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict containing GeoJSON FeatureCollection with drawn features</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Try to get current data first</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terra_draw_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terra_draw_data</span>

        <span class="c1"># If no data in trait, call JavaScript to get fresh data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;getTerraDrawData&quot;</span><span class="p">)</span>
        <span class="c1"># Give JavaScript time to execute and sync data</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="c1"># Return the synced data or empty FeatureCollection if nothing</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_terra_draw_data</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terra_draw_data</span>
            <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_terra_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all Terra Draw features from the draw control.&quot;&quot;&quot;</span>
        <span class="c1"># Clear the trait data immediately</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_terra_draw_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="c1"># Clear in JavaScript</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;clearTerraDrawData&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_terra_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geojson_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load GeoJSON data into the Terra Draw control.</span>

<span class="sd">        Args:</span>
<span class="sd">            geojson_data: GeoJSON data as dictionary or JSON string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geojson_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">geojson_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">geojson_data</span><span class="p">)</span>

        <span class="c1"># Update the trait immediately to ensure consistency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_terra_draw_data</span> <span class="o">=</span> <span class="n">geojson_data</span>

        <span class="c1"># Send to JavaScript</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;loadTerraDrawData&quot;</span><span class="p">,</span> <span class="n">geojson_data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_html_template</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">map_state</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate HTML template for MapLibre GL JS.</span>

<span class="sd">        Args:</span>
<span class="sd">            map_state: Dictionary containing the current map state including</span>
<span class="sd">                      center, zoom, style, layers, and sources.</span>
<span class="sd">            title: Title for the HTML page.</span>
<span class="sd">            **kwargs: Additional arguments for template customization.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Complete HTML string for a standalone MapLibre GL JS map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

        <span class="c1"># Get the directory of the current file</span>
        <span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
        <span class="n">template_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="s2">&quot;templates&quot;</span><span class="p">,</span> <span class="s2">&quot;maplibre_template.html&quot;</span><span class="p">)</span>

        <span class="c1"># Read the template file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">template_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">template_content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="c1"># Normalize double braces used to escape Python str.format in template assets.</span>
        <span class="c1"># We now do manual placeholder substitution, so convert &#39;{{&#39; -&gt; &#39;{&#39; and &#39;}}&#39; -&gt; &#39;}&#39;.</span>
        <span class="c1"># This fixes invalid CSS/JS like &#39;body {{ ... }}&#39; and &#39;${{x}}&#39; in the exported HTML.</span>
        <span class="n">template_content</span> <span class="o">=</span> <span class="n">template_content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;{{&quot;</span><span class="p">,</span> <span class="s2">&quot;{&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;}}&quot;</span><span class="p">,</span> <span class="s2">&quot;}&quot;</span><span class="p">)</span>

        <span class="c1"># Serialize map state for JavaScript</span>
        <span class="n">map_state_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">map_state</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Replace placeholders with actual values using safe string replacement</span>
        <span class="c1"># to avoid conflicts with single-brace usage throughout the template.</span>
        <span class="n">html_template</span> <span class="o">=</span> <span class="n">template_content</span>
        <span class="n">html_template</span> <span class="o">=</span> <span class="n">html_template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{title}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
        <span class="n">html_template</span> <span class="o">=</span> <span class="n">html_template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{width}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]))</span>
        <span class="n">html_template</span> <span class="o">=</span> <span class="n">html_template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{height}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]))</span>
        <span class="n">html_template</span> <span class="o">=</span> <span class="n">html_template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{map_state_json}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">map_state_json</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">html_template</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update current state attributes from moveend event.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;center&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_current_center</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;center&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;zoom&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_current_zoom</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;zoom&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;bearing&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_current_bearing</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;bearing&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;pitch&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_current_pitch</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;pitch&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;bounds&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_current_bounds</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;bounds&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lng</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lat</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the map center coordinates.</span>

<span class="sd">        Args:</span>
<span class="sd">            lng: Longitude coordinate.</span>
<span class="sd">            lat: Latitude coordinate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="n">lng</span><span class="p">,</span> <span class="n">lat</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_center</span> <span class="o">=</span> <span class="p">[</span><span class="n">lng</span><span class="p">,</span> <span class="n">lat</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zoom</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the map zoom level.</span>

<span class="sd">        Args:</span>
<span class="sd">            zoom: Zoom level (typically 0-20).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span> <span class="o">=</span> <span class="n">zoom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_zoom</span> <span class="o">=</span> <span class="n">zoom</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">current_center</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current map center coordinates as [longitude, latitude].&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_center</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">current_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current map zoom level.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_zoom</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">current_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current map bounds as [[lng, lat], [lng, lat]] (southwest, northeast).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_bounds</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">viewstate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current map viewstate including center, zoom, bearing, pitch, and bounds.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_center</span><span class="p">,</span>
            <span class="s2">&quot;zoom&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_zoom</span><span class="p">,</span>
            <span class="s2">&quot;bearing&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_bearing</span><span class="p">,</span>
            <span class="s2">&quot;pitch&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_pitch</span><span class="p">,</span>
            <span class="s2">&quot;bounds&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_bounds</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_cog_metadata</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EPSG:4326&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve metadata from a Cloud Optimized GeoTIFF (COG) file.</span>

<span class="sd">        This method fetches metadata from a COG file. It uses rasterio if available,</span>
<span class="sd">        which provides comprehensive metadata extraction capabilities.</span>

<span class="sd">        Note:</span>
<span class="sd">            This feature corresponds to the getCogMetadata function in maplibre-cog-protocol,</span>
<span class="sd">            which is marked as [unstable]. Some metadata internals may change in future releases.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): The URL of the COG file to retrieve metadata from.</span>
<span class="sd">            crs (str, optional): The coordinate reference system to use for the output bbox.</span>
<span class="sd">                Defaults to &quot;EPSG:4326&quot; (WGS84 lat/lon). Set to None to use the COG&#39;s native CRS.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[Dict[str, Any]]: A dictionary containing COG metadata with keys such as:</span>
<span class="sd">                - bbox: Bounding box coordinates [west, south, east, north] in the specified CRS</span>
<span class="sd">                - bounds: BoundingBox in native CRS</span>
<span class="sd">                - width: Width of the raster in pixels</span>
<span class="sd">                - height: Height of the raster in pixels</span>
<span class="sd">                - crs: Original coordinate reference system of the COG</span>
<span class="sd">                - output_crs: CRS of the returned bbox</span>
<span class="sd">                - transform: Affine transformation matrix</span>
<span class="sd">                - count: Number of bands</span>
<span class="sd">                - dtypes: Data types for each band</span>
<span class="sd">                - nodata: NoData value</span>
<span class="sd">                - scale: Scale value (if available)</span>
<span class="sd">                - offset: Offset value (if available)</span>
<span class="sd">            Returns None if metadata retrieval fails.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; m = MapLibreMap()</span>
<span class="sd">            &gt;&gt;&gt; url = &quot;https://example.com/data.tif&quot;</span>
<span class="sd">            &gt;&gt;&gt; # Get metadata with bbox in WGS84 (default)</span>
<span class="sd">            &gt;&gt;&gt; metadata = m.get_cog_metadata(url)</span>
<span class="sd">            &gt;&gt;&gt; if metadata:</span>
<span class="sd">            ...     print(f&quot;Bounding box (WGS84): {metadata.get(&#39;bbox&#39;)}&quot;)</span>
<span class="sd">            ...     # Fit bounds using WGS84 coordinates</span>
<span class="sd">            ...     bbox = metadata[&#39;bbox&#39;]</span>
<span class="sd">            ...     m.fit_bounds([[bbox[0], bbox[1]], [bbox[2], bbox[3]]])</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Get metadata in native CRS</span>
<span class="sd">            &gt;&gt;&gt; metadata = m.get_cog_metadata(url, crs=None)</span>
<span class="sd">            &gt;&gt;&gt; if metadata:</span>
<span class="sd">            ...     print(f&quot;Native CRS: {metadata.get(&#39;crs&#39;)}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_cog_metadata</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_basemap_control</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
        <span class="n">basemaps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">initial_basemap</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">expand_direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a basemap control to the map for switching between different basemaps.</span>

<span class="sd">        The basemap control allows users to switch between different basemap providers</span>
<span class="sd">        using a dropdown or expandable control. It uses the maplibre-gl-basemaps library.</span>

<span class="sd">        Args:</span>
<span class="sd">            position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">            basemaps: List of basemap names to include. If None, uses a default set.</span>
<span class="sd">                     Available basemaps can be found in anymap.basemaps.available_basemaps</span>
<span class="sd">            labels: Dictionary mapping basemap names to display labels. If None, uses basemap names.</span>
<span class="sd">            initial_basemap: Name of the initial basemap to show. If None, uses the first basemap.</span>
<span class="sd">            expand_direction: Direction to expand the control (&#39;up&#39;, &#39;down&#39;, &#39;left&#39;, &#39;right&#39;)</span>
<span class="sd">            options: Additional options for the basemap control</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; m = MapLibreMap()</span>
<span class="sd">            &gt;&gt;&gt; m.add_basemap_control(</span>
<span class="sd">            ...     position=&quot;top-right&quot;,</span>
<span class="sd">            ...     basemaps=[&quot;OpenStreetMap.Mapnik&quot;, &quot;Esri.WorldImagery&quot;, &quot;CartoDB.DarkMatter&quot;],</span>
<span class="sd">            ...     labels={&quot;OpenStreetMap.Mapnik&quot;: &quot;OpenStreetMap&quot;, &quot;Esri.WorldImagery&quot;: &quot;Satellite&quot;},</span>
<span class="sd">            ...     initial_basemap=&quot;OpenStreetMap.Mapnik&quot;</span>
<span class="sd">            ... )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.basemaps</span><span class="w"> </span><span class="kn">import</span> <span class="n">available_basemaps</span>

        <span class="c1"># Default basemaps if none provided</span>
        <span class="k">if</span> <span class="n">basemaps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">basemaps</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;OpenStreetMap.Mapnik&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Esri.WorldImagery&quot;</span><span class="p">,</span>
                <span class="s2">&quot;CartoDB.DarkMatter&quot;</span><span class="p">,</span>
                <span class="s2">&quot;CartoDB.Positron&quot;</span><span class="p">,</span>
            <span class="p">]</span>

        <span class="c1"># Filter available basemaps to only include those that exist</span>
        <span class="n">valid_basemaps</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">basemaps</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">available_basemaps</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_basemaps</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No valid basemaps found. Available basemaps: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">available_basemaps</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Set initial basemap if not provided</span>
        <span class="k">if</span> <span class="n">initial_basemap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">initial_basemap</span> <span class="o">=</span> <span class="n">valid_basemaps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">initial_basemap</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_basemaps</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Initial basemap &#39;</span><span class="si">{</span><span class="n">initial_basemap</span><span class="si">}</span><span class="s2">&#39; not found in provided basemaps&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Create basemap configurations for the control</span>
        <span class="n">basemap_configs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">basemap_name</span> <span class="ow">in</span> <span class="n">valid_basemaps</span><span class="p">:</span>
            <span class="n">basemap_provider</span> <span class="o">=</span> <span class="n">available_basemaps</span><span class="p">[</span><span class="n">basemap_name</span><span class="p">]</span>
            <span class="n">tile_url</span> <span class="o">=</span> <span class="n">basemap_provider</span><span class="o">.</span><span class="n">build_url</span><span class="p">()</span>
            <span class="n">attribution</span> <span class="o">=</span> <span class="n">basemap_provider</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attribution&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="c1"># Use custom label if provided, otherwise use basemap name</span>
            <span class="n">display_label</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">basemap_name</span><span class="p">,</span> <span class="n">basemap_name</span><span class="p">)</span> <span class="k">if</span> <span class="n">labels</span> <span class="k">else</span> <span class="n">basemap_name</span>
            <span class="p">)</span>

            <span class="n">basemap_config</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">basemap_name</span><span class="p">,</span>
                <span class="s2">&quot;tiles&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">tile_url</span><span class="p">],</span>
                <span class="s2">&quot;sourceExtraParams&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;tileSize&quot;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
                    <span class="s2">&quot;attribution&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">,</span>
                    <span class="s2">&quot;minzoom&quot;</span><span class="p">:</span> <span class="n">basemap_provider</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;min_zoom&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="s2">&quot;maxzoom&quot;</span><span class="p">:</span> <span class="n">basemap_provider</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_zoom&quot;</span><span class="p">,</span> <span class="mi">22</span><span class="p">),</span>
                <span class="p">},</span>
                <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">display_label</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">basemap_configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">basemap_config</span><span class="p">)</span>

        <span class="n">control_options</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
                <span class="s2">&quot;basemaps&quot;</span><span class="p">:</span> <span class="n">basemap_configs</span><span class="p">,</span>
                <span class="s2">&quot;initialBasemap&quot;</span><span class="p">:</span> <span class="n">initial_basemap</span><span class="p">,</span>
                <span class="s2">&quot;expandDirection&quot;</span><span class="p">:</span> <span class="n">expand_direction</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Store control in persistent state</span>
        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;basemap_control_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basemap_control&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;basemap_control&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_temporal_control</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">frames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
        <span class="n">interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">performance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a temporal control to the map for animating time-series data.</span>

<span class="sd">        The temporal control enables animation of map layers across time, allowing</span>
<span class="sd">        users to visualize changes over time with playback controls. It uses the</span>
<span class="sd">        maplibre-gl-temporal-control plugin.</span>

<span class="sd">        Args:</span>
<span class="sd">            frames: List of frame configurations. Each frame is a dictionary with:</span>
<span class="sd">                - title: Display name for the frame (e.g., &quot;2020-01-01&quot;)</span>
<span class="sd">                - layers: List of layer IDs to show in this frame</span>
<span class="sd">            position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">            interval: Duration to display each frame in milliseconds. Default is 1000 (1 second).</span>
<span class="sd">            performance: Enable performance mode for slower systems. Default is False.</span>
<span class="sd">            options: Additional options for the temporal control</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; m = MapLibreMap()</span>
<span class="sd">            &gt;&gt;&gt; # Add layers for different time periods</span>
<span class="sd">            &gt;&gt;&gt; m.add_geojson_layer(&quot;data-2020&quot;, geojson_2020, &quot;circle&quot;, paint={&quot;circle-color&quot;: &quot;red&quot;})</span>
<span class="sd">            &gt;&gt;&gt; m.add_geojson_layer(&quot;data-2021&quot;, geojson_2021, &quot;circle&quot;, paint={&quot;circle-color&quot;: &quot;blue&quot;})</span>
<span class="sd">            &gt;&gt;&gt; m.add_geojson_layer(&quot;data-2022&quot;, geojson_2022, &quot;circle&quot;, paint={&quot;circle-color&quot;: &quot;green&quot;})</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Configure temporal frames</span>
<span class="sd">            &gt;&gt;&gt; frames = [</span>
<span class="sd">            ...     {&quot;title&quot;: &quot;2020&quot;, &quot;layers&quot;: [&quot;data-2020&quot;]},</span>
<span class="sd">            ...     {&quot;title&quot;: &quot;2021&quot;, &quot;layers&quot;: [&quot;data-2021&quot;]},</span>
<span class="sd">            ...     {&quot;title&quot;: &quot;2022&quot;, &quot;layers&quot;: [&quot;data-2022&quot;]},</span>
<span class="sd">            ... ]</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Add temporal control</span>
<span class="sd">            &gt;&gt;&gt; m.add_temporal_control(</span>
<span class="sd">            ...     frames=frames,</span>
<span class="sd">            ...     position=&quot;top-right&quot;,</span>
<span class="sd">            ...     interval=2000  # 2 seconds per frame</span>
<span class="sd">            ... )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">frames</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one frame must be provided&quot;</span><span class="p">)</span>

        <span class="n">control_options</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
                <span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="n">frames</span><span class="p">,</span>
                <span class="s2">&quot;interval&quot;</span><span class="p">:</span> <span class="n">interval</span><span class="p">,</span>
                <span class="s2">&quot;performance&quot;</span><span class="p">:</span> <span class="n">performance</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Store control in persistent state</span>
        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;temporal_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;temporal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;temporal&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_infobox_control</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">formatter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">collapsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an InfoBox control (mapbox-gl-infobox) to display feature attributes.</span>

<span class="sd">        Args:</span>
<span class="sd">            position: Control position (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;).</span>
<span class="sd">            layer_id: Optional target layer id to listen for hover/click features.</span>
<span class="sd">            formatter: Either an HTML template string (e.g., &quot;&lt;b&gt;{{name}}&lt;/b&gt;&quot;) or a callable</span>
<span class="sd">                taking a properties dict and returning HTML. Strings will be templated against</span>
<span class="sd">                feature properties; unknown keys render as empty.</span>
<span class="sd">            collapsed: Whether the control starts collapsed.</span>
<span class="sd">            options: Additional plugin options passed through.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">control_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
                <span class="s2">&quot;collapsed&quot;</span><span class="p">:</span> <span class="n">collapsed</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;layerId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_id</span>
        <span class="k">if</span> <span class="n">formatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Strings are handled as templates in JS; callables cannot be serialized</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">formatter</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;formatter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatter</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Best-effort stringification to avoid non-serializable objects</span>
                <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;formatter_template&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>

        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;infobox_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;infobox&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;infobox&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_gradientbox_control</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">weight_property</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">min_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">colors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">collapsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a GradientBox control (mapbox-gl-infobox) to show value legend.</span>

<span class="sd">        Args:</span>
<span class="sd">            position: Control position.</span>
<span class="sd">            layer_id: Optional target layer id used for value extraction.</span>
<span class="sd">            weight_property: Feature property name used to compute weights.</span>
<span class="sd">            min_value: Minimum value for gradient legend.</span>
<span class="sd">            max_value: Maximum value for gradient legend.</span>
<span class="sd">            collapsed: Whether the control starts collapsed.</span>
<span class="sd">            options: Additional plugin options.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">control_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
                <span class="s2">&quot;collapsed&quot;</span><span class="p">:</span> <span class="n">collapsed</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;layerId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_id</span>
        <span class="k">if</span> <span class="n">weight_property</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;weight_property&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight_property</span>
        <span class="k">if</span> <span class="n">min_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">max_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># JS layer will normalize into minMaxValues</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;min_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_value</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;max_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_value</span>
        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span>

        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;gradientbox_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;gradientbox&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;gradientbox&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_legend_control</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bottom-left&quot;</span><span class="p">,</span>
        <span class="n">show_default</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">show_checkbox</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">only_rendered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">reverse_order</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">label_overrides</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">toggle_icon</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a Legend control (watergis/mapbox-gl-legend) to the map.</span>

<span class="sd">        The legend control inspects map layers and renders a legend UI. It works</span>
<span class="sd">        best when layers include helpful `metadata` such as a human-readable</span>
<span class="sd">        name, unit, or labels.</span>

<span class="sd">        Args:</span>
<span class="sd">            position: Control position (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;).</span>
<span class="sd">            show_default: Whether to show default legend items inferred from layers.</span>
<span class="sd">            show_checkbox: Whether to include visibility checkboxes per item.</span>
<span class="sd">            only_rendered: If True, only include layers currently rendered in viewport.</span>
<span class="sd">            reverse_order: If True, reverse the legend item order.</span>
<span class="sd">            options: Additional plugin options forwarded to LegendControl.</span>
<span class="sd">            targets: Optional mapping of layer IDs to include in the legend. When</span>
<span class="sd">                provided, only these layers will appear (matching plugin behaviour).</span>
<span class="sd">            label_overrides: Optional mapping of layer IDs to custom legend labels.</span>
<span class="sd">                When omitted, labels are derived from layer metadata and fall back</span>
<span class="sd">                to layer ids. This does not restrict which layers are shown.</span>
<span class="sd">            max_height: Optional CSS size (e.g. 320, &quot;320px&quot;, &quot;60vh&quot;) used to cap the</span>
<span class="sd">                legend panel height. When provided, a scrollbar appears if content</span>
<span class="sd">                exceeds this limit.</span>
<span class="sd">            toggle_icon: Optional HTML string or Unicode glyph for the collapsed</span>
<span class="sd">                legend toggle button. Defaults to a list-style icon if omitted.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_derive_labels</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
            <span class="n">derived</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">layer_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">layer_config</span> <span class="o">=</span> <span class="n">layer_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layer&quot;</span><span class="p">,</span> <span class="p">{})</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer_config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">layer_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;background&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;visible&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="n">metadata</span> <span class="o">=</span> <span class="n">layer_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
                <span class="n">legend_meta</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;legend&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">legend_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exclude&quot;</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="n">label</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">legend_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">legend_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">legend_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">layer_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">layer_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">layer_id</span>
                <span class="p">)</span>
                <span class="n">derived</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>

            <span class="k">return</span> <span class="n">derived</span>

        <span class="n">control_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
                <span class="s2">&quot;showDefault&quot;</span><span class="p">:</span> <span class="n">show_default</span><span class="p">,</span>
                <span class="s2">&quot;showCheckbox&quot;</span><span class="p">:</span> <span class="n">show_checkbox</span><span class="p">,</span>
                <span class="s2">&quot;onlyRendered&quot;</span><span class="p">:</span> <span class="n">only_rendered</span><span class="p">,</span>
                <span class="s2">&quot;reverseOrder&quot;</span><span class="p">:</span> <span class="n">reverse_order</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;targets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">max_height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_height</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="n">max_height_value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">max_height</span><span class="si">}</span><span class="s2">px&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_height_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_height</span><span class="p">)</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;maxHeight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_height_value</span>

        <span class="k">if</span> <span class="n">toggle_icon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;toggleIcon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">toggle_icon</span><span class="p">)</span>

        <span class="n">auto_labels</span> <span class="o">=</span> <span class="n">_derive_labels</span><span class="p">()</span>
        <span class="n">merged_labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">auto_labels</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">label_map</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="n">control_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;label_overrides&quot;</span><span class="p">),</span>
            <span class="n">control_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;labelOverrides&quot;</span><span class="p">),</span>
            <span class="n">label_overrides</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">label_map</span><span class="p">:</span>
                <span class="n">merged_labels</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">label_map</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">merged_labels</span><span class="p">:</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;label_overrides&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_labels</span>

        <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;legend_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;legend&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;legend&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_deckgl_props</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process DeckGL properties to handle lambda functions and other non-serializable objects.</span>

<span class="sd">        Args:</span>
<span class="sd">            props: Dictionary of DeckGL layer properties.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Processed properties dictionary with serializable values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">processed_props</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="c1"># Handle lambda functions and other callables</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;&lt;lambda&gt;&quot;</span><span class="p">:</span>
                    <span class="c1"># For lambda functions, we&#39;ll need to convert them to accessor strings</span>
                    <span class="c1"># This is a simplified approach - in practice, you might want to</span>
                    <span class="c1"># inspect the lambda to generate appropriate accessors</span>
                    <span class="n">processed_props</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;@@=d =&gt; d.</span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># For named functions, convert to string representation</span>
                    <span class="n">processed_props</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Keep other values as-is</span>
                <span class="n">processed_props</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">processed_props</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_deckgl_layer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">layer_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
        <span class="n">props</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a DeckGL layer to the map.</span>

<span class="sd">        This method adds a DeckGL layer overlay to the MapLibre map. DeckGL provides</span>
<span class="sd">        high-performance visualization of large datasets with WebGL-powered layers.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Unique identifier for the DeckGL layer.</span>
<span class="sd">            layer_type: Type of DeckGL layer (e.g., &#39;ScatterplotLayer&#39;, &#39;PathLayer&#39;, &#39;GeoJsonLayer&#39;).</span>
<span class="sd">            data: Data for the layer. Can be a list of objects or GeoJSON-like structure.</span>
<span class="sd">            props: Layer-specific properties for styling and behavior.</span>
<span class="sd">            visible: Whether the layer should be visible initially.</span>
<span class="sd">            **kwargs: Additional layer properties.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; m = MapLibreMap()</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Add a scatterplot layer</span>
<span class="sd">            &gt;&gt;&gt; data = [</span>
<span class="sd">            ...     {&quot;position&quot;: [-122.4, 37.8], &quot;radius&quot;: 100, &quot;color&quot;: [255, 0, 0]},</span>
<span class="sd">            ...     {&quot;position&quot;: [-74.0, 40.7], &quot;radius&quot;: 150, &quot;color&quot;: [0, 255, 0]}</span>
<span class="sd">            ... ]</span>
<span class="sd">            &gt;&gt;&gt; m.add_deckgl_layer(</span>
<span class="sd">            ...     &quot;my_points&quot;,</span>
<span class="sd">            ...     &quot;ScatterplotLayer&quot;,</span>
<span class="sd">            ...     data,</span>
<span class="sd">            ...     props={</span>
<span class="sd">            ...         &quot;getPosition&quot;: &quot;position&quot;,</span>
<span class="sd">            ...         &quot;getRadius&quot;: &quot;radius&quot;,</span>
<span class="sd">            ...         &quot;getFillColor&quot;: &quot;color&quot;,</span>
<span class="sd">            ...         &quot;pickable&quot;: True</span>
<span class="sd">            ...     }</span>
<span class="sd">            ... )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">props</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">props</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Merge kwargs into props</span>
        <span class="n">layer_props</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">props</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">}</span>

        <span class="c1"># Convert lambda functions to JavaScript-compatible strings</span>
        <span class="n">layer_props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_deckgl_props</span><span class="p">(</span><span class="n">layer_props</span><span class="p">)</span>

        <span class="n">layer_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">layer_type</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
            <span class="s2">&quot;props&quot;</span><span class="p">:</span> <span class="n">layer_props</span><span class="p">,</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">visible</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Store layer in local state</span>
        <span class="n">current_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">)</span>
        <span class="n">current_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span> <span class="o">=</span> <span class="n">current_layers</span>

        <span class="c1"># Send to JavaScript</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addDeckGLLayer&quot;</span><span class="p">,</span> <span class="n">layer_config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_deckgl_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a DeckGL layer from the map.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Unique identifier of the DeckGL layer to remove.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Remove from local state</span>
        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">:</span>
            <span class="n">current_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">current_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span> <span class="o">=</span> <span class="n">current_layers</span>

        <span class="c1"># Send to JavaScript</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeDeckGLLayer&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_deckgl_layer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">props</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update a DeckGL layer&#39;s data or properties.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Unique identifier of the DeckGL layer to update.</span>
<span class="sd">            data: New data for the layer. If None, data is not updated.</span>
<span class="sd">            props: New or updated properties for the layer.</span>
<span class="sd">            **kwargs: Additional layer properties to update.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DeckGL layer &#39;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>

        <span class="c1"># Get current layer config</span>
        <span class="n">current_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">)</span>
        <span class="n">layer_config</span> <span class="o">=</span> <span class="n">current_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Update data if provided</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

        <span class="c1"># Update properties if provided</span>
        <span class="k">if</span> <span class="n">props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">current_props</span> <span class="o">=</span> <span class="n">layer_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;props&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">if</span> <span class="n">props</span><span class="p">:</span>
                <span class="n">current_props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">current_props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># Process the updated props to handle lambda functions</span>
            <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;props&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_deckgl_props</span><span class="p">(</span><span class="n">current_props</span><span class="p">)</span>

        <span class="c1"># Store updated config</span>
        <span class="n">current_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span> <span class="o">=</span> <span class="n">current_layers</span>

        <span class="c1"># Send to JavaScript</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;updateDeckGLLayer&quot;</span><span class="p">,</span> <span class="n">layer_config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_deckgl_layer_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the visibility of a DeckGL layer.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_id: Unique identifier of the DeckGL layer.</span>
<span class="sd">            visible: Whether the layer should be visible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">:</span>
            <span class="n">current_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">)</span>
            <span class="n">current_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">][</span><span class="s2">&quot;visible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">visible</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span> <span class="o">=</span> <span class="n">current_layers</span>

            <span class="c1"># Send to JavaScript</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setDeckGLLayerVisibility&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_deckgl_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all DeckGL layers currently on the map.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary mapping layer IDs to their configurations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_deckgl_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove all DeckGL layers from the map.&quot;&quot;&quot;</span>
        <span class="c1"># Clear local state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Send to JavaScript</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;clearDeckGLLayers&quot;</span><span class="p">)</span>

    <span class="c1"># Three.js / MapLibre Three Plugin methods</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">init_three_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the MapLibre Three.js scene.</span>

<span class="sd">        This must be called before adding any 3D models or lights.</span>
<span class="sd">        It initializes the MapScene object that connects MapLibre GL JS with Three.js.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; m = MapLibreMap(center=[148.9819, -35.3981], zoom=18, pitch=60)</span>
<span class="sd">            &gt;&gt;&gt; m.init_three_scene()</span>
<span class="sd">            &gt;&gt;&gt; m.add_three_light(light_type=&#39;ambient&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;initMapScene&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_three_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">coordinates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">scale</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">rotation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a 3D GLTF model to the map using Three.js.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_id: Unique identifier for the 3D model.</span>
<span class="sd">            url: URL to the GLTF/GLB model file.</span>
<span class="sd">            coordinates: Geographic coordinates [longitude, latitude] where the model should be placed.</span>
<span class="sd">            scale: Scale factor for the model. Can be a single number or [x, y, z] list.</span>
<span class="sd">            rotation: Optional rotation in radians as [x, y, z].</span>
<span class="sd">            **kwargs: Additional options for the model.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; m = MapLibreMap(center=[148.9819, -35.3981], zoom=18, pitch=60)</span>
<span class="sd">            &gt;&gt;&gt; m.init_three_scene()</span>
<span class="sd">            &gt;&gt;&gt; m.add_three_light(type=&#39;ambient&#39;)</span>
<span class="sd">            &gt;&gt;&gt; m.add_three_model(</span>
<span class="sd">            ...     model_id=&#39;my_model&#39;,</span>
<span class="sd">            ...     url=&#39;https://example.com/model.gltf&#39;,</span>
<span class="sd">            ...     coordinates=[148.9819, -35.3981],</span>
<span class="sd">            ...     scale=100,</span>
<span class="sd">            ...     rotation=[0, 0, 0]</span>
<span class="sd">            ... )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">model_id</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
            <span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="n">coordinates</span><span class="p">,</span>
            <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="n">scale</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model_config</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotation</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addThreeModel&quot;</span><span class="p">,</span> <span class="n">model_config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_three_light</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">light_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ambient&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mh">0xFFFFFF</span><span class="p">,</span>
        <span class="n">intensity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">light_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cast_shadow</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">shadow_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sun_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a light to the Three.js scene.</span>

<span class="sd">        Args:</span>
<span class="sd">            light_type: Type of light (&#39;ambient&#39;, &#39;directional&#39;, or &#39;sun&#39;).</span>
<span class="sd">            color: Hexadecimal color value for the light (e.g., 0xffffff for white).</span>
<span class="sd">            intensity: Light intensity value.</span>
<span class="sd">            position: Optional position for directional lights as [x, y, z].</span>
<span class="sd">            light_id: Optional identifier for the light so it can be updated or removed later.</span>
<span class="sd">            target: Optional target position for directional lights as [x, y, z].</span>
<span class="sd">            cast_shadow: Whether the light should cast shadows (if supported by the light type).</span>
<span class="sd">            shadow_options: Additional shadow configuration such as map size or clipping planes.</span>
<span class="sd">            sun_options: Additional options when using the `sun` light type (e.g., ``{&quot;current_time&quot;: &quot;2024-01-01T12:00:00Z&quot;}``).</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; m = MapLibreMap(center=[148.9819, -35.3981], zoom=18, pitch=60)</span>
<span class="sd">            &gt;&gt;&gt; m.init_three_scene()</span>
<span class="sd">            &gt;&gt;&gt; m.add_three_light(light_type=&#39;ambient&#39;, intensity=0.5)</span>
<span class="sd">            &gt;&gt;&gt; m.add_three_light(light_type=&#39;directional&#39;, position=[1, 1, 1])</span>
<span class="sd">            &gt;&gt;&gt; m.add_three_light(light_type=&#39;sun&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">light_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">light_type</span><span class="p">,</span>
            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span>
            <span class="s2">&quot;intensity&quot;</span><span class="p">:</span> <span class="n">intensity</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">light_config</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>
        <span class="k">if</span> <span class="n">light_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">light_config</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">light_id</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">light_config</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">if</span> <span class="n">cast_shadow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">light_config</span><span class="p">[</span><span class="s2">&quot;castShadow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast_shadow</span>
        <span class="k">if</span> <span class="n">shadow_options</span><span class="p">:</span>
            <span class="n">light_config</span><span class="p">[</span><span class="s2">&quot;shadowOptions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shadow_options</span>
        <span class="k">if</span> <span class="n">sun_options</span><span class="p">:</span>
            <span class="n">light_config</span><span class="p">[</span><span class="s2">&quot;sunOptions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sun_options</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addThreeLight&quot;</span><span class="p">,</span> <span class="n">light_config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_three_light</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">light_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">intensity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cast_shadow</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">shadow_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sun_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update properties of an existing Three.js light.&quot;&quot;&quot;</span>

        <span class="n">update_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">light_id</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
        <span class="k">if</span> <span class="n">intensity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intensity</span>
        <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">if</span> <span class="n">cast_shadow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;castShadow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast_shadow</span>
        <span class="k">if</span> <span class="n">shadow_options</span><span class="p">:</span>
            <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;shadowOptions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shadow_options</span>
        <span class="k">if</span> <span class="n">sun_options</span><span class="p">:</span>
            <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;sunOptions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sun_options</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;updateThreeLight&quot;</span><span class="p">,</span> <span class="n">update_config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_three_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">light_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a Three.js light from the scene.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeThreeLight&quot;</span><span class="p">,</span> <span class="n">light_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_three_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a 3D model from the scene.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_id: Unique identifier of the model to remove.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; m.remove_three_model(&#39;my_model&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeThreeModel&quot;</span><span class="p">,</span> <span class="n">model_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_three_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rotation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update properties of an existing 3D model.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_id: Unique identifier of the model to update.</span>
<span class="sd">            position: Optional new position as [x, y, z].</span>
<span class="sd">            scale: Optional new scale. Can be a single number or [x, y, z] list.</span>
<span class="sd">            rotation: Optional new rotation in radians as [x, y, z].</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; m.update_three_model(&#39;my_model&#39;, scale=200, rotation=[0, 1.57, 0])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">update_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">model_id</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="k">if</span> <span class="n">rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotation</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;updateThreeModel&quot;</span><span class="p">,</span> <span class="n">update_config</span><span class="p">)</span>

    <span class="c1"># 3D Tiles helpers</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_three_tileset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tileset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">asset_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ion_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">auto_refresh_token</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">auto_disable_renderer_culling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">fetch_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">lru_cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">draco_decoder_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ktx2_transcoder_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">use_fade</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">use_unload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">use_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">height_offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">fly_to</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a 3D Tiles dataset to the scene using TilesRenderer.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">asset_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Either asset_id or url must be provided for add_three_tileset&quot;</span>
            <span class="p">)</span>

        <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">tileset_id</span><span class="p">,</span>
            <span class="s2">&quot;assetId&quot;</span><span class="p">:</span> <span class="n">asset_id</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
            <span class="s2">&quot;ionToken&quot;</span><span class="p">:</span> <span class="n">ion_token</span><span class="p">,</span>
            <span class="s2">&quot;autoRefreshToken&quot;</span><span class="p">:</span> <span class="n">auto_refresh_token</span><span class="p">,</span>
            <span class="s2">&quot;autoDisableRendererCulling&quot;</span><span class="p">:</span> <span class="n">auto_disable_renderer_culling</span><span class="p">,</span>
            <span class="s2">&quot;fetchOptions&quot;</span><span class="p">:</span> <span class="n">fetch_options</span><span class="p">,</span>
            <span class="s2">&quot;lruCache&quot;</span><span class="p">:</span> <span class="n">lru_cache</span><span class="p">,</span>
            <span class="s2">&quot;dracoDecoderPath&quot;</span><span class="p">:</span> <span class="n">draco_decoder_path</span><span class="p">,</span>
            <span class="s2">&quot;ktx2TranscoderPath&quot;</span><span class="p">:</span> <span class="n">ktx2_transcoder_path</span><span class="p">,</span>
            <span class="s2">&quot;useDebug&quot;</span><span class="p">:</span> <span class="n">use_debug</span><span class="p">,</span>
            <span class="s2">&quot;useFade&quot;</span><span class="p">:</span> <span class="n">use_fade</span><span class="p">,</span>
            <span class="s2">&quot;useUnload&quot;</span><span class="p">:</span> <span class="n">use_unload</span><span class="p">,</span>
            <span class="s2">&quot;useUpdate&quot;</span><span class="p">:</span> <span class="n">use_update</span><span class="p">,</span>
            <span class="s2">&quot;heightOffset&quot;</span><span class="p">:</span> <span class="n">height_offset</span><span class="p">,</span>
            <span class="s2">&quot;flyTo&quot;</span><span class="p">:</span> <span class="n">fly_to</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Remove None values to keep payload minimal</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addThreeTileset&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_three_tileset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tileset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a 3D Tiles dataset from the scene.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeThreeTileset&quot;</span><span class="p">,</span> <span class="n">tileset_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_three_tileset_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tileset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adjust the height offset applied to a 3D Tiles dataset.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span>
            <span class="s2">&quot;setThreeTilesetHeight&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">tileset_id</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">height</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fly_to_three_tileset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tileset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Animate the camera to frame a 3D Tiles dataset.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;flyToThreeTileset&quot;</span><span class="p">,</span> <span class="n">tileset_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_html</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Anymap Export&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;100%&quot;</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;600px&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export the map to a standalone HTML file with DeckGL layers.</span>

<span class="sd">        This method extends the base to_html method to include DeckGL layer state.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: Optional filename to save the HTML. If None, returns HTML string.</span>
<span class="sd">            title: Title for the HTML page.</span>
<span class="sd">            width: Width of the map container as CSS string.</span>
<span class="sd">            height: Height of the map container as CSS string.</span>
<span class="sd">            **kwargs: Additional arguments passed to the HTML template.</span>

<span class="sd">        Returns:</span>
<span class="sd">            HTML string content of the exported map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the current map state</span>
        <span class="n">map_state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">,</span>
            <span class="s2">&quot;zoom&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">,</span>
            <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">height</span><span class="p">,</span>
            <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">,</span>
            <span class="s2">&quot;_layers&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="p">),</span>
            <span class="s2">&quot;_sources&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sources</span><span class="p">),</span>
            <span class="s2">&quot;_controls&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">),</span>
            <span class="s2">&quot;_terrain&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_terrain</span><span class="p">),</span>
            <span class="s2">&quot;_deckgl_layers&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">),</span>  <span class="c1"># Include DeckGL layers</span>
            <span class="c1"># Include recorded JS calls so we can faithfully reconstruct dynamic elements</span>
            <span class="s2">&quot;_js_calls&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_js_calls</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># Add class-specific attributes</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">):</span>
            <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;style&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;bearing&quot;</span><span class="p">):</span>
            <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;bearing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;pitch&quot;</span><span class="p">):</span>
            <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;pitch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;antialias&quot;</span><span class="p">):</span>
            <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;antialias&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">antialias</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_draw_data&quot;</span><span class="p">):</span>
            <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;_draw_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_draw_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_terra_draw_data&quot;</span><span class="p">):</span>
            <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;_terra_draw_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_terra_draw_data</span><span class="p">)</span>
        <span class="c1"># Persist Geoman data if available</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;geoman_data&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;geoman_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># Best-effort; skip if not serializable</span>
                <span class="k">pass</span>
        <span class="c1"># Extract last requested fitBounds to guarantee initial viewport in export</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">last_fit</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_js_calls</span><span class="p">:</span>  <span class="c1"># type: ignore[attr-defined]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">call</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">call</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;fitBounds&quot;</span><span class="p">:</span>
                    <span class="n">last_fit</span> <span class="o">=</span> <span class="n">call</span>
            <span class="k">if</span> <span class="n">last_fit</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">last_fit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;args&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;_initial_fit_bounds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;_initial_fit_bounds_options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Non-fatal if inspection fails</span>
            <span class="k">pass</span>

        <span class="c1"># Generate HTML content</span>
        <span class="n">html_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_html_template</span><span class="p">(</span><span class="n">map_state</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Save to file if filename provided</span>
        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">html_content</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_legend</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Legend&quot;</span><span class="p">,</span>
        <span class="n">legend_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">colors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
        <span class="n">bg_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
        <span class="n">icon</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bottom-right&quot;</span><span class="p">,</span>
        <span class="n">collapsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">builtin_legend</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">shape_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rectangle&quot;</span><span class="p">,</span>
        <span class="n">header_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">header_text_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">responsive</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">max_height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">380</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a legend to the map.</span>

<span class="sd">        This method allows for the addition of a legend to the map. The legend can be customized with a title,</span>
<span class="sd">        labels, colors, and more. A built-in legend can also be specified.</span>

<span class="sd">        Args:</span>
<span class="sd">            title (str, optional): The title of the legend. Defaults to &quot;Legend&quot;.</span>
<span class="sd">            legend_dict (Optional[Dict[str, str]], optional): A dictionary with legend items as keys and colors as values.</span>
<span class="sd">                If provided, `labels` and `colors` will be ignored. Defaults to None.</span>
<span class="sd">            labels (Optional[List[str]], optional): A list of legend labels. Defaults to None.</span>
<span class="sd">            colors (Optional[List[str]], optional): A list of colors corresponding to the labels. Defaults to None.</span>
<span class="sd">            fontsize (int, optional): The font size of the legend text. Defaults to 15.</span>
<span class="sd">            bg_color (str, optional): The background color of the legend. Defaults to &quot;white&quot;.</span>
<span class="sd">                To make the background transparent, set this to &quot;transparent&quot;.</span>
<span class="sd">                To make the background half transparent, set this to &quot;rgba(255, 255, 255, 0.5)&quot;.</span>
<span class="sd">            icon (str, optional): The icon of the legend. Defaults to &quot;&quot;.</span>
<span class="sd">            position (str, optional): The position of the legend on the map. Can be one of &quot;top-left&quot;,</span>
<span class="sd">                &quot;top-right&quot;, &quot;bottom-left&quot;, &quot;bottom-right&quot;. Defaults to &quot;bottom-right&quot;.</span>
<span class="sd">            collapsed (bool, optional): Whether the legend is collapsed by default. Defaults to True.</span>
<span class="sd">            builtin_legend (Optional[str], optional): The name of a built-in legend to use. Available options: &quot;NLCD&quot;, &quot;NWI&quot;. Defaults to None.</span>
<span class="sd">            shape_type (str, optional): The shape type of the legend items. Can be one of &quot;rectangle&quot;, &quot;circle&quot;, or &quot;line&quot;. Defaults to &quot;rectangle&quot;.</span>
<span class="sd">            header_color (str, optional): The background color of the legend header, like &quot;linear-gradient(135deg,#444,#888)&quot;. Defaults to None.</span>
<span class="sd">            header_text_color (str, optional): The text color of the legend header, like &quot;#fff&quot;. Defaults to None.</span>
<span class="sd">            responsive (bool, optional): Whether the legend is responsive. Defaults to True.</span>
<span class="sd">            max_height (int, optional): Maximum height of the legend content area in pixels. Defaults to 380.</span>
<span class="sd">            **kwargs: Any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">shape_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">shape_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;rectangle&quot;</span><span class="p">,</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="s2">&quot;line&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;shape_type must be one of &#39;rectangle&#39;, &#39;circle&#39;, or &#39;line&#39;&quot;</span>
            <span class="p">)</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">html</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">html_module</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">widgets</span>

        <span class="c1"># Built-in legend presets</span>
        <span class="n">BUILTIN_LEGENDS</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;NLCD&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;11 Open Water&quot;</span><span class="p">:</span> <span class="s2">&quot;466b9f&quot;</span><span class="p">,</span>
                <span class="s2">&quot;12 Perennial Ice/Snow&quot;</span><span class="p">:</span> <span class="s2">&quot;d1def8&quot;</span><span class="p">,</span>
                <span class="s2">&quot;21 Developed, Open Space&quot;</span><span class="p">:</span> <span class="s2">&quot;dec5c5&quot;</span><span class="p">,</span>
                <span class="s2">&quot;22 Developed, Low Intensity&quot;</span><span class="p">:</span> <span class="s2">&quot;d99282&quot;</span><span class="p">,</span>
                <span class="s2">&quot;23 Developed, Medium Intensity&quot;</span><span class="p">:</span> <span class="s2">&quot;eb0000&quot;</span><span class="p">,</span>
                <span class="s2">&quot;24 Developed High Intensity&quot;</span><span class="p">:</span> <span class="s2">&quot;ab0000&quot;</span><span class="p">,</span>
                <span class="s2">&quot;31 Barren Land (Rock/Sand/Clay)&quot;</span><span class="p">:</span> <span class="s2">&quot;b3ac9f&quot;</span><span class="p">,</span>
                <span class="s2">&quot;41 Deciduous Forest&quot;</span><span class="p">:</span> <span class="s2">&quot;68ab5f&quot;</span><span class="p">,</span>
                <span class="s2">&quot;42 Evergreen Forest&quot;</span><span class="p">:</span> <span class="s2">&quot;1c5f2c&quot;</span><span class="p">,</span>
                <span class="s2">&quot;43 Mixed Forest&quot;</span><span class="p">:</span> <span class="s2">&quot;b5c58f&quot;</span><span class="p">,</span>
                <span class="s2">&quot;51 Dwarf Scrub&quot;</span><span class="p">:</span> <span class="s2">&quot;af963c&quot;</span><span class="p">,</span>
                <span class="s2">&quot;52 Shrub/Scrub&quot;</span><span class="p">:</span> <span class="s2">&quot;ccb879&quot;</span><span class="p">,</span>
                <span class="s2">&quot;71 Grassland/Herbaceous&quot;</span><span class="p">:</span> <span class="s2">&quot;dfdfc2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;72 Sedge/Herbaceous&quot;</span><span class="p">:</span> <span class="s2">&quot;d1d182&quot;</span><span class="p">,</span>
                <span class="s2">&quot;73 Lichens&quot;</span><span class="p">:</span> <span class="s2">&quot;a3cc51&quot;</span><span class="p">,</span>
                <span class="s2">&quot;74 Moss&quot;</span><span class="p">:</span> <span class="s2">&quot;82ba9e&quot;</span><span class="p">,</span>
                <span class="s2">&quot;81 Pasture/Hay&quot;</span><span class="p">:</span> <span class="s2">&quot;dcd939&quot;</span><span class="p">,</span>
                <span class="s2">&quot;82 Cultivated Crops&quot;</span><span class="p">:</span> <span class="s2">&quot;ab6c28&quot;</span><span class="p">,</span>
                <span class="s2">&quot;90 Woody Wetlands&quot;</span><span class="p">:</span> <span class="s2">&quot;b8d9eb&quot;</span><span class="p">,</span>
                <span class="s2">&quot;95 Emergent Herbaceous Wetlands&quot;</span><span class="p">:</span> <span class="s2">&quot;6c9fb8&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;NWI&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;Freshwater Forested/Shrub Wetland&quot;</span><span class="p">:</span> <span class="s2">&quot;#008837&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Freshwater Emergent Wetland&quot;</span><span class="p">:</span> <span class="s2">&quot;#7FC31C&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Freshwater Pond&quot;</span><span class="p">:</span> <span class="s2">&quot;#688CC0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Estuarine and Marine Wetland&quot;</span><span class="p">:</span> <span class="s2">&quot;#66C2A5&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Riverine&quot;</span><span class="p">:</span> <span class="s2">&quot;#0190BF&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Lake&quot;</span><span class="p">:</span> <span class="s2">&quot;#13007C&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Estuarine and Marine Deepwater&quot;</span><span class="p">:</span> <span class="s2">&quot;#007C88&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Other&quot;</span><span class="p">:</span> <span class="s2">&quot;#B28656&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>

        <span class="c1"># Use builtin legend if specified</span>
        <span class="k">if</span> <span class="n">builtin_legend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">builtin_legend</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">BUILTIN_LEGENDS</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Warning: builtin_legend &#39;</span><span class="si">{</span><span class="n">builtin_legend</span><span class="si">}</span><span class="s2">&#39; not found. Available: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">BUILTIN_LEGENDS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span>
            <span class="n">legend_dict</span> <span class="o">=</span> <span class="n">BUILTIN_LEGENDS</span><span class="p">[</span><span class="n">builtin_legend</span><span class="p">]</span>

        <span class="c1"># Determine legend items</span>
        <span class="k">if</span> <span class="n">legend_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">legend_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">legend_dict</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: labels and colors must have the same length&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Error: Either legend_dict or both labels and colors must be provided&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Normalize colors (add # if not present)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">]</span>

        <span class="c1"># Build legend items as a list of HTML widgets (no title needed - it&#39;s in the panel header)</span>
        <span class="n">legend_items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Add each legend item</span>
        <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;circle&quot;</span><span class="p">:</span>
                <span class="n">shape_html</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;span style=&quot;display: inline-block; width: 20px; height: 20px; background-color: </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s1">; border-radius: 50%; margin-right: 8px; vertical-align: middle;&quot;&gt;&lt;/span&gt;&#39;</span>
            <span class="k">elif</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;line&quot;</span><span class="p">:</span>
                <span class="n">shape_html</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;span style=&quot;display: inline-block; width: 20px; height: 3px; background-color: </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s1">; margin-right: 8px; vertical-align: middle;&quot;&gt;&lt;/span&gt;&#39;</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># rectangle</span>
                <span class="n">shape_html</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;span style=&quot;display: inline-block; width: 20px; height: 20px; background-color: </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s1">; margin-right: 8px; vertical-align: middle;&quot;&gt;&lt;/span&gt;&#39;</span>

            <span class="c1"># Validate fontsize before using it in CSS</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">safe_fontsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">safe_fontsize</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">):</span>
                    <span class="n">safe_fontsize</span> <span class="o">=</span> <span class="mi">14</span>  <span class="c1"># default value</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="n">safe_fontsize</span> <span class="o">=</span> <span class="mi">14</span>  <span class="c1"># default value</span>

            <span class="n">item_html</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span>
                <span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;&lt;div style=&quot;margin: 0; padding: 0; line-height: 1.4; white-space: nowrap; font-size: </span><span class="si">{</span><span class="n">safe_fontsize</span><span class="si">}</span><span class="s1">px;&quot;&gt;</span><span class="si">{</span><span class="n">shape_html</span><span class="si">}{</span><span class="n">html_module</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="si">}</span><span class="s1">&lt;/div&gt;&#39;</span><span class="p">,</span>
                <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
                    <span class="n">margin</span><span class="o">=</span><span class="s2">&quot;0 0 4px 0&quot;</span>
                <span class="p">),</span>  <span class="c1"># Control spacing between items</span>
            <span class="p">)</span>
            <span class="n">legend_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_html</span><span class="p">)</span>

        <span class="c1"># Create a VBox container for legend items</span>
        <span class="c1"># Subtract space for panel header (~60px) from panel_max_height</span>
        <span class="c1"># This ensures the legend content scrolls properly within the panel</span>
        <span class="n">legend_content_height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_height</span> <span class="o">-</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">legend_vbox</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span>
            <span class="n">legend_items</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
                <span class="n">width</span><span class="o">=</span><span class="s2">&quot;fit-content&quot;</span><span class="p">,</span>
                <span class="n">max_height</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">legend_content_height</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span>
                <span class="n">overflow_y</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
                <span class="n">overflow_x</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">,</span>
                <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;8px&quot;</span><span class="p">,</span>
                <span class="n">border</span><span class="o">=</span><span class="s2">&quot;2px solid grey&quot;</span><span class="p">,</span>
                <span class="n">border_radius</span><span class="o">=</span><span class="s2">&quot;5px&quot;</span><span class="p">,</span>
                <span class="n">background_color</span><span class="o">=</span><span class="n">bg_color</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Determine responsiveness: default to responsive unless user supplied panel_width</span>
        <span class="k">if</span> <span class="n">responsive</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">auto_flag</span> <span class="o">=</span> <span class="s2">&quot;panel_width&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s2">&quot;auto_panel_width&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">auto_flag</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">responsive</span><span class="p">)</span>

        <span class="c1"># Build options</span>
        <span class="n">control_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">control_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
                <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
                <span class="s2">&quot;icon&quot;</span><span class="p">:</span> <span class="n">icon</span><span class="p">,</span>
                <span class="s2">&quot;collapsed&quot;</span><span class="p">:</span> <span class="n">collapsed</span><span class="p">,</span>
                <span class="s2">&quot;header_bg&quot;</span><span class="p">:</span> <span class="n">header_color</span><span class="p">,</span>
                <span class="s2">&quot;header_text_color&quot;</span><span class="p">:</span> <span class="n">header_text_color</span><span class="p">,</span>
                <span class="s2">&quot;panel_max_height&quot;</span><span class="p">:</span> <span class="n">max_height</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Configure width behavior based on responsive setting</span>
        <span class="k">if</span> <span class="n">auto_flag</span><span class="p">:</span>
            <span class="c1"># Responsive mode: use auto width with min/max constraints</span>
            <span class="n">control_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
                <span class="s2">&quot;panel_min_width&quot;</span><span class="p">,</span> <span class="mi">100</span>
            <span class="p">)</span>  <span class="c1"># Minimum width for legend items (reduced for short text)</span>
            <span class="n">control_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
                <span class="s2">&quot;panel_max_width&quot;</span><span class="p">,</span> <span class="mi">500</span>
            <span class="p">)</span>  <span class="c1"># Reasonable maximum width</span>
            <span class="n">control_kwargs</span><span class="p">[</span><span class="s2">&quot;auto_panel_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fixed width mode: ensure auto_panel_width is False</span>
            <span class="n">control_kwargs</span><span class="p">[</span><span class="s2">&quot;auto_panel_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># Use default panel_width if not specified</span>
            <span class="n">control_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;panel_width&quot;</span><span class="p">,</span> <span class="mi">320</span><span class="p">)</span>

        <span class="c1"># Extract parameters for add_widget_control</span>
        <span class="n">widget_control_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">),</span>
            <span class="s2">&quot;icon&quot;</span><span class="p">:</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;icon&quot;</span><span class="p">),</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">),</span>
            <span class="s2">&quot;collapsed&quot;</span><span class="p">:</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;collapsed&quot;</span><span class="p">),</span>
            <span class="s2">&quot;auto_panel_width&quot;</span><span class="p">:</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;auto_panel_width&quot;</span><span class="p">),</span>
            <span class="s2">&quot;header_bg&quot;</span><span class="p">:</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;header_bg&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="s2">&quot;header_text_color&quot;</span><span class="p">:</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;header_text_color&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># Add panel width parameters if specified</span>
        <span class="k">if</span> <span class="s2">&quot;panel_width&quot;</span> <span class="ow">in</span> <span class="n">control_kwargs</span><span class="p">:</span>
            <span class="n">widget_control_params</span><span class="p">[</span><span class="s2">&quot;panel_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;panel_width&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;panel_min_width&quot;</span> <span class="ow">in</span> <span class="n">control_kwargs</span><span class="p">:</span>
            <span class="n">widget_control_params</span><span class="p">[</span><span class="s2">&quot;panel_min_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
                <span class="s2">&quot;panel_min_width&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;panel_max_width&quot;</span> <span class="ow">in</span> <span class="n">control_kwargs</span><span class="p">:</span>
            <span class="n">widget_control_params</span><span class="p">[</span><span class="s2">&quot;panel_max_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
                <span class="s2">&quot;panel_max_width&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;panel_max_height&quot;</span> <span class="ow">in</span> <span class="n">control_kwargs</span><span class="p">:</span>
            <span class="n">widget_control_params</span><span class="p">[</span><span class="s2">&quot;panel_max_height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
                <span class="s2">&quot;panel_max_height&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Add legend as a widget control at the specified position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_widget_control</span><span class="p">(</span>
            <span class="n">legend_vbox</span><span class="p">,</span>
            <span class="o">**</span><span class="n">widget_control_params</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-attribute">



<h3 id="anymap.maplibre.MapLibreMap.current_bounds" class="doc doc-heading">
<code class="highlight language-python"><span class="n">current_bounds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#anymap.maplibre.MapLibreMap.current_bounds" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the current map bounds as [[lng, lat], [lng, lat]] (southwest, northeast).</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="anymap.maplibre.MapLibreMap.current_center" class="doc doc-heading">
<code class="highlight language-python"><span class="n">current_center</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#anymap.maplibre.MapLibreMap.current_center" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the current map center coordinates as [longitude, latitude].</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="anymap.maplibre.MapLibreMap.current_zoom" class="doc doc-heading">
<code class="highlight language-python"><span class="n">current_zoom</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#anymap.maplibre.MapLibreMap.current_zoom" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the current map zoom level.</p>
    </div>

  </div>




  <div class="doc doc-object doc-attribute">



<h3 id="anymap.maplibre.MapLibreMap.draw_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">draw_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#anymap.maplibre.MapLibreMap.draw_data" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the current draw data as GeoJSON.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="anymap.maplibre.MapLibreMap.first_symbol_layer_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">first_symbol_layer_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#anymap.maplibre.MapLibreMap.first_symbol_layer_id" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the ID of the first symbol layer in the map's current style.</p>
    </div>

  </div>








  <div class="doc doc-object doc-attribute">



<h3 id="anymap.maplibre.MapLibreMap.sidebar_widgets" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sidebar_widgets</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ipywidgets</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">Widget</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#anymap.maplibre.MapLibreMap.sidebar_widgets" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Returns a dictionary of widgets currently in the sidebar.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, widgets.Widget]</code></td>
      <td><p>A dictionary where keys are the labels of the widgets and values are the widgets themselves.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>




  <div class="doc doc-object doc-attribute">



<h3 id="anymap.maplibre.MapLibreMap.viewstate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">viewstate</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#anymap.maplibre.MapLibreMap.viewstate" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the current map viewstate including center, zoom, bearing, pitch, and bounds.</p>
    </div>

  </div>






  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="n">zoom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;dark-matter&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s1">&#39;100%&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s1">&#39;680px&#39;</span><span class="p">,</span> <span class="n">bearing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">pitch</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">controls</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;navigation&#39;</span><span class="p">:</span> <span class="s1">&#39;top-right&#39;</span><span class="p">,</span> <span class="s1">&#39;fullscreen&#39;</span><span class="p">:</span> <span class="s1">&#39;top-right&#39;</span><span class="p">,</span> <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="s1">&#39;bottom-left&#39;</span><span class="p">,</span> <span class="s1">&#39;globe&#39;</span><span class="p">:</span> <span class="s1">&#39;top-right&#39;</span><span class="p">,</span> <span class="s1">&#39;layers&#39;</span><span class="p">:</span> <span class="s1">&#39;top-right&#39;</span><span class="p">},</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;mercator&#39;</span><span class="p">,</span> <span class="n">add_sidebar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sidebar_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sidebar_width</span><span class="o">=</span><span class="mi">360</span><span class="p">,</span> <span class="n">sidebar_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_manager_expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#anymap.maplibre.MapLibreMap.__init__" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Initialize MapLibre map widget.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>center</code></td>
        <td><code>List[float]</code></td>
        <td><p>Map center coordinates as [longitude, latitude]. Default is [0, 20].</p></td>
        <td><code>[0, 20]</code></td>
      </tr>
      <tr>
        <td><code>zoom</code></td>
        <td><code>float</code></td>
        <td><p>Initial zoom level (typically 0-20). Default is 1.0.</p></td>
        <td><code>1.0</code></td>
      </tr>
      <tr>
        <td><code>style</code></td>
        <td><code>Union[str, Dict[str, Any]]</code></td>
        <td><p>MapLibre style URL string or style object dictionary.</p></td>
        <td><code>&#39;dark-matter&#39;</code></td>
      </tr>
      <tr>
        <td><code>width</code></td>
        <td><code>str</code></td>
        <td><p>Widget width as CSS string (e.g., "100%", "800px").</p></td>
        <td><code>&#39;100%&#39;</code></td>
      </tr>
      <tr>
        <td><code>height</code></td>
        <td><code>str</code></td>
        <td><p>Widget height as CSS string (e.g., "680px", "50vh").</p></td>
        <td><code>&#39;680px&#39;</code></td>
      </tr>
      <tr>
        <td><code>bearing</code></td>
        <td><code>float</code></td>
        <td><p>Map bearing (rotation) in degrees (0-360).</p></td>
        <td><code>0.0</code></td>
      </tr>
      <tr>
        <td><code>pitch</code></td>
        <td><code>float</code></td>
        <td><p>Map pitch (tilt) in degrees (0-60).</p></td>
        <td><code>0.0</code></td>
      </tr>
      <tr>
        <td><code>controls</code></td>
        <td><code>Dict[str, str]</code></td>
        <td><p>Dictionary of control names and their positions. Default is {
"navigation": "top-right",
"fullscreen": "top-right",
"scale": "bottom-left",
"globe": "top-right",
"layers": "top-right",</p></td>
        <td><code>{&#39;navigation&#39;: &#39;top-right&#39;, &#39;fullscreen&#39;: &#39;top-right&#39;, &#39;scale&#39;: &#39;bottom-left&#39;, &#39;globe&#39;: &#39;top-right&#39;, &#39;layers&#39;: &#39;top-right&#39;}</code></td>
      </tr>
      <tr>
        <td><code>projection</code></td>
        <td><code>str</code></td>
        <td><p>Map projection type. Can be "mercator" or "globe". Default is "mercator".</p></td>
        <td><code>&#39;mercator&#39;</code></td>
      </tr>
      <tr>
        <td><code>add_sidebar</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to add a sidebar to the map. Default is False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>sidebar_visible</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the sidebar is visible. Default is False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>sidebar_width</code></td>
        <td><code>int</code></td>
        <td><p>Width of the sidebar in pixels. Default is 360.</p></td>
        <td><code>360</code></td>
      </tr>
      <tr>
        <td><code>sidebar_args</code></td>
        <td><code>Optional[Dict]</code></td>
        <td><p>Additional keyword arguments for the sidebar. Default is None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>layer_manager_expanded</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the layer manager is expanded. Default is True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional keyword arguments passed to parent class.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">center</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
    <span class="n">zoom</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">style</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;dark-matter&quot;</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;100%&quot;</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;680px&quot;</span><span class="p">,</span>
    <span class="n">bearing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">pitch</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">controls</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;navigation&quot;</span><span class="p">:</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fullscreen&quot;</span><span class="p">:</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="s2">&quot;bottom-left&quot;</span><span class="p">,</span>
        <span class="s2">&quot;globe&quot;</span><span class="p">:</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
        <span class="s2">&quot;layers&quot;</span><span class="p">:</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">projection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mercator&quot;</span><span class="p">,</span>
    <span class="n">add_sidebar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">sidebar_visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">sidebar_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">360</span><span class="p">,</span>
    <span class="n">sidebar_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layer_manager_expanded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize MapLibre map widget.</span>

<span class="sd">    Args:</span>
<span class="sd">        center: Map center coordinates as [longitude, latitude]. Default is [0, 20].</span>
<span class="sd">        zoom: Initial zoom level (typically 0-20). Default is 1.0.</span>
<span class="sd">        style: MapLibre style URL string or style object dictionary.</span>
<span class="sd">        width: Widget width as CSS string (e.g., &quot;100%&quot;, &quot;800px&quot;).</span>
<span class="sd">        height: Widget height as CSS string (e.g., &quot;680px&quot;, &quot;50vh&quot;).</span>
<span class="sd">        bearing: Map bearing (rotation) in degrees (0-360).</span>
<span class="sd">        pitch: Map pitch (tilt) in degrees (0-60).</span>
<span class="sd">        controls: Dictionary of control names and their positions. Default is {</span>
<span class="sd">            &quot;navigation&quot;: &quot;top-right&quot;,</span>
<span class="sd">            &quot;fullscreen&quot;: &quot;top-right&quot;,</span>
<span class="sd">            &quot;scale&quot;: &quot;bottom-left&quot;,</span>
<span class="sd">            &quot;globe&quot;: &quot;top-right&quot;,</span>
<span class="sd">            &quot;layers&quot;: &quot;top-right&quot;,</span>
<span class="sd">        }.</span>
<span class="sd">        projection: Map projection type. Can be &quot;mercator&quot; or &quot;globe&quot;. Default is &quot;mercator&quot;.</span>
<span class="sd">        add_sidebar: Whether to add a sidebar to the map. Default is False.</span>
<span class="sd">        sidebar_visible: Whether the sidebar is visible. Default is False.</span>
<span class="sd">        sidebar_width: Width of the sidebar in pixels. Default is 360.</span>
<span class="sd">        sidebar_args: Additional keyword arguments for the sidebar. Default is None.</span>
<span class="sd">        layer_manager_expanded: Whether the layer manager is expanded. Default is True.</span>
<span class="sd">        **kwargs: Additional keyword arguments passed to parent class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">style</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">construct_maplibre_style</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">center</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
        <span class="n">zoom</span><span class="o">=</span><span class="n">zoom</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
        <span class="n">bearing</span><span class="o">=</span><span class="n">bearing</span><span class="p">,</span>
        <span class="n">pitch</span><span class="o">=</span><span class="n">pitch</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="s2">&quot;Background&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;Background&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;background&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;background&quot;</span><span class="p">,</span>
        <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Initialize the _layer_dict trait with the layer_dict content</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_layer_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">)</span>

    <span class="c1"># Initialize current state attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_center</span> <span class="o">=</span> <span class="n">center</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_zoom</span> <span class="o">=</span> <span class="n">zoom</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_bearing</span> <span class="o">=</span> <span class="n">bearing</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_pitch</span> <span class="o">=</span> <span class="n">pitch</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_bounds</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Will be set after map loads</span>

    <span class="c1"># Register event handler to update current state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">on_map_event</span><span class="p">(</span><span class="s2">&quot;moveend&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_current_state</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="n">style</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">style_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_style_layers</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style_dict</span><span class="p">[</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">layer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">source_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">projection</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;globe&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_projection</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;interpolate&quot;</span><span class="p">,</span>
                    <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s2">&quot;zoom&quot;</span><span class="p">],</span>
                    <span class="mi">10</span><span class="p">,</span>
                    <span class="s2">&quot;vertical-perspective&quot;</span><span class="p">,</span>
                    <span class="mi">12</span><span class="p">,</span>
                    <span class="s2">&quot;mercator&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">controls</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">control</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">controls</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">control</span> <span class="o">==</span> <span class="s2">&quot;layers&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_layer_control</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">control</span> <span class="o">==</span> <span class="s2">&quot;geoman&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_geoman_control</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="n">control</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>
        <span class="k">elif</span> <span class="n">control</span> <span class="o">==</span> <span class="s2">&quot;export&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_export_control</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="n">control</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_control</span><span class="p">(</span><span class="n">control</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="n">control</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>

    <span class="k">if</span> <span class="n">sidebar_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sidebar_args</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="s2">&quot;sidebar_visible&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sidebar_args</span><span class="p">:</span>
        <span class="n">sidebar_args</span><span class="p">[</span><span class="s2">&quot;sidebar_visible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sidebar_visible</span>
    <span class="k">if</span> <span class="s2">&quot;sidebar_width&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sidebar_args</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sidebar_width</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">sidebar_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sidebar_width</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;px&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">sidebar_args</span><span class="p">[</span><span class="s2">&quot;min_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sidebar_width</span>
        <span class="n">sidebar_args</span><span class="p">[</span><span class="s2">&quot;max_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sidebar_width</span>
    <span class="k">if</span> <span class="s2">&quot;expanded&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sidebar_args</span><span class="p">:</span>
        <span class="n">sidebar_args</span><span class="p">[</span><span class="s2">&quot;expanded&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_manager_expanded</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sidebar_args</span> <span class="o">=</span> <span class="n">sidebar_args</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_widget_control_widgets</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_flatgeobuf_defaults</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">add_sidebar</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ipython_display_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_patched_display</span>
    <span class="c1"># Listen for union toggle events coming from the toolbar button in JS</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_map_event</span><span class="p">(</span><span class="s2">&quot;geoman_union_toggled&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_geoman_union_toggle</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="c1"># Listen for split mode events coming from the toolbar button/drawing in JS</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_map_event</span><span class="p">(</span><span class="s2">&quot;geoman_split_toggled&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_geoman_split_toggle</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_map_event</span><span class="p">(</span><span class="s2">&quot;geoman_split_line&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_geoman_split_line</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.activate_geoman_button" class="doc doc-heading">
<code class="highlight language-python"><span class="n">activate_geoman_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.activate_geoman_button" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Programmatically activate/click a Geoman toolbar button by name.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>Button name or a unique substring of its label/title (case-insensitive).</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">activate_geoman_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Programmatically activate/click a Geoman toolbar button by name.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Button name or a unique substring of its label/title (case-insensitive).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;activateGeomanButton&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_basemap" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_basemap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basemap</span><span class="p">,</span> <span class="n">layer_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_basemap" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a basemap to the map using xyzservices providers.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>basemap</code></td>
        <td><code>str</code></td>
        <td><p>Name of the basemap from xyzservices (e.g., "Esri.WorldImagery").
    Use available_basemaps to see all available options.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional ID for the basemap layer. If None, uses basemap name.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>before_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional layer ID to insert this layer before.
      If None, layer is added on top.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>visible</code></td>
        <td><code>Optional[bool]</code></td>
        <td><p>Whether the layer should be visible initially.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional parameters passed to the basemap layer.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If the specified basemap is not available.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_basemap</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">basemap</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">layer_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">visible</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a basemap to the map using xyzservices providers.</span>

<span class="sd">    Args:</span>
<span class="sd">        basemap: Name of the basemap from xyzservices (e.g., &quot;Esri.WorldImagery&quot;).</span>
<span class="sd">                Use available_basemaps to see all available options.</span>
<span class="sd">        layer_id: Optional ID for the basemap layer. If None, uses basemap name.</span>
<span class="sd">        before_id: Optional layer ID to insert this layer before.</span>
<span class="sd">                  If None, layer is added on top.</span>
<span class="sd">        visible: Whether the layer should be visible initially.</span>
<span class="sd">        **kwargs: Additional parameters passed to the basemap layer.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the specified basemap is not available.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.basemaps</span><span class="w"> </span><span class="kn">import</span> <span class="n">available_basemaps</span>

    <span class="k">if</span> <span class="n">basemap</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_basemaps</span><span class="p">:</span>
        <span class="n">available_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">available_basemaps</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Basemap &#39;</span><span class="si">{</span><span class="n">basemap</span><span class="si">}</span><span class="s2">&#39; not found. Available basemaps: </span><span class="si">{</span><span class="n">available_names</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">basemap_config</span> <span class="o">=</span> <span class="n">available_basemaps</span><span class="p">[</span><span class="n">basemap</span><span class="p">]</span>

    <span class="c1"># Convert xyzservices URL template to tile URL</span>
    <span class="n">tile_url</span> <span class="o">=</span> <span class="n">basemap_config</span><span class="o">.</span><span class="n">build_url</span><span class="p">()</span>

    <span class="c1"># Get attribution if available</span>
    <span class="n">attribution</span> <span class="o">=</span> <span class="n">basemap_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attribution&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">layer_id</span> <span class="o">=</span> <span class="n">basemap</span>

    <span class="c1"># Add as raster layer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_tile_layer</span><span class="p">(</span>
        <span class="n">layer_id</span><span class="o">=</span><span class="n">layer_id</span><span class="p">,</span>
        <span class="n">source_url</span><span class="o">=</span><span class="n">tile_url</span><span class="p">,</span>
        <span class="n">paint</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;raster-opacity&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
        <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span>
        <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_basemap_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_basemap_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-right&#39;</span><span class="p">,</span> <span class="n">basemaps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initial_basemap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">expand_direction</span><span class="o">=</span><span class="s1">&#39;down&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_basemap_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a basemap control to the map for switching between different basemaps.</p>
<p>The basemap control allows users to switch between different basemap providers
using a dropdown or expandable control. It uses the maplibre-gl-basemaps library.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Position on map ('top-left', 'top-right', 'bottom-left', 'bottom-right')</p></td>
        <td><code>&#39;top-right&#39;</code></td>
      </tr>
      <tr>
        <td><code>basemaps</code></td>
        <td><code>Optional[List[str]]</code></td>
        <td><p>List of basemap names to include. If None, uses a default set.
     Available basemaps can be found in anymap.basemaps.available_basemaps</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>labels</code></td>
        <td><code>Optional[Dict[str, str]]</code></td>
        <td><p>Dictionary mapping basemap names to display labels. If None, uses basemap names.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>initial_basemap</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Name of the initial basemap to show. If None, uses the first basemap.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>expand_direction</code></td>
        <td><code>str</code></td>
        <td><p>Direction to expand the control ('up', 'down', 'left', 'right')</p></td>
        <td><code>&#39;down&#39;</code></td>
      </tr>
      <tr>
        <td><code>options</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Additional options for the basemap control</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">MapLibreMap</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_basemap_control</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">position</span><span class="o">=</span><span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">basemaps</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenStreetMap.Mapnik&quot;</span><span class="p">,</span> <span class="s2">&quot;Esri.WorldImagery&quot;</span><span class="p">,</span> <span class="s2">&quot;CartoDB.DarkMatter&quot;</span><span class="p">],</span>
<span class="o">...</span>     <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;OpenStreetMap.Mapnik&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenStreetMap&quot;</span><span class="p">,</span> <span class="s2">&quot;Esri.WorldImagery&quot;</span><span class="p">:</span> <span class="s2">&quot;Satellite&quot;</span><span class="p">},</span>
<span class="o">...</span>     <span class="n">initial_basemap</span><span class="o">=</span><span class="s2">&quot;OpenStreetMap.Mapnik&quot;</span>
<span class="o">...</span> <span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_basemap_control</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
    <span class="n">basemaps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">initial_basemap</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">expand_direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a basemap control to the map for switching between different basemaps.</span>

<span class="sd">    The basemap control allows users to switch between different basemap providers</span>
<span class="sd">    using a dropdown or expandable control. It uses the maplibre-gl-basemaps library.</span>

<span class="sd">    Args:</span>
<span class="sd">        position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">        basemaps: List of basemap names to include. If None, uses a default set.</span>
<span class="sd">                 Available basemaps can be found in anymap.basemaps.available_basemaps</span>
<span class="sd">        labels: Dictionary mapping basemap names to display labels. If None, uses basemap names.</span>
<span class="sd">        initial_basemap: Name of the initial basemap to show. If None, uses the first basemap.</span>
<span class="sd">        expand_direction: Direction to expand the control (&#39;up&#39;, &#39;down&#39;, &#39;left&#39;, &#39;right&#39;)</span>
<span class="sd">        options: Additional options for the basemap control</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; m = MapLibreMap()</span>
<span class="sd">        &gt;&gt;&gt; m.add_basemap_control(</span>
<span class="sd">        ...     position=&quot;top-right&quot;,</span>
<span class="sd">        ...     basemaps=[&quot;OpenStreetMap.Mapnik&quot;, &quot;Esri.WorldImagery&quot;, &quot;CartoDB.DarkMatter&quot;],</span>
<span class="sd">        ...     labels={&quot;OpenStreetMap.Mapnik&quot;: &quot;OpenStreetMap&quot;, &quot;Esri.WorldImagery&quot;: &quot;Satellite&quot;},</span>
<span class="sd">        ...     initial_basemap=&quot;OpenStreetMap.Mapnik&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.basemaps</span><span class="w"> </span><span class="kn">import</span> <span class="n">available_basemaps</span>

    <span class="c1"># Default basemaps if none provided</span>
    <span class="k">if</span> <span class="n">basemaps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">basemaps</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;OpenStreetMap.Mapnik&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Esri.WorldImagery&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CartoDB.DarkMatter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CartoDB.Positron&quot;</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="c1"># Filter available basemaps to only include those that exist</span>
    <span class="n">valid_basemaps</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">basemaps</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">available_basemaps</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_basemaps</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;No valid basemaps found. Available basemaps: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">available_basemaps</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Set initial basemap if not provided</span>
    <span class="k">if</span> <span class="n">initial_basemap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">initial_basemap</span> <span class="o">=</span> <span class="n">valid_basemaps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">initial_basemap</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_basemaps</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Initial basemap &#39;</span><span class="si">{</span><span class="n">initial_basemap</span><span class="si">}</span><span class="s2">&#39; not found in provided basemaps&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create basemap configurations for the control</span>
    <span class="n">basemap_configs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">basemap_name</span> <span class="ow">in</span> <span class="n">valid_basemaps</span><span class="p">:</span>
        <span class="n">basemap_provider</span> <span class="o">=</span> <span class="n">available_basemaps</span><span class="p">[</span><span class="n">basemap_name</span><span class="p">]</span>
        <span class="n">tile_url</span> <span class="o">=</span> <span class="n">basemap_provider</span><span class="o">.</span><span class="n">build_url</span><span class="p">()</span>
        <span class="n">attribution</span> <span class="o">=</span> <span class="n">basemap_provider</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attribution&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Use custom label if provided, otherwise use basemap name</span>
        <span class="n">display_label</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">basemap_name</span><span class="p">,</span> <span class="n">basemap_name</span><span class="p">)</span> <span class="k">if</span> <span class="n">labels</span> <span class="k">else</span> <span class="n">basemap_name</span>
        <span class="p">)</span>

        <span class="n">basemap_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">basemap_name</span><span class="p">,</span>
            <span class="s2">&quot;tiles&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">tile_url</span><span class="p">],</span>
            <span class="s2">&quot;sourceExtraParams&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;tileSize&quot;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
                <span class="s2">&quot;attribution&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">,</span>
                <span class="s2">&quot;minzoom&quot;</span><span class="p">:</span> <span class="n">basemap_provider</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;min_zoom&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;maxzoom&quot;</span><span class="p">:</span> <span class="n">basemap_provider</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_zoom&quot;</span><span class="p">,</span> <span class="mi">22</span><span class="p">),</span>
            <span class="p">},</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">display_label</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">basemap_configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">basemap_config</span><span class="p">)</span>

    <span class="n">control_options</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;basemaps&quot;</span><span class="p">:</span> <span class="n">basemap_configs</span><span class="p">,</span>
            <span class="s2">&quot;initialBasemap&quot;</span><span class="p">:</span> <span class="n">initial_basemap</span><span class="p">,</span>
            <span class="s2">&quot;expandDirection&quot;</span><span class="p">:</span> <span class="n">expand_direction</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Store control in persistent state</span>
    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;basemap_control_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basemap_control&quot;</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;basemap_control&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_cog_layer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_cog_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">cog_url</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">paint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">titiler_endpoint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fit_bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_cog_layer" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a Cloud Optimized GeoTIFF (COG) layer to the map.</p>
<p>This method supports COGs in any coordinate reference system (CRS). For COGs
in EPSG:3857, it uses the maplibre-cog-protocol for direct rendering. For COGs
in other CRS, it uses TiTiler to reproject on-the-fly.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier for the COG layer.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>cog_url</code></td>
        <td><code>str</code></td>
        <td><p>URL to the COG file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>opacity</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>Layer opacity between 0.0 and 1.0.</p></td>
        <td><code>1.0</code></td>
      </tr>
      <tr>
        <td><code>visible</code></td>
        <td><code>Optional[bool]</code></td>
        <td><p>Whether the layer should be visible initially.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>paint</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Optional paint properties for the layer.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>before_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional layer ID to insert this layer before.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>titiler_endpoint</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional TiTiler endpoint URL. If None, checks COG CRS
and uses TiTiler automatically for non-EPSG:3857 COGs. Set to a TiTiler
URL (e.g., "https://giswqs-titiler-endpoint.hf.space") to force using TiTiler.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>fit_bounds</code></td>
        <td><code>bool</code></td>
        <td><p>If True, automatically fit map bounds to COG extent.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional parameters passed to TiTiler (e.g., rescale, colormap,
bidx for band selection).</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">MapLibreMap</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># COG in EPSG:3857 (uses cog:// protocol)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_cog_layer</span><span class="p">(</span><span class="s2">&quot;cog1&quot;</span><span class="p">,</span> <span class="s2">&quot;https://example.com/data_3857.tif&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># COG in any other CRS (uses TiTiler)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_cog_layer</span><span class="p">(</span><span class="s2">&quot;cog2&quot;</span><span class="p">,</span> <span class="s2">&quot;https://example.com/data_4326.tif&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Force TiTiler with custom endpoint</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_cog_layer</span><span class="p">(</span>
<span class="o">...</span>     <span class="s2">&quot;cog3&quot;</span><span class="p">,</span>
<span class="o">...</span>     <span class="s2">&quot;https://example.com/data.tif&quot;</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">titiler_endpoint</span><span class="o">=</span><span class="s2">&quot;https://giswqs-titiler-endpoint.hf.space&quot;</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">rescale</span><span class="o">=</span><span class="s2">&quot;0,255&quot;</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">colormap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span>
<span class="o">...</span> <span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_cog_layer</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cog_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">opacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">visible</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">titiler_endpoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fit_bounds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a Cloud Optimized GeoTIFF (COG) layer to the map.</span>

<span class="sd">    This method supports COGs in any coordinate reference system (CRS). For COGs</span>
<span class="sd">    in EPSG:3857, it uses the maplibre-cog-protocol for direct rendering. For COGs</span>
<span class="sd">    in other CRS, it uses TiTiler to reproject on-the-fly.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Unique identifier for the COG layer.</span>
<span class="sd">        cog_url: URL to the COG file.</span>
<span class="sd">        opacity: Layer opacity between 0.0 and 1.0.</span>
<span class="sd">        visible: Whether the layer should be visible initially.</span>
<span class="sd">        paint: Optional paint properties for the layer.</span>
<span class="sd">        before_id: Optional layer ID to insert this layer before.</span>
<span class="sd">        titiler_endpoint: Optional TiTiler endpoint URL. If None, checks COG CRS</span>
<span class="sd">            and uses TiTiler automatically for non-EPSG:3857 COGs. Set to a TiTiler</span>
<span class="sd">            URL (e.g., &quot;https://giswqs-titiler-endpoint.hf.space&quot;) to force using TiTiler.</span>
<span class="sd">        fit_bounds: If True, automatically fit map bounds to COG extent.</span>
<span class="sd">        **kwargs: Additional parameters passed to TiTiler (e.g., rescale, colormap,</span>
<span class="sd">            bidx for band selection).</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; m = MapLibreMap()</span>
<span class="sd">        &gt;&gt;&gt; # COG in EPSG:3857 (uses cog:// protocol)</span>
<span class="sd">        &gt;&gt;&gt; m.add_cog_layer(&quot;cog1&quot;, &quot;https://example.com/data_3857.tif&quot;)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # COG in any other CRS (uses TiTiler)</span>
<span class="sd">        &gt;&gt;&gt; m.add_cog_layer(&quot;cog2&quot;, &quot;https://example.com/data_4326.tif&quot;)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Force TiTiler with custom endpoint</span>
<span class="sd">        &gt;&gt;&gt; m.add_cog_layer(</span>
<span class="sd">        ...     &quot;cog3&quot;,</span>
<span class="sd">        ...     &quot;https://example.com/data.tif&quot;,</span>
<span class="sd">        ...     titiler_endpoint=&quot;https://giswqs-titiler-endpoint.hf.space&quot;,</span>
<span class="sd">        ...     rescale=&quot;0,255&quot;,</span>
<span class="sd">        ...     colormap=&quot;viridis&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_source&quot;</span>

    <span class="c1"># Check if we should use TiTiler</span>
    <span class="n">use_titiler</span> <span class="o">=</span> <span class="n">titiler_endpoint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">use_titiler</span><span class="p">:</span>
        <span class="c1"># Auto-detect if TiTiler is needed by checking COG CRS</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cog_metadata</span><span class="p">(</span><span class="n">cog_url</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">metadata</span> <span class="ow">and</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;crs&quot;</span><span class="p">):</span>
                <span class="n">cog_crs</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;crs&quot;</span><span class="p">]</span>
                <span class="c1"># Use TiTiler if COG is not in EPSG:3857</span>
                <span class="k">if</span> <span class="n">cog_crs</span> <span class="o">!=</span> <span class="s2">&quot;EPSG:3857&quot;</span><span class="p">:</span>
                    <span class="n">use_titiler</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;COG is in </span><span class="si">{</span><span class="n">cog_crs</span><span class="si">}</span><span class="s2">, using TiTiler for reprojection&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not determine COG CRS, trying cog:// protocol: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">use_titiler</span><span class="p">:</span>
        <span class="c1"># Use TiTiler for on-the-fly reprojection</span>
        <span class="k">if</span> <span class="n">titiler_endpoint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">titiler_endpoint</span> <span class="o">=</span> <span class="s2">&quot;https://giswqs-titiler-endpoint.hf.space&quot;</span>

        <span class="c1"># Build TiTiler tile URL</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlencode</span><span class="p">,</span> <span class="n">quote</span>

        <span class="c1"># Encode the COG URL</span>
        <span class="n">encoded_url</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="n">cog_url</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Build query parameters</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">cog_url</span><span class="p">,</span>
            <span class="s2">&quot;TileMatrixSetId&quot;</span><span class="p">:</span> <span class="s2">&quot;WebMercatorQuad&quot;</span><span class="p">,</span>  <span class="c1"># Reproject to Web Mercator</span>
        <span class="p">}</span>

        <span class="c1"># Add any additional TiTiler parameters</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">query_string</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;url&quot;</span><span class="p">})</span>

        <span class="c1"># TiTiler tile URL format: {endpoint}/cog/tiles/WebMercatorQuad/{z}/{x}/{y}</span>
        <span class="n">tile_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">titiler_endpoint</span><span class="si">}</span><span class="s2">/cog/tiles/WebMercatorQuad/</span><span class="se">{{</span><span class="s2">z</span><span class="se">}}</span><span class="s2">/</span><span class="se">{{</span><span class="s2">x</span><span class="se">}}</span><span class="s2">/</span><span class="se">{{</span><span class="s2">y</span><span class="se">}}</span><span class="s2">?url=</span><span class="si">{</span><span class="n">encoded_url</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">query_string</span><span class="p">:</span>
            <span class="n">tile_url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&amp;</span><span class="si">{</span><span class="n">query_string</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># print(f&quot;Using TiTiler: {titiler_endpoint}&quot;)</span>
        <span class="c1"># print(f&quot;Tile URL pattern: {tile_url[:100]}...&quot;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span>
            <span class="n">source_id</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;raster&quot;</span><span class="p">,</span>
                <span class="s2">&quot;tiles&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">tile_url</span><span class="p">],</span>
                <span class="s2">&quot;tileSize&quot;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
                <span class="s2">&quot;attribution&quot;</span><span class="p">:</span> <span class="s2">&quot;TiTiler&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Use cog:// protocol for EPSG:3857 COGs</span>
        <span class="n">cog_source_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;cog://</span><span class="si">{</span><span class="n">cog_url</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span>
            <span class="n">source_id</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;raster&quot;</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">cog_source_url</span><span class="p">,</span>
                <span class="s2">&quot;tileSize&quot;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="c1"># Add raster layer</span>
    <span class="n">layer_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;raster&quot;</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">paint</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paint</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span>
        <span class="n">layer</span><span class="o">=</span><span class="n">layer_config</span><span class="p">,</span>
        <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="o">=</span><span class="n">layer_id</span><span class="p">,</span>
        <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
        <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Optionally fit bounds to COG extent</span>
    <span class="k">if</span> <span class="n">fit_bounds</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cog_metadata</span><span class="p">(</span><span class="n">cog_url</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">metadata</span> <span class="ow">and</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bbox&quot;</span><span class="p">):</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;bbox&quot;</span><span class="p">]</span>
                <span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit_bounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
                <span class="c1"># print(f&quot;Map fitted to COG bounds: {bounds}&quot;)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not fit bounds to COG extent: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_type</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-right&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a control to the map.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>control_type</code></td>
        <td><code>str</code></td>
        <td><p>Type of control ('navigation', 'scale', 'fullscreen', 'geolocate', 'attribution', 'globe')</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Position on map ('top-left', 'top-right', 'bottom-left', 'bottom-right')</p></td>
        <td><code>&#39;top-right&#39;</code></td>
      </tr>
      <tr>
        <td><code>options</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Additional options for the control</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_control</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">control_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a control to the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        control_type: Type of control (&#39;navigation&#39;, &#39;scale&#39;, &#39;fullscreen&#39;, &#39;geolocate&#39;, &#39;attribution&#39;, &#39;globe&#39;)</span>
<span class="sd">        position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">        options: Additional options for the control</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">control_options</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>

    <span class="c1"># Store control in persistent state</span>
    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">control_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">control_type</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="n">control_type</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_deckgl_layer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_deckgl_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">layer_type</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_deckgl_layer" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a DeckGL layer to the map.</p>
<p>This method adds a DeckGL layer overlay to the MapLibre map. DeckGL provides
high-performance visualization of large datasets with WebGL-powered layers.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier for the DeckGL layer.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>layer_type</code></td>
        <td><code>str</code></td>
        <td><p>Type of DeckGL layer (e.g., 'ScatterplotLayer', 'PathLayer', 'GeoJsonLayer').</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>data</code></td>
        <td><code>Union[List[Dict], Dict[str, Any]]</code></td>
        <td><p>Data for the layer. Can be a list of objects or GeoJSON-like structure.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>props</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Layer-specific properties for styling and behavior.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>visible</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the layer should be visible initially.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional layer properties.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">MapLibreMap</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Add a scatterplot layer</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
<span class="o">...</span>     <span class="p">{</span><span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">122.4</span><span class="p">,</span> <span class="mf">37.8</span><span class="p">],</span> <span class="s2">&quot;radius&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]},</span>
<span class="o">...</span>     <span class="p">{</span><span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">74.0</span><span class="p">,</span> <span class="mf">40.7</span><span class="p">],</span> <span class="s2">&quot;radius&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}</span>
<span class="o">...</span> <span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_deckgl_layer</span><span class="p">(</span>
<span class="o">...</span>     <span class="s2">&quot;my_points&quot;</span><span class="p">,</span>
<span class="o">...</span>     <span class="s2">&quot;ScatterplotLayer&quot;</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">data</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">props</span><span class="o">=</span><span class="p">{</span>
<span class="o">...</span>         <span class="s2">&quot;getPosition&quot;</span><span class="p">:</span> <span class="s2">&quot;position&quot;</span><span class="p">,</span>
<span class="o">...</span>         <span class="s2">&quot;getRadius&quot;</span><span class="p">:</span> <span class="s2">&quot;radius&quot;</span><span class="p">,</span>
<span class="o">...</span>         <span class="s2">&quot;getFillColor&quot;</span><span class="p">:</span> <span class="s2">&quot;color&quot;</span><span class="p">,</span>
<span class="o">...</span>         <span class="s2">&quot;pickable&quot;</span><span class="p">:</span> <span class="kc">True</span>
<span class="o">...</span>     <span class="p">}</span>
<span class="o">...</span> <span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_deckgl_layer</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">layer_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="n">props</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a DeckGL layer to the map.</span>

<span class="sd">    This method adds a DeckGL layer overlay to the MapLibre map. DeckGL provides</span>
<span class="sd">    high-performance visualization of large datasets with WebGL-powered layers.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Unique identifier for the DeckGL layer.</span>
<span class="sd">        layer_type: Type of DeckGL layer (e.g., &#39;ScatterplotLayer&#39;, &#39;PathLayer&#39;, &#39;GeoJsonLayer&#39;).</span>
<span class="sd">        data: Data for the layer. Can be a list of objects or GeoJSON-like structure.</span>
<span class="sd">        props: Layer-specific properties for styling and behavior.</span>
<span class="sd">        visible: Whether the layer should be visible initially.</span>
<span class="sd">        **kwargs: Additional layer properties.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; m = MapLibreMap()</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Add a scatterplot layer</span>
<span class="sd">        &gt;&gt;&gt; data = [</span>
<span class="sd">        ...     {&quot;position&quot;: [-122.4, 37.8], &quot;radius&quot;: 100, &quot;color&quot;: [255, 0, 0]},</span>
<span class="sd">        ...     {&quot;position&quot;: [-74.0, 40.7], &quot;radius&quot;: 150, &quot;color&quot;: [0, 255, 0]}</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt; m.add_deckgl_layer(</span>
<span class="sd">        ...     &quot;my_points&quot;,</span>
<span class="sd">        ...     &quot;ScatterplotLayer&quot;,</span>
<span class="sd">        ...     data,</span>
<span class="sd">        ...     props={</span>
<span class="sd">        ...         &quot;getPosition&quot;: &quot;position&quot;,</span>
<span class="sd">        ...         &quot;getRadius&quot;: &quot;radius&quot;,</span>
<span class="sd">        ...         &quot;getFillColor&quot;: &quot;color&quot;,</span>
<span class="sd">        ...         &quot;pickable&quot;: True</span>
<span class="sd">        ...     }</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">props</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">props</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Merge kwargs into props</span>
    <span class="n">layer_props</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">props</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">}</span>

    <span class="c1"># Convert lambda functions to JavaScript-compatible strings</span>
    <span class="n">layer_props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_deckgl_props</span><span class="p">(</span><span class="n">layer_props</span><span class="p">)</span>

    <span class="n">layer_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">layer_type</span><span class="p">,</span>
        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
        <span class="s2">&quot;props&quot;</span><span class="p">:</span> <span class="n">layer_props</span><span class="p">,</span>
        <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">visible</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Store layer in local state</span>
    <span class="n">current_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">)</span>
    <span class="n">current_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span> <span class="o">=</span> <span class="n">current_layers</span>

    <span class="c1"># Send to JavaScript</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addDeckGLLayer&quot;</span><span class="p">,</span> <span class="n">layer_config</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_draw_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_draw_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-left&#39;</span><span class="p">,</span> <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_mode</span><span class="o">=</span><span class="s1">&#39;simple_select&#39;</span><span class="p">,</span> <span class="n">keybindings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">touch_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">preserve_selection_on_edit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">styles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_draw_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a draw control to the map for drawing and editing geometries.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Position on map ('top-left', 'top-right', 'bottom-left', 'bottom-right')</p></td>
        <td><code>&#39;top-left&#39;</code></td>
      </tr>
      <tr>
        <td><code>controls</code></td>
        <td><code>Optional[Dict[str, bool]]</code></td>
        <td><p>Dictionary specifying which drawing tools to show.
     Defaults to {'point': True, 'line_string': True, 'polygon': True, 'trash': True}</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>default_mode</code></td>
        <td><code>str</code></td>
        <td><p>Initial interaction mode ('simple_select', 'direct_select', 'draw_point', etc.)</p></td>
        <td><code>&#39;simple_select&#39;</code></td>
      </tr>
      <tr>
        <td><code>keybindings</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to enable keyboard shortcuts</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>touch_enabled</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to enable touch interactions</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>preserve_selection_on_edit</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to keep features selected during vertex editing/moving.
                       If True, features remain selected after editing. If False, uses
                       default MapboxDraw behavior (deselection after edit).</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>styles</code></td>
        <td><code>Optional[List[Dict[str, Any]]]</code></td>
        <td><p>Optional list of custom MapboxDraw style objects. If None, uses default styles.
   Each style should be a dict with 'id', 'type', 'filter', and 'paint'/'layout' properties.
   See MapboxDraw documentation for style object format.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional options to pass to MapboxDraw constructor</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_draw_control</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
    <span class="n">controls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;simple_select&quot;</span><span class="p">,</span>
    <span class="n">keybindings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">touch_enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">preserve_selection_on_edit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">styles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a draw control to the map for drawing and editing geometries.</span>

<span class="sd">    Args:</span>
<span class="sd">        position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">        controls: Dictionary specifying which drawing tools to show.</span>
<span class="sd">                 Defaults to {&#39;point&#39;: True, &#39;line_string&#39;: True, &#39;polygon&#39;: True, &#39;trash&#39;: True}</span>
<span class="sd">        default_mode: Initial interaction mode (&#39;simple_select&#39;, &#39;direct_select&#39;, &#39;draw_point&#39;, etc.)</span>
<span class="sd">        keybindings: Whether to enable keyboard shortcuts</span>
<span class="sd">        touch_enabled: Whether to enable touch interactions</span>
<span class="sd">        preserve_selection_on_edit: Whether to keep features selected during vertex editing/moving.</span>
<span class="sd">                                   If True, features remain selected after editing. If False, uses</span>
<span class="sd">                                   default MapboxDraw behavior (deselection after edit).</span>
<span class="sd">        styles: Optional list of custom MapboxDraw style objects. If None, uses default styles.</span>
<span class="sd">               Each style should be a dict with &#39;id&#39;, &#39;type&#39;, &#39;filter&#39;, and &#39;paint&#39;/&#39;layout&#39; properties.</span>
<span class="sd">               See MapboxDraw documentation for style object format.</span>
<span class="sd">        **kwargs: Additional options to pass to MapboxDraw constructor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">controls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">controls</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;line_string&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;polygon&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;trash&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="n">draw_options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;displayControlsDefault&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;controls&quot;</span><span class="p">:</span> <span class="n">controls</span><span class="p">,</span>
        <span class="s2">&quot;defaultMode&quot;</span><span class="p">:</span> <span class="n">default_mode</span><span class="p">,</span>
        <span class="s2">&quot;keybindings&quot;</span><span class="p">:</span> <span class="n">keybindings</span><span class="p">,</span>
        <span class="s2">&quot;touchEnabled&quot;</span><span class="p">:</span> <span class="n">touch_enabled</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;preserveSelectionOnEdit&quot;</span><span class="p">:</span> <span class="n">preserve_selection_on_edit</span><span class="p">,</span>
        <span class="s2">&quot;customStyles&quot;</span><span class="p">:</span> <span class="n">styles</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Store draw control configuration</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">draw_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;draw_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">draw_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;draw&quot;</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">draw_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addDrawControl&quot;</span><span class="p">,</span> <span class="n">draw_options</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_draw_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geojson_data</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_draw_data" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add GeoJSON features to the existing draw control data.</p>
<p>This method appends new features to the draw control without clearing
existing drawn features, unlike load_draw_data which replaces all data.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>geojson_data</code></td>
        <td><code>Union[Dict[str, Any], str]</code></td>
        <td><p>GeoJSON data as dictionary or JSON string. Can be a
         FeatureCollection or a single Feature.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geojson_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add GeoJSON features to the existing draw control data.</span>

<span class="sd">    This method appends new features to the draw control without clearing</span>
<span class="sd">    existing drawn features, unlike load_draw_data which replaces all data.</span>

<span class="sd">    Args:</span>
<span class="sd">        geojson_data: GeoJSON data as dictionary or JSON string. Can be a</span>
<span class="sd">                     FeatureCollection or a single Feature.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geojson_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">geojson_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">geojson_data</span><span class="p">)</span>

    <span class="c1"># Normalize input to FeatureCollection if it&#39;s a single Feature</span>
    <span class="k">if</span> <span class="n">geojson_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Feature&quot;</span><span class="p">:</span>
        <span class="n">geojson_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">geojson_data</span><span class="p">]}</span>

    <span class="c1"># Send to JavaScript - it will handle adding features and syncing back the data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addDrawData&quot;</span><span class="p">,</span> <span class="n">geojson_data</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_export_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_export_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-right&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">page_orientation</span><span class="o">=</span><span class="s1">&#39;landscape&#39;</span><span class="p">,</span> <span class="n">default_format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">allowed_sizes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">crosshair</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">printable_area</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collapsed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_export_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add an export control for saving the map as images or PDF.</p>
<p>This control leverages the <code>@watergis/maplibre-gl-export</code> plugin to provide an
interactive, collapsible button that lets users export the current map view as
PNG, JPEG, PDF, or SVG files. The control appears alongside other MapLibre
controls and opens a small panel when toggled.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Placement of the control on the map container.</p></td>
        <td><code>&#39;top-right&#39;</code></td>
      </tr>
      <tr>
        <td><code>filename</code></td>
        <td><code>str</code></td>
        <td><p>Default filename (without extension) suggested for exports.</p></td>
        <td><code>&#39;map&#39;</code></td>
      </tr>
      <tr>
        <td><code>page_size</code></td>
        <td><code>Optional[Sequence[Union[int, float]]]</code></td>
        <td><p>Size of the export page in millimetres as [width, height]. If
omitted, the plugin defaults to A4.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>page_orientation</code></td>
        <td><code>str</code></td>
        <td><p>Page orientation, either <code>"landscape"</code> or <code>"portrait"</code>.</p></td>
        <td><code>&#39;landscape&#39;</code></td>
      </tr>
      <tr>
        <td><code>default_format</code></td>
        <td><code>str</code></td>
        <td><p>Default export format (<code>"pdf"</code>, <code>"png"</code>, <code>"jpg"</code>, <code>"svg"</code>).</p></td>
        <td><code>&#39;pdf&#39;</code></td>
      </tr>
      <tr>
        <td><code>dpi</code></td>
        <td><code>int</code></td>
        <td><p>Dots per inch used when rendering the export.</p></td>
        <td><code>300</code></td>
      </tr>
      <tr>
        <td><code>allowed_sizes</code></td>
        <td><code>Optional[Sequence[str]]</code></td>
        <td><p>Optional whitelist of page sizes (e.g. <code>["A4", "LETTER"]</code>).</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>crosshair</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to show the crosshair overlay when the panel is open.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>printable_area</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to show the printable area overlay when the panel is open.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>locale</code></td>
        <td><code>str</code></td>
        <td><p>Two-letter locale code for the control's UI language.</p></td>
        <td><code>&#39;en&#39;</code></td>
      </tr>
      <tr>
        <td><code>options</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Extra keyword arguments forwarded to the export plugin.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>collapsed</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the control should start collapsed (button only).</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_export_control</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;map&quot;</span><span class="p">,</span>
    <span class="n">page_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">page_orientation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;landscape&quot;</span><span class="p">,</span>
    <span class="n">default_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pdf&quot;</span><span class="p">,</span>
    <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
    <span class="n">allowed_sizes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">crosshair</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">printable_area</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">locale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">collapsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an export control for saving the map as images or PDF.</span>

<span class="sd">    This control leverages the `@watergis/maplibre-gl-export` plugin to provide an</span>
<span class="sd">    interactive, collapsible button that lets users export the current map view as</span>
<span class="sd">    PNG, JPEG, PDF, or SVG files. The control appears alongside other MapLibre</span>
<span class="sd">    controls and opens a small panel when toggled.</span>

<span class="sd">    Args:</span>
<span class="sd">        position: Placement of the control on the map container.</span>
<span class="sd">        filename: Default filename (without extension) suggested for exports.</span>
<span class="sd">        page_size: Size of the export page in millimetres as [width, height]. If</span>
<span class="sd">            omitted, the plugin defaults to A4.</span>
<span class="sd">        page_orientation: Page orientation, either ``&quot;landscape&quot;`` or ``&quot;portrait&quot;``.</span>
<span class="sd">        default_format: Default export format (``&quot;pdf&quot;``, ``&quot;png&quot;``, ``&quot;jpg&quot;``, ``&quot;svg&quot;``).</span>
<span class="sd">        dpi: Dots per inch used when rendering the export.</span>
<span class="sd">        allowed_sizes: Optional whitelist of page sizes (e.g. ``[&quot;A4&quot;, &quot;LETTER&quot;]``).</span>
<span class="sd">        crosshair: Whether to show the crosshair overlay when the panel is open.</span>
<span class="sd">        printable_area: Whether to show the printable area overlay when the panel is open.</span>
<span class="sd">        locale: Two-letter locale code for the control&#39;s UI language.</span>
<span class="sd">        options: Extra keyword arguments forwarded to the export plugin.</span>
<span class="sd">        collapsed: Whether the control should start collapsed (button only).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">orientation_value</span> <span class="o">=</span> <span class="n">page_orientation</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">orientation_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;landscape&quot;</span><span class="p">,</span> <span class="s2">&quot;portrait&quot;</span><span class="p">}:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;page_orientation must be &#39;landscape&#39; or &#39;portrait&#39;&quot;</span><span class="p">)</span>

    <span class="n">format_value</span> <span class="o">=</span> <span class="n">default_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">format_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="s2">&quot;jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;svg&quot;</span><span class="p">}:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;default_format must be one of {&#39;png&#39;, &#39;jpg&#39;, &#39;jpeg&#39;, &#39;pdf&#39;, &#39;svg&#39;}&quot;</span>
        <span class="p">)</span>
    <span class="c1"># Normalise JPEG alias</span>
    <span class="k">if</span> <span class="n">format_value</span> <span class="o">==</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">:</span>
        <span class="n">format_value</span> <span class="o">=</span> <span class="s2">&quot;jpg&quot;</span>

    <span class="n">control_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span> <span class="ow">or</span> <span class="p">{})</span>
    <span class="n">clean_filename</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">filename</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">clean_locale</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">locale</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">locale</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>
    <span class="n">control_options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;Filename&quot;</span><span class="p">,</span> <span class="n">clean_filename</span> <span class="ow">or</span> <span class="s2">&quot;map&quot;</span><span class="p">)</span>
    <span class="n">control_options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;PageOrientation&quot;</span><span class="p">,</span> <span class="n">orientation_value</span><span class="p">)</span>
    <span class="n">control_options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;Format&quot;</span><span class="p">,</span> <span class="n">format_value</span><span class="p">)</span>
    <span class="n">control_options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;DPI&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">dpi</span><span class="p">))</span>
    <span class="n">control_options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;Crosshair&quot;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">crosshair</span><span class="p">))</span>
    <span class="n">control_options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;PrintableArea&quot;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">printable_area</span><span class="p">))</span>
    <span class="n">control_options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;Locale&quot;</span><span class="p">,</span> <span class="n">clean_locale</span> <span class="ow">or</span> <span class="s2">&quot;en&quot;</span><span class="p">)</span>
    <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;collapsed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collapsed</span>

    <span class="k">if</span> <span class="n">page_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">page_size_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">page_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">page_size_values</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;page_size must contain exactly two values [width, height]&quot;</span>
            <span class="p">)</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;PageSize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">page_size_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">page_size_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">]</span>

    <span class="k">if</span> <span class="n">allowed_sizes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;AllowedSizes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">size</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">allowed_sizes</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;export_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;export&quot;</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;export&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_flatgeobuf_layer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_flatgeobuf_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">layer_type</span><span class="o">=</span><span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">paint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">promote_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minzoom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxzoom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_flatgeobuf_layer" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a vector layer from a FlatGeobuf dataset.</p>
<p>The FlatGeobuf file is streamed in the browser and converted to GeoJSON
before being added to the map. Rendering happens entirely client-side,
so very large datasets may still impact browser performance.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>url</code></td>
        <td><code>str</code></td>
        <td><p>URL pointing to the FlatGeobuf resource.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier for the map layer.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>layer_type</code></td>
        <td><code>str</code></td>
        <td><p>MapLibre layer type (e.g., <code>'fill'</code>, <code>'line'</code>, <code>'circle'</code>).</p></td>
        <td><code>&#39;fill&#39;</code></td>
      </tr>
      <tr>
        <td><code>source_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional custom source identifier. Defaults to <code>{layer_id}_source</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>paint</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Optional paint properties dictionary.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>layout</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Optional layout properties dictionary.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>filter</code></td>
        <td><code>Optional[Any]</code></td>
        <td><p>Optional MapLibre expression used to filter features.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>bbox</code></td>
        <td><code>Optional[List[float]]</code></td>
        <td><p>Optional bounding box <code>[minX, minY, maxX, maxY]</code> used to limit
features retrieved from the dataset.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>promote_id</code></td>
        <td><code>Union[str, Dict[str, str]]</code></td>
        <td><p>Optional feature identifier promotion configuration.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>minzoom</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>Optional minimum zoom level for the layer.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>maxzoom</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>Optional maximum zoom level for the layer.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>before_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional layer id to insert the new layer before.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>metadata</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Optional metadata dictionary attached to the layer configuration.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>name</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional friendly name used in the layer manager. Defaults to <code>layer_id</code>.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The identifier of the layer that was registered.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_flatgeobuf_layer</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">layer_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
    <span class="n">source_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">bbox</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">promote_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">minzoom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">maxzoom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a vector layer from a FlatGeobuf dataset.</span>

<span class="sd">    The FlatGeobuf file is streamed in the browser and converted to GeoJSON</span>
<span class="sd">    before being added to the map. Rendering happens entirely client-side,</span>
<span class="sd">    so very large datasets may still impact browser performance.</span>

<span class="sd">    Args:</span>
<span class="sd">        url: URL pointing to the FlatGeobuf resource.</span>
<span class="sd">        layer_id: Unique identifier for the map layer.</span>
<span class="sd">        layer_type: MapLibre layer type (e.g., ``&#39;fill&#39;``, ``&#39;line&#39;``, ``&#39;circle&#39;``).</span>
<span class="sd">        source_id: Optional custom source identifier. Defaults to ``{layer_id}_source``.</span>
<span class="sd">        paint: Optional paint properties dictionary.</span>
<span class="sd">        layout: Optional layout properties dictionary.</span>
<span class="sd">        filter: Optional MapLibre expression used to filter features.</span>
<span class="sd">        bbox: Optional bounding box ``[minX, minY, maxX, maxY]`` used to limit</span>
<span class="sd">            features retrieved from the dataset.</span>
<span class="sd">        promote_id: Optional feature identifier promotion configuration.</span>
<span class="sd">        minzoom: Optional minimum zoom level for the layer.</span>
<span class="sd">        maxzoom: Optional maximum zoom level for the layer.</span>
<span class="sd">        before_id: Optional layer id to insert the new layer before.</span>
<span class="sd">        metadata: Optional metadata dictionary attached to the layer configuration.</span>
<span class="sd">        name: Optional friendly name used in the layer manager. Defaults to ``layer_id``.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The identifier of the layer that was registered.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">source_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">source_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_source&quot;</span>

    <span class="n">layer_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">layer_type</span><span class="p">,</span>
        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">paint</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paint</span>
    <span class="k">if</span> <span class="n">layout</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layout</span>
    <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span>
    <span class="k">if</span> <span class="n">promote_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;promoteId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">promote_id</span>
    <span class="k">if</span> <span class="n">minzoom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;minzoom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minzoom</span>
    <span class="k">if</span> <span class="n">maxzoom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;maxzoom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxzoom</span>
    <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span>

    <span class="c1"># Track the layer locally so the layer manager can interact with it.</span>
    <span class="n">current_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="p">)</span>
    <span class="n">current_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span> <span class="o">=</span> <span class="n">current_layers</span>

    <span class="n">display_name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">layer_id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="n">layer_config</span><span class="p">,</span>
        <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;flatgeobuf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">display_name</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>

    <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;layerId&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span>
        <span class="s2">&quot;sourceId&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
        <span class="s2">&quot;layerType&quot;</span><span class="p">:</span> <span class="n">layer_type</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">paint</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paint</span>
    <span class="k">if</span> <span class="n">layout</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layout</span>
    <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span>
    <span class="k">if</span> <span class="n">bbox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;bbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bbox</span>
    <span class="k">if</span> <span class="n">promote_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;promoteId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">promote_id</span>
    <span class="k">if</span> <span class="n">minzoom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;minzoom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minzoom</span>
    <span class="k">if</span> <span class="n">maxzoom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;maxzoom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxzoom</span>
    <span class="k">if</span> <span class="n">before_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;beforeId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">before_id</span>
    <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span>
    <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">display_name</span>

    <span class="n">flatgeobuf_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flatgeobuf_layers</span><span class="p">)</span>
    <span class="n">flatgeobuf_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flatgeobuf_layers</span> <span class="o">=</span> <span class="n">flatgeobuf_layers</span>

    <span class="k">return</span> <span class="n">layer_id</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_geocoder_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_geocoder_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-left&#39;</span><span class="p">,</span> <span class="n">api_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collapsed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_geocoder_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a geocoder control to the map for searching locations.</p>
<p>The geocoder control allows users to search for locations using a geocoding service.
By default, it uses the Nominatim (OpenStreetMap) geocoding API.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Position on map ('top-left', 'top-right', 'bottom-left', 'bottom-right')</p></td>
        <td><code>&#39;top-left&#39;</code></td>
      </tr>
      <tr>
        <td><code>api_config</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Configuration for the geocoding API. If None, uses default Nominatim config</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>options</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Additional options for the geocoder control</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>collapsed</code></td>
        <td><code>bool</code></td>
        <td><p>If True, shows only search icon initially. Click to expand input box.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_geocoder_control</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
    <span class="n">api_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">collapsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a geocoder control to the map for searching locations.</span>

<span class="sd">    The geocoder control allows users to search for locations using a geocoding service.</span>
<span class="sd">    By default, it uses the Nominatim (OpenStreetMap) geocoding API.</span>

<span class="sd">    Args:</span>
<span class="sd">        position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">        api_config: Configuration for the geocoding API. If None, uses default Nominatim config</span>
<span class="sd">        options: Additional options for the geocoder control</span>
<span class="sd">        collapsed: If True, shows only search icon initially. Click to expand input box.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">api_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Default configuration using Nominatim API</span>
        <span class="n">api_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;forwardGeocode&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;reverseGeocode&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;placeholder&quot;</span><span class="p">:</span> <span class="s2">&quot;Search for places...&quot;</span><span class="p">,</span>
            <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;api_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://nominatim.openstreetmap.org/search&quot;</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="n">control_options</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;api_config&quot;</span><span class="p">:</span> <span class="n">api_config</span><span class="p">,</span>
            <span class="s2">&quot;collapsed&quot;</span><span class="p">:</span> <span class="n">collapsed</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Store control in persistent state</span>
    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;geocoder_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;geocoder&quot;</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;geocoder&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_geogrid_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_geogrid_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-left&#39;</span><span class="p">,</span> <span class="n">before_layer_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zoom_level_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label_style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_geogrid_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a geographic grid (graticule) with labeled coordinates to the map.</p>
<p>This control uses the <code>geogrid-maplibre-gl</code> plugin to display latitude/longitude
grid lines with customizable styling and formatting. The grid dynamically adjusts
based on zoom level and supports globe projection (MapLibre GL 5.x).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Placement of the control on the map container (not applicable
for this plugin, but kept for API consistency).</p></td>
        <td><code>&#39;top-left&#39;</code></td>
      </tr>
      <tr>
        <td><code>before_layer_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>ID of the layer to insert the grid beneath. If None,
the grid is added as the top layer.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>zoom_level_range</code></td>
        <td><code>Optional[Sequence[Union[int, float]]]</code></td>
        <td><p>Tuple of [min_zoom, max_zoom] defining visibility range.
If None, the grid is visible at all zoom levels.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>grid_style</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Styling options for grid lines. Supports both MapLibre paint
properties (<code>line-color</code>, <code>line-width</code>, <code>line-dasharray</code>,
<code>line-opacity</code>) and GeoGrid native properties (<code>color</code>, <code>width</code>,
<code>dasharray</code>, <code>opacity</code>). MapLibre properties are automatically
converted to GeoGrid format.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>label_style</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Styling options for coordinate labels. Supports CSS properties
like <code>color</code>, <code>fontSize</code>, <code>textShadow</code>, etc.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>options</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Additional configuration options passed directly to the GeoGrid
constructor. Can include custom <code>gridDensity</code> or <code>formatLabels</code> functions.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">MapLibreMap</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Using MapLibre paint properties</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_geogrid_control</span><span class="p">(</span><span class="n">grid_style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;line-color&#39;</span><span class="p">:</span> <span class="s1">&#39;#ff0000&#39;</span><span class="p">,</span> <span class="s1">&#39;line-width&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Using GeoGrid native properties</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_geogrid_control</span><span class="p">(</span><span class="n">grid_style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_geogrid_control</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
    <span class="n">before_layer_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">zoom_level_range</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">grid_style</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">label_style</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a geographic grid (graticule) with labeled coordinates to the map.</span>

<span class="sd">    This control uses the `geogrid-maplibre-gl` plugin to display latitude/longitude</span>
<span class="sd">    grid lines with customizable styling and formatting. The grid dynamically adjusts</span>
<span class="sd">    based on zoom level and supports globe projection (MapLibre GL 5.x).</span>

<span class="sd">    Args:</span>
<span class="sd">        position: Placement of the control on the map container (not applicable</span>
<span class="sd">            for this plugin, but kept for API consistency).</span>
<span class="sd">        before_layer_id: ID of the layer to insert the grid beneath. If None,</span>
<span class="sd">            the grid is added as the top layer.</span>
<span class="sd">        zoom_level_range: Tuple of [min_zoom, max_zoom] defining visibility range.</span>
<span class="sd">            If None, the grid is visible at all zoom levels.</span>
<span class="sd">        grid_style: Styling options for grid lines. Supports both MapLibre paint</span>
<span class="sd">            properties (``line-color``, ``line-width``, ``line-dasharray``,</span>
<span class="sd">            ``line-opacity``) and GeoGrid native properties (``color``, ``width``,</span>
<span class="sd">            ``dasharray``, ``opacity``). MapLibre properties are automatically</span>
<span class="sd">            converted to GeoGrid format.</span>
<span class="sd">        label_style: Styling options for coordinate labels. Supports CSS properties</span>
<span class="sd">            like ``color``, ``fontSize``, ``textShadow``, etc.</span>
<span class="sd">        options: Additional configuration options passed directly to the GeoGrid</span>
<span class="sd">            constructor. Can include custom ``gridDensity`` or ``formatLabels`` functions.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; m = MapLibreMap(center=[0, 20], zoom=2)</span>
<span class="sd">        &gt;&gt;&gt; # Using MapLibre paint properties</span>
<span class="sd">        &gt;&gt;&gt; m.add_geogrid_control(grid_style={&#39;line-color&#39;: &#39;#ff0000&#39;, &#39;line-width&#39;: 2})</span>
<span class="sd">        &gt;&gt;&gt; # Using GeoGrid native properties</span>
<span class="sd">        &gt;&gt;&gt; m.add_geogrid_control(grid_style={&#39;color&#39;: &#39;red&#39;, &#39;width&#39;: 2})</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">control_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span> <span class="ow">or</span> <span class="p">{})</span>
    <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>

    <span class="k">if</span> <span class="n">before_layer_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;beforeLayerId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">before_layer_id</span>

    <span class="k">if</span> <span class="n">zoom_level_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">zoom_range</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">zoom_level_range</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zoom_range</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;zoom_level_range must contain exactly two values [min_zoom, max_zoom]&quot;</span>
            <span class="p">)</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;zoomLevelRange&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">zoom_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">zoom_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">]</span>

    <span class="k">if</span> <span class="n">grid_style</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;gridStyle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">grid_style</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">label_style</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;labelStyle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label_style</span><span class="p">)</span>

    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;geogrid_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;geogrid&quot;</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;geogrid&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_geojson" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_geojson</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">layer_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">paint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fit_bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_geojson" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a GeoJSON layer to the map.</p>
<p>This method adds a GeoJSON layer to the map. The GeoJSON data can be a
URL to a GeoJSON file or a GeoJSON dictionary.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>data</code></td>
        <td><code>Union[str, Dict]</code></td>
        <td><p>The GeoJSON data. This can be a URL to a GeoJSON file or a
GeoJSON dictionary.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>layer_type</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The type of the layer. It can be one of the following:
'circle', 'fill', 'fill-extrusion', 'line', 'symbol'. If None,
the type is inferred from the GeoJSON data.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>filter</code></td>
        <td><code>Optional[Dict]</code></td>
        <td><p>The filter to apply to the layer. If None, no filter is applied.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>paint</code></td>
        <td><code>Optional[Dict]</code></td>
        <td><p>The paint properties to apply to the layer. If None, default
paint properties are applied based on geometry type.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>name</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The name of the layer. If None, 'GeoJSON' is used.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>fit_bounds</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to adjust the viewport of the map to fit the
bounds of the GeoJSON data. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>visible</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the layer is visible or not. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>opacity</code></td>
        <td><code>float</code></td>
        <td><p>The opacity of the layer. Defaults to 1.0.</p></td>
        <td><code>1.0</code></td>
      </tr>
      <tr>
        <td><code>before_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The ID of an existing layer before which the new layer
should be inserted.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>source_args</code></td>
        <td><code>Optional[Dict]</code></td>
        <td><p>Additional keyword arguments that are passed to the
GeoJSON source.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional keyword arguments that are passed to the layer.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_geojson</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">],</span>
    <span class="n">layer_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fit_bounds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">source_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a GeoJSON layer to the map.</span>

<span class="sd">    This method adds a GeoJSON layer to the map. The GeoJSON data can be a</span>
<span class="sd">    URL to a GeoJSON file or a GeoJSON dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: The GeoJSON data. This can be a URL to a GeoJSON file or a</span>
<span class="sd">            GeoJSON dictionary.</span>
<span class="sd">        layer_type: The type of the layer. It can be one of the following:</span>
<span class="sd">            &#39;circle&#39;, &#39;fill&#39;, &#39;fill-extrusion&#39;, &#39;line&#39;, &#39;symbol&#39;. If None,</span>
<span class="sd">            the type is inferred from the GeoJSON data.</span>
<span class="sd">        filter: The filter to apply to the layer. If None, no filter is applied.</span>
<span class="sd">        paint: The paint properties to apply to the layer. If None, default</span>
<span class="sd">            paint properties are applied based on geometry type.</span>
<span class="sd">        name: The name of the layer. If None, &#39;GeoJSON&#39; is used.</span>
<span class="sd">        fit_bounds: Whether to adjust the viewport of the map to fit the</span>
<span class="sd">            bounds of the GeoJSON data. Defaults to True.</span>
<span class="sd">        visible: Whether the layer is visible or not. Defaults to True.</span>
<span class="sd">        opacity: The opacity of the layer. Defaults to 1.0.</span>
<span class="sd">        before_id: The ID of an existing layer before which the new layer</span>
<span class="sd">            should be inserted.</span>
<span class="sd">        source_args: Additional keyword arguments that are passed to the</span>
<span class="sd">            GeoJSON source.</span>
<span class="sd">        **kwargs: Additional keyword arguments that are passed to the layer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">geom_type</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">source_args</span> <span class="o">=</span> <span class="n">source_args</span> <span class="ow">or</span> <span class="p">{}</span>

    <span class="c1"># Load data from file or URL if necessary</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">):</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">__geo_interface__</span>
            <span class="k">if</span> <span class="n">fit_bounds</span><span class="p">:</span>
                <span class="n">bounds</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">total_bounds</span>  <span class="c1"># [minx, miny, maxx, maxy]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The data must be a URL, file path, or GeoJSON dictionary.&quot;</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fit_bounds</span><span class="p">:</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">total_bounds</span>  <span class="c1"># [minx, miny, maxx, maxy]</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The data must be a URL, file path, or GeoJSON dictionary.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Generate layer name if not provided</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;GeoJSON&quot;</span>

    <span class="c1"># Infer geometry type and set default paint if not provided</span>
    <span class="k">if</span> <span class="n">paint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;features&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">geom_type</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;geometry&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;geometry&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">geom_type</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">geom_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Point&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiPoint&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">layer_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">layer_type</span> <span class="o">=</span> <span class="s2">&quot;circle&quot;</span>
            <span class="n">paint</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;circle-radius&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                <span class="s2">&quot;circle-color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3388ff&quot;</span><span class="p">,</span>
                <span class="s2">&quot;circle-stroke-color&quot;</span><span class="p">:</span> <span class="s2">&quot;#ffffff&quot;</span><span class="p">,</span>
                <span class="s2">&quot;circle-stroke-width&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="n">geom_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;LineString&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiLineString&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">layer_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">layer_type</span> <span class="o">=</span> <span class="s2">&quot;line&quot;</span>
            <span class="n">paint</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;line-color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3388ff&quot;</span><span class="p">,</span> <span class="s2">&quot;line-width&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">geom_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Polygon&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiPolygon&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">layer_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">layer_type</span> <span class="o">=</span> <span class="s2">&quot;fill&quot;</span>
            <span class="n">paint</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;fill-color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3388ff&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fill-opacity&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="c1"># Add source</span>
    <span class="n">source_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_source&quot;</span>
    <span class="n">source_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;geojson&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">}</span>
    <span class="n">source_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">source_args</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">source_id</span><span class="p">,</span> <span class="n">source_config</span><span class="p">)</span>

    <span class="c1"># Prepare layer configuration</span>
    <span class="n">layer_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">layer_type</span> <span class="ow">or</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span>

    <span class="k">if</span> <span class="n">paint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paint</span>

    <span class="n">layer_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Add layer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="o">=</span><span class="n">layer_config</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span> <span class="n">layer_id</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># Set visibility</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">visible</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_visibility</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Set opacity</span>
    <span class="k">if</span> <span class="n">opacity</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_opacity</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>

    <span class="c1"># Fit bounds if requested</span>
    <span class="k">if</span> <span class="n">fit_bounds</span> <span class="ow">and</span> <span class="n">bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Convert from [minx, miny, maxx, maxy] to [[west, south], [east, north]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_bounds</span><span class="p">([[</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]]])</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_geojson_layer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_geojson_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">geojson_data</span><span class="p">,</span> <span class="n">layer_type</span><span class="o">=</span><span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="n">paint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_geojson_layer" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a GeoJSON layer to the map.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier for the layer.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>geojson_data</code></td>
        <td><code>Dict[str, Any]</code></td>
        <td><p>GeoJSON data as a dictionary.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>layer_type</code></td>
        <td><code>str</code></td>
        <td><p>Type of layer (e.g., 'fill', 'line', 'circle', 'symbol').</p></td>
        <td><code>&#39;fill&#39;</code></td>
      </tr>
      <tr>
        <td><code>paint</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Optional paint properties for styling the layer.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>before_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional layer ID to insert this layer before.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_geojson_layer</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">geojson_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">layer_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
    <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a GeoJSON layer to the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Unique identifier for the layer.</span>
<span class="sd">        geojson_data: GeoJSON data as a dictionary.</span>
<span class="sd">        layer_type: Type of layer (e.g., &#39;fill&#39;, &#39;line&#39;, &#39;circle&#39;, &#39;symbol&#39;).</span>
<span class="sd">        paint: Optional paint properties for styling the layer.</span>
<span class="sd">        before_id: Optional layer ID to insert this layer before.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_source&quot;</span>

    <span class="c1"># Add source</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">source_id</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;geojson&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">geojson_data</span><span class="p">})</span>

    <span class="c1"># Add layer</span>
    <span class="n">layer_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">layer_type</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">paint</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paint</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="o">=</span><span class="n">layer_config</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span> <span class="n">layer_id</span><span class="o">=</span><span class="n">layer_id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_geoman_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_geoman_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-left&#39;</span><span class="p">,</span> <span class="n">geoman_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collapsed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_info_box</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">info_box_mode</span><span class="o">=</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="n">info_box_tolerance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">paint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">paint_above_geoman</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_geoman_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add the MapLibre-Geoman drawing and editing toolkit.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Where to dock the Geoman toolbar on the map.</p></td>
        <td><code>&#39;top-left&#39;</code></td>
      </tr>
      <tr>
        <td><code>geoman_options</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Raw configuration dictionary passed directly to the
<code>Geoman</code> constructor.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>settings</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Optional convenience overrides merged into
<code>geoman_options['settings']</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>controls</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Optional overrides for toolbar sections such as <code>draw</code>,
<code>edit</code>, or <code>helper</code>. Each key should map to a dictionary of
button configuration overrides.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>collapsed</code></td>
        <td><code>Optional[bool]</code></td>
        <td><p>Whether the toolbar UI should start collapsed. Use
<code>None</code> to defer to the underlying configuration.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>show_info_box</code></td>
        <td><code>Optional[bool]</code></td>
        <td><p>If True, show an info box that displays the properties
of the currently selected feature when clicking or hovering over any feature
in the Geoman layer, not just during editing. Defaults to None (no change in frontend default).</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>info_box_mode</code></td>
        <td><code>str</code></td>
        <td><p>'click' to show info only after clicking a feature (default),
or 'hover' to show on mouse hover.</p></td>
        <td><code>&#39;click&#39;</code></td>
      </tr>
      <tr>
        <td><code>info_box_tolerance</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>Pixel search tolerance when detecting a feature
under the pointer. Larger values make selection easier (default 8 for
click, 6 for hover if not specified).</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>paint</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Optional styling config for a mirrored, read-only GeoJSON layer
that reflects the current <code>geoman_data</code> for visualization. All keys
are optional. Structure:
{
    "line": { ... MapLibre line paint ... },     # For LineString/MultiLineString
    "fill": { ... MapLibre fill paint ... },     # For Polygon/MultiPolygon
    "point": { ... MapLibre circle paint ... }   # For Point/MultiPoint
}
The mirrored layer shows the final saved geometry, not intermediate
editing states. You can use data-driven expressions here, e.g.
line color by ["get","highway"]. Note: If your paint styles are too
similar to Geoman's default editing styles, features may be visually
difficult to distinguish during editing.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>paint_above_geoman</code></td>
        <td><code>bool</code></td>
        <td><p>If True (default), place the mirrored style layers
above Geomans edit layers; set False to draw beneath them.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_geoman_control</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
    <span class="n">geoman_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">controls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">collapsed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">show_info_box</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">info_box_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;click&quot;</span><span class="p">,</span>
    <span class="n">info_box_tolerance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">paint_above_geoman</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add the MapLibre-Geoman drawing and editing toolkit.</span>

<span class="sd">    Args:</span>
<span class="sd">        position: Where to dock the Geoman toolbar on the map.</span>
<span class="sd">        geoman_options: Raw configuration dictionary passed directly to the</span>
<span class="sd">            ``Geoman`` constructor.</span>
<span class="sd">        settings: Optional convenience overrides merged into</span>
<span class="sd">            ``geoman_options[&#39;settings&#39;]``.</span>
<span class="sd">        controls: Optional overrides for toolbar sections such as ``draw``,</span>
<span class="sd">            ``edit``, or ``helper``. Each key should map to a dictionary of</span>
<span class="sd">            button configuration overrides.</span>
<span class="sd">        collapsed: Whether the toolbar UI should start collapsed. Use</span>
<span class="sd">            ``None`` to defer to the underlying configuration.</span>
<span class="sd">        show_info_box: If True, show an info box that displays the properties</span>
<span class="sd">            of the currently selected feature when clicking or hovering over any feature</span>
<span class="sd">            in the Geoman layer, not just during editing. Defaults to None (no change in frontend default).</span>
<span class="sd">        info_box_mode: &#39;click&#39; to show info only after clicking a feature (default),</span>
<span class="sd">            or &#39;hover&#39; to show on mouse hover.</span>
<span class="sd">        info_box_tolerance: Pixel search tolerance when detecting a feature</span>
<span class="sd">            under the pointer. Larger values make selection easier (default 8 for</span>
<span class="sd">            click, 6 for hover if not specified).</span>
<span class="sd">        paint: Optional styling config for a mirrored, read-only GeoJSON layer</span>
<span class="sd">            that reflects the current ``geoman_data`` for visualization. All keys</span>
<span class="sd">            are optional. Structure:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;line&quot;: { ... MapLibre line paint ... },     # For LineString/MultiLineString</span>
<span class="sd">                &quot;fill&quot;: { ... MapLibre fill paint ... },     # For Polygon/MultiPolygon</span>
<span class="sd">                &quot;point&quot;: { ... MapLibre circle paint ... }   # For Point/MultiPoint</span>
<span class="sd">            }</span>
<span class="sd">            The mirrored layer shows the final saved geometry, not intermediate</span>
<span class="sd">            editing states. You can use data-driven expressions here, e.g.</span>
<span class="sd">            line color by [&quot;get&quot;,&quot;highway&quot;]. Note: If your paint styles are too</span>
<span class="sd">            similar to Geoman&#39;s default editing styles, features may be visually</span>
<span class="sd">            difficult to distinguish during editing.</span>
<span class="sd">        paint_above_geoman: If True (default), place the mirrored style layers</span>
<span class="sd">            above Geomans edit layers; set False to draw beneath them.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">geoman_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">geoman_options</span> <span class="ow">or</span> <span class="p">{})</span>

    <span class="k">if</span> <span class="n">settings</span><span class="p">:</span>
        <span class="n">geoman_settings</span> <span class="o">=</span> <span class="n">geoman_config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;settings&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">geoman_settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>

    <span class="c1"># Enable snapping by default</span>
    <span class="n">geoman_controls</span> <span class="o">=</span> <span class="n">geoman_config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;controls&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">helper_controls</span> <span class="o">=</span> <span class="n">geoman_controls</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;helper&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">snapping_config</span> <span class="o">=</span> <span class="n">helper_controls</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;snapping&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">if</span> <span class="s2">&quot;active&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">snapping_config</span><span class="p">:</span>
        <span class="n">snapping_config</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">controls</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">section</span><span class="p">,</span> <span class="n">section_options</span> <span class="ow">in</span> <span class="n">controls</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">section_options</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">section_config</span> <span class="o">=</span> <span class="n">geoman_controls</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="p">{})</span>
                <span class="n">section_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">section_options</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">geoman_controls</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="o">=</span> <span class="n">section_options</span>

    <span class="n">control_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">geoman_config</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;geoman_options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geoman_config</span>
    <span class="k">if</span> <span class="n">show_info_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;show_info_box&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">show_info_box</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">info_box_mode</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;info_box_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">info_box_mode</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">info_box_tolerance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;info_box_tolerance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info_box_tolerance</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">paint</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;geoman_paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">paint</span><span class="p">)</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;geoman_paint_above&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">paint_above_geoman</span><span class="p">)</span>

    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;geoman_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;geoman&quot;</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="s2">&quot;geoman&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;geoman&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>

    <span class="c1"># If Geoman is already initialized, ensure the info box setting is applied at runtime</span>
    <span class="k">if</span> <span class="n">show_info_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setGeomanInfoBoxEnabled&quot;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">show_info_box</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">if</span> <span class="n">collapsed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">collapsed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collapse_geoman_control</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If an explicit method to uncollapse exists, call it here.</span>
            <span class="c1"># For now, this is a placeholder for future logic.</span>
            <span class="k">pass</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_google_streetview" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_google_streetview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-left&#39;</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_google_streetview" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a Google Street View control to the map.</p>
<p>This method adds a Google Street View control that allows users to view
street-level imagery at clicked locations on the map.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Position on map ('top-left', 'top-right', 'bottom-left', 'bottom-right')</p></td>
        <td><code>&#39;top-left&#39;</code></td>
      </tr>
      <tr>
        <td><code>api_key</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Google Maps API key. If None, retrieves from GOOGLE_MAPS_API_KEY environment variable</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>options</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Additional options for the Street View control</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If no API key is provided and none can be found in environment variables</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_google_streetview</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a Google Street View control to the map.</span>

<span class="sd">    This method adds a Google Street View control that allows users to view</span>
<span class="sd">    street-level imagery at clicked locations on the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">        api_key: Google Maps API key. If None, retrieves from GOOGLE_MAPS_API_KEY environment variable</span>
<span class="sd">        options: Additional options for the Street View control</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no API key is provided and none can be found in environment variables</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_env_var</span><span class="p">(</span><span class="s2">&quot;GOOGLE_MAPS_API_KEY&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Google Maps API key is required. Please provide it as a parameter &quot;</span>
                <span class="s2">&quot;or set the GOOGLE_MAPS_API_KEY environment variable.&quot;</span>
            <span class="p">)</span>

    <span class="n">control_options</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Store control in persistent state</span>
    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;google_streetview_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;google_streetview&quot;</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;google_streetview&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_gradientbox_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_gradientbox_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-right&#39;</span><span class="p">,</span> <span class="n">layer_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weight_property</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collapsed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_gradientbox_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a GradientBox control (mapbox-gl-infobox) to show value legend.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Control position.</p></td>
        <td><code>&#39;top-right&#39;</code></td>
      </tr>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional target layer id used for value extraction.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>weight_property</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Feature property name used to compute weights.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>min_value</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>Minimum value for gradient legend.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>max_value</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>Maximum value for gradient legend.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>collapsed</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the control starts collapsed.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>options</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Additional plugin options.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_gradientbox_control</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
    <span class="n">layer_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">weight_property</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">colors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">collapsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a GradientBox control (mapbox-gl-infobox) to show value legend.</span>

<span class="sd">    Args:</span>
<span class="sd">        position: Control position.</span>
<span class="sd">        layer_id: Optional target layer id used for value extraction.</span>
<span class="sd">        weight_property: Feature property name used to compute weights.</span>
<span class="sd">        min_value: Minimum value for gradient legend.</span>
<span class="sd">        max_value: Maximum value for gradient legend.</span>
<span class="sd">        collapsed: Whether the control starts collapsed.</span>
<span class="sd">        options: Additional plugin options.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">control_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span> <span class="ow">or</span> <span class="p">{})</span>
    <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;collapsed&quot;</span><span class="p">:</span> <span class="n">collapsed</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;layerId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_id</span>
    <span class="k">if</span> <span class="n">weight_property</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;weight_property&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight_property</span>
    <span class="k">if</span> <span class="n">min_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">max_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># JS layer will normalize into minMaxValues</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;min_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_value</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;max_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_value</span>
    <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span>

    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;gradientbox_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;gradientbox&quot;</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;gradientbox&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_html" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">bg_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;bottom-right&#39;</span><span class="p">,</span> <span class="n">control_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_html" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add an HTML element to the map.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>html</code></td>
        <td><code>str</code></td>
        <td><p>HTML string to display</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>bg_color</code></td>
        <td><code>str</code></td>
        <td><p>Background color for the HTML container (default: 'white')</p></td>
        <td><code>&#39;white&#39;</code></td>
      </tr>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Position on map ('top-left', 'top-right', 'bottom-left', 'bottom-right')</p></td>
        <td><code>&#39;bottom-right&#39;</code></td>
      </tr>
      <tr>
        <td><code>control_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional unique identifier for the control. If not provided, one will be generated.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional options passed to the control</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_html</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">html</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">bg_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bottom-right&quot;</span><span class="p">,</span>
    <span class="n">control_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an HTML element to the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        html: HTML string to display</span>
<span class="sd">        bg_color: Background color for the HTML container (default: &#39;white&#39;)</span>
<span class="sd">        position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">        control_id: Optional unique identifier for the control. If not provided, one will be generated.</span>
<span class="sd">        **kwargs: Additional options passed to the control</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate control_id if not provided</span>
    <span class="k">if</span> <span class="n">control_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">control_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;html_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Check if control already exists and remove it first</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;html_</span><span class="si">{</span><span class="n">control_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">control_key</span> <span class="ow">in</span> <span class="n">current_controls</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_html</span><span class="p">(</span><span class="n">control_id</span><span class="p">)</span>
        <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>

    <span class="n">control_options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="n">html</span><span class="p">,</span>
            <span class="s2">&quot;bgColor&quot;</span><span class="p">:</span> <span class="n">bg_color</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;control_id&quot;</span><span class="p">:</span> <span class="n">control_id</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Store control in persistent state</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_image_layer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_image_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">image_url</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">paint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_image_layer" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add an image layer to the map.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier for the layer.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>image_url</code></td>
        <td><code>str</code></td>
        <td><p>URL of the image to display.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>coordinates</code></td>
        <td><code>List[List[float]]</code></td>
        <td><p>Corner coordinates of the image as [[top-left], [top-right], [bottom-right], [bottom-left]].
        Each coordinate should be [longitude, latitude].</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>paint</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Optional paint properties for the image layer.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>before_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional layer ID to insert this layer before.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_image_layer</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">image_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">coordinates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
    <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an image layer to the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Unique identifier for the layer.</span>
<span class="sd">        image_url: URL of the image to display.</span>
<span class="sd">        coordinates: Corner coordinates of the image as [[top-left], [top-right], [bottom-right], [bottom-left]].</span>
<span class="sd">                    Each coordinate should be [longitude, latitude].</span>
<span class="sd">        paint: Optional paint properties for the image layer.</span>
<span class="sd">        before_id: Optional layer ID to insert this layer before.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_source&quot;</span>

    <span class="c1"># Add image source</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span>
        <span class="n">source_id</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">image_url</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="n">coordinates</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Add raster layer for the image</span>
    <span class="n">layer_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;raster&quot;</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">paint</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paint</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="o">=</span><span class="n">layer_config</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span> <span class="n">layer_id</span><span class="o">=</span><span class="n">layer_id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_infobox_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_infobox_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-right&#39;</span><span class="p">,</span> <span class="n">layer_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collapsed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_infobox_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add an InfoBox control (mapbox-gl-infobox) to display feature attributes.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Control position ('top-left', 'top-right', 'bottom-left', 'bottom-right').</p></td>
        <td><code>&#39;top-right&#39;</code></td>
      </tr>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional target layer id to listen for hover/click features.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>formatter</code></td>
        <td><code>Union[str, Any]</code></td>
        <td><p>Either an HTML template string (e.g., "<b>{{name}}</b>") or a callable
taking a properties dict and returning HTML. Strings will be templated against
feature properties; unknown keys render as empty.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>collapsed</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the control starts collapsed.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>options</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Additional plugin options passed through.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_infobox_control</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
    <span class="n">layer_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">formatter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">collapsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an InfoBox control (mapbox-gl-infobox) to display feature attributes.</span>

<span class="sd">    Args:</span>
<span class="sd">        position: Control position (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;).</span>
<span class="sd">        layer_id: Optional target layer id to listen for hover/click features.</span>
<span class="sd">        formatter: Either an HTML template string (e.g., &quot;&lt;b&gt;{{name}}&lt;/b&gt;&quot;) or a callable</span>
<span class="sd">            taking a properties dict and returning HTML. Strings will be templated against</span>
<span class="sd">            feature properties; unknown keys render as empty.</span>
<span class="sd">        collapsed: Whether the control starts collapsed.</span>
<span class="sd">        options: Additional plugin options passed through.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">control_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span> <span class="ow">or</span> <span class="p">{})</span>
    <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;collapsed&quot;</span><span class="p">:</span> <span class="n">collapsed</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;layerId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_id</span>
    <span class="k">if</span> <span class="n">formatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Strings are handled as templates in JS; callables cannot be serialized</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">formatter</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;formatter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatter</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Best-effort stringification to avoid non-serializable objects</span>
            <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;formatter_template&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>

    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;infobox_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;infobox&quot;</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;infobox&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_layer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_layer" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a layer to the map.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier for the layer.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>layer_config</code></td>
        <td></td>
        <td><p>Layer configuration dictionary containing
         properties like type, source, paint, and layout.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>before_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional layer ID to insert this layer before.
      If None, layer is added on top.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_layer</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">layer</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">opacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">visible</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a layer to the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Unique identifier for the layer.</span>
<span class="sd">        layer_config: Layer configuration dictionary containing</span>
<span class="sd">                     properties like type, source, paint, and layout.</span>
<span class="sd">        before_id: Optional layer ID to insert this layer before.</span>
<span class="sd">                  If None, layer is added on top.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;minzoom&quot;</span> <span class="ow">in</span> <span class="n">layer</span><span class="p">:</span>
            <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;min-zoom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;minzoom&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;maxzoom&quot;</span> <span class="ow">in</span> <span class="n">layer</span><span class="p">:</span>
            <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;max-zoom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;maxzoom&quot;</span><span class="p">)</span>
        <span class="c1"># MapLibre expects hyphenated keys like &#39;source-layer&#39;, &#39;text-field&#39;, etc.</span>
        <span class="c1"># Convert any underscore_keys to hyphen-keys recursively for JS compatibility.</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">replace_underscores_in_keys</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">layer_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">layer_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">layer_id</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_unique_name</span><span class="p">(</span>
            <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">overwrite</span>
        <span class="p">)</span>

    <span class="c1"># Store before_id in layer metadata for restoration when displaying in multiple cells</span>
    <span class="k">if</span> <span class="n">before_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;metadata&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="p">:</span>
            <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;beforeId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">before_id</span>

    <span class="c1"># Store layer in local state for persistence</span>
    <span class="n">current_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="p">)</span>
    <span class="n">current_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span> <span class="o">=</span> <span class="n">current_layers</span>

    <span class="c1"># Call JavaScript method with before_id if provided</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addLayer&quot;</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">before_id</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">set_visibility</span><span class="p">(</span><span class="n">layer_id</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_opacity</span><span class="p">(</span><span class="n">layer_id</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="n">layer</span><span class="p">,</span>
        <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="n">opacity</span><span class="p">,</span>
        <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">visible</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
        <span class="c1"># &quot;color&quot;: color,</span>
    <span class="p">}</span>

    <span class="c1"># Update the _layer_dict trait to trigger JavaScript sync</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_layer_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

    <span class="c1"># Update layer controls if they exist</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_layer_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_layer_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-right&#39;</span><span class="p">,</span> <span class="n">collapsed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_layer_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a collapsible layer control panel to the map.</p>
<p>The layer control is a collapsible panel that allows users to toggle
visibility and adjust opacity of map layers. It displays as an icon
similar to other controls, and expands when clicked.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Position on map ('top-left', 'top-right', 'bottom-left', 'bottom-right')</p></td>
        <td><code>&#39;top-right&#39;</code></td>
      </tr>
      <tr>
        <td><code>collapsed</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the control starts collapsed</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>layers</code></td>
        <td><code>Optional[List[str]]</code></td>
        <td><p>List of layer IDs to include. If None, includes all layers</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>options</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Additional options for the control</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_layer_control</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
    <span class="n">collapsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">layers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a collapsible layer control panel to the map.</span>

<span class="sd">    The layer control is a collapsible panel that allows users to toggle</span>
<span class="sd">    visibility and adjust opacity of map layers. It displays as an icon</span>
<span class="sd">    similar to other controls, and expands when clicked.</span>

<span class="sd">    Args:</span>
<span class="sd">        position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">        collapsed: Whether the control starts collapsed</span>
<span class="sd">        layers: List of layer IDs to include. If None, includes all layers</span>
<span class="sd">        options: Additional options for the control</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">control_options</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;collapsed&quot;</span><span class="p">:</span> <span class="n">collapsed</span><span class="p">,</span>
            <span class="s2">&quot;layers&quot;</span><span class="p">:</span> <span class="n">layers</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Get current layer states for initialization</span>
    <span class="n">layer_states</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">target_layers</span> <span class="o">=</span> <span class="n">layers</span> <span class="k">if</span> <span class="n">layers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="c1"># Always include Background layer for controlling map style layers</span>
    <span class="k">if</span> <span class="n">layers</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s2">&quot;Background&quot;</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
        <span class="n">layer_states</span><span class="p">[</span><span class="s2">&quot;Background&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Background&quot;</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">for</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="n">target_layers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span> <span class="ow">and</span> <span class="n">layer_id</span> <span class="o">!=</span> <span class="s2">&quot;Background&quot;</span><span class="p">:</span>
            <span class="n">layer_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span>
            <span class="n">layer_states</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">layer_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;visible&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="n">layer_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span>  <span class="c1"># Use layer_id as display name by default</span>
            <span class="p">}</span>

    <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;layerStates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_states</span>

    <span class="c1"># Store control in persistent state</span>
    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;layer_control_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;layer_control&quot;</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;layer_control&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_legend" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_legend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Legend&#39;</span><span class="p">,</span> <span class="n">legend_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">bg_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;bottom-right&#39;</span><span class="p">,</span> <span class="n">collapsed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">builtin_legend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shape_type</span><span class="o">=</span><span class="s1">&#39;rectangle&#39;</span><span class="p">,</span> <span class="n">header_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">header_text_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">responsive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_height</span><span class="o">=</span><span class="mi">380</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_legend" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Adds a legend to the map.</p>
<p>This method allows for the addition of a legend to the map. The legend can be customized with a title,
labels, colors, and more. A built-in legend can also be specified.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>title</code></td>
        <td><code>str</code></td>
        <td><p>The title of the legend. Defaults to "Legend".</p></td>
        <td><code>&#39;Legend&#39;</code></td>
      </tr>
      <tr>
        <td><code>legend_dict</code></td>
        <td><code>Optional[Dict[str, str]]</code></td>
        <td><p>A dictionary with legend items as keys and colors as values.
If provided, <code>labels</code> and <code>colors</code> will be ignored. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>labels</code></td>
        <td><code>Optional[List[str]]</code></td>
        <td><p>A list of legend labels. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>colors</code></td>
        <td><code>Optional[List[str]]</code></td>
        <td><p>A list of colors corresponding to the labels. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>fontsize</code></td>
        <td><code>int</code></td>
        <td><p>The font size of the legend text. Defaults to 15.</p></td>
        <td><code>15</code></td>
      </tr>
      <tr>
        <td><code>bg_color</code></td>
        <td><code>str</code></td>
        <td><p>The background color of the legend. Defaults to "white".
To make the background transparent, set this to "transparent".
To make the background half transparent, set this to "rgba(255, 255, 255, 0.5)".</p></td>
        <td><code>&#39;white&#39;</code></td>
      </tr>
      <tr>
        <td><code>icon</code></td>
        <td><code>str</code></td>
        <td><p>The icon of the legend. Defaults to "".</p></td>
        <td><code>&#39;&#39;</code></td>
      </tr>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>The position of the legend on the map. Can be one of "top-left",
"top-right", "bottom-left", "bottom-right". Defaults to "bottom-right".</p></td>
        <td><code>&#39;bottom-right&#39;</code></td>
      </tr>
      <tr>
        <td><code>collapsed</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the legend is collapsed by default. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>builtin_legend</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The name of a built-in legend to use. Available options: "NLCD", "NWI". Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>shape_type</code></td>
        <td><code>str</code></td>
        <td><p>The shape type of the legend items. Can be one of "rectangle", "circle", or "line". Defaults to "rectangle".</p></td>
        <td><code>&#39;rectangle&#39;</code></td>
      </tr>
      <tr>
        <td><code>header_color</code></td>
        <td><code>str</code></td>
        <td><p>The background color of the legend header, like "linear-gradient(135deg,#444,#888)". Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>header_text_color</code></td>
        <td><code>str</code></td>
        <td><p>The text color of the legend header, like "#fff". Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>responsive</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the legend is responsive. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>max_height</code></td>
        <td><code>int</code></td>
        <td><p>Maximum height of the legend content area in pixels. Defaults to 380.</p></td>
        <td><code>380</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Union[str, int, float]</code></td>
        <td><p>Any</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_legend</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Legend&quot;</span><span class="p">,</span>
    <span class="n">legend_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">colors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
    <span class="n">bg_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
    <span class="n">icon</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bottom-right&quot;</span><span class="p">,</span>
    <span class="n">collapsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">builtin_legend</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">shape_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rectangle&quot;</span><span class="p">,</span>
    <span class="n">header_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">header_text_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">responsive</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">max_height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">380</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a legend to the map.</span>

<span class="sd">    This method allows for the addition of a legend to the map. The legend can be customized with a title,</span>
<span class="sd">    labels, colors, and more. A built-in legend can also be specified.</span>

<span class="sd">    Args:</span>
<span class="sd">        title (str, optional): The title of the legend. Defaults to &quot;Legend&quot;.</span>
<span class="sd">        legend_dict (Optional[Dict[str, str]], optional): A dictionary with legend items as keys and colors as values.</span>
<span class="sd">            If provided, `labels` and `colors` will be ignored. Defaults to None.</span>
<span class="sd">        labels (Optional[List[str]], optional): A list of legend labels. Defaults to None.</span>
<span class="sd">        colors (Optional[List[str]], optional): A list of colors corresponding to the labels. Defaults to None.</span>
<span class="sd">        fontsize (int, optional): The font size of the legend text. Defaults to 15.</span>
<span class="sd">        bg_color (str, optional): The background color of the legend. Defaults to &quot;white&quot;.</span>
<span class="sd">            To make the background transparent, set this to &quot;transparent&quot;.</span>
<span class="sd">            To make the background half transparent, set this to &quot;rgba(255, 255, 255, 0.5)&quot;.</span>
<span class="sd">        icon (str, optional): The icon of the legend. Defaults to &quot;&quot;.</span>
<span class="sd">        position (str, optional): The position of the legend on the map. Can be one of &quot;top-left&quot;,</span>
<span class="sd">            &quot;top-right&quot;, &quot;bottom-left&quot;, &quot;bottom-right&quot;. Defaults to &quot;bottom-right&quot;.</span>
<span class="sd">        collapsed (bool, optional): Whether the legend is collapsed by default. Defaults to True.</span>
<span class="sd">        builtin_legend (Optional[str], optional): The name of a built-in legend to use. Available options: &quot;NLCD&quot;, &quot;NWI&quot;. Defaults to None.</span>
<span class="sd">        shape_type (str, optional): The shape type of the legend items. Can be one of &quot;rectangle&quot;, &quot;circle&quot;, or &quot;line&quot;. Defaults to &quot;rectangle&quot;.</span>
<span class="sd">        header_color (str, optional): The background color of the legend header, like &quot;linear-gradient(135deg,#444,#888)&quot;. Defaults to None.</span>
<span class="sd">        header_text_color (str, optional): The text color of the legend header, like &quot;#fff&quot;. Defaults to None.</span>
<span class="sd">        responsive (bool, optional): Whether the legend is responsive. Defaults to True.</span>
<span class="sd">        max_height (int, optional): Maximum height of the legend content area in pixels. Defaults to 380.</span>
<span class="sd">        **kwargs: Any</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">shape_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">shape_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;rectangle&quot;</span><span class="p">,</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="s2">&quot;line&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;shape_type must be one of &#39;rectangle&#39;, &#39;circle&#39;, or &#39;line&#39;&quot;</span>
        <span class="p">)</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">html</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">html_module</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">widgets</span>

    <span class="c1"># Built-in legend presets</span>
    <span class="n">BUILTIN_LEGENDS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;NLCD&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;11 Open Water&quot;</span><span class="p">:</span> <span class="s2">&quot;466b9f&quot;</span><span class="p">,</span>
            <span class="s2">&quot;12 Perennial Ice/Snow&quot;</span><span class="p">:</span> <span class="s2">&quot;d1def8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;21 Developed, Open Space&quot;</span><span class="p">:</span> <span class="s2">&quot;dec5c5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;22 Developed, Low Intensity&quot;</span><span class="p">:</span> <span class="s2">&quot;d99282&quot;</span><span class="p">,</span>
            <span class="s2">&quot;23 Developed, Medium Intensity&quot;</span><span class="p">:</span> <span class="s2">&quot;eb0000&quot;</span><span class="p">,</span>
            <span class="s2">&quot;24 Developed High Intensity&quot;</span><span class="p">:</span> <span class="s2">&quot;ab0000&quot;</span><span class="p">,</span>
            <span class="s2">&quot;31 Barren Land (Rock/Sand/Clay)&quot;</span><span class="p">:</span> <span class="s2">&quot;b3ac9f&quot;</span><span class="p">,</span>
            <span class="s2">&quot;41 Deciduous Forest&quot;</span><span class="p">:</span> <span class="s2">&quot;68ab5f&quot;</span><span class="p">,</span>
            <span class="s2">&quot;42 Evergreen Forest&quot;</span><span class="p">:</span> <span class="s2">&quot;1c5f2c&quot;</span><span class="p">,</span>
            <span class="s2">&quot;43 Mixed Forest&quot;</span><span class="p">:</span> <span class="s2">&quot;b5c58f&quot;</span><span class="p">,</span>
            <span class="s2">&quot;51 Dwarf Scrub&quot;</span><span class="p">:</span> <span class="s2">&quot;af963c&quot;</span><span class="p">,</span>
            <span class="s2">&quot;52 Shrub/Scrub&quot;</span><span class="p">:</span> <span class="s2">&quot;ccb879&quot;</span><span class="p">,</span>
            <span class="s2">&quot;71 Grassland/Herbaceous&quot;</span><span class="p">:</span> <span class="s2">&quot;dfdfc2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;72 Sedge/Herbaceous&quot;</span><span class="p">:</span> <span class="s2">&quot;d1d182&quot;</span><span class="p">,</span>
            <span class="s2">&quot;73 Lichens&quot;</span><span class="p">:</span> <span class="s2">&quot;a3cc51&quot;</span><span class="p">,</span>
            <span class="s2">&quot;74 Moss&quot;</span><span class="p">:</span> <span class="s2">&quot;82ba9e&quot;</span><span class="p">,</span>
            <span class="s2">&quot;81 Pasture/Hay&quot;</span><span class="p">:</span> <span class="s2">&quot;dcd939&quot;</span><span class="p">,</span>
            <span class="s2">&quot;82 Cultivated Crops&quot;</span><span class="p">:</span> <span class="s2">&quot;ab6c28&quot;</span><span class="p">,</span>
            <span class="s2">&quot;90 Woody Wetlands&quot;</span><span class="p">:</span> <span class="s2">&quot;b8d9eb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;95 Emergent Herbaceous Wetlands&quot;</span><span class="p">:</span> <span class="s2">&quot;6c9fb8&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;NWI&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;Freshwater Forested/Shrub Wetland&quot;</span><span class="p">:</span> <span class="s2">&quot;#008837&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Freshwater Emergent Wetland&quot;</span><span class="p">:</span> <span class="s2">&quot;#7FC31C&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Freshwater Pond&quot;</span><span class="p">:</span> <span class="s2">&quot;#688CC0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Estuarine and Marine Wetland&quot;</span><span class="p">:</span> <span class="s2">&quot;#66C2A5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Riverine&quot;</span><span class="p">:</span> <span class="s2">&quot;#0190BF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Lake&quot;</span><span class="p">:</span> <span class="s2">&quot;#13007C&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Estuarine and Marine Deepwater&quot;</span><span class="p">:</span> <span class="s2">&quot;#007C88&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Other&quot;</span><span class="p">:</span> <span class="s2">&quot;#B28656&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="c1"># Use builtin legend if specified</span>
    <span class="k">if</span> <span class="n">builtin_legend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">builtin_legend</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">BUILTIN_LEGENDS</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Warning: builtin_legend &#39;</span><span class="si">{</span><span class="n">builtin_legend</span><span class="si">}</span><span class="s2">&#39; not found. Available: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">BUILTIN_LEGENDS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="n">legend_dict</span> <span class="o">=</span> <span class="n">BUILTIN_LEGENDS</span><span class="p">[</span><span class="n">builtin_legend</span><span class="p">]</span>

    <span class="c1"># Determine legend items</span>
    <span class="k">if</span> <span class="n">legend_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">legend_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">legend_dict</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: labels and colors must have the same length&quot;</span><span class="p">)</span>
            <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Error: Either legend_dict or both labels and colors must be provided&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Normalize colors (add # if not present)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">]</span>

    <span class="c1"># Build legend items as a list of HTML widgets (no title needed - it&#39;s in the panel header)</span>
    <span class="n">legend_items</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Add each legend item</span>
    <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;circle&quot;</span><span class="p">:</span>
            <span class="n">shape_html</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;span style=&quot;display: inline-block; width: 20px; height: 20px; background-color: </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s1">; border-radius: 50%; margin-right: 8px; vertical-align: middle;&quot;&gt;&lt;/span&gt;&#39;</span>
        <span class="k">elif</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;line&quot;</span><span class="p">:</span>
            <span class="n">shape_html</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;span style=&quot;display: inline-block; width: 20px; height: 3px; background-color: </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s1">; margin-right: 8px; vertical-align: middle;&quot;&gt;&lt;/span&gt;&#39;</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># rectangle</span>
            <span class="n">shape_html</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;span style=&quot;display: inline-block; width: 20px; height: 20px; background-color: </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s1">; margin-right: 8px; vertical-align: middle;&quot;&gt;&lt;/span&gt;&#39;</span>

        <span class="c1"># Validate fontsize before using it in CSS</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">safe_fontsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">safe_fontsize</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">):</span>
                <span class="n">safe_fontsize</span> <span class="o">=</span> <span class="mi">14</span>  <span class="c1"># default value</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">safe_fontsize</span> <span class="o">=</span> <span class="mi">14</span>  <span class="c1"># default value</span>

        <span class="n">item_html</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;&lt;div style=&quot;margin: 0; padding: 0; line-height: 1.4; white-space: nowrap; font-size: </span><span class="si">{</span><span class="n">safe_fontsize</span><span class="si">}</span><span class="s1">px;&quot;&gt;</span><span class="si">{</span><span class="n">shape_html</span><span class="si">}{</span><span class="n">html_module</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="si">}</span><span class="s1">&lt;/div&gt;&#39;</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
                <span class="n">margin</span><span class="o">=</span><span class="s2">&quot;0 0 4px 0&quot;</span>
            <span class="p">),</span>  <span class="c1"># Control spacing between items</span>
        <span class="p">)</span>
        <span class="n">legend_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_html</span><span class="p">)</span>

    <span class="c1"># Create a VBox container for legend items</span>
    <span class="c1"># Subtract space for panel header (~60px) from panel_max_height</span>
    <span class="c1"># This ensures the legend content scrolls properly within the panel</span>
    <span class="n">legend_content_height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_height</span> <span class="o">-</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">legend_vbox</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span>
        <span class="n">legend_items</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
            <span class="n">width</span><span class="o">=</span><span class="s2">&quot;fit-content&quot;</span><span class="p">,</span>
            <span class="n">max_height</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">legend_content_height</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span>
            <span class="n">overflow_y</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
            <span class="n">overflow_x</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;8px&quot;</span><span class="p">,</span>
            <span class="n">border</span><span class="o">=</span><span class="s2">&quot;2px solid grey&quot;</span><span class="p">,</span>
            <span class="n">border_radius</span><span class="o">=</span><span class="s2">&quot;5px&quot;</span><span class="p">,</span>
            <span class="n">background_color</span><span class="o">=</span><span class="n">bg_color</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Determine responsiveness: default to responsive unless user supplied panel_width</span>
    <span class="k">if</span> <span class="n">responsive</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">auto_flag</span> <span class="o">=</span> <span class="s2">&quot;panel_width&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s2">&quot;auto_panel_width&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">auto_flag</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">responsive</span><span class="p">)</span>

    <span class="c1"># Build options</span>
    <span class="n">control_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">control_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
            <span class="s2">&quot;icon&quot;</span><span class="p">:</span> <span class="n">icon</span><span class="p">,</span>
            <span class="s2">&quot;collapsed&quot;</span><span class="p">:</span> <span class="n">collapsed</span><span class="p">,</span>
            <span class="s2">&quot;header_bg&quot;</span><span class="p">:</span> <span class="n">header_color</span><span class="p">,</span>
            <span class="s2">&quot;header_text_color&quot;</span><span class="p">:</span> <span class="n">header_text_color</span><span class="p">,</span>
            <span class="s2">&quot;panel_max_height&quot;</span><span class="p">:</span> <span class="n">max_height</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Configure width behavior based on responsive setting</span>
    <span class="k">if</span> <span class="n">auto_flag</span><span class="p">:</span>
        <span class="c1"># Responsive mode: use auto width with min/max constraints</span>
        <span class="n">control_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
            <span class="s2">&quot;panel_min_width&quot;</span><span class="p">,</span> <span class="mi">100</span>
        <span class="p">)</span>  <span class="c1"># Minimum width for legend items (reduced for short text)</span>
        <span class="n">control_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
            <span class="s2">&quot;panel_max_width&quot;</span><span class="p">,</span> <span class="mi">500</span>
        <span class="p">)</span>  <span class="c1"># Reasonable maximum width</span>
        <span class="n">control_kwargs</span><span class="p">[</span><span class="s2">&quot;auto_panel_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Fixed width mode: ensure auto_panel_width is False</span>
        <span class="n">control_kwargs</span><span class="p">[</span><span class="s2">&quot;auto_panel_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Use default panel_width if not specified</span>
        <span class="n">control_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;panel_width&quot;</span><span class="p">,</span> <span class="mi">320</span><span class="p">)</span>

    <span class="c1"># Extract parameters for add_widget_control</span>
    <span class="n">widget_control_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">),</span>
        <span class="s2">&quot;icon&quot;</span><span class="p">:</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;icon&quot;</span><span class="p">),</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">),</span>
        <span class="s2">&quot;collapsed&quot;</span><span class="p">:</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;collapsed&quot;</span><span class="p">),</span>
        <span class="s2">&quot;auto_panel_width&quot;</span><span class="p">:</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;auto_panel_width&quot;</span><span class="p">),</span>
        <span class="s2">&quot;header_bg&quot;</span><span class="p">:</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;header_bg&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="s2">&quot;header_text_color&quot;</span><span class="p">:</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;header_text_color&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># Add panel width parameters if specified</span>
    <span class="k">if</span> <span class="s2">&quot;panel_width&quot;</span> <span class="ow">in</span> <span class="n">control_kwargs</span><span class="p">:</span>
        <span class="n">widget_control_params</span><span class="p">[</span><span class="s2">&quot;panel_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;panel_width&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;panel_min_width&quot;</span> <span class="ow">in</span> <span class="n">control_kwargs</span><span class="p">:</span>
        <span class="n">widget_control_params</span><span class="p">[</span><span class="s2">&quot;panel_min_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
            <span class="s2">&quot;panel_min_width&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;panel_max_width&quot;</span> <span class="ow">in</span> <span class="n">control_kwargs</span><span class="p">:</span>
        <span class="n">widget_control_params</span><span class="p">[</span><span class="s2">&quot;panel_max_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
            <span class="s2">&quot;panel_max_width&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;panel_max_height&quot;</span> <span class="ow">in</span> <span class="n">control_kwargs</span><span class="p">:</span>
        <span class="n">widget_control_params</span><span class="p">[</span><span class="s2">&quot;panel_max_height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">control_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
            <span class="s2">&quot;panel_max_height&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Add legend as a widget control at the specified position</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_widget_control</span><span class="p">(</span>
        <span class="n">legend_vbox</span><span class="p">,</span>
        <span class="o">**</span><span class="n">widget_control_params</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_legend_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_legend_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;bottom-left&#39;</span><span class="p">,</span> <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_checkbox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">only_rendered</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reverse_order</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label_overrides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">toggle_icon</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_legend_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a Legend control (watergis/mapbox-gl-legend) to the map.</p>
<p>The legend control inspects map layers and renders a legend UI. It works
best when layers include helpful <code>metadata</code> such as a human-readable
name, unit, or labels.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Control position ('top-left', 'top-right', 'bottom-left', 'bottom-right').</p></td>
        <td><code>&#39;bottom-left&#39;</code></td>
      </tr>
      <tr>
        <td><code>show_default</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to show default legend items inferred from layers.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>show_checkbox</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to include visibility checkboxes per item.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>only_rendered</code></td>
        <td><code>bool</code></td>
        <td><p>If True, only include layers currently rendered in viewport.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>reverse_order</code></td>
        <td><code>bool</code></td>
        <td><p>If True, reverse the legend item order.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>options</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Additional plugin options forwarded to LegendControl.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>targets</code></td>
        <td><code>Optional[Dict[str, str]]</code></td>
        <td><p>Optional mapping of layer IDs to include in the legend. When
provided, only these layers will appear (matching plugin behaviour).</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>label_overrides</code></td>
        <td><code>Optional[Dict[str, str]]</code></td>
        <td><p>Optional mapping of layer IDs to custom legend labels.
When omitted, labels are derived from layer metadata and fall back
to layer ids. This does not restrict which layers are shown.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>max_height</code></td>
        <td><code>Union[int, float, str]</code></td>
        <td><p>Optional CSS size (e.g. 320, "320px", "60vh") used to cap the
legend panel height. When provided, a scrollbar appears if content
exceeds this limit.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>toggle_icon</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional HTML string or Unicode glyph for the collapsed
legend toggle button. Defaults to a list-style icon if omitted.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_legend_control</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bottom-left&quot;</span><span class="p">,</span>
    <span class="n">show_default</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_checkbox</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">only_rendered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">reverse_order</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">label_overrides</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">toggle_icon</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a Legend control (watergis/mapbox-gl-legend) to the map.</span>

<span class="sd">    The legend control inspects map layers and renders a legend UI. It works</span>
<span class="sd">    best when layers include helpful `metadata` such as a human-readable</span>
<span class="sd">    name, unit, or labels.</span>

<span class="sd">    Args:</span>
<span class="sd">        position: Control position (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;).</span>
<span class="sd">        show_default: Whether to show default legend items inferred from layers.</span>
<span class="sd">        show_checkbox: Whether to include visibility checkboxes per item.</span>
<span class="sd">        only_rendered: If True, only include layers currently rendered in viewport.</span>
<span class="sd">        reverse_order: If True, reverse the legend item order.</span>
<span class="sd">        options: Additional plugin options forwarded to LegendControl.</span>
<span class="sd">        targets: Optional mapping of layer IDs to include in the legend. When</span>
<span class="sd">            provided, only these layers will appear (matching plugin behaviour).</span>
<span class="sd">        label_overrides: Optional mapping of layer IDs to custom legend labels.</span>
<span class="sd">            When omitted, labels are derived from layer metadata and fall back</span>
<span class="sd">            to layer ids. This does not restrict which layers are shown.</span>
<span class="sd">        max_height: Optional CSS size (e.g. 320, &quot;320px&quot;, &quot;60vh&quot;) used to cap the</span>
<span class="sd">            legend panel height. When provided, a scrollbar appears if content</span>
<span class="sd">            exceeds this limit.</span>
<span class="sd">        toggle_icon: Optional HTML string or Unicode glyph for the collapsed</span>
<span class="sd">            legend toggle button. Defaults to a list-style icon if omitted.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_derive_labels</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">derived</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">layer_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">layer_config</span> <span class="o">=</span> <span class="n">layer_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layer&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer_config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">layer_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;background&quot;</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;visible&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">metadata</span> <span class="o">=</span> <span class="n">layer_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
            <span class="n">legend_meta</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;legend&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">legend_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exclude&quot;</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">label</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">legend_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">legend_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">legend_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">layer_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">layer_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">layer_id</span>
            <span class="p">)</span>
            <span class="n">derived</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>

        <span class="k">return</span> <span class="n">derived</span>

    <span class="n">control_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span> <span class="ow">or</span> <span class="p">{})</span>
    <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;showDefault&quot;</span><span class="p">:</span> <span class="n">show_default</span><span class="p">,</span>
            <span class="s2">&quot;showCheckbox&quot;</span><span class="p">:</span> <span class="n">show_checkbox</span><span class="p">,</span>
            <span class="s2">&quot;onlyRendered&quot;</span><span class="p">:</span> <span class="n">only_rendered</span><span class="p">,</span>
            <span class="s2">&quot;reverseOrder&quot;</span><span class="p">:</span> <span class="n">reverse_order</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;targets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">max_height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_height</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">max_height_value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">max_height</span><span class="si">}</span><span class="s2">px&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_height_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_height</span><span class="p">)</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;maxHeight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_height_value</span>

    <span class="k">if</span> <span class="n">toggle_icon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;toggleIcon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">toggle_icon</span><span class="p">)</span>

    <span class="n">auto_labels</span> <span class="o">=</span> <span class="n">_derive_labels</span><span class="p">()</span>
    <span class="n">merged_labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">auto_labels</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">label_map</span> <span class="ow">in</span> <span class="p">(</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;label_overrides&quot;</span><span class="p">),</span>
        <span class="n">control_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;labelOverrides&quot;</span><span class="p">),</span>
        <span class="n">label_overrides</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">label_map</span><span class="p">:</span>
            <span class="n">merged_labels</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">label_map</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">merged_labels</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;label_overrides&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_labels</span>

    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;legend_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;legend&quot;</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;legend&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_maplibre_geocoder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_maplibre_geocoder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-left&#39;</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maplibre_api</span><span class="o">=</span><span class="s1">&#39;maptiler&#39;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;Search&#39;</span><span class="p">,</span> <span class="n">proximity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_result_markers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">collapsed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear_on_blur</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear_and_blur_on_esc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">enable_event_logging</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_maplibre_geocoder" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add MapLibre GL Geocoder control to the map.</p>
<p>The MapLibre GL Geocoder is a geocoder control for MapLibre GL that supports
various geocoding APIs including Maptiler, Mapbox, and others. It provides a
search interface for finding locations and can display markers for search results.</p>
<p>See: https://github.com/maplibre/maplibre-gl-geocoder</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Position on map ('top-left', 'top-right', 'bottom-left', 'bottom-right')</p></td>
        <td><code>&#39;top-left&#39;</code></td>
      </tr>
      <tr>
        <td><code>api_key</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>API key for the geocoding service (required for most services)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>maplibre_api</code></td>
        <td><code>str</code></td>
        <td><p>Geocoding API to use ('maptiler', 'mapbox', or custom)</p></td>
        <td><code>&#39;maptiler&#39;</code></td>
      </tr>
      <tr>
        <td><code>language</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Language code for results (e.g., 'en', 'es', 'fr')</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>placeholder</code></td>
        <td><code>str</code></td>
        <td><p>Placeholder text in the search input</p></td>
        <td><code>&#39;Search&#39;</code></td>
      </tr>
      <tr>
        <td><code>proximity</code></td>
        <td><code>Optional[List[float]]</code></td>
        <td><p>[lng, lat] to bias results towards this location</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>bbox</code></td>
        <td><code>Optional[List[float]]</code></td>
        <td><p>[minLng, minLat, maxLng, maxLat] to limit results to this bounding box</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>country</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Country code(s) to limit results (e.g., 'us' or 'us,ca')</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>types</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Comma-separated types to filter results (e.g., 'country,region,place')</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>limit</code></td>
        <td><code>int</code></td>
        <td><p>Maximum number of results to return</p></td>
        <td><code>5</code></td>
      </tr>
      <tr>
        <td><code>marker</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to add a marker at the geocoded location</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>show_result_markers</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to show markers for all search results</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>collapsed</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the control should start collapsed</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>clear_on_blur</code></td>
        <td><code>bool</code></td>
        <td><p>Clear the input when it loses focus</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>clear_and_blur_on_esc</code></td>
        <td><code>bool</code></td>
        <td><p>Clear input and remove focus when ESC is pressed</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>enable_event_logging</code></td>
        <td><code>bool</code></td>
        <td><p>Enable console logging of geocoder events</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>min_length</code></td>
        <td><code>int</code></td>
        <td><p>Minimum number of characters to trigger search</p></td>
        <td><code>2</code></td>
      </tr>
      <tr>
        <td><code>options</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Additional options passed to the MaplibreGeocoder constructor</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">m</span> <span class="o">=</span> <span class="n">MapLibreMap</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">87.61694</span><span class="p">,</span> <span class="mf">41.86625</span><span class="p">],</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_maplibre_geocoder</span><span class="p">(</span>
    <span class="n">position</span><span class="o">=</span><span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
    <span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;your_api_key&quot;</span><span class="p">,</span>
    <span class="n">maplibre_api</span><span class="o">=</span><span class="s2">&quot;maptiler&quot;</span><span class="p">,</span>
    <span class="n">language</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span>
    <span class="n">country</span><span class="o">=</span><span class="s2">&quot;us&quot;</span>
<span class="p">)</span>
</code></pre></div></td></tr></table></div>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_maplibre_geocoder</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">maplibre_api</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;maptiler&quot;</span><span class="p">,</span>
    <span class="n">language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">placeholder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Search&quot;</span><span class="p">,</span>
    <span class="n">proximity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">bbox</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">country</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">marker</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_result_markers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">collapsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">clear_on_blur</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">clear_and_blur_on_esc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">enable_event_logging</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">min_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add MapLibre GL Geocoder control to the map.</span>

<span class="sd">    The MapLibre GL Geocoder is a geocoder control for MapLibre GL that supports</span>
<span class="sd">    various geocoding APIs including Maptiler, Mapbox, and others. It provides a</span>
<span class="sd">    search interface for finding locations and can display markers for search results.</span>

<span class="sd">    See: https://github.com/maplibre/maplibre-gl-geocoder</span>

<span class="sd">    Args:</span>
<span class="sd">        position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">        api_key: API key for the geocoding service (required for most services)</span>
<span class="sd">        maplibre_api: Geocoding API to use (&#39;maptiler&#39;, &#39;mapbox&#39;, or custom)</span>
<span class="sd">        language: Language code for results (e.g., &#39;en&#39;, &#39;es&#39;, &#39;fr&#39;)</span>
<span class="sd">        placeholder: Placeholder text in the search input</span>
<span class="sd">        proximity: [lng, lat] to bias results towards this location</span>
<span class="sd">        bbox: [minLng, minLat, maxLng, maxLat] to limit results to this bounding box</span>
<span class="sd">        country: Country code(s) to limit results (e.g., &#39;us&#39; or &#39;us,ca&#39;)</span>
<span class="sd">        types: Comma-separated types to filter results (e.g., &#39;country,region,place&#39;)</span>
<span class="sd">        limit: Maximum number of results to return</span>
<span class="sd">        marker: Whether to add a marker at the geocoded location</span>
<span class="sd">        show_result_markers: Whether to show markers for all search results</span>
<span class="sd">        collapsed: Whether the control should start collapsed</span>
<span class="sd">        clear_on_blur: Clear the input when it loses focus</span>
<span class="sd">        clear_and_blur_on_esc: Clear input and remove focus when ESC is pressed</span>
<span class="sd">        enable_event_logging: Enable console logging of geocoder events</span>
<span class="sd">        min_length: Minimum number of characters to trigger search</span>
<span class="sd">        options: Additional options passed to the MaplibreGeocoder constructor</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        m = MapLibreMap(center=[-87.61694, 41.86625], zoom=10)</span>
<span class="sd">        m.add_maplibre_geocoder(</span>
<span class="sd">            position=&quot;top-left&quot;,</span>
<span class="sd">            api_key=&quot;your_api_key&quot;,</span>
<span class="sd">            maplibre_api=&quot;maptiler&quot;,</span>
<span class="sd">            language=&quot;en&quot;,</span>
<span class="sd">            country=&quot;us&quot;</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">geocoder_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>

    <span class="c1"># Build configuration</span>
    <span class="n">geocoder_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;maplibregl&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Signal to use maplibregl</span>
            <span class="s2">&quot;placeholder&quot;</span><span class="p">:</span> <span class="n">placeholder</span><span class="p">,</span>
            <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
            <span class="s2">&quot;marker&quot;</span><span class="p">:</span> <span class="n">marker</span><span class="p">,</span>
            <span class="s2">&quot;showResultMarkers&quot;</span><span class="p">:</span> <span class="n">show_result_markers</span><span class="p">,</span>
            <span class="s2">&quot;collapsed&quot;</span><span class="p">:</span> <span class="n">collapsed</span><span class="p">,</span>
            <span class="s2">&quot;clearOnBlur&quot;</span><span class="p">:</span> <span class="n">clear_on_blur</span><span class="p">,</span>
            <span class="s2">&quot;clearAndBlurOnEsc&quot;</span><span class="p">:</span> <span class="n">clear_and_blur_on_esc</span><span class="p">,</span>
            <span class="s2">&quot;enableEventLogging&quot;</span><span class="p">:</span> <span class="n">enable_event_logging</span><span class="p">,</span>
            <span class="s2">&quot;minLength&quot;</span><span class="p">:</span> <span class="n">min_length</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">api_key</span><span class="p">:</span>
        <span class="n">geocoder_config</span><span class="p">[</span><span class="s2">&quot;apiKey&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">api_key</span>

    <span class="k">if</span> <span class="n">maplibre_api</span><span class="p">:</span>
        <span class="n">geocoder_config</span><span class="p">[</span><span class="s2">&quot;maplibreApi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maplibre_api</span>

    <span class="k">if</span> <span class="n">language</span><span class="p">:</span>
        <span class="n">geocoder_config</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">language</span>

    <span class="k">if</span> <span class="n">proximity</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">proximity</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;proximity must be a list of two floats: [longitude, latitude]&quot;</span>
            <span class="p">)</span>
        <span class="n">geocoder_config</span><span class="p">[</span><span class="s2">&quot;proximity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proximity</span>

    <span class="k">if</span> <span class="n">bbox</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;bbox must be a list of four floats: [minLng, minLat, maxLng, maxLat]&quot;</span>
            <span class="p">)</span>
        <span class="n">geocoder_config</span><span class="p">[</span><span class="s2">&quot;bbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bbox</span>

    <span class="k">if</span> <span class="n">country</span><span class="p">:</span>
        <span class="n">geocoder_config</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">country</span>

    <span class="k">if</span> <span class="n">types</span><span class="p">:</span>
        <span class="n">geocoder_config</span><span class="p">[</span><span class="s2">&quot;types&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">types</span>

    <span class="c1"># Store control state</span>
    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;maplibre_geocoder_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;maplibre_geocoder&quot;</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">geocoder_config</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;maplibre_geocoder&quot;</span><span class="p">,</span> <span class="n">geocoder_config</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_marker" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lng</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">popup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_marker" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a marker to the map.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>lng</code></td>
        <td><code>float</code></td>
        <td><p>Longitude coordinate for the marker.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>lat</code></td>
        <td><code>float</code></td>
        <td><p>Latitude coordinate for the marker.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>popup</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional popup HTML to display when marker is clicked.
Supports HTML content including images.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>tooltip</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional tooltip HTML to display when hovering over marker.
Supports HTML content including images.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>options</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Optional marker options forwarded to MapLibre GL JS.
This supports properties like color, draggable, and opacity.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>scale</code></td>
        <td><code>float</code></td>
        <td><p>Scale factor for marker size (default: 1.0, range: 0.1 to 3.0).
For example, 0.5 makes the marker half size, 2.0 makes it double size.</p></td>
        <td><code>1.0</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_marker</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">lng</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">lat</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">popup</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a marker to the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        lng: Longitude coordinate for the marker.</span>
<span class="sd">        lat: Latitude coordinate for the marker.</span>
<span class="sd">        popup: Optional popup HTML to display when marker is clicked.</span>
<span class="sd">            Supports HTML content including images.</span>
<span class="sd">        tooltip: Optional tooltip HTML to display when hovering over marker.</span>
<span class="sd">            Supports HTML content including images.</span>
<span class="sd">        options: Optional marker options forwarded to MapLibre GL JS.</span>
<span class="sd">            This supports properties like color, draggable, and opacity.</span>
<span class="sd">        scale: Scale factor for marker size (default: 1.0, range: 0.1 to 3.0).</span>
<span class="sd">            For example, 0.5 makes the marker half size, 2.0 makes it double size.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">marker_options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="k">if</span> <span class="n">options</span> <span class="k">else</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="s2">&quot;scale&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">marker_options</span><span class="p">:</span>
        <span class="n">marker_options</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span>

    <span class="n">marker_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">lng</span><span class="p">,</span> <span class="n">lat</span><span class="p">],</span>
        <span class="s2">&quot;popup&quot;</span><span class="p">:</span> <span class="n">popup</span><span class="p">,</span>
        <span class="s2">&quot;tooltip&quot;</span><span class="p">:</span> <span class="n">tooltip</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">marker_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addMarker&quot;</span><span class="p">,</span> <span class="n">marker_data</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_marker_group" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_marker_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_marker_group" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a group of markers as a controllable layer.</p>
<p>This method adds multiple markers as a single layer that can be controlled
through the layer control panel. All markers in the group share the same
visibility and opacity settings.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier for the marker group layer.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>markers</code></td>
        <td><code>List[Dict[str, Any]]</code></td>
        <td><p>List of marker definitions. Each marker should be a dictionary with:
- lng (float): Longitude coordinate
- lat (float): Latitude coordinate
- popup (str, optional): Popup HTML content
- tooltip (str, optional): Tooltip HTML content
- options (dict, optional): Marker options (color, draggable, etc.)
- scale (float, optional): Marker scale factor (default: 1.0)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>name</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Display name for the layer in the layer control.
If None, uses layer_id.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>visible</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the marker group should be visible initially.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>opacity</code></td>
        <td><code>float</code></td>
        <td><p>Initial opacity for all markers in the group (0.0 to 1.0).</p></td>
        <td><code>1.0</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">MapLibreMap</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span>
<span class="o">...</span>     <span class="p">{</span><span class="s2">&quot;lng&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">122.4</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="mf">37.8</span><span class="p">,</span> <span class="s2">&quot;popup&quot;</span><span class="p">:</span> <span class="s2">&quot;San Francisco&quot;</span><span class="p">},</span>
<span class="o">...</span>     <span class="p">{</span><span class="s2">&quot;lng&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">118.2</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="mf">34.0</span><span class="p">,</span> <span class="s2">&quot;popup&quot;</span><span class="p">:</span> <span class="s2">&quot;Los Angeles&quot;</span><span class="p">},</span>
<span class="o">...</span>     <span class="p">{</span><span class="s2">&quot;lng&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">122.3</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="mf">47.6</span><span class="p">,</span> <span class="s2">&quot;popup&quot;</span><span class="p">:</span> <span class="s2">&quot;Seattle&quot;</span><span class="p">}</span>
<span class="o">...</span> <span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_marker_group</span><span class="p">(</span><span class="s2">&quot;cities&quot;</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;West Coast Cities&quot;</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_marker_group</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">markers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a group of markers as a controllable layer.</span>

<span class="sd">    This method adds multiple markers as a single layer that can be controlled</span>
<span class="sd">    through the layer control panel. All markers in the group share the same</span>
<span class="sd">    visibility and opacity settings.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Unique identifier for the marker group layer.</span>
<span class="sd">        markers: List of marker definitions. Each marker should be a dictionary with:</span>
<span class="sd">            - lng (float): Longitude coordinate</span>
<span class="sd">            - lat (float): Latitude coordinate</span>
<span class="sd">            - popup (str, optional): Popup HTML content</span>
<span class="sd">            - tooltip (str, optional): Tooltip HTML content</span>
<span class="sd">            - options (dict, optional): Marker options (color, draggable, etc.)</span>
<span class="sd">            - scale (float, optional): Marker scale factor (default: 1.0)</span>
<span class="sd">        name: Display name for the layer in the layer control.</span>
<span class="sd">            If None, uses layer_id.</span>
<span class="sd">        visible: Whether the marker group should be visible initially.</span>
<span class="sd">        opacity: Initial opacity for all markers in the group (0.0 to 1.0).</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; m = MapLibreMap()</span>
<span class="sd">        &gt;&gt;&gt; markers = [</span>
<span class="sd">        ...     {&quot;lng&quot;: -122.4, &quot;lat&quot;: 37.8, &quot;popup&quot;: &quot;San Francisco&quot;},</span>
<span class="sd">        ...     {&quot;lng&quot;: -118.2, &quot;lat&quot;: 34.0, &quot;popup&quot;: &quot;Los Angeles&quot;},</span>
<span class="sd">        ...     {&quot;lng&quot;: -122.3, &quot;lat&quot;: 47.6, &quot;popup&quot;: &quot;Seattle&quot;}</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt; m.add_marker_group(&quot;cities&quot;, markers, name=&quot;West Coast Cities&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">display_name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="n">layer_id</span>

    <span class="c1"># Validate markers</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">markers</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;lng&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">marker</span> <span class="ow">or</span> <span class="s2">&quot;lat&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">marker</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Marker at index </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> missing required &#39;lng&#39; or &#39;lat&#39; coordinate&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Store in layer_dict for layer control integration</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;marker-group&quot;</span><span class="p">},</span>
        <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">visible</span><span class="p">,</span>
        <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="n">opacity</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">display_name</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;marker-group&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Update layer controls</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>

    <span class="c1"># Send to JavaScript</span>
    <span class="n">marker_group_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;layerId&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span>
        <span class="s2">&quot;markers&quot;</span><span class="p">:</span> <span class="n">markers</span><span class="p">,</span>
        <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">visible</span><span class="p">,</span>
        <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="n">opacity</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addMarkerGroup&quot;</span><span class="p">,</span> <span class="n">marker_group_data</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_measures_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_measures_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-left&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;metric&#39;</span><span class="p">,</span> <span class="n">area_button_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">length_button_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clear_button_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_measures_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add the MapLibre GL Measures control for distance and area measurement.</p>
<p>This control allows users to measure distances along lines and calculate areas
within polygons on the map.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Position on map ('top-left', 'top-right', 'bottom-left', 'bottom-right')</p></td>
        <td><code>&#39;top-left&#39;</code></td>
      </tr>
      <tr>
        <td><code>units</code></td>
        <td><code>str</code></td>
        <td><p>Unit system for measurements, either 'metric' or 'imperial'</p></td>
        <td><code>&#39;metric&#39;</code></td>
      </tr>
      <tr>
        <td><code>area_button_title</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Custom title for the area measurement button</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>length_button_title</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Custom title for the length measurement button</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>clear_button_title</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Custom title for the clear measurements button</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>options</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Additional options for the measures control (styling, callbacks, etc.)</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_measures_control</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
    <span class="n">units</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;metric&quot;</span><span class="p">,</span>
    <span class="n">area_button_title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">length_button_title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">clear_button_title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add the MapLibre GL Measures control for distance and area measurement.</span>

<span class="sd">    This control allows users to measure distances along lines and calculate areas</span>
<span class="sd">    within polygons on the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">        units: Unit system for measurements, either &#39;metric&#39; or &#39;imperial&#39;</span>
<span class="sd">        area_button_title: Custom title for the area measurement button</span>
<span class="sd">        length_button_title: Custom title for the length measurement button</span>
<span class="sd">        clear_button_title: Custom title for the clear measurements button</span>
<span class="sd">        options: Additional options for the measures control (styling, callbacks, etc.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">,</span> <span class="s2">&quot;imperial&quot;</span><span class="p">}:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;units must be either &#39;metric&#39; or &#39;imperial&#39;&quot;</span><span class="p">)</span>

    <span class="n">measures_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span> <span class="ow">or</span> <span class="p">{})</span>

    <span class="c1"># Set unit system</span>
    <span class="n">measures_config</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">units</span>

    <span class="c1"># Set custom button titles if provided</span>
    <span class="k">if</span> <span class="n">area_button_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">measures_config</span><span class="p">[</span><span class="s2">&quot;areaMeasurementButtonTitle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">area_button_title</span>
    <span class="k">if</span> <span class="n">length_button_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">measures_config</span><span class="p">[</span><span class="s2">&quot;lengthMeasurementButtonTitle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">length_button_title</span>
    <span class="k">if</span> <span class="n">clear_button_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">measures_config</span><span class="p">[</span><span class="s2">&quot;clearMeasurementsButtonTitle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clear_button_title</span>

    <span class="n">control_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;measures_options&quot;</span><span class="p">:</span> <span class="n">measures_config</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;measures_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;measures&quot;</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="s2">&quot;measures&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;measures&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_pmtiles" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_pmtiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pmtiles_url</span><span class="p">,</span> <span class="n">layer_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_pmtiles" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add PMTiles vector tiles to the map.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>pmtiles_url</code></td>
        <td><code>str</code></td>
        <td><p>URL to the PMTiles file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional unique identifier for the layer. If None, uses filename.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>layers</code></td>
        <td><code>Optional[List[Dict[str, Any]]]</code></td>
        <td><p>Optional list of layer configurations for rendering. If None, creates default layers.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>opacity</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>Layer opacity between 0.0 and 1.0.</p></td>
        <td><code>1.0</code></td>
      </tr>
      <tr>
        <td><code>visible</code></td>
        <td><code>Optional[bool]</code></td>
        <td><p>Whether the layer should be visible initially.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>before_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional layer ID to insert this layer before.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_pmtiles</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">pmtiles_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">layer_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">opacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">visible</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add PMTiles vector tiles to the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        pmtiles_url: URL to the PMTiles file.</span>
<span class="sd">        layer_id: Optional unique identifier for the layer. If None, uses filename.</span>
<span class="sd">        layers: Optional list of layer configurations for rendering. If None, creates default layers.</span>
<span class="sd">        opacity: Layer opacity between 0.0 and 1.0.</span>
<span class="sd">        visible: Whether the layer should be visible initially.</span>
<span class="sd">        before_id: Optional layer ID to insert this layer before.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">layer_id</span> <span class="o">=</span> <span class="n">pmtiles_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.pmtiles&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">source_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_source&quot;</span>

    <span class="c1"># Add PMTiles source using pmtiles:// protocol</span>
    <span class="n">pmtiles_source_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;pmtiles://</span><span class="si">{</span><span class="n">pmtiles_url</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span>
        <span class="n">source_id</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;vector&quot;</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">pmtiles_source_url</span><span class="p">,</span>
            <span class="s2">&quot;attribution&quot;</span><span class="p">:</span> <span class="s2">&quot;PMTiles&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>

    <span class="c1"># Add default layers if none provided</span>
    <span class="k">if</span> <span class="n">layers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">url_lower</span> <span class="o">=</span> <span class="n">pmtiles_url</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="c1"># Heuristic defaults:</span>
        <span class="c1"># - If this looks like an Overture Buildings dataset, add only the buildings layer.</span>
        <span class="c1"># - Otherwise, fall back to a simple protomaps-style set.</span>
        <span class="k">if</span> <span class="s2">&quot;buildings&quot;</span> <span class="ow">in</span> <span class="n">url_lower</span><span class="p">:</span>
            <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_buildings&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
                    <span class="s2">&quot;source-layer&quot;</span><span class="p">:</span> <span class="s2">&quot;buildings&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;paint&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;fill-color&quot;</span><span class="p">:</span> <span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="s2">&quot;fill-opacity&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">},</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_landuse&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
                    <span class="s2">&quot;source-layer&quot;</span><span class="p">:</span> <span class="s2">&quot;landuse&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;paint&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;fill-color&quot;</span><span class="p">:</span> <span class="s2">&quot;steelblue&quot;</span><span class="p">,</span> <span class="s2">&quot;fill-opacity&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_roads&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
                    <span class="s2">&quot;source-layer&quot;</span><span class="p">:</span> <span class="s2">&quot;roads&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;line&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;paint&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;line-color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;line-width&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_buildings&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
                    <span class="s2">&quot;source-layer&quot;</span><span class="p">:</span> <span class="s2">&quot;buildings&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;paint&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;fill-color&quot;</span><span class="p">:</span> <span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="s2">&quot;fill-opacity&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">},</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_water&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
                    <span class="s2">&quot;source-layer&quot;</span><span class="p">:</span> <span class="s2">&quot;water&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;paint&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;fill-color&quot;</span><span class="p">:</span> <span class="s2">&quot;lightblue&quot;</span><span class="p">,</span> <span class="s2">&quot;fill-opacity&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">},</span>
                <span class="p">},</span>
            <span class="p">]</span>

    <span class="c1"># Add all layers</span>
    <span class="k">for</span> <span class="n">layer_config</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span>
            <span class="n">layer</span><span class="o">=</span><span class="n">layer_config</span><span class="p">,</span>
            <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span>
            <span class="n">layer_id</span><span class="o">=</span><span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
            <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
            <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_popup" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_popup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trigger</span><span class="o">=</span><span class="s1">&#39;click&#39;</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_popup" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a popup to a layer.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>The layer to which the popup is added.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>prop</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The property of the source to be displayed. If None, all properties are displayed.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>template</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>A simple template with mustache-style variable interpolation. Only
     <code>{{property_name}}</code> substitution is supported; sections, conditionals,
     and iteration are not. Example: "Name: {{name}}<br>Value: {{value}}"</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>trigger</code></td>
        <td><code>str</code></td>
        <td><p>Event that triggers the popup. Either "click" or "hover". Defaults to "click".</p></td>
        <td><code>&#39;click&#39;</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_popup</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">prop</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">template</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">trigger</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;click&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a popup to a layer.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: The layer to which the popup is added.</span>
<span class="sd">        prop: The property of the source to be displayed. If None, all properties are displayed.</span>
<span class="sd">        template: A simple template with mustache-style variable interpolation. Only</span>
<span class="sd">                 `{{property_name}}` substitution is supported; sections, conditionals,</span>
<span class="sd">                 and iteration are not. Example: &quot;Name: {{name}}&lt;br&gt;Value: {{value}}&quot;</span>
<span class="sd">        trigger: Event that triggers the popup. Either &quot;click&quot; or &quot;hover&quot;. Defaults to &quot;click&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">trigger</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;hover&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;trigger must be either &#39;click&#39; or &#39;hover&#39;&quot;</span><span class="p">)</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;layerId&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="n">trigger</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">template</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Use template for custom formatting</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;template&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">template</span>
    <span class="k">elif</span> <span class="n">prop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Show only specific property</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">prop</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">prop</span><span class="p">}]</span>
    <span class="c1"># If both are None, show all properties (default behavior)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;enableFeaturePopup&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_raster" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_raster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">indexes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Raster&#39;</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fit_bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">array_args</span><span class="o">=</span><span class="p">{},</span> <span class="n">client_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cors_all&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_raster" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a local raster dataset to the map.
    If you are using this function in JupyterHub on a remote server
    (e.g., Binder, Microsoft Planetary Computer) and if the raster
    does not render properly, try installing jupyter-server-proxy using
    <code>pip install jupyter-server-proxy</code>, then running the following code
    before calling this function. For more info, see https://bit.ly/3JbmF93.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>import os
os.environ[&#39;LOCALTILESERVER_CLIENT_PREFIX&#39;] = &#39;proxy/{port}&#39;
</code></pre></div></td></tr></table></div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>source</code></td>
        <td><code>str</code></td>
        <td><p>The path to the GeoTIFF file or the URL of the Cloud
Optimized GeoTIFF.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>indexes</code></td>
        <td><code>int</code></td>
        <td><p>The band(s) to use. Band indexing starts
at 1. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>colormap</code></td>
        <td><code>str</code></td>
        <td><p>The name of the colormap from <code>matplotlib</code>
to use when plotting a single band.
See https://matplotlib.org/stable/gallery/color/colormap_reference.html.
Default is greyscale.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>vmin</code></td>
        <td><code>float</code></td>
        <td><p>The minimum value to use when colormapping
the palette when plotting a single band. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>vmax</code></td>
        <td><code>float</code></td>
        <td><p>The maximum value to use when colormapping
the palette when plotting a single band. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>nodata</code></td>
        <td><code>float</code></td>
        <td><p>The value from the band to use to interpret
as not valid data. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>The layer name to use. Defaults to 'Raster'.</p></td>
        <td><code>&#39;Raster&#39;</code></td>
      </tr>
      <tr>
        <td><code>before_id</code></td>
        <td><code>str</code></td>
        <td><p>The layer id to insert the layer before. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>fit_bounds</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to zoom to the extent of the
layer. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>visible</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the layer is visible. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>opacity</code></td>
        <td><code>float</code></td>
        <td><p>The opacity of the layer. Defaults to 1.0.</p></td>
        <td><code>1.0</code></td>
      </tr>
      <tr>
        <td><code>array_args</code></td>
        <td><code>dict</code></td>
        <td><p>Additional arguments to pass to
<code>array_to_memory_file</code> when reading the raster. Defaults to {}.</p></td>
        <td><code>{}</code></td>
      </tr>
      <tr>
        <td><code>client_args</code></td>
        <td><code>dict</code></td>
        <td><p>Additional arguments to pass to
localtileserver.TileClient. Defaults to { "cors_all": False }.</p></td>
        <td><code>{&#39;cors_all&#39;: True}</code></td>
      </tr>
      <tr>
        <td><code>overwrite</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to overwrite an existing layer with the same name.
Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional keyword arguments to be passed to the underlying
<code>add_tile_layer</code> method.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_raster</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">source</span><span class="p">,</span>
    <span class="n">indexes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colormap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nodata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Raster&quot;</span><span class="p">,</span>
    <span class="n">before_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fit_bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">array_args</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">client_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cors_all&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a local raster dataset to the map.</span>
<span class="sd">        If you are using this function in JupyterHub on a remote server</span>
<span class="sd">        (e.g., Binder, Microsoft Planetary Computer) and if the raster</span>
<span class="sd">        does not render properly, try installing jupyter-server-proxy using</span>
<span class="sd">        `pip install jupyter-server-proxy`, then running the following code</span>
<span class="sd">        before calling this function. For more info, see https://bit.ly/3JbmF93.</span>

<span class="sd">        import os</span>
<span class="sd">        os.environ[&#39;LOCALTILESERVER_CLIENT_PREFIX&#39;] = &#39;proxy/{port}&#39;</span>

<span class="sd">    Args:</span>
<span class="sd">        source (str): The path to the GeoTIFF file or the URL of the Cloud</span>
<span class="sd">            Optimized GeoTIFF.</span>
<span class="sd">        indexes (int, optional): The band(s) to use. Band indexing starts</span>
<span class="sd">            at 1. Defaults to None.</span>
<span class="sd">        colormap (str, optional): The name of the colormap from `matplotlib`</span>
<span class="sd">            to use when plotting a single band.</span>
<span class="sd">            See https://matplotlib.org/stable/gallery/color/colormap_reference.html.</span>
<span class="sd">            Default is greyscale.</span>
<span class="sd">        vmin (float, optional): The minimum value to use when colormapping</span>
<span class="sd">            the palette when plotting a single band. Defaults to None.</span>
<span class="sd">        vmax (float, optional): The maximum value to use when colormapping</span>
<span class="sd">            the palette when plotting a single band. Defaults to None.</span>
<span class="sd">        nodata (float, optional): The value from the band to use to interpret</span>
<span class="sd">            as not valid data. Defaults to None.</span>
<span class="sd">        name (str, optional): The layer name to use. Defaults to &#39;Raster&#39;.</span>
<span class="sd">        before_id (str, optional): The layer id to insert the layer before. Defaults to None.</span>
<span class="sd">        fit_bounds (bool, optional): Whether to zoom to the extent of the</span>
<span class="sd">            layer. Defaults to True.</span>
<span class="sd">        visible (bool, optional): Whether the layer is visible. Defaults to True.</span>
<span class="sd">        opacity (float, optional): The opacity of the layer. Defaults to 1.0.</span>
<span class="sd">        array_args (dict, optional): Additional arguments to pass to</span>
<span class="sd">            `array_to_memory_file` when reading the raster. Defaults to {}.</span>
<span class="sd">        client_args (dict, optional): Additional arguments to pass to</span>
<span class="sd">            localtileserver.TileClient. Defaults to { &quot;cors_all&quot;: False }.</span>
<span class="sd">        overwrite (bool, optional): Whether to overwrite an existing layer with the same name.</span>
<span class="sd">            Defaults to True.</span>
<span class="sd">        **kwargs: Additional keyword arguments to be passed to the underlying</span>
<span class="sd">            `add_tile_layer` method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>

    <span class="k">if</span> <span class="s2">&quot;zoom_to_layer&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">fit_bounds</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;zoom_to_layer&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;layer_name&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;layer_name&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">):</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">array_to_image</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="o">**</span><span class="n">array_args</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;colormap_name&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;colormap_name&quot;</span><span class="p">)</span>

    <span class="n">url</span><span class="p">,</span> <span class="n">tile_client</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_local_tile_url</span><span class="p">(</span>
        <span class="n">source</span><span class="p">,</span>
        <span class="n">indexes</span><span class="o">=</span><span class="n">indexes</span><span class="p">,</span>
        <span class="n">colormap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
        <span class="n">nodata</span><span class="o">=</span><span class="n">nodata</span><span class="p">,</span>
        <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
        <span class="n">client_args</span><span class="o">=</span><span class="n">client_args</span><span class="p">,</span>
        <span class="n">return_client</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">add_tile_layer</span><span class="p">(</span>
        <span class="n">layer_id</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">source_url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
        <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
        <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span>
        <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="n">tile_client</span><span class="o">.</span><span class="n">bounds</span><span class="p">()</span>  <span class="c1"># [ymin, ymax, xmin, xmax]</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
    <span class="c1"># [minx, miny, maxx, maxy]</span>
    <span class="k">if</span> <span class="n">fit_bounds</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_bounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_source" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">source_config</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_source" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a data source to the map.</p>
<p>This method adds a data source and tracks it in the source_dict attribute
for easy reference. The source can then be used by layers.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>source_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier for the data source.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>source_config</code></td>
        <td><code>Dict[str, Any]</code></td>
        <td><p>Dictionary containing source configuration.
          Must include a 'type' field (e.g., 'geojson', 'vector', 'raster').
          Additional fields depend on the source type.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">MapLibreMap</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="s1">&#39;my-source&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="o">...</span>     <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;geojson&#39;</span><span class="p">,</span>
<span class="o">...</span>     <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="o">...</span>         <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">,</span>
<span class="o">...</span>         <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">,</span> <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}</span>
<span class="o">...</span>     <span class="p">}</span>
<span class="o">...</span> <span class="p">})</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">source_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a data source to the map.</span>

<span class="sd">    This method adds a data source and tracks it in the source_dict attribute</span>
<span class="sd">    for easy reference. The source can then be used by layers.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_id: Unique identifier for the data source.</span>
<span class="sd">        source_config: Dictionary containing source configuration.</span>
<span class="sd">                      Must include a &#39;type&#39; field (e.g., &#39;geojson&#39;, &#39;vector&#39;, &#39;raster&#39;).</span>
<span class="sd">                      Additional fields depend on the source type.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; m = MapLibreMap()</span>
<span class="sd">        &gt;&gt;&gt; m.add_source(&#39;my-source&#39;, {</span>
<span class="sd">        ...     &#39;type&#39;: &#39;geojson&#39;,</span>
<span class="sd">        ...     &#39;data&#39;: {</span>
<span class="sd">        ...         &#39;type&#39;: &#39;Feature&#39;,</span>
<span class="sd">        ...         &#39;geometry&#39;: {&#39;type&#39;: &#39;Point&#39;, &#39;coordinates&#39;: [0, 0]}</span>
<span class="sd">        ...     }</span>
<span class="sd">        ... })</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Store source in source_dict for local tracking</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">source_dict</span><span class="p">[</span><span class="n">source_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">source_config</span>

    <span class="c1"># Call parent class method to handle JavaScript synchronization</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">source_id</span><span class="p">,</span> <span class="n">source_config</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_temporal_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_temporal_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-right&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">performance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_temporal_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a temporal control to the map for animating time-series data.</p>
<p>The temporal control enables animation of map layers across time, allowing
users to visualize changes over time with playback controls. It uses the
maplibre-gl-temporal-control plugin.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>frames</code></td>
        <td><code>List[Dict[str, Any]]</code></td>
        <td><p>List of frame configurations. Each frame is a dictionary with:
- title: Display name for the frame (e.g., "2020-01-01")
- layers: List of layer IDs to show in this frame</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Position on map ('top-left', 'top-right', 'bottom-left', 'bottom-right')</p></td>
        <td><code>&#39;top-right&#39;</code></td>
      </tr>
      <tr>
        <td><code>interval</code></td>
        <td><code>int</code></td>
        <td><p>Duration to display each frame in milliseconds. Default is 1000 (1 second).</p></td>
        <td><code>1000</code></td>
      </tr>
      <tr>
        <td><code>performance</code></td>
        <td><code>bool</code></td>
        <td><p>Enable performance mode for slower systems. Default is False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>options</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Additional options for the temporal control</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">MapLibreMap</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Add layers for different time periods</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_geojson_layer</span><span class="p">(</span><span class="s2">&quot;data-2020&quot;</span><span class="p">,</span> <span class="n">geojson_2020</span><span class="p">,</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="n">paint</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;circle-color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">})</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_geojson_layer</span><span class="p">(</span><span class="s2">&quot;data-2021&quot;</span><span class="p">,</span> <span class="n">geojson_2021</span><span class="p">,</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="n">paint</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;circle-color&quot;</span><span class="p">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">})</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_geojson_layer</span><span class="p">(</span><span class="s2">&quot;data-2022&quot;</span><span class="p">,</span> <span class="n">geojson_2022</span><span class="p">,</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="n">paint</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;circle-color&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">})</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Configure temporal frames</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">frames</span> <span class="o">=</span> <span class="p">[</span>
<span class="o">...</span>     <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;2020&quot;</span><span class="p">,</span> <span class="s2">&quot;layers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;data-2020&quot;</span><span class="p">]},</span>
<span class="o">...</span>     <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;2021&quot;</span><span class="p">,</span> <span class="s2">&quot;layers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;data-2021&quot;</span><span class="p">]},</span>
<span class="o">...</span>     <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;2022&quot;</span><span class="p">,</span> <span class="s2">&quot;layers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;data-2022&quot;</span><span class="p">]},</span>
<span class="o">...</span> <span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Add temporal control</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_temporal_control</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">frames</span><span class="o">=</span><span class="n">frames</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">position</span><span class="o">=</span><span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">interval</span><span class="o">=</span><span class="mi">2000</span>  <span class="c1"># 2 seconds per frame</span>
<span class="o">...</span> <span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_temporal_control</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">frames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
    <span class="n">interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">performance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a temporal control to the map for animating time-series data.</span>

<span class="sd">    The temporal control enables animation of map layers across time, allowing</span>
<span class="sd">    users to visualize changes over time with playback controls. It uses the</span>
<span class="sd">    maplibre-gl-temporal-control plugin.</span>

<span class="sd">    Args:</span>
<span class="sd">        frames: List of frame configurations. Each frame is a dictionary with:</span>
<span class="sd">            - title: Display name for the frame (e.g., &quot;2020-01-01&quot;)</span>
<span class="sd">            - layers: List of layer IDs to show in this frame</span>
<span class="sd">        position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">        interval: Duration to display each frame in milliseconds. Default is 1000 (1 second).</span>
<span class="sd">        performance: Enable performance mode for slower systems. Default is False.</span>
<span class="sd">        options: Additional options for the temporal control</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; m = MapLibreMap()</span>
<span class="sd">        &gt;&gt;&gt; # Add layers for different time periods</span>
<span class="sd">        &gt;&gt;&gt; m.add_geojson_layer(&quot;data-2020&quot;, geojson_2020, &quot;circle&quot;, paint={&quot;circle-color&quot;: &quot;red&quot;})</span>
<span class="sd">        &gt;&gt;&gt; m.add_geojson_layer(&quot;data-2021&quot;, geojson_2021, &quot;circle&quot;, paint={&quot;circle-color&quot;: &quot;blue&quot;})</span>
<span class="sd">        &gt;&gt;&gt; m.add_geojson_layer(&quot;data-2022&quot;, geojson_2022, &quot;circle&quot;, paint={&quot;circle-color&quot;: &quot;green&quot;})</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Configure temporal frames</span>
<span class="sd">        &gt;&gt;&gt; frames = [</span>
<span class="sd">        ...     {&quot;title&quot;: &quot;2020&quot;, &quot;layers&quot;: [&quot;data-2020&quot;]},</span>
<span class="sd">        ...     {&quot;title&quot;: &quot;2021&quot;, &quot;layers&quot;: [&quot;data-2021&quot;]},</span>
<span class="sd">        ...     {&quot;title&quot;: &quot;2022&quot;, &quot;layers&quot;: [&quot;data-2022&quot;]},</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Add temporal control</span>
<span class="sd">        &gt;&gt;&gt; m.add_temporal_control(</span>
<span class="sd">        ...     frames=frames,</span>
<span class="sd">        ...     position=&quot;top-right&quot;,</span>
<span class="sd">        ...     interval=2000  # 2 seconds per frame</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">frames</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one frame must be provided&quot;</span><span class="p">)</span>

    <span class="n">control_options</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">control_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="n">frames</span><span class="p">,</span>
            <span class="s2">&quot;interval&quot;</span><span class="p">:</span> <span class="n">interval</span><span class="p">,</span>
            <span class="s2">&quot;performance&quot;</span><span class="p">:</span> <span class="n">performance</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Store control in persistent state</span>
    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;temporal_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;temporal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;temporal&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_terra_draw" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_terra_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-left&#39;</span><span class="p">,</span> <span class="n">modes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">open</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_terra_draw" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a Terra Draw control to the map for drawing and editing geometries.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Position on map ('top-left', 'top-right', 'bottom-left', 'bottom-right')</p></td>
        <td><code>&#39;top-left&#39;</code></td>
      </tr>
      <tr>
        <td><code>modes</code></td>
        <td><code>Optional[List[str]]</code></td>
        <td><p>List of drawing modes to enable. Available modes:
  ['render', 'point', 'linestring', 'polygon', 'rectangle', 'circle',
   'freehand', 'angled-rectangle', 'sensor', 'sector', 'select',
   'delete-selection', 'delete', 'download']
  Defaults to all modes except 'render'</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>open</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the draw control panel should be open by default</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional options to pass to Terra Draw constructor</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_terra_draw</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
    <span class="n">modes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">open</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a Terra Draw control to the map for drawing and editing geometries.</span>

<span class="sd">    Args:</span>
<span class="sd">        position: Position on map (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">        modes: List of drawing modes to enable. Available modes:</span>
<span class="sd">              [&#39;render&#39;, &#39;point&#39;, &#39;linestring&#39;, &#39;polygon&#39;, &#39;rectangle&#39;, &#39;circle&#39;,</span>
<span class="sd">               &#39;freehand&#39;, &#39;angled-rectangle&#39;, &#39;sensor&#39;, &#39;sector&#39;, &#39;select&#39;,</span>
<span class="sd">               &#39;delete-selection&#39;, &#39;delete&#39;, &#39;download&#39;]</span>
<span class="sd">              Defaults to all modes except &#39;render&#39;</span>
<span class="sd">        open: Whether the draw control panel should be open by default</span>
<span class="sd">        **kwargs: Additional options to pass to Terra Draw constructor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">modes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">modes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1"># &#39;render&#39;,  # Commented out to always show drawing tool</span>
            <span class="s2">&quot;point&quot;</span><span class="p">,</span>
            <span class="s2">&quot;linestring&quot;</span><span class="p">,</span>
            <span class="s2">&quot;polygon&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rectangle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;circle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;freehand&quot;</span><span class="p">,</span>
            <span class="s2">&quot;angled-rectangle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sensor&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sector&quot;</span><span class="p">,</span>
            <span class="s2">&quot;select&quot;</span><span class="p">,</span>
            <span class="s2">&quot;delete-selection&quot;</span><span class="p">,</span>
            <span class="s2">&quot;delete&quot;</span><span class="p">,</span>
            <span class="s2">&quot;download&quot;</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="n">terra_draw_options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="n">modes</span><span class="p">,</span>
        <span class="s2">&quot;open&quot;</span><span class="p">:</span> <span class="nb">open</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Mark that Terra Draw is enabled</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_terra_draw_enabled</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Store Terra Draw control configuration</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">terra_draw_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;terra_draw_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">terra_draw_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;terra_draw&quot;</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">terra_draw_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addTerraDrawControl&quot;</span><span class="p">,</span> <span class="n">terra_draw_options</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_three_light" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_three_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">light_type</span><span class="o">=</span><span class="s1">&#39;ambient&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mi">16777215</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">light_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cast_shadow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shadow_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sun_options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_three_light" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a light to the Three.js scene.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>light_type</code></td>
        <td><code>str</code></td>
        <td><p>Type of light ('ambient', 'directional', or 'sun').</p></td>
        <td><code>&#39;ambient&#39;</code></td>
      </tr>
      <tr>
        <td><code>color</code></td>
        <td><code>int</code></td>
        <td><p>Hexadecimal color value for the light (e.g., 0xffffff for white).</p></td>
        <td><code>16777215</code></td>
      </tr>
      <tr>
        <td><code>intensity</code></td>
        <td><code>float</code></td>
        <td><p>Light intensity value.</p></td>
        <td><code>1.0</code></td>
      </tr>
      <tr>
        <td><code>position</code></td>
        <td><code>Optional[List[float]]</code></td>
        <td><p>Optional position for directional lights as [x, y, z].</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>light_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional identifier for the light so it can be updated or removed later.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>target</code></td>
        <td><code>Optional[List[float]]</code></td>
        <td><p>Optional target position for directional lights as [x, y, z].</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>cast_shadow</code></td>
        <td><code>Optional[bool]</code></td>
        <td><p>Whether the light should cast shadows (if supported by the light type).</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>shadow_options</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Additional shadow configuration such as map size or clipping planes.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>sun_options</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Additional options when using the <code>sun</code> light type (e.g., <code>{"current_time": "2024-01-01T12:00:00Z"}</code>).</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">MapLibreMap</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">148.9819</span><span class="p">,</span> <span class="o">-</span><span class="mf">35.3981</span><span class="p">],</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">pitch</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">init_three_scene</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_three_light</span><span class="p">(</span><span class="n">light_type</span><span class="o">=</span><span class="s1">&#39;ambient&#39;</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_three_light</span><span class="p">(</span><span class="n">light_type</span><span class="o">=</span><span class="s1">&#39;directional&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_three_light</span><span class="p">(</span><span class="n">light_type</span><span class="o">=</span><span class="s1">&#39;sun&#39;</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_three_light</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">light_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ambient&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mh">0xFFFFFF</span><span class="p">,</span>
    <span class="n">intensity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">light_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cast_shadow</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">shadow_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sun_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a light to the Three.js scene.</span>

<span class="sd">    Args:</span>
<span class="sd">        light_type: Type of light (&#39;ambient&#39;, &#39;directional&#39;, or &#39;sun&#39;).</span>
<span class="sd">        color: Hexadecimal color value for the light (e.g., 0xffffff for white).</span>
<span class="sd">        intensity: Light intensity value.</span>
<span class="sd">        position: Optional position for directional lights as [x, y, z].</span>
<span class="sd">        light_id: Optional identifier for the light so it can be updated or removed later.</span>
<span class="sd">        target: Optional target position for directional lights as [x, y, z].</span>
<span class="sd">        cast_shadow: Whether the light should cast shadows (if supported by the light type).</span>
<span class="sd">        shadow_options: Additional shadow configuration such as map size or clipping planes.</span>
<span class="sd">        sun_options: Additional options when using the `sun` light type (e.g., ``{&quot;current_time&quot;: &quot;2024-01-01T12:00:00Z&quot;}``).</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; m = MapLibreMap(center=[148.9819, -35.3981], zoom=18, pitch=60)</span>
<span class="sd">        &gt;&gt;&gt; m.init_three_scene()</span>
<span class="sd">        &gt;&gt;&gt; m.add_three_light(light_type=&#39;ambient&#39;, intensity=0.5)</span>
<span class="sd">        &gt;&gt;&gt; m.add_three_light(light_type=&#39;directional&#39;, position=[1, 1, 1])</span>
<span class="sd">        &gt;&gt;&gt; m.add_three_light(light_type=&#39;sun&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">light_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">light_type</span><span class="p">,</span>
        <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span>
        <span class="s2">&quot;intensity&quot;</span><span class="p">:</span> <span class="n">intensity</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">light_config</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>
    <span class="k">if</span> <span class="n">light_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">light_config</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">light_id</span>
    <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">light_config</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
    <span class="k">if</span> <span class="n">cast_shadow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">light_config</span><span class="p">[</span><span class="s2">&quot;castShadow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast_shadow</span>
    <span class="k">if</span> <span class="n">shadow_options</span><span class="p">:</span>
        <span class="n">light_config</span><span class="p">[</span><span class="s2">&quot;shadowOptions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shadow_options</span>
    <span class="k">if</span> <span class="n">sun_options</span><span class="p">:</span>
        <span class="n">light_config</span><span class="p">[</span><span class="s2">&quot;sunOptions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sun_options</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addThreeLight&quot;</span><span class="p">,</span> <span class="n">light_config</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_three_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_three_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_id</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_three_model" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a 3D GLTF model to the map using Three.js.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>model_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier for the 3D model.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>url</code></td>
        <td><code>str</code></td>
        <td><p>URL to the GLTF/GLB model file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>coordinates</code></td>
        <td><code>List[float]</code></td>
        <td><p>Geographic coordinates [longitude, latitude] where the model should be placed.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>scale</code></td>
        <td><code>Union[float, List[float]]</code></td>
        <td><p>Scale factor for the model. Can be a single number or [x, y, z] list.</p></td>
        <td><code>1.0</code></td>
      </tr>
      <tr>
        <td><code>rotation</code></td>
        <td><code>Optional[List[float]]</code></td>
        <td><p>Optional rotation in radians as [x, y, z].</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional options for the model.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">MapLibreMap</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">148.9819</span><span class="p">,</span> <span class="o">-</span><span class="mf">35.3981</span><span class="p">],</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">pitch</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">init_three_scene</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_three_light</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ambient&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_three_model</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">model_id</span><span class="o">=</span><span class="s1">&#39;my_model&#39;</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://example.com/model.gltf&#39;</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">coordinates</span><span class="o">=</span><span class="p">[</span><span class="mf">148.9819</span><span class="p">,</span> <span class="o">-</span><span class="mf">35.3981</span><span class="p">],</span>
<span class="o">...</span>     <span class="n">scale</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">rotation</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="o">...</span> <span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_three_model</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">coordinates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">scale</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">rotation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a 3D GLTF model to the map using Three.js.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_id: Unique identifier for the 3D model.</span>
<span class="sd">        url: URL to the GLTF/GLB model file.</span>
<span class="sd">        coordinates: Geographic coordinates [longitude, latitude] where the model should be placed.</span>
<span class="sd">        scale: Scale factor for the model. Can be a single number or [x, y, z] list.</span>
<span class="sd">        rotation: Optional rotation in radians as [x, y, z].</span>
<span class="sd">        **kwargs: Additional options for the model.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; m = MapLibreMap(center=[148.9819, -35.3981], zoom=18, pitch=60)</span>
<span class="sd">        &gt;&gt;&gt; m.init_three_scene()</span>
<span class="sd">        &gt;&gt;&gt; m.add_three_light(type=&#39;ambient&#39;)</span>
<span class="sd">        &gt;&gt;&gt; m.add_three_model(</span>
<span class="sd">        ...     model_id=&#39;my_model&#39;,</span>
<span class="sd">        ...     url=&#39;https://example.com/model.gltf&#39;,</span>
<span class="sd">        ...     coordinates=[148.9819, -35.3981],</span>
<span class="sd">        ...     scale=100,</span>
<span class="sd">        ...     rotation=[0, 0, 0]</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">model_id</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
        <span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="n">coordinates</span><span class="p">,</span>
        <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="n">scale</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">model_config</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotation</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addThreeModel&quot;</span><span class="p">,</span> <span class="n">model_config</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_three_tileset" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_three_tileset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tileset_id</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">asset_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ion_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_refresh_token</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">auto_disable_renderer_culling</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fetch_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lru_cache</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draco_decoder_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ktx2_transcoder_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_fade</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_unload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">height_offset</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fly_to</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_three_tileset" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a 3D Tiles dataset to the scene using TilesRenderer.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_three_tileset</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">tileset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">asset_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ion_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">auto_refresh_token</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">auto_disable_renderer_culling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">fetch_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">lru_cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">draco_decoder_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ktx2_transcoder_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">use_fade</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">use_unload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">use_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">height_offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">fly_to</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a 3D Tiles dataset to the scene using TilesRenderer.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">asset_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Either asset_id or url must be provided for add_three_tileset&quot;</span>
        <span class="p">)</span>

    <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">tileset_id</span><span class="p">,</span>
        <span class="s2">&quot;assetId&quot;</span><span class="p">:</span> <span class="n">asset_id</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
        <span class="s2">&quot;ionToken&quot;</span><span class="p">:</span> <span class="n">ion_token</span><span class="p">,</span>
        <span class="s2">&quot;autoRefreshToken&quot;</span><span class="p">:</span> <span class="n">auto_refresh_token</span><span class="p">,</span>
        <span class="s2">&quot;autoDisableRendererCulling&quot;</span><span class="p">:</span> <span class="n">auto_disable_renderer_culling</span><span class="p">,</span>
        <span class="s2">&quot;fetchOptions&quot;</span><span class="p">:</span> <span class="n">fetch_options</span><span class="p">,</span>
        <span class="s2">&quot;lruCache&quot;</span><span class="p">:</span> <span class="n">lru_cache</span><span class="p">,</span>
        <span class="s2">&quot;dracoDecoderPath&quot;</span><span class="p">:</span> <span class="n">draco_decoder_path</span><span class="p">,</span>
        <span class="s2">&quot;ktx2TranscoderPath&quot;</span><span class="p">:</span> <span class="n">ktx2_transcoder_path</span><span class="p">,</span>
        <span class="s2">&quot;useDebug&quot;</span><span class="p">:</span> <span class="n">use_debug</span><span class="p">,</span>
        <span class="s2">&quot;useFade&quot;</span><span class="p">:</span> <span class="n">use_fade</span><span class="p">,</span>
        <span class="s2">&quot;useUnload&quot;</span><span class="p">:</span> <span class="n">use_unload</span><span class="p">,</span>
        <span class="s2">&quot;useUpdate&quot;</span><span class="p">:</span> <span class="n">use_update</span><span class="p">,</span>
        <span class="s2">&quot;heightOffset&quot;</span><span class="p">:</span> <span class="n">height_offset</span><span class="p">,</span>
        <span class="s2">&quot;flyTo&quot;</span><span class="p">:</span> <span class="n">fly_to</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Remove None values to keep payload minimal</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addThreeTileset&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_tile_layer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_tile_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">source_url</span><span class="p">,</span> <span class="n">attribution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">minzoom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxzoom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">paint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_tile_layer" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a raster tile layer to the map.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier for the layer.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>source_url</code></td>
        <td><code>str</code></td>
        <td><p>URL template for the tile source (e.g., 'https://example.com/{z}/{x}/{y}.png').</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>attribution</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional attribution text for the tile source.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>opacity</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>Layer opacity between 0.0 and 1.0.</p></td>
        <td><code>1.0</code></td>
      </tr>
      <tr>
        <td><code>visible</code></td>
        <td><code>Optional[bool]</code></td>
        <td><p>Whether the layer should be visible initially.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>minzoom</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>Minimum zoom level for the layer.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>maxzoom</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>Maximum zoom level for the layer.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>paint</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Optional paint properties for the layer.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>layout</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Optional layout properties for the layer.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>before_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional layer ID to insert this layer before.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional source configuration options.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_tile_layer</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">source_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">attribution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">opacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">visible</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">minzoom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">maxzoom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a raster tile layer to the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Unique identifier for the layer.</span>
<span class="sd">        source_url: URL template for the tile source (e.g., &#39;https://example.com/{z}/{x}/{y}.png&#39;).</span>
<span class="sd">        attribution: Optional attribution text for the tile source.</span>
<span class="sd">        opacity: Layer opacity between 0.0 and 1.0.</span>
<span class="sd">        visible: Whether the layer should be visible initially.</span>
<span class="sd">        minzoom: Minimum zoom level for the layer.</span>
<span class="sd">        maxzoom: Maximum zoom level for the layer.</span>
<span class="sd">        paint: Optional paint properties for the layer.</span>
<span class="sd">        layout: Optional layout properties for the layer.</span>
<span class="sd">        before_id: Optional layer ID to insert this layer before.</span>
<span class="sd">        **kwargs: Additional source configuration options.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_source&quot;</span>

    <span class="c1"># Build source configuration</span>
    <span class="n">source_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;raster&quot;</span><span class="p">,</span> <span class="s2">&quot;tiles&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">source_url</span><span class="p">],</span> <span class="s2">&quot;tileSize&quot;</span><span class="p">:</span> <span class="mi">256</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">attribution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">source_config</span><span class="p">[</span><span class="s2">&quot;attribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attribution</span>

    <span class="c1"># Add any additional source options from kwargs</span>
    <span class="n">source_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Add raster source</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">source_id</span><span class="p">,</span> <span class="n">source_config</span><span class="p">)</span>

    <span class="c1"># Add raster layer</span>
    <span class="n">layer_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;raster&quot;</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">}</span>

    <span class="c1"># Add minzoom/maxzoom if specified</span>
    <span class="k">if</span> <span class="n">minzoom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;minzoom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minzoom</span>
    <span class="k">if</span> <span class="n">maxzoom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;maxzoom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxzoom</span>

    <span class="k">if</span> <span class="n">paint</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paint</span>
    <span class="k">if</span> <span class="n">layout</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layout</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span>
        <span class="n">layer</span><span class="o">=</span><span class="n">layer_config</span><span class="p">,</span>
        <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span>
        <span class="n">layer_id</span><span class="o">=</span><span class="n">layer_id</span><span class="p">,</span>
        <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
        <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_to_sidebar" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_to_sidebar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">add_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">widget_icon</span><span class="o">=</span><span class="s1">&#39;mdi-tools&#39;</span><span class="p">,</span> <span class="n">close_icon</span><span class="o">=</span><span class="s1">&#39;mdi-close&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;My Tools&#39;</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;#f5f5f5&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s1">&#39;40px&#39;</span><span class="p">,</span> <span class="n">expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_to_sidebar" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Appends a widget to the sidebar content.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>widget</code></td>
        <td><code>Optional[Union[widgets.Widget, List[widgets.Widget]]]</code></td>
        <td><p>Initial widget(s) to display in the content box.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>widget_icon</code></td>
        <td><code>str</code></td>
        <td><p>Icon for the header. See https://pictogrammers.github.io/@mdi/font/2.0.46/ for available icons.</p></td>
        <td><code>&#39;mdi-tools&#39;</code></td>
      </tr>
      <tr>
        <td><code>close_icon</code></td>
        <td><code>str</code></td>
        <td><p>Icon for the close button. See https://pictogrammers.github.io/@mdi/font/2.0.46/ for available icons.</p></td>
        <td><code>&#39;mdi-close&#39;</code></td>
      </tr>
      <tr>
        <td><code>background_color</code></td>
        <td><code>str</code></td>
        <td><p>Background color of the header. Defaults to "#f5f5f5".</p></td>
        <td><code>&#39;#f5f5f5&#39;</code></td>
      </tr>
      <tr>
        <td><code>label</code></td>
        <td><code>str</code></td>
        <td><p>Text label for the header. Defaults to "My Tools".</p></td>
        <td><code>&#39;My Tools&#39;</code></td>
      </tr>
      <tr>
        <td><code>height</code></td>
        <td><code>str</code></td>
        <td><p>Height of the header. Defaults to "40px".</p></td>
        <td><code>&#39;40px&#39;</code></td>
      </tr>
      <tr>
        <td><code>expanded</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the panel is expanded by default. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional keyword arguments for the parent class.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_to_sidebar</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">widget</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span><span class="p">]],</span>
    <span class="n">add_header</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">widget_icon</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mdi-tools&quot;</span><span class="p">,</span>
    <span class="n">close_icon</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mdi-close&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;My Tools&quot;</span><span class="p">,</span>
    <span class="n">background_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;#f5f5f5&quot;</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;40px&quot;</span><span class="p">,</span>
    <span class="n">expanded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Appends a widget to the sidebar content.</span>

<span class="sd">    Args:</span>
<span class="sd">        widget (Optional[Union[widgets.Widget, List[widgets.Widget]]]): Initial widget(s) to display in the content box.</span>
<span class="sd">        widget_icon (str): Icon for the header. See https://pictogrammers.github.io/@mdi/font/2.0.46/ for available icons.</span>
<span class="sd">        close_icon (str): Icon for the close button. See https://pictogrammers.github.io/@mdi/font/2.0.46/ for available icons.</span>
<span class="sd">        background_color (str): Background color of the header. Defaults to &quot;#f5f5f5&quot;.</span>
<span class="sd">        label (str): Text label for the header. Defaults to &quot;My Tools&quot;.</span>
<span class="sd">        height (str): Height of the header. Defaults to &quot;40px&quot;.</span>
<span class="sd">        expanded (bool): Whether the panel is expanded by default. Defaults to True.</span>
<span class="sd">        **kwargs (Any): Additional keyword arguments for the parent class.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_container</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">sidebar_args</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">add_to_sidebar</span><span class="p">(</span>
        <span class="n">widget</span><span class="p">,</span>
        <span class="n">add_header</span><span class="o">=</span><span class="n">add_header</span><span class="p">,</span>
        <span class="n">widget_icon</span><span class="o">=</span><span class="n">widget_icon</span><span class="p">,</span>
        <span class="n">close_icon</span><span class="o">=</span><span class="n">close_icon</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
        <span class="n">background_color</span><span class="o">=</span><span class="n">background_color</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="n">expanded</span><span class="o">=</span><span class="n">expanded</span><span class="p">,</span>
        <span class="n">host_map</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_vector" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">layer_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">paint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fit_bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_vector" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a vector layer to the map.</p>
<p>This method adds a vector layer to the map. The vector data can be a
URL or local file path to a vector file (e.g., shapefile, GeoJSON,
GeoPackage) or a GeoDataFrame.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>data</code></td>
        <td><code>Union[str, gpd.GeoDataFrame]</code></td>
        <td><p>The vector data. This can be a URL, local file path to a
vector file, or a GeoDataFrame.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>layer_type</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The type of the layer. If None, the type is inferred
from the GeoJSON data.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>filter</code></td>
        <td><code>Optional[Dict]</code></td>
        <td><p>The filter to apply to the layer. If None, no filter is applied.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>paint</code></td>
        <td><code>Optional[Dict]</code></td>
        <td><p>The paint properties to apply to the layer. If None, default
paint properties are applied.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>name</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The name of the layer. If None, a default name is generated.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>fit_bounds</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to adjust the viewport of the map to fit the
bounds of the data. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>visible</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the layer is visible or not. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>opacity</code></td>
        <td><code>float</code></td>
        <td><p>The opacity of the layer. Defaults to 1.0.</p></td>
        <td><code>1.0</code></td>
      </tr>
      <tr>
        <td><code>before_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The ID of an existing layer before which the new layer
should be inserted.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>source_args</code></td>
        <td><code>Optional[Dict]</code></td>
        <td><p>Additional keyword arguments that are passed to the
GeoJSON source.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional keyword arguments that are passed to the layer.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_vector</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;gpd.GeoDataFrame&quot;</span><span class="p">],</span>
    <span class="n">layer_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fit_bounds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">source_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a vector layer to the map.</span>

<span class="sd">    This method adds a vector layer to the map. The vector data can be a</span>
<span class="sd">    URL or local file path to a vector file (e.g., shapefile, GeoJSON,</span>
<span class="sd">    GeoPackage) or a GeoDataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: The vector data. This can be a URL, local file path to a</span>
<span class="sd">            vector file, or a GeoDataFrame.</span>
<span class="sd">        layer_type: The type of the layer. If None, the type is inferred</span>
<span class="sd">            from the GeoJSON data.</span>
<span class="sd">        filter: The filter to apply to the layer. If None, no filter is applied.</span>
<span class="sd">        paint: The paint properties to apply to the layer. If None, default</span>
<span class="sd">            paint properties are applied.</span>
<span class="sd">        name: The name of the layer. If None, a default name is generated.</span>
<span class="sd">        fit_bounds: Whether to adjust the viewport of the map to fit the</span>
<span class="sd">            bounds of the data. Defaults to True.</span>
<span class="sd">        visible: Whether the layer is visible or not. Defaults to True.</span>
<span class="sd">        opacity: The opacity of the layer. Defaults to 1.0.</span>
<span class="sd">        before_id: The ID of an existing layer before which the new layer</span>
<span class="sd">            should be inserted.</span>
<span class="sd">        source_args: Additional keyword arguments that are passed to the</span>
<span class="sd">            GeoJSON source.</span>
<span class="sd">        **kwargs: Additional keyword arguments that are passed to the layer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.parquet&quot;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">__geo_interface__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">__geo_interface__</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">__geo_interface__</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">add_geojson</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">layer_type</span><span class="p">,</span>
        <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
        <span class="n">paint</span><span class="o">=</span><span class="n">paint</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">fit_bounds</span><span class="o">=</span><span class="n">fit_bounds</span><span class="p">,</span>
        <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span>
        <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
        <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span>
        <span class="n">source_args</span><span class="o">=</span><span class="n">source_args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_vector_editor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_vector_editor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename_prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">time_format</span><span class="o">=</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">T%H%M%S&#39;</span><span class="p">,</span> <span class="n">file_ext</span><span class="o">=</span><span class="s1">&#39;geojson&#39;</span><span class="p">,</span> <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">geoman_position</span><span class="o">=</span><span class="s1">&#39;top-left&#39;</span><span class="p">,</span> <span class="n">widget_position</span><span class="o">=</span><span class="s1">&#39;top-right&#39;</span><span class="p">,</span> <span class="n">widget_label</span><span class="o">=</span><span class="s1">&#39;Vector Editor&#39;</span><span class="p">,</span> <span class="n">widget_icon</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">fit_bounds_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_vector_editor" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add an interactive vector editor with property assignment capabilities.</p>
<p>This method creates an interactive interface for editing vector features and
assigning properties to them. It loads existing vector data, adds a Geoman
drawing control, and provides a widget panel for editing feature properties.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>filename</code></td>
        <td><code>Union[str, Dict[str, Any], gpd.GeoDataFrame]</code></td>
        <td><p>Vector data source - can be:
- File path (GeoJSON, shapefile, etc.)
- URL to remote GeoJSON
- GeoJSON dictionary
- GeoDataFrame</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>properties</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Dictionary defining editable properties where keys are property
names and values define the input type:
- List/tuple: Creates dropdown with these options
- int: Creates integer input with this default value
- float: Creates float input with this default value
- str: Creates text input with this default value
If None, properties are inferred from the data.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>out_dir</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Directory for exported files. Defaults to current directory.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>filename_prefix</code></td>
        <td><code>str</code></td>
        <td><p>Prefix for exported filenames.</p></td>
        <td><code>&#39;&#39;</code></td>
      </tr>
      <tr>
        <td><code>time_format</code></td>
        <td><code>str</code></td>
        <td><p>Format string for timestamp in exported filenames.</p></td>
        <td><code>&#39;%Y%m%dT%H%M%S&#39;</code></td>
      </tr>
      <tr>
        <td><code>file_ext</code></td>
        <td><code>str</code></td>
        <td><p>File extension for exports (default: "geojson").</p></td>
        <td><code>&#39;geojson&#39;</code></td>
      </tr>
      <tr>
        <td><code>controls</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Dictionary specifying Geoman drawing controls to enable. The dictionary should have keys such as "draw", "edit", and "helper", each mapping to a list of control names to enable.
Defaults to:
    {
        "draw": ["point", "polygon", "line_string"],
        "edit": ["edit", "cut", "copy", "merge", "split"],
        "helper": ["trash"]
    }
Example:
    controls = {
        "draw": ["point", "polygon", "line_string"],
        "edit": ["edit", "cut", "copy", "merge", "split"],
        "helper": ["trash"]
    }</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>geoman_position</code></td>
        <td><code>str</code></td>
        <td><p>Position of Geoman control on map.</p></td>
        <td><code>&#39;top-left&#39;</code></td>
      </tr>
      <tr>
        <td><code>widget_position</code></td>
        <td><code>str</code></td>
        <td><p>Position of property editor widget on map.</p></td>
        <td><code>&#39;top-right&#39;</code></td>
      </tr>
      <tr>
        <td><code>widget_label</code></td>
        <td><code>str</code></td>
        <td><p>Label for the property editor widget panel.</p></td>
        <td><code>&#39;Vector Editor&#39;</code></td>
      </tr>
      <tr>
        <td><code>widget_icon</code></td>
        <td><code>str</code></td>
        <td><p>Icon for the property editor toggle button.</p></td>
        <td><code>&#39;&#39;</code></td>
      </tr>
      <tr>
        <td><code>fit_bounds_options</code></td>
        <td><code>Optional[Dict]</code></td>
        <td><p>Options passed to fit_bounds().</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional arguments passed to add_geoman_control().</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The control ID of the added widget control.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">MapLibreMap</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="s2">&quot;Esri.WorldImagery&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://example.com/buildings.geojson&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">properties</span> <span class="o">=</span> <span class="p">{</span>
<span class="o">...</span>     <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;residential&quot;</span><span class="p">,</span> <span class="s2">&quot;commercial&quot;</span><span class="p">,</span> <span class="s2">&quot;industrial&quot;</span><span class="p">],</span>
<span class="o">...</span>     <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="o">...</span>     <span class="s2">&quot;floors&quot;</span><span class="p">:</span> <span class="mi">1</span>
<span class="o">...</span> <span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">control_id</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">add_vector_editor</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_vector_editor</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="s2">&quot;gpd.GeoDataFrame&quot;</span><span class="p">],</span>
    <span class="n">properties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">out_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filename_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">time_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">T%H%M%S&quot;</span><span class="p">,</span>
    <span class="n">file_ext</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;geojson&quot;</span><span class="p">,</span>
    <span class="n">controls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">geoman_position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">,</span>
    <span class="n">widget_position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
    <span class="n">widget_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Vector Editor&quot;</span><span class="p">,</span>
    <span class="n">widget_icon</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">fit_bounds_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an interactive vector editor with property assignment capabilities.</span>

<span class="sd">    This method creates an interactive interface for editing vector features and</span>
<span class="sd">    assigning properties to them. It loads existing vector data, adds a Geoman</span>
<span class="sd">    drawing control, and provides a widget panel for editing feature properties.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename: Vector data source - can be:</span>
<span class="sd">            - File path (GeoJSON, shapefile, etc.)</span>
<span class="sd">            - URL to remote GeoJSON</span>
<span class="sd">            - GeoJSON dictionary</span>
<span class="sd">            - GeoDataFrame</span>
<span class="sd">        properties: Dictionary defining editable properties where keys are property</span>
<span class="sd">            names and values define the input type:</span>
<span class="sd">            - List/tuple: Creates dropdown with these options</span>
<span class="sd">            - int: Creates integer input with this default value</span>
<span class="sd">            - float: Creates float input with this default value</span>
<span class="sd">            - str: Creates text input with this default value</span>
<span class="sd">            If None, properties are inferred from the data.</span>
<span class="sd">        out_dir: Directory for exported files. Defaults to current directory.</span>
<span class="sd">        filename_prefix: Prefix for exported filenames.</span>
<span class="sd">        time_format: Format string for timestamp in exported filenames.</span>
<span class="sd">        file_ext: File extension for exports (default: &quot;geojson&quot;).</span>
<span class="sd">        controls: Dictionary specifying Geoman drawing controls to enable. The dictionary should have keys such as &quot;draw&quot;, &quot;edit&quot;, and &quot;helper&quot;, each mapping to a list of control names to enable.</span>
<span class="sd">            Defaults to:</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;draw&quot;: [&quot;point&quot;, &quot;polygon&quot;, &quot;line_string&quot;],</span>
<span class="sd">                    &quot;edit&quot;: [&quot;edit&quot;, &quot;cut&quot;, &quot;copy&quot;, &quot;merge&quot;, &quot;split&quot;],</span>
<span class="sd">                    &quot;helper&quot;: [&quot;trash&quot;]</span>
<span class="sd">                }</span>
<span class="sd">            Example:</span>
<span class="sd">                controls = {</span>
<span class="sd">                    &quot;draw&quot;: [&quot;point&quot;, &quot;polygon&quot;, &quot;line_string&quot;],</span>
<span class="sd">                    &quot;edit&quot;: [&quot;edit&quot;, &quot;cut&quot;, &quot;copy&quot;, &quot;merge&quot;, &quot;split&quot;],</span>
<span class="sd">                    &quot;helper&quot;: [&quot;trash&quot;]</span>
<span class="sd">                }</span>
<span class="sd">        geoman_position: Position of Geoman control on map.</span>
<span class="sd">        widget_position: Position of property editor widget on map.</span>
<span class="sd">        widget_label: Label for the property editor widget panel.</span>
<span class="sd">        widget_icon: Icon for the property editor toggle button.</span>
<span class="sd">        fit_bounds_options: Options passed to fit_bounds().</span>
<span class="sd">        **kwargs: Additional arguments passed to add_geoman_control().</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The control ID of the added widget control.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; m = MapLibreMap()</span>
<span class="sd">        &gt;&gt;&gt; m.add_basemap(&quot;Esri.WorldImagery&quot;)</span>
<span class="sd">        &gt;&gt;&gt; url = &quot;https://example.com/buildings.geojson&quot;</span>
<span class="sd">        &gt;&gt;&gt; properties = {</span>
<span class="sd">        ...     &quot;class&quot;: [&quot;residential&quot;, &quot;commercial&quot;, &quot;industrial&quot;],</span>
<span class="sd">        ...     &quot;height&quot;: 0.0,</span>
<span class="sd">        ...     &quot;floors&quot;: 1</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; control_id = m.add_vector_editor(url, properties=properties)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_GEOPANDAS</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;geopandas is required for add_vector_editor. &quot;</span>
            <span class="s2">&quot;Install it with: pip install geopandas&quot;</span>
        <span class="p">)</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>

    <span class="c1"># Load vector data</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># Check if it&#39;s a URL or file path</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;http://&quot;</span><span class="p">,</span> <span class="s2">&quot;https://&quot;</span><span class="p">)):</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;.pq&quot;</span><span class="p">,</span> <span class="s2">&quot;.geoparquet&quot;</span><span class="p">]:</span>
                <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;filename must be a string (path/URL), dict (GeoJSON), or GeoDataFrame&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Ensure WGS84</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>

    <span class="c1"># Set output directory</span>
    <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="c1"># Infer properties from GeoDataFrame if not provided</span>
    <span class="k">if</span> <span class="n">properties</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dtypes</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">gdf</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                        <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;int32&quot;</span><span class="p">,</span> <span class="s2">&quot;int64&quot;</span><span class="p">]:</span>
                    <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;float32&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">]:</span>
                    <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;bool&quot;</span><span class="p">:</span>
                    <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Select only property columns plus geometry</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">properties</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">columns</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]]</span>
    <span class="n">geojson</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">__geo_interface__</span>

    <span class="c1"># Get bounds and fit map</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">geojson_bounds</span><span class="p">(</span><span class="n">geojson</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Transform flat bounds [minx, miny, maxx, maxy] to [[minx, miny], [maxx, maxy]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_bounds</span><span class="p">([[</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]]])</span>
    <span class="c1"># else: bounds is None, skip fitting bounds</span>
    <span class="c1"># Prepare GeoJSON features for Geoman with proper IDs</span>
    <span class="n">geoman_geojson</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">feature</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">geojson</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]):</span>
        <span class="c1"># Create a unique ID for each feature</span>
        <span class="n">feature_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;feature-</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Determine the Geoman shape type from geometry</span>
        <span class="n">geom_type</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">geom_type</span> <span class="o">==</span> <span class="s2">&quot;Point&quot;</span><span class="p">:</span>
            <span class="n">gm_shape</span> <span class="o">=</span> <span class="s2">&quot;marker&quot;</span>
        <span class="k">elif</span> <span class="n">geom_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Polygon&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiPolygon&quot;</span><span class="p">]:</span>
            <span class="n">gm_shape</span> <span class="o">=</span> <span class="s2">&quot;polygon&quot;</span>
        <span class="k">elif</span> <span class="n">geom_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;LineString&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiLineString&quot;</span><span class="p">]:</span>
            <span class="n">gm_shape</span> <span class="o">=</span> <span class="s2">&quot;line&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gm_shape</span> <span class="o">=</span> <span class="s2">&quot;polygon&quot;</span>

        <span class="c1"># Create Geoman-compatible feature with preserved properties</span>
        <span class="c1"># Start with original properties, then add Geoman-specific ones</span>
        <span class="n">feature_properties</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">feature_properties</span><span class="p">[</span><span class="s2">&quot;__gm_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_id</span>
        <span class="n">feature_properties</span><span class="p">[</span><span class="s2">&quot;__gm_shape&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gm_shape</span>

        <span class="n">geoman_feature</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">feature_id</span><span class="p">,</span>
            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">feature_properties</span><span class="p">,</span>
            <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="n">geoman_geojson</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geoman_feature</span><span class="p">)</span>

    <span class="c1"># Set default controls if not provided</span>
    <span class="k">if</span> <span class="n">controls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">controls</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;draw&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                <span class="s2">&quot;polygon&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                <span class="s2">&quot;line_string&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="p">},</span>
            <span class="s2">&quot;edit&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;change&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>  <span class="c1"># Disable edit mode button</span>
                <span class="s2">&quot;trash&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>  <span class="c1"># Keep delete button</span>
            <span class="p">},</span>
            <span class="s2">&quot;helper&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;click_to_edit&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>  <span class="c1"># Enable click-to-edit mode</span>
            <span class="p">},</span>
        <span class="p">}</span>

    <span class="c1"># Add Geoman control first</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_geoman_control</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">geoman_position</span><span class="p">,</span> <span class="n">controls</span><span class="o">=</span><span class="n">controls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Now load the features into Geoman (will be editable with JS fix)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_geoman_data</span><span class="p">(</span><span class="n">geoman_geojson</span><span class="p">)</span>

    <span class="c1"># Initialize feature properties storage</span>
    <span class="c1"># Map Geoman feature IDs to properties from GeoDataFrame</span>
    <span class="n">draw_features</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">row_idx</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>
        <span class="c1"># Get the corresponding Geoman feature ID</span>
        <span class="n">feature_id</span> <span class="o">=</span> <span class="n">geoman_geojson</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

        <span class="n">feature_props</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span>
                <span class="c1"># Convert numpy/pandas types to Python native types</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">):</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                <span class="n">feature_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Use default value from properties</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">properties</span><span class="p">[</span><span class="n">prop</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                    <span class="n">feature_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="n">prop</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">feature_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span>
        <span class="n">draw_features</span><span class="p">[</span><span class="n">feature_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_props</span>

    <span class="c1"># Store on map instance</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;draw_features&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">draw_features</span><span class="p">)</span>

    <span class="c1"># Expand dropdown options to include values from loaded GeoDataFrame</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="c1"># Get unique values from the loaded data</span>
            <span class="n">existing_values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

            <span class="c1"># Merge with provided options</span>
            <span class="n">options_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">merged_options</span> <span class="o">=</span> <span class="n">options_set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">existing_values</span><span class="p">)</span>
            <span class="n">merged_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">values</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">merged_options</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">existing_values</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options_set</span><span class="p">:</span>
                    <span class="n">merged_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_list</span>

    <span class="c1"># Create property editing widgets</span>
    <span class="n">prop_widgets</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">()</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>

    <span class="c1"># Add a label to show which feature is selected</span>
    <span class="n">feature_label</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&lt;p style=&#39;margin:5px 0; color:#666; font-size:12px;&#39;&gt;No feature selected&lt;/p&gt;&quot;</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">prop_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                <span class="n">options</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;initial&quot;</span><span class="p">},</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">prop_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntText</span><span class="p">(</span>
                <span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;initial&quot;</span><span class="p">},</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">prop_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span>
                <span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;initial&quot;</span><span class="p">},</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prop_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
                <span class="n">value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
                <span class="n">description</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;initial&quot;</span><span class="p">},</span>
            <span class="p">)</span>
        <span class="n">prop_widgets</span><span class="o">.</span><span class="n">children</span> <span class="o">+=</span> <span class="p">(</span><span class="n">prop_widget</span><span class="p">,)</span>

    <span class="c1"># Create buttons</span>
    <span class="n">button_layout</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;100px&quot;</span><span class="p">)</span>
    <span class="n">save_btn</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Save&quot;</span><span class="p">,</span>
        <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">button_layout</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Save current feature properties&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">export_btn</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Export&quot;</span><span class="p">,</span>
        <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">button_layout</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Export all features to file&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">reset_btn</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Reset&quot;</span><span class="p">,</span>
        <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">button_layout</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Reset to default values&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Track currently selected feature for property editing</span>
    <span class="n">current_feature_id</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># Create a dropdown to select features</span>
    <span class="n">feature_selector</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
        <span class="n">options</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Select Feature:&quot;</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;initial&quot;</span><span class="p">},</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="s2">&quot;5px 0&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Update feature selector when geoman_data changes</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_feature_list</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the feature dropdown when features change.&quot;&quot;&quot;</span>
        <span class="n">geoman_data</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">geoman_data</span> <span class="ow">and</span> <span class="s2">&quot;features&quot;</span> <span class="ow">in</span> <span class="n">geoman_data</span><span class="p">:</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">geoman_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Create options: (label, feature_id)</span>
                <span class="n">options</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feature </span><span class="si">{</span><span class="n">idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="n">feature_selector</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>

                <span class="c1"># If no feature selected yet, select the first one</span>
                <span class="k">if</span> <span class="n">current_feature_id</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">feature_selector</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">feature_selector</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">current_feature_id</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">feature_label</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&lt;p style=&#39;margin:5px 0; color:#666; font-size:12px;&#39;&gt;No features available&lt;/p&gt;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feature_selector</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">current_feature_id</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">feature_label</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&lt;p style=&#39;margin:5px 0; color:#666; font-size:12px;&#39;&gt;No features available&lt;/p&gt;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">update_feature_list</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;geoman_data&quot;</span><span class="p">)</span>

    <span class="c1"># When user selects a feature from dropdown</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_feature_selected</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update property widgets when user selects a feature.&quot;&quot;&quot;</span>
        <span class="n">feature_id</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">feature_id</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">current_feature_id</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_id</span>
        <span class="n">feature_label</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;p style=&#39;margin:5px 0; color:#0066cc; font-size:12px;&#39;&gt;&lt;b&gt;Editing:&lt;/b&gt; </span><span class="si">{</span><span class="n">feature_id</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>

        <span class="c1"># Initialize properties for new features</span>
        <span class="k">if</span> <span class="n">feature_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="p">[</span><span class="n">feature_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="p">[</span><span class="n">feature_id</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="p">[</span><span class="n">feature_id</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>

        <span class="c1"># Update widgets with feature&#39;s current properties</span>
        <span class="n">feature_props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="p">[</span><span class="n">feature_id</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">prop_widget</span> <span class="ow">in</span> <span class="n">prop_widgets</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">prop_widget</span><span class="o">.</span><span class="n">description</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">feature_props</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">feature_props</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="c1"># For dropdowns, only set if value is in options</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">prop_widget</span><span class="p">,</span> <span class="s2">&quot;options&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">prop_widget</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                        <span class="n">prop_widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop_widget</span><span class="o">.</span><span class="n">options</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">prop_widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">prop_widget</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">prop_widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="n">feature_selector</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">on_feature_selected</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>

    <span class="c1"># Trigger initial update</span>
    <span class="n">update_feature_list</span><span class="p">({</span><span class="s2">&quot;new&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span><span class="p">})</span>

    <span class="c1"># Save button handler</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_save_click</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
        <span class="n">feature_id</span> <span class="o">=</span> <span class="n">current_feature_id</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">feature_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Save widget values to feature properties</span>
            <span class="k">for</span> <span class="n">prop_widget</span> <span class="ow">in</span> <span class="n">prop_widgets</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">prop_widget</span><span class="o">.</span><span class="n">description</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="p">[</span><span class="n">feature_id</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop_widget</span><span class="o">.</span><span class="n">value</span>
            <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Feature properties saved&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot; No feature selected. Click on a feature to edit it or draw a new one.&quot;</span>
                <span class="p">)</span>

    <span class="n">save_btn</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">on_save_click</span><span class="p">)</span>

    <span class="c1"># Export button handler</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_export_click</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">time_format</span><span class="p">)</span>
        <span class="n">export_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename_prefix</span><span class="si">}{</span><span class="n">current_time</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">file_ext</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Update feature collection with saved properties</span>
        <span class="n">geoman_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span>
        <span class="k">if</span> <span class="n">geoman_data</span> <span class="ow">and</span> <span class="s2">&quot;features&quot;</span> <span class="ow">in</span> <span class="n">geoman_data</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">feature</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">geoman_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]):</span>
                <span class="n">feature_id</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">feature_id</span> <span class="ow">and</span> <span class="n">feature_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="p">:</span>
                    <span class="c1"># Merge Geoman properties with our custom properties</span>
                    <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">,</span> <span class="p">{}))</span>
                    <span class="n">props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">draw_features</span><span class="p">[</span><span class="n">feature_id</span><span class="p">])</span>
                    <span class="n">geoman_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">][</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">props</span>

            <span class="c1"># Export to file</span>
            <span class="n">export_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span>
                <span class="n">geoman_data</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span>
            <span class="p">)</span>
            <span class="n">export_gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">export_filename</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GeoJSON&quot;</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Exported: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">export_filename</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; No features to export&quot;</span><span class="p">)</span>

    <span class="n">export_btn</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">on_export_click</span><span class="p">)</span>

    <span class="c1"># Reset button handler</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_reset_click</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">prop_widget</span> <span class="ow">in</span> <span class="n">prop_widgets</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">prop_widget</span><span class="o">.</span><span class="n">description</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                    <span class="n">prop_widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">prop_widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Reset to defaults&quot;</span><span class="p">)</span>

    <span class="n">reset_btn</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">on_reset_click</span><span class="p">)</span>

    <span class="c1"># Create main widget container</span>
    <span class="n">info_label</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&lt;i&gt;Select a feature from the dropdown to edit its properties&lt;/i&gt;&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="s2">&quot;0 0 5px 0&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">button_box</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span>
        <span class="p">[</span><span class="n">save_btn</span><span class="p">,</span> <span class="n">export_btn</span><span class="p">,</span> <span class="n">reset_btn</span><span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="s2">&quot;10px 0&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">main_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">info_label</span><span class="p">,</span>
            <span class="n">feature_selector</span><span class="p">,</span>
            <span class="n">feature_label</span><span class="p">,</span>
            <span class="n">prop_widgets</span><span class="p">,</span>
            <span class="n">button_box</span><span class="p">,</span>
            <span class="n">output</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">padding</span><span class="o">=</span><span class="s2">&quot;10px&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Add widget control to map</span>
    <span class="n">control_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_widget_control</span><span class="p">(</span>
        <span class="n">main_widget</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">widget_label</span><span class="p">,</span>
        <span class="n">icon</span><span class="o">=</span><span class="n">widget_icon</span><span class="p">,</span>
        <span class="n">position</span><span class="o">=</span><span class="n">widget_position</span><span class="p">,</span>
        <span class="n">collapsed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">panel_width</span><span class="o">=</span><span class="mi">320</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">control_id</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_vector_layer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_vector_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">source_url</span><span class="p">,</span> <span class="n">source_layer</span><span class="p">,</span> <span class="n">layer_type</span><span class="o">=</span><span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="n">paint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_vector_layer" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a vector tile layer to the map.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier for the layer.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>source_url</code></td>
        <td><code>str</code></td>
        <td><p>URL for the vector tile source.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>source_layer</code></td>
        <td><code>str</code></td>
        <td><p>Name of the source layer within the vector tiles.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>layer_type</code></td>
        <td><code>str</code></td>
        <td><p>Type of layer (e.g., 'fill', 'line', 'circle', 'symbol').</p></td>
        <td><code>&#39;fill&#39;</code></td>
      </tr>
      <tr>
        <td><code>paint</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Optional paint properties for styling the layer.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>layout</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>Optional layout properties for the layer.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>before_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional layer ID to insert this layer before.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_vector_layer</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">source_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">source_layer</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">layer_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
    <span class="n">paint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">before_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a vector tile layer to the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Unique identifier for the layer.</span>
<span class="sd">        source_url: URL for the vector tile source.</span>
<span class="sd">        source_layer: Name of the source layer within the vector tiles.</span>
<span class="sd">        layer_type: Type of layer (e.g., &#39;fill&#39;, &#39;line&#39;, &#39;circle&#39;, &#39;symbol&#39;).</span>
<span class="sd">        paint: Optional paint properties for styling the layer.</span>
<span class="sd">        layout: Optional layout properties for the layer.</span>
<span class="sd">        before_id: Optional layer ID to insert this layer before.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">_source&quot;</span>

    <span class="c1"># Add vector source</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">source_id</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;vector&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">source_url</span><span class="p">})</span>

    <span class="c1"># Add vector layer</span>
    <span class="n">layer_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">layer_type</span><span class="p">,</span>
        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
        <span class="s2">&quot;source-layer&quot;</span><span class="p">:</span> <span class="n">source_layer</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">paint</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paint</span>
    <span class="k">if</span> <span class="n">layout</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layout</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="o">=</span><span class="n">layer_config</span><span class="p">,</span> <span class="n">before_id</span><span class="o">=</span><span class="n">before_id</span><span class="p">,</span> <span class="n">layer_id</span><span class="o">=</span><span class="n">layer_id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.add_widget_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_widget_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Tools&#39;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-right&#39;</span><span class="p">,</span> <span class="n">collapsed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">panel_width</span><span class="o">=</span><span class="mi">320</span><span class="p">,</span> <span class="n">panel_min_width</span><span class="o">=</span><span class="mi">220</span><span class="p">,</span> <span class="n">panel_max_width</span><span class="o">=</span><span class="mi">420</span><span class="p">,</span> <span class="n">panel_max_height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_panel_width</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header_bg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">header_text_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">control_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.add_widget_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a collapsible widget control anchored to the map viewport.</p>
<p>The control displays as a button alongside other MapLibre controls. Clicking
the button expands a sidebar-style panel that renders the supplied
ipywidget content.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>widget</code></td>
        <td><code>Widget</code></td>
        <td><p>The ipywidget instance to embed inside the collapsible panel.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>label</code></td>
        <td><code>str</code></td>
        <td><p>Title shown at the top of the expanded panel.</p></td>
        <td><code>&#39;Tools&#39;</code></td>
      </tr>
      <tr>
        <td><code>icon</code></td>
        <td><code>str</code></td>
        <td><p>Text or icon hint shown on the toggle button. Defaults to a vertical ellipsis.</p></td>
        <td><code>&#39;&#39;</code></td>
      </tr>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Map control corner (<code>'top-left'</code>, <code>'top-right'</code>,
<code>'bottom-left'</code>, or <code>'bottom-right'</code>).</p></td>
        <td><code>&#39;top-right&#39;</code></td>
      </tr>
      <tr>
        <td><code>collapsed</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the panel starts collapsed.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>panel_width</code></td>
        <td><code>int</code></td>
        <td><p>Default panel width in pixels.</p></td>
        <td><code>320</code></td>
      </tr>
      <tr>
        <td><code>panel_min_width</code></td>
        <td><code>int</code></td>
        <td><p>Minimum panel width in pixels when resized on the front-end.</p></td>
        <td><code>220</code></td>
      </tr>
      <tr>
        <td><code>panel_max_width</code></td>
        <td><code>int</code></td>
        <td><p>Maximum panel width in pixels when resized on the front-end.</p></td>
        <td><code>420</code></td>
      </tr>
      <tr>
        <td><code>panel_max_height</code></td>
        <td><code>Union[int, str]</code></td>
        <td><p>Maximum panel height. Can be an int (pixels) or a CSS string (e.g., '70vh', '500px').
Defaults to None, which uses the JavaScript default of '70vh'.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>auto_panel_width</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the panel width should be automatically adjusted to the content width. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>header_bg</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The background color of the header, like "linear-gradient(135deg,#444,#888)". Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>header_text_color</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The text color of the header, like "#fff". Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>control_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional identifier used for duplicate detection and later removal.
If omitted, a unique identifier is generated from the label.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>description</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional tooltip description for the toggle button.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The unique identifier assigned to the widget control.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>TypeError</code></td>
        <td><p>If <code>widget</code> is not an ipywidget instance.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_widget_control</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">widget</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Tools&quot;</span><span class="p">,</span>
    <span class="n">icon</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
    <span class="n">collapsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">panel_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>
    <span class="n">panel_min_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">220</span><span class="p">,</span>
    <span class="n">panel_max_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">420</span><span class="p">,</span>
    <span class="n">panel_max_height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">auto_panel_width</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">header_bg</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">header_text_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">control_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a collapsible widget control anchored to the map viewport.</span>

<span class="sd">    The control displays as a button alongside other MapLibre controls. Clicking</span>
<span class="sd">    the button expands a sidebar-style panel that renders the supplied</span>
<span class="sd">    ipywidget content.</span>

<span class="sd">    Args:</span>
<span class="sd">        widget: The ipywidget instance to embed inside the collapsible panel.</span>
<span class="sd">        label: Title shown at the top of the expanded panel.</span>
<span class="sd">        icon: Text or icon hint shown on the toggle button. Defaults to a vertical ellipsis.</span>
<span class="sd">        position: Map control corner (``&#39;top-left&#39;``, ``&#39;top-right&#39;``,</span>
<span class="sd">            ``&#39;bottom-left&#39;``, or ``&#39;bottom-right&#39;``).</span>
<span class="sd">        collapsed: Whether the panel starts collapsed.</span>
<span class="sd">        panel_width: Default panel width in pixels.</span>
<span class="sd">        panel_min_width: Minimum panel width in pixels when resized on the front-end.</span>
<span class="sd">        panel_max_width: Maximum panel width in pixels when resized on the front-end.</span>
<span class="sd">        panel_max_height: Maximum panel height. Can be an int (pixels) or a CSS string (e.g., &#39;70vh&#39;, &#39;500px&#39;).</span>
<span class="sd">            Defaults to None, which uses the JavaScript default of &#39;70vh&#39;.</span>
<span class="sd">        auto_panel_width: Whether the panel width should be automatically adjusted to the content width. Defaults to False.</span>
<span class="sd">        header_bg: The background color of the header, like &quot;linear-gradient(135deg,#444,#888)&quot;. Defaults to None.</span>
<span class="sd">        header_text_color: The text color of the header, like &quot;#fff&quot;. Defaults to None.</span>
<span class="sd">        control_id: Optional identifier used for duplicate detection and later removal.</span>
<span class="sd">            If omitted, a unique identifier is generated from the label.</span>
<span class="sd">        description: Optional tooltip description for the toggle button.</span>
<span class="sd">    Returns:</span>
<span class="sd">        str: The unique identifier assigned to the widget control.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: If ``widget`` is not an ipywidget instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;widget must be an ipywidgets.Widget instance&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">control_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">base_slug</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">char</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;-&quot;</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">label</span>
        <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_slug</span><span class="p">:</span>
            <span class="n">base_slug</span> <span class="o">=</span> <span class="s2">&quot;widget&quot;</span>
        <span class="n">control_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_slug</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Ensure uniqueness when callers supply their own identifier</span>
    <span class="k">if</span> <span class="n">control_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_widget_control_widgets</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Widget control &#39;</span><span class="si">{</span><span class="n">control_id</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span><span class="p">)</span>

    <span class="n">widget_id</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="s2">&quot;model_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">widget_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The supplied widget does not have a model_id. Ensure it is an ipywidget &quot;</span>
            <span class="s2">&quot;instance created within the current notebook session.&quot;</span>
        <span class="p">)</span>

    <span class="n">control_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">label</span><span class="p">,</span>
        <span class="s2">&quot;icon&quot;</span><span class="p">:</span> <span class="n">icon</span><span class="p">,</span>
        <span class="s2">&quot;collapsed&quot;</span><span class="p">:</span> <span class="n">collapsed</span><span class="p">,</span>
        <span class="s2">&quot;panelWidth&quot;</span><span class="p">:</span> <span class="n">panel_width</span><span class="p">,</span>
        <span class="s2">&quot;panelMinWidth&quot;</span><span class="p">:</span> <span class="n">panel_min_width</span><span class="p">,</span>
        <span class="s2">&quot;panelMaxWidth&quot;</span><span class="p">:</span> <span class="n">panel_max_width</span><span class="p">,</span>
        <span class="s2">&quot;autoWidth&quot;</span><span class="p">:</span> <span class="n">auto_panel_width</span><span class="p">,</span>
        <span class="s2">&quot;headerBg&quot;</span><span class="p">:</span> <span class="n">header_bg</span><span class="p">,</span>
        <span class="s2">&quot;headerTextColor&quot;</span><span class="p">:</span> <span class="n">header_text_color</span><span class="p">,</span>
        <span class="s2">&quot;control_id&quot;</span><span class="p">:</span> <span class="n">control_id</span><span class="p">,</span>
        <span class="s2">&quot;widget_model_id&quot;</span><span class="p">:</span> <span class="n">widget_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">panel_max_height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;maxHeight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">panel_max_height</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">panel_max_height</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">panel_max_height</span><span class="si">}</span><span class="s2">px&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">description</span><span class="p">:</span>
        <span class="n">control_options</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span>

    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;widget_panel_</span><span class="si">{</span><span class="n">control_id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;widget_panel&quot;</span><span class="p">,</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">control_options</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_widget_control_widgets</span><span class="p">[</span><span class="n">control_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">widget</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;addControl&quot;</span><span class="p">,</span> <span class="s2">&quot;widget_panel&quot;</span><span class="p">,</span> <span class="n">control_options</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">control_id</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.clear_deckgl_layers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">clear_deckgl_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.clear_deckgl_layers" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Remove all DeckGL layers from the map.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clear_deckgl_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove all DeckGL layers from the map.&quot;&quot;&quot;</span>
    <span class="c1"># Clear local state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Send to JavaScript</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;clearDeckGLLayers&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.clear_draw_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">clear_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.clear_draw_data" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Clear all drawn features from the draw control.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clear_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear all drawn features from the draw control.&quot;&quot;&quot;</span>
    <span class="c1"># Clear the trait data immediately</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_draw_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="c1"># Clear in JavaScript</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;clearDrawData&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.clear_geoman_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">clear_geoman_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.clear_geoman_data" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Clear all Geoman-managed features.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clear_geoman_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear all Geoman-managed features.&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">set_geoman_data</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]})</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.clear_terra_draw_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">clear_terra_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.clear_terra_draw_data" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Clear all Terra Draw features from the draw control.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clear_terra_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear all Terra Draw features from the draw control.&quot;&quot;&quot;</span>
    <span class="c1"># Clear the trait data immediately</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_terra_draw_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="c1"># Clear in JavaScript</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;clearTerraDrawData&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.collapse_geoman_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">collapse_geoman_control</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.collapse_geoman_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Collapse the Geoman draw control toolbar.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">collapse_geoman_control</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collapse the Geoman draw control toolbar.&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;collapseGeomanControl&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.create_container" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sidebar_visible</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">expanded</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.create_container" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Creates a container widget for the map with an optional sidebar.</p>
<p>This method initializes a <code>LayerManagerWidget</code> and a <code>Container</code> widget to display the map
alongside a sidebar. The sidebar can be customized with visibility, width, and additional content.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>sidebar_visible</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the sidebar is visible. Defaults to False.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>min_width</code></td>
        <td><code>int</code></td>
        <td><p>Minimum width of the sidebar in pixels. Defaults to 360.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>max_width</code></td>
        <td><code>int</code></td>
        <td><p>Maximum width of the sidebar in pixels. Defaults to 360.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>expanded</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the <code>LayerManagerWidget</code> is expanded by default. Defaults to True.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional keyword arguments passed to the <code>Container</code> widget.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Container</code></td>
      <td><p>The created container widget with the map and sidebar.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_container</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">sidebar_visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">expanded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a container widget for the map with an optional sidebar.</span>

<span class="sd">    This method initializes a `LayerManagerWidget` and a `Container` widget to display the map</span>
<span class="sd">    alongside a sidebar. The sidebar can be customized with visibility, width, and additional content.</span>

<span class="sd">    Args:</span>
<span class="sd">        sidebar_visible (bool): Whether the sidebar is visible. Defaults to False.</span>
<span class="sd">        min_width (int): Minimum width of the sidebar in pixels. Defaults to 360.</span>
<span class="sd">        max_width (int): Maximum width of the sidebar in pixels. Defaults to 360.</span>
<span class="sd">        expanded (bool): Whether the `LayerManagerWidget` is expanded by default. Defaults to True.</span>
<span class="sd">        **kwargs (Any): Additional keyword arguments passed to the `Container` widget.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Container: The created container widget with the map and sidebar.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">sidebar_visible</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sidebar_visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sidebar_visible&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">min_width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">min_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;min_width&quot;</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_width&quot;</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">expanded</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">expanded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;expanded&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span> <span class="o">=</span> <span class="n">LayerManagerWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expanded</span><span class="o">=</span><span class="n">expanded</span><span class="p">)</span>

    <span class="n">container</span> <span class="o">=</span> <span class="n">Container</span><span class="p">(</span>
        <span class="n">host_map</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">sidebar_visible</span><span class="o">=</span><span class="n">sidebar_visible</span><span class="p">,</span>
        <span class="n">min_width</span><span class="o">=</span><span class="n">min_width</span><span class="p">,</span>
        <span class="n">max_width</span><span class="o">=</span><span class="n">max_width</span><span class="p">,</span>
        <span class="n">sidebar_content</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span><span class="p">],</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="n">container</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">sidebar_widgets</span><span class="p">[</span><span class="s2">&quot;Layers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_manager</span>
    <span class="k">return</span> <span class="n">container</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.deactivate_geoman_button" class="doc doc-heading">
<code class="highlight language-python"><span class="n">deactivate_geoman_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.deactivate_geoman_button" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Programmatically deactivate a Geoman toolbar button by name.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>Button name or a unique substring of its label/title (case-insensitive).</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">deactivate_geoman_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Programmatically deactivate a Geoman toolbar button by name.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Button name or a unique substring of its label/title (case-insensitive).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;deactivateGeomanButton&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.delete_draw_features" class="doc doc-heading">
<code class="highlight language-python"><span class="n">delete_draw_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_ids</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.delete_draw_features" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Delete specific features from the draw control.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>feature_ids</code></td>
        <td><code>List[str]</code></td>
        <td><p>List of feature IDs to delete</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_draw_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete specific features from the draw control.</span>

<span class="sd">    Args:</span>
<span class="sd">        feature_ids: List of feature IDs to delete</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;deleteDrawFeatures&quot;</span><span class="p">,</span> <span class="n">feature_ids</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.disable_feature_popup" class="doc doc-heading">
<code class="highlight language-python"><span class="n">disable_feature_popup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.disable_feature_popup" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Disable attribute popups for the specified layer.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Identifier of the target layer.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">disable_feature_popup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Disable attribute popups for the specified layer.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Identifier of the target layer.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;disableFeaturePopup&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;layerId&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">})</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.disable_geoman_split_mode" class="doc doc-heading">
<code class="highlight language-python"><span class="n">disable_geoman_split_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.disable_geoman_split_mode" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Disable free split mode.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">disable_geoman_split_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Disable free split mode.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_split_mode_enabled</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.disable_geoman_union_mode" class="doc doc-heading">
<code class="highlight language-python"><span class="n">disable_geoman_union_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.disable_geoman_union_mode" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Disable the simple 'union mode' and unregister the click handler.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">disable_geoman_union_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Disable the simple &#39;union mode&#39; and unregister the click handler.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_union_click_callback&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">off_interaction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_union_click_callback</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;click&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_union_mode_enabled</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_union_selected_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_union_expected_geom_type</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;clearUnionSelection&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.enable_feature_popup" class="doc doc-heading">
<code class="highlight language-python"><span class="n">enable_feature_popup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title_field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_properties</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">close_button</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="s1">&#39;320px&#39;</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.enable_feature_popup" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Enable attribute popups for a layer when users click its features.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Identifier of the target layer.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>fields</code></td>
        <td><code>Union[Sequence[str], Dict[str, str]]</code></td>
        <td><p>Optional ordered list of attribute keys to display. When omitted,
up to <code>max_properties</code> properties are shown.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>aliases</code></td>
        <td><code>Optional[Dict[str, str]]</code></td>
        <td><p>Optional mapping from attribute key to display label. Only applies
when <code>fields</code> is provided.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>title</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional static string rendered above the attribute table.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>title_field</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional property key whose value should be used as the popup
title. Ignored when <code>title</code> is provided.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>max_properties</code></td>
        <td><code>int</code></td>
        <td><p>Maximum number of properties displayed when <code>fields</code> is
not supplied. Defaults to 25.</p></td>
        <td><code>25</code></td>
      </tr>
      <tr>
        <td><code>close_button</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the popup shows a close button. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>max_width</code></td>
        <td><code>str</code></td>
        <td><p>CSS max-width applied to the popup container. Defaults to 320px.</p></td>
        <td><code>&#39;320px&#39;</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">enable_feature_popup</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">aliases</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">title_field</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_properties</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">close_button</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">max_width</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;320px&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enable attribute popups for a layer when users click its features.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Identifier of the target layer.</span>
<span class="sd">        fields: Optional ordered list of attribute keys to display. When omitted,</span>
<span class="sd">            up to ``max_properties`` properties are shown.</span>
<span class="sd">        aliases: Optional mapping from attribute key to display label. Only applies</span>
<span class="sd">            when ``fields`` is provided.</span>
<span class="sd">        title: Optional static string rendered above the attribute table.</span>
<span class="sd">        title_field: Optional property key whose value should be used as the popup</span>
<span class="sd">            title. Ignored when ``title`` is provided.</span>
<span class="sd">        max_properties: Maximum number of properties displayed when ``fields`` is</span>
<span class="sd">            not supplied. Defaults to 25.</span>
<span class="sd">        close_button: Whether the popup shows a close button. Defaults to True.</span>
<span class="sd">        max_width: CSS max-width applied to the popup container. Defaults to 320px.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">alias_lookup</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">aliases</span> <span class="ow">or</span> <span class="p">{}</span>

    <span class="n">field_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">field_config</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)}</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">field_config</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">field_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">label_source</span> <span class="o">=</span> <span class="n">alias_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">alias_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">field_config</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">field_name</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">label_source</span><span class="p">)}</span>
                <span class="p">)</span>

    <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;layerId&quot;</span><span class="p">:</span> <span class="n">layer_id</span><span class="p">,</span>
        <span class="s2">&quot;maxProperties&quot;</span><span class="p">:</span> <span class="n">max_properties</span><span class="p">,</span>
        <span class="s2">&quot;closeButton&quot;</span><span class="p">:</span> <span class="n">close_button</span><span class="p">,</span>
        <span class="s2">&quot;maxWidth&quot;</span><span class="p">:</span> <span class="n">max_width</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">field_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_config</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span>
    <span class="k">if</span> <span class="n">title_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;titleField&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title_field</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;enableFeaturePopup&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.enable_geoman_split_mode" class="doc doc-heading">
<code class="highlight language-python"><span class="n">enable_geoman_split_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.enable_geoman_split_mode" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Enable free split mode.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">enable_geoman_split_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enable free split mode.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_GEOPANDAS</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;GeoPandas is required for split mode.&quot;</span><span class="p">)</span>
    <span class="c1"># Turning on split mode; union off to avoid conflicts</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disable_geoman_union_mode</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_split_mode_enabled</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.enable_geoman_union_mode" class="doc doc-heading">
<code class="highlight language-python"><span class="n">enable_geoman_union_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance_tolerance</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.enable_geoman_union_mode" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Enable a simple 'union mode' without Geoman Pro that works for polygons and lines.</p>
<div class="admonition behavior">
<p class="admonition-title">Behavior</p>
<ul>
<li>On each map click, finds the first Geoman polygon under the click.</li>
<li>For lines, selects the closest line within distance_tolerance degrees.</li>
<li>When two features of the same type have been clicked, merges them into a single feature,
  removes the originals, and adds the merged polygon back.</li>
</ul>
</div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>distance_tolerance</code></td>
        <td><code>float</code></td>
        <td><p>Max angular distance (degrees) to consider a line selected
                when clicking near it. Default ~1e-4 (~11 m at equator).</p></td>
        <td><code>0.0001</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">enable_geoman_union_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance_tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enable a simple &#39;union mode&#39; without Geoman Pro that works for polygons and lines.</span>

<span class="sd">    Behavior:</span>
<span class="sd">        - On each map click, finds the first Geoman polygon under the click.</span>
<span class="sd">        - For lines, selects the closest line within distance_tolerance degrees.</span>
<span class="sd">        - When two features of the same type have been clicked, merges them into a single feature,</span>
<span class="sd">          removes the originals, and adds the merged polygon back.</span>
<span class="sd">    Args:</span>
<span class="sd">        distance_tolerance: Max angular distance (degrees) to consider a line selected</span>
<span class="sd">                            when clicking near it. Default ~1e-4 (~11 m at equator).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_GEOPANDAS</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;GeoPandas is required for union mode.&quot;</span><span class="p">)</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>  <span class="c1"># type: ignore</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">Point</span>  <span class="c1"># type: ignore</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_union_mode_enabled</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_union_selected_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_union_expected_geom_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_union_distance_tolerance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">distance_tolerance</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_union_click_handler</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;click&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_union_mode_enabled</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;coordinates&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">coords</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">lng</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">coords</span>  <span class="c1"># coordinates are [lng, lat]</span>

        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">features</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">gdf</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="n">pt</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">lng</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
        <span class="c1"># Prefer polygon hit-testing first</span>
        <span class="n">cand</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">geom_type</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;Polygon&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiPolygon&quot;</span><span class="p">])]</span>
        <span class="n">poly_mask</span> <span class="o">=</span> <span class="n">cand</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span> <span class="o">|</span> <span class="n">cand</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
        <span class="n">cand</span> <span class="o">=</span> <span class="n">cand</span><span class="p">[</span><span class="n">poly_mask</span><span class="p">]</span>
        <span class="n">selected_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">selected_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cand</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">selected_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cand</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">selected_type</span> <span class="o">=</span> <span class="s2">&quot;polygon&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># For lines, pick the nearest within tolerance</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span>
                <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">geom_type</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;LineString&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiLineString&quot;</span><span class="p">])</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">lines</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="c1"># Compute distance to point; choose min</span>
                <span class="n">distances</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
                <span class="n">min_dist</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">distances</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">min_dist</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_union_distance_tolerance</span><span class="p">:</span>
                    <span class="n">selected_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">distances</span><span class="o">.</span><span class="n">idxmin</span><span class="p">())</span>
                    <span class="n">selected_type</span> <span class="o">=</span> <span class="s2">&quot;line&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="c1"># Respect expected type: first selection sets it, subsequent must match</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_union_expected_geom_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_union_expected_geom_type</span> <span class="o">=</span> <span class="n">selected_type</span>
        <span class="k">elif</span> <span class="n">selected_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_union_expected_geom_type</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="n">selected_idx</span>
        <span class="n">fid</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
        <span class="k">if</span> <span class="n">fid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_union_selected_ids</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_union_selected_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
        <span class="c1"># Update visual highlight</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setUnionSelection&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_union_selected_ids</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_union_selected_ids</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_union_geoman_features_by_ids</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_union_selected_ids</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_union_selected_ids</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_union_expected_geom_type</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;clearUnionSelection&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>

    <span class="c1"># Store and register the interaction handler</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_union_click_callback</span> <span class="o">=</span> <span class="n">_union_click_handler</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">on_interaction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_union_click_callback</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;click&quot;</span><span class="p">])</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.expand_geoman_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">expand_geoman_control</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.expand_geoman_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Expand the Geoman draw control toolbar.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_geoman_control</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Expand the Geoman draw control toolbar.&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;expandGeomanControl&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.find_first_symbol_layer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">find_first_symbol_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.find_first_symbol_layer" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Find the first symbol layer in the map's current style.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[Dict]</code></td>
      <td><p>The first symbol layer as a dictionary if found, otherwise None.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_first_symbol_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the first symbol layer in the map&#39;s current style.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[Dict]: The first symbol layer as a dictionary if found, otherwise None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">layers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_style_layers</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;symbol&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">layer</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.find_style_layer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">find_style_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.find_style_layer" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Searches for a style layer in the map's current style by its ID and returns it if found.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>id</code></td>
        <td><code>str</code></td>
        <td><p>The ID of the style layer to find.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[Dict]</code></td>
      <td><p>The style layer as a dictionary if found, otherwise None.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_style_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Searches for a style layer in the map&#39;s current style by its ID and returns it if found.</span>

<span class="sd">    Args:</span>
<span class="sd">        id (str): The ID of the style layer to find.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[Dict]: The style layer as a dictionary if found, otherwise None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">layers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_style_layers</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">layer</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.fit_bounds" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fit_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.fit_bounds" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Fit the map to given bounds.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>bounds</code></td>
        <td><code>List[List[float]]</code></td>
        <td><p>Bounding box as [[south, west], [north, east]].</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>padding</code></td>
        <td><code>int</code></td>
        <td><p>Padding around the bounds in pixels.</p></td>
        <td><code>50</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bounds</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span> <span class="n">padding</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit the map to given bounds.</span>

<span class="sd">    Args:</span>
<span class="sd">        bounds: Bounding box as [[south, west], [north, east]].</span>
<span class="sd">        padding: Padding around the bounds in pixels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;fitBounds&quot;</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;padding&quot;</span><span class="p">:</span> <span class="n">padding</span><span class="p">})</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.fly_to_three_tileset" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fly_to_three_tileset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tileset_id</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.fly_to_three_tileset" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Animate the camera to frame a 3D Tiles dataset.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fly_to_three_tileset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tileset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Animate the camera to frame a 3D Tiles dataset.&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;flyToThreeTileset&quot;</span><span class="p">,</span> <span class="n">tileset_id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.get_cog_metadata" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_cog_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.get_cog_metadata" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Retrieve metadata from a Cloud Optimized GeoTIFF (COG) file.</p>
<p>This method fetches metadata from a COG file. It uses rasterio if available,
which provides comprehensive metadata extraction capabilities.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature corresponds to the getCogMetadata function in maplibre-cog-protocol,
which is marked as [unstable]. Some metadata internals may change in future releases.</p>
</div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>url</code></td>
        <td><code>str</code></td>
        <td><p>The URL of the COG file to retrieve metadata from.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>crs</code></td>
        <td><code>str</code></td>
        <td><p>The coordinate reference system to use for the output bbox.
Defaults to "EPSG:4326" (WGS84 lat/lon). Set to None to use the COG's native CRS.</p></td>
        <td><code>&#39;EPSG:4326&#39;</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[Dict[str, Any]]</code></td>
      <td><p>A dictionary containing COG metadata with keys such as:
    - bbox: Bounding box coordinates [west, south, east, north] in the specified CRS
    - bounds: BoundingBox in native CRS
    - width: Width of the raster in pixels
    - height: Height of the raster in pixels
    - crs: Original coordinate reference system of the COG
    - output_crs: CRS of the returned bbox
    - transform: Affine transformation matrix
    - count: Number of bands
    - dtypes: Data types for each band
    - nodata: NoData value
    - scale: Scale value (if available)
    - offset: Offset value (if available)
Returns None if metadata retrieval fails.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">MapLibreMap</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://example.com/data.tif&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Get metadata with bbox in WGS84 (default)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_cog_metadata</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
<span class="o">...</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bounding box (WGS84): </span><span class="si">{</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bbox&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="o">...</span>     <span class="c1"># Fit bounds using WGS84 coordinates</span>
<span class="o">...</span>     <span class="n">bbox</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;bbox&#39;</span><span class="p">]</span>
<span class="o">...</span>     <span class="n">m</span><span class="o">.</span><span class="n">fit_bounds</span><span class="p">([[</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]]])</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Get metadata in native CRS</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_cog_metadata</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
<span class="o">...</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Native CRS: </span><span class="si">{</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;crs&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_cog_metadata</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EPSG:4326&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve metadata from a Cloud Optimized GeoTIFF (COG) file.</span>

<span class="sd">    This method fetches metadata from a COG file. It uses rasterio if available,</span>
<span class="sd">    which provides comprehensive metadata extraction capabilities.</span>

<span class="sd">    Note:</span>
<span class="sd">        This feature corresponds to the getCogMetadata function in maplibre-cog-protocol,</span>
<span class="sd">        which is marked as [unstable]. Some metadata internals may change in future releases.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str): The URL of the COG file to retrieve metadata from.</span>
<span class="sd">        crs (str, optional): The coordinate reference system to use for the output bbox.</span>
<span class="sd">            Defaults to &quot;EPSG:4326&quot; (WGS84 lat/lon). Set to None to use the COG&#39;s native CRS.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[Dict[str, Any]]: A dictionary containing COG metadata with keys such as:</span>
<span class="sd">            - bbox: Bounding box coordinates [west, south, east, north] in the specified CRS</span>
<span class="sd">            - bounds: BoundingBox in native CRS</span>
<span class="sd">            - width: Width of the raster in pixels</span>
<span class="sd">            - height: Height of the raster in pixels</span>
<span class="sd">            - crs: Original coordinate reference system of the COG</span>
<span class="sd">            - output_crs: CRS of the returned bbox</span>
<span class="sd">            - transform: Affine transformation matrix</span>
<span class="sd">            - count: Number of bands</span>
<span class="sd">            - dtypes: Data types for each band</span>
<span class="sd">            - nodata: NoData value</span>
<span class="sd">            - scale: Scale value (if available)</span>
<span class="sd">            - offset: Offset value (if available)</span>
<span class="sd">        Returns None if metadata retrieval fails.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; m = MapLibreMap()</span>
<span class="sd">        &gt;&gt;&gt; url = &quot;https://example.com/data.tif&quot;</span>
<span class="sd">        &gt;&gt;&gt; # Get metadata with bbox in WGS84 (default)</span>
<span class="sd">        &gt;&gt;&gt; metadata = m.get_cog_metadata(url)</span>
<span class="sd">        &gt;&gt;&gt; if metadata:</span>
<span class="sd">        ...     print(f&quot;Bounding box (WGS84): {metadata.get(&#39;bbox&#39;)}&quot;)</span>
<span class="sd">        ...     # Fit bounds using WGS84 coordinates</span>
<span class="sd">        ...     bbox = metadata[&#39;bbox&#39;]</span>
<span class="sd">        ...     m.fit_bounds([[bbox[0], bbox[1]], [bbox[2], bbox[3]]])</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Get metadata in native CRS</span>
<span class="sd">        &gt;&gt;&gt; metadata = m.get_cog_metadata(url, crs=None)</span>
<span class="sd">        &gt;&gt;&gt; if metadata:</span>
<span class="sd">        ...     print(f&quot;Native CRS: {metadata.get(&#39;crs&#39;)}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_cog_metadata</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.get_deckgl_layers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_deckgl_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.get_deckgl_layers" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get all DeckGL layers currently on the map.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, Dict[str, Any]]</code></td>
      <td><p>Dictionary mapping layer IDs to their configurations.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_deckgl_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all DeckGL layers currently on the map.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary mapping layer IDs to their configurations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.get_draw_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.get_draw_data" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get all drawn features as GeoJSON.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, Any]</code></td>
      <td><p>Dict containing GeoJSON FeatureCollection with drawn features</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all drawn features as GeoJSON.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict containing GeoJSON FeatureCollection with drawn features</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Try to get current data first</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_data</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_data</span>

    <span class="c1"># If no data in trait, call JavaScript to get fresh data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;getDrawData&quot;</span><span class="p">)</span>
    <span class="c1"># Give JavaScript time to execute and sync data</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="c1"># Return the synced data or empty FeatureCollection if nothing</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_data</span>
        <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.get_geoman_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_geoman_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.get_geoman_data" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Return the current Geoman feature collection.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, Any]</code></td>
      <td><p>A GeoJSON FeatureCollection containing all Geoman-managed features.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_geoman_data</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the current Geoman feature collection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A GeoJSON FeatureCollection containing all Geoman-managed features.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.get_geoman_data_as_gdf" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_geoman_data_as_gdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.get_geoman_data_as_gdf" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Return the current Geoman feature collection as a GeoDataFrame.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>crs</code></td>
        <td><code>str</code></td>
        <td><p>The CRS of the GeoDataFrame. Defaults to "EPSG:4326".</p></td>
        <td><code>&#39;EPSG:4326&#39;</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>GeoDataFrame</code></td>
      <td><p>A GeoDataFrame containing the current Geoman feature collection.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_geoman_data_as_gdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the current Geoman feature collection as a GeoDataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        crs: The CRS of the GeoDataFrame. Defaults to &quot;EPSG:4326&quot;.</span>
<span class="sd">    Returns:</span>
<span class="sd">        A GeoDataFrame containing the current Geoman feature collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.get_geoman_status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_geoman_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.get_geoman_status" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the current Geoman toolbar status synced from the frontend.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, Any]</code></td>
      <td><p>Status including keys like 'activeButtons', 'isCollapsed', 'globalEditMode'.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_geoman_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the current Geoman toolbar status synced from the frontend.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict[str, Any]: Status including keys like &#39;activeButtons&#39;, &#39;isCollapsed&#39;, &#39;globalEditMode&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geoman_status</span> <span class="ow">or</span> <span class="p">{})</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.get_layer_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_layer_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.get_layer_type" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the type of a layer.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier of the layer.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[str]</code></td>
      <td><p>Layer type string, or None if layer doesn't exist.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_layer_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the type of a layer.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Unique identifier of the layer.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Layer type string, or None if layer doesn&#39;t exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.get_style" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_style</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.get_style" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the style of the map.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict</code></td>
      <td><p>The style of the map.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_style</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the style of the map.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict: The style of the map.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">style</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">style</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="n">style</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.get_style_layers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_style_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">sorted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.get_style_layers" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the names of the basemap layers.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[str]</code></td>
      <td><p>The names of the basemap layers.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_style_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">sorted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the names of the basemap layers.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: The names of the basemap layers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_style</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;layers&quot;</span> <span class="ow">in</span> <span class="n">style</span><span class="p">:</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="n">style</span><span class="p">[</span><span class="s2">&quot;layers&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">return_ids</span><span class="p">:</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">sorted</span><span class="p">:</span>
                <span class="n">ids</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">ids</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">layers</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.get_terra_draw_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_terra_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.get_terra_draw_data" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get all Terra Draw features as GeoJSON.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, Any]</code></td>
      <td><p>Dict containing GeoJSON FeatureCollection with drawn features</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_terra_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all Terra Draw features as GeoJSON.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict containing GeoJSON FeatureCollection with drawn features</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Try to get current data first</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terra_draw_data</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terra_draw_data</span>

    <span class="c1"># If no data in trait, call JavaScript to get fresh data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;getTerraDrawData&quot;</span><span class="p">)</span>
    <span class="c1"># Give JavaScript time to execute and sync data</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="c1"># Return the synced data or empty FeatureCollection if nothing</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_terra_draw_data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terra_draw_data</span>
        <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.init_three_scene" class="doc doc-heading">
<code class="highlight language-python"><span class="n">init_three_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.init_three_scene" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Initialize the MapLibre Three.js scene.</p>
<p>This must be called before adding any 3D models or lights.
It initializes the MapScene object that connects MapLibre GL JS with Three.js.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">MapLibreMap</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">148.9819</span><span class="p">,</span> <span class="o">-</span><span class="mf">35.3981</span><span class="p">],</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">pitch</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">init_three_scene</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">add_three_light</span><span class="p">(</span><span class="n">light_type</span><span class="o">=</span><span class="s1">&#39;ambient&#39;</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_three_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the MapLibre Three.js scene.</span>

<span class="sd">    This must be called before adding any 3D models or lights.</span>
<span class="sd">    It initializes the MapScene object that connects MapLibre GL JS with Three.js.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; m = MapLibreMap(center=[148.9819, -35.3981], zoom=18, pitch=60)</span>
<span class="sd">        &gt;&gt;&gt; m.init_three_scene()</span>
<span class="sd">        &gt;&gt;&gt; m.add_three_light(light_type=&#39;ambient&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;initMapScene&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.load_draw_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geojson_data</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.load_draw_data" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Load GeoJSON data into the draw control.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>geojson_data</code></td>
        <td><code>Union[Dict[str, Any], str]</code></td>
        <td><p>GeoJSON data as dictionary or JSON string</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geojson_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load GeoJSON data into the draw control.</span>

<span class="sd">    Args:</span>
<span class="sd">        geojson_data: GeoJSON data as dictionary or JSON string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geojson_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">geojson_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">geojson_data</span><span class="p">)</span>

    <span class="c1"># Update the trait immediately to ensure consistency</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_draw_data</span> <span class="o">=</span> <span class="n">geojson_data</span>

    <span class="c1"># Send to JavaScript</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;loadDrawData&quot;</span><span class="p">,</span> <span class="n">geojson_data</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.load_osm_transport_to_geoman" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_osm_transport_to_geoman</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.load_osm_transport_to_geoman" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Search OSM transportation data (node, way, relation) within a bbox and import
the results into the Geoman control for editing.</p>
<p>This triggers a frontend Overpass API query and <strong>replaces</strong> the current Geoman
editable features with the fetched GeoJSON. <strong>This is a destructive operation:</strong>
any existing editable features will be permanently removed and replaced.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is currently no way to append features; this method always replaces
all existing Geoman editable features. If you wish to preserve your current
work, please save or export it before calling this method.</p>
</div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>bbox</code></td>
        <td><code>Optional[List[float]]</code></td>
        <td><p>Optional [west, south, east, north] (WGS84). If None, uses map bounds.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>keys</code></td>
        <td><code>Optional[List[str]]</code></td>
        <td><p>Optional list of OSM keys to include, default ['highway', 'railway'].</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>timeout</code></td>
        <td><code>int</code></td>
        <td><p>Overpass API timeout in seconds (default 25).</p></td>
        <td><code>25</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_osm_transport_to_geoman</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bbox</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">keys</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search OSM transportation data (node, way, relation) within a bbox and import</span>
<span class="sd">    the results into the Geoman control for editing.</span>

<span class="sd">    This triggers a frontend Overpass API query and **replaces** the current Geoman</span>
<span class="sd">    editable features with the fetched GeoJSON. **This is a destructive operation:**</span>
<span class="sd">    any existing editable features will be permanently removed and replaced.</span>

<span class="sd">    Note:</span>
<span class="sd">        There is currently no way to append features; this method always replaces</span>
<span class="sd">        all existing Geoman editable features. If you wish to preserve your current</span>
<span class="sd">        work, please save or export it before calling this method.</span>
<span class="sd">    Args:</span>
<span class="sd">        bbox: Optional [west, south, east, north] (WGS84). If None, uses map bounds.</span>
<span class="sd">        keys: Optional list of OSM keys to include, default [&#39;highway&#39;, &#39;railway&#39;].</span>
<span class="sd">        timeout: Overpass API timeout in seconds (default 25).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">bbox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;bbox must be [west, south, east, north].&quot;</span><span class="p">)</span>
        <span class="n">options</span><span class="p">[</span><span class="s2">&quot;bbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s2">&quot;keys&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s2">&quot;timeout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;loadOsmTransportToGeoman&quot;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.load_terra_draw_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_terra_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geojson_data</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.load_terra_draw_data" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Load GeoJSON data into the Terra Draw control.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>geojson_data</code></td>
        <td><code>Union[Dict[str, Any], str]</code></td>
        <td><p>GeoJSON data as dictionary or JSON string</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_terra_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geojson_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load GeoJSON data into the Terra Draw control.</span>

<span class="sd">    Args:</span>
<span class="sd">        geojson_data: GeoJSON data as dictionary or JSON string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geojson_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">geojson_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">geojson_data</span><span class="p">)</span>

    <span class="c1"># Update the trait immediately to ensure consistency</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_terra_draw_data</span> <span class="o">=</span> <span class="n">geojson_data</span>

    <span class="c1"># Send to JavaScript</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;loadTerraDrawData&quot;</span><span class="p">,</span> <span class="n">geojson_data</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.off_interaction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">off_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.off_interaction" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Unregister a previously registered interaction callback.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>callback</code></td>
        <td><code>Callable[..., NoneType]</code></td>
        <td><p>The callback originally passed to on_interaction.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>types</code></td>
        <td><code>Optional[List[str]]</code></td>
        <td><p>Optional list of event types to stop observing. If None, all types for this callback are removed.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">off_interaction</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="n">types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unregister a previously registered interaction callback.</span>

<span class="sd">    Args:</span>
<span class="sd">        callback: The callback originally passed to on_interaction.</span>
<span class="sd">        types: Optional list of event types to stop observing. If None, all types for this callback are removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_interaction_wrappers&quot;</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="n">wrapper_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_wrappers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">wrapper_map</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">target_types</span> <span class="o">=</span> <span class="n">types</span> <span class="k">if</span> <span class="n">types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">wrapper_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">etype</span> <span class="ow">in</span> <span class="n">target_types</span><span class="p">:</span>
        <span class="n">wrapper</span> <span class="o">=</span> <span class="n">wrapper_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">etype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wrapper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">off_map_event</span><span class="p">(</span><span class="n">etype</span><span class="p">,</span> <span class="n">wrapper</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">wrapper_map</span><span class="p">[</span><span class="n">etype</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">wrapper_map</span><span class="p">:</span>
        <span class="c1"># Remove the callback entry entirely when no wrappers remain</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_wrappers</span><span class="p">[</span><span class="n">callback</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.on_interaction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">on_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.on_interaction" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Register a unified interaction callback similar to ipyleaflet's on_interaction.</p>
<p>The callback will be invoked with keyword arguments like:
    - event: 'interaction'
    - type: event type (e.g., 'mousemove', 'mousedown', 'mouseup', 'click', 'dblclick', 'contextmenu')
    - coordinates: [lng, lat] when available</p>

<p><strong>Examples:</strong></p>
    <p>def handle_map_interaction(**kwargs):
    print(kwargs)</p>
<p>m.on_interaction(handle_map_interaction)</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>callback</code></td>
        <td><code>Callable[..., NoneType]</code></td>
        <td><p>Function that accepts **kwargs for interaction events.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>types</code></td>
        <td><code>Optional[List[str]]</code></td>
        <td><p>Optional list of event types to subscribe to. If None, subscribes
   to common pointer events.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">on_interaction</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="n">types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register a unified interaction callback similar to ipyleaflet&#39;s on_interaction.</span>

<span class="sd">    The callback will be invoked with keyword arguments like:</span>
<span class="sd">        - event: &#39;interaction&#39;</span>
<span class="sd">        - type: event type (e.g., &#39;mousemove&#39;, &#39;mousedown&#39;, &#39;mouseup&#39;, &#39;click&#39;, &#39;dblclick&#39;, &#39;contextmenu&#39;)</span>
<span class="sd">        - coordinates: [lng, lat] when available</span>

<span class="sd">    Example:</span>
<span class="sd">        def handle_map_interaction(**kwargs):</span>
<span class="sd">            print(kwargs)</span>

<span class="sd">        m.on_interaction(handle_map_interaction)</span>

<span class="sd">    Args:</span>
<span class="sd">        callback: Function that accepts **kwargs for interaction events.</span>
<span class="sd">        types: Optional list of event types to subscribe to. If None, subscribes</span>
<span class="sd">               to common pointer events.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_types</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;mousemove&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mousedown&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mouseup&quot;</span><span class="p">,</span>
        <span class="s2">&quot;click&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dblclick&quot;</span><span class="p">,</span>
        <span class="s2">&quot;contextmenu&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">event_types</span> <span class="o">=</span> <span class="n">types</span> <span class="k">if</span> <span class="n">types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">default_types</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_wrapper</span><span class="p">(</span><span class="n">expected_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_wrapper</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">event_type</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">expected_type</span><span class="p">)</span>
            <span class="c1"># Normalize coordinates to [lng, lat] to match MapLibre</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lat&quot;</span><span class="p">)</span>
            <span class="n">lng</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lng&quot;</span><span class="p">)</span>
            <span class="n">coordinates</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lng</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[</span><span class="n">lng</span><span class="p">,</span> <span class="n">lat</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lnglat</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lngLat&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">lnglat</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
                    <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">lnglat</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
                    <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lnglat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
                    <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lnglat</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
                <span class="p">):</span>
                    <span class="c1"># lngLat is already [lng, lat] from JS</span>
                    <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[</span><span class="n">lnglat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lnglat</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

            <span class="n">payload</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;interaction&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">event_type</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">coordinates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coordinates</span>

            <span class="c1"># Prefer kwargs-style callback like ipyleaflet; fallback to single dict</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">callback</span><span class="p">(</span><span class="o">**</span><span class="n">payload</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">callback</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_wrapper</span>

    <span class="c1"># Keep track of wrapper functions to allow unobserve later</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_interaction_wrappers&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_wrappers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span><span class="p">]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">wrapper_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">etype</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
        <span class="n">wrapper</span> <span class="o">=</span> <span class="n">_make_wrapper</span><span class="p">(</span><span class="n">etype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_map_event</span><span class="p">(</span><span class="n">etype</span><span class="p">,</span> <span class="n">wrapper</span><span class="p">)</span>
        <span class="n">wrapper_map</span><span class="p">[</span><span class="n">etype</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrapper</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_wrappers</span><span class="p">[</span><span class="n">callback</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_interaction_wrappers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="p">{}),</span>
        <span class="o">**</span><span class="n">wrapper_map</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.refresh_geoman_status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">refresh_geoman_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.refresh_geoman_status" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Request the frontend to refresh and sync the current Geoman toolbar status.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">refresh_geoman_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Request the frontend to refresh and sync the current Geoman toolbar status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;getGeomanStatus&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.remove_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_type</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-right&#39;</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.remove_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Remove a control from the map.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>control_type</code></td>
        <td><code>str</code></td>
        <td><p>Type of control to remove ('navigation', 'scale', 'fullscreen', 'geolocate', 'attribution', 'globe')</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>position</code></td>
        <td><code>str</code></td>
        <td><p>Position where the control was added ('top-left', 'top-right', 'bottom-left', 'bottom-right')</p></td>
        <td><code>&#39;top-right&#39;</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_control</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">control_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-right&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a control from the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        control_type: Type of control to remove (&#39;navigation&#39;, &#39;scale&#39;, &#39;fullscreen&#39;, &#39;geolocate&#39;, &#39;attribution&#39;, &#39;globe&#39;)</span>
<span class="sd">        position: Position where the control was added (&#39;top-left&#39;, &#39;top-right&#39;, &#39;bottom-left&#39;, &#39;bottom-right&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Remove control from persistent state</span>
    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">control_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">control_key</span> <span class="ow">in</span> <span class="n">current_controls</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeControl&quot;</span><span class="p">,</span> <span class="n">control_type</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.remove_deckgl_layer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_deckgl_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.remove_deckgl_layer" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Remove a DeckGL layer from the map.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier of the DeckGL layer to remove.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_deckgl_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a DeckGL layer from the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Unique identifier of the DeckGL layer to remove.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Remove from local state</span>
    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">:</span>
        <span class="n">current_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">current_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span> <span class="o">=</span> <span class="n">current_layers</span>

    <span class="c1"># Send to JavaScript</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeDeckGLLayer&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.remove_from_sidebar" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_from_sidebar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.remove_from_sidebar" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Removes a widget from the sidebar content.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>widget</code></td>
        <td><code>widgets.Widget</code></td>
        <td><p>The widget to remove from the sidebar.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>The name of the widget to remove from the sidebar.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_from_sidebar</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes a widget from the sidebar content.</span>

<span class="sd">    Args:</span>
<span class="sd">        widget (widgets.Widget): The widget to remove from the sidebar.</span>
<span class="sd">        name (str): The name of the widget to remove from the sidebar.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">remove_from_sidebar</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.remove_geogrid_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_geogrid_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-left&#39;</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.remove_geogrid_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Remove the GeoGrid control from the map.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_geogrid_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove the GeoGrid control from the map.&quot;&quot;&quot;</span>

    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;geogrid_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">control_key</span> <span class="ow">in</span> <span class="n">current_controls</span><span class="p">:</span>
        <span class="n">current_controls</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">control_key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeControl&quot;</span><span class="p">,</span> <span class="s2">&quot;geogrid&quot;</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.remove_geoman_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_geoman_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-left&#39;</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.remove_geoman_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Remove the Geoman control toolbar.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_geoman_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove the Geoman control toolbar.&quot;&quot;&quot;</span>

    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;geoman_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">control_key</span> <span class="ow">in</span> <span class="n">current_controls</span><span class="p">:</span>
        <span class="n">current_controls</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">control_key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;geoman&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeControl&quot;</span><span class="p">,</span> <span class="s2">&quot;geoman&quot;</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.remove_html" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_id</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.remove_html" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Remove an HTML control from the map.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>control_id</code></td>
        <td><code>str</code></td>
        <td><p>The control ID used when adding the HTML control</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_html</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">control_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove an HTML control from the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        control_id: The control ID used when adding the HTML control</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Remove from persistent state</span>
    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;html_</span><span class="si">{</span><span class="n">control_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">control_key</span> <span class="ow">in</span> <span class="n">current_controls</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeHTML&quot;</span><span class="p">,</span> <span class="n">control_key</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.remove_layer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.remove_layer" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Remove a layer from the map.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier for the layer to remove.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a layer from the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Unique identifier for the layer to remove.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if this is a marker group</span>
    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">:</span>
        <span class="n">layer_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">layer_type</span> <span class="o">==</span> <span class="s2">&quot;marker-group&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeMarkerGroup&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>
            <span class="k">return</span>

    <span class="c1"># Remove from JavaScript map</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeLayer&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">)</span>

    <span class="c1"># Remove from local state</span>
    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="p">:</span>
        <span class="n">current_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">current_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span> <span class="o">=</span> <span class="n">current_layers</span>

    <span class="c1"># Remove FlatGeobuf metadata if present</span>
    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatgeobuf_layers</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeFlatGeobufLayer&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">)</span>
        <span class="n">flatgeobuf_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flatgeobuf_layers</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">flatgeobuf_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flatgeobuf_layers</span> <span class="o">=</span> <span class="n">flatgeobuf_layers</span>

    <span class="c1"># Remove from layer_dict</span>
    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">:</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span>

    <span class="c1"># Update layer controls if they exist</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.remove_measures_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_measures_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top-left&#39;</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.remove_measures_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Remove the Measures control.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_measures_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;top-left&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove the Measures control.&quot;&quot;&quot;</span>

    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;measures_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">control_key</span> <span class="ow">in</span> <span class="n">current_controls</span><span class="p">:</span>
        <span class="n">current_controls</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">control_key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;measures&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeControl&quot;</span><span class="p">,</span> <span class="s2">&quot;measures&quot;</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.remove_three_light" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_three_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">light_id</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.remove_three_light" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Remove a Three.js light from the scene.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_three_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">light_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a Three.js light from the scene.&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeThreeLight&quot;</span><span class="p">,</span> <span class="n">light_id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.remove_three_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_three_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_id</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.remove_three_model" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Remove a 3D model from the scene.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>model_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier of the model to remove.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">remove_three_model</span><span class="p">(</span><span class="s1">&#39;my_model&#39;</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_three_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a 3D model from the scene.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_id: Unique identifier of the model to remove.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; m.remove_three_model(&#39;my_model&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeThreeModel&quot;</span><span class="p">,</span> <span class="n">model_id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.remove_three_tileset" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_three_tileset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tileset_id</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.remove_three_tileset" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Remove a 3D Tiles dataset from the scene.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_three_tileset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tileset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a 3D Tiles dataset from the scene.&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeThreeTileset&quot;</span><span class="p">,</span> <span class="n">tileset_id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.remove_widget_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_widget_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_id</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.remove_widget_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Remove a previously registered widget control.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_widget_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a previously registered widget control.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">control_id</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;control_id is required&quot;</span><span class="p">)</span>

    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="n">target_key</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">current_controls</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;widget_panel&quot;</span>
            <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;control_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">control_id</span>
        <span class="p">):</span>
            <span class="n">target_key</span> <span class="o">=</span> <span class="n">key</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="n">target_key</span><span class="p">:</span>
        <span class="n">current_controls</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">target_key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="k">if</span> <span class="n">control_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_widget_control_widgets</span><span class="p">:</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_widget_control_widgets</span><span class="p">[</span><span class="n">control_id</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;removeWidgetControl&quot;</span><span class="p">,</span> <span class="n">control_id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.save_draw_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.save_draw_data" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Save drawn features to a file in various formats.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>filepath</code></td>
        <td><code>str</code></td>
        <td><p>Path where to save the file. The file extension determines
     the output format if driver is not specified.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>driver</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>GeoPandas driver name (e.g., 'GeoJSON', 'ESRI Shapefile', 'GPKG').
   If None, inferred from file extension.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ImportError</code></td>
        <td><p>If geopandas is not installed.</p></td>
      </tr>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If no drawn features exist or invalid driver/format.</p></td>
      </tr>
  </tbody>
</table>      <div class="admonition note">
<p class="admonition-title">Note</p>
<p>For shapefiles, all features must have the same geometry type.
Use GeoJSON or GPKG formats for mixed geometry types.</p>
</div>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">driver</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save drawn features to a file in various formats.</span>

<span class="sd">    Args:</span>
<span class="sd">        filepath: Path where to save the file. The file extension determines</span>
<span class="sd">                 the output format if driver is not specified.</span>
<span class="sd">        driver: GeoPandas driver name (e.g., &#39;GeoJSON&#39;, &#39;ESRI Shapefile&#39;, &#39;GPKG&#39;).</span>
<span class="sd">               If None, inferred from file extension.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ImportError: If geopandas is not installed.</span>
<span class="sd">        ValueError: If no drawn features exist or invalid driver/format.</span>

<span class="sd">    Note:</span>
<span class="sd">        For shapefiles, all features must have the same geometry type.</span>
<span class="sd">        Use GeoJSON or GPKG formats for mixed geometry types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_GEOPANDAS</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;geopandas is required for save_draw_data. &quot;</span>
            <span class="s2">&quot;Install it with: pip install geopandas&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Get the drawn features</span>
    <span class="n">draw_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_draw_data</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">draw_data</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">draw_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No drawn features to save&quot;</span><span class="p">)</span>

    <span class="c1"># Convert to GeoDataFrame</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="n">draw_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">])</span>

    <span class="c1"># Set a default CRS if not present</span>
    <span class="k">if</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gdf</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Save to file</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Provide helpful error message for common shapefile issues</span>
        <span class="k">if</span> <span class="s2">&quot;shapefile&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">driver</span> <span class="ow">and</span> <span class="s2">&quot;shapefile&quot;</span> <span class="ow">in</span> <span class="n">driver</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">geometry_types</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">geom_type</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">geometry_types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot save mixed geometry types </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">geometry_types</span><span class="p">)</span><span class="si">}</span><span class="s2"> to shapefile. &quot;</span>
                    <span class="s2">&quot;Use GeoJSON (.geojson) or GeoPackage (.gpkg) format instead.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_bearing" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_bearing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bearing</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_bearing" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Set the map bearing (rotation).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>bearing</code></td>
        <td><code>float</code></td>
        <td><p>Map rotation in degrees (0-360).</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_bearing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bearing</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the map bearing (rotation).</span>

<span class="sd">    Args:</span>
<span class="sd">        bearing: Map rotation in degrees (0-360).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">=</span> <span class="n">bearing</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_center" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lng</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_center" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Set the map center coordinates.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>lng</code></td>
        <td><code>float</code></td>
        <td><p>Longitude coordinate.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>lat</code></td>
        <td><code>float</code></td>
        <td><p>Latitude coordinate.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lng</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lat</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the map center coordinates.</span>

<span class="sd">    Args:</span>
<span class="sd">        lng: Longitude coordinate.</span>
<span class="sd">        lat: Latitude coordinate.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="n">lng</span><span class="p">,</span> <span class="n">lat</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_center</span> <span class="o">=</span> <span class="p">[</span><span class="n">lng</span><span class="p">,</span> <span class="n">lat</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_deckgl_layer_visibility" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_deckgl_layer_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_deckgl_layer_visibility" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Set the visibility of a DeckGL layer.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier of the DeckGL layer.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>visible</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the layer should be visible.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_deckgl_layer_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the visibility of a DeckGL layer.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Unique identifier of the DeckGL layer.</span>
<span class="sd">        visible: Whether the layer should be visible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">:</span>
        <span class="n">current_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">)</span>
        <span class="n">current_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">][</span><span class="s2">&quot;visible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span> <span class="o">=</span> <span class="n">current_layers</span>

        <span class="c1"># Send to JavaScript</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setDeckGLLayerVisibility&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_draw_mode" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_draw_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_draw_mode" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Set the draw control mode.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>mode</code></td>
        <td><code>str</code></td>
        <td><p>Draw mode ('simple_select', 'direct_select', 'draw_point',
 'draw_line_string', 'draw_polygon', 'static')</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_draw_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the draw control mode.</span>

<span class="sd">    Args:</span>
<span class="sd">        mode: Draw mode (&#39;simple_select&#39;, &#39;direct_select&#39;, &#39;draw_point&#39;,</span>
<span class="sd">             &#39;draw_line_string&#39;, &#39;draw_polygon&#39;, &#39;static&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setDrawMode&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_geoman_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_geoman_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_geoman_data" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Replace the current Geoman feature collection.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_geoman_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replace the current Geoman feature collection.&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span> <span class="o">=</span> <span class="n">data</span> <span class="ow">or</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_geoman_info_box_enabled" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_geoman_info_box_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_geoman_info_box_enabled" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Enable or disable the Geoman info box at runtime.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>enabled</code></td>
        <td><code>bool</code></td>
        <td><p>True to show the info box when selecting/editing features;
     False to hide it.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_geoman_info_box_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enable or disable the Geoman info box at runtime.</span>

<span class="sd">    Args:</span>
<span class="sd">        enabled: True to show the info box when selecting/editing features;</span>
<span class="sd">                 False to hide it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setGeomanInfoBoxEnabled&quot;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">enabled</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_layout_property" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_layout_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_layout_property" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Set a layout property for a layer.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier of the layer.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>Name of the layout property to set.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>value</code></td>
        <td><code>Any</code></td>
        <td><p>Value to set for the property.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_layout_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set a layout property for a layer.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Unique identifier of the layer.</span>
<span class="sd">        name: Name of the layout property to set.</span>
<span class="sd">        value: Value to set for the property.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setLayoutProperty&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_opacity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_opacity" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Set the opacity of a layer.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier of the layer.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>opacity</code></td>
        <td><code>float</code></td>
        <td><p>Opacity value between 0.0 (transparent) and 1.0 (opaque).</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">opacity</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the opacity of a layer.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Unique identifier of the layer.</span>
<span class="sd">        opacity: Opacity value between 0.0 (transparent) and 1.0 (opaque).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if this is a marker group</span>
    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">:</span>
        <span class="n">layer_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">layer_type</span> <span class="o">==</span> <span class="s2">&quot;marker-group&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">][</span><span class="s2">&quot;opacity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opacity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setMarkerGroupOpacity&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>
            <span class="k">return</span>

    <span class="n">layer_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_layer_type</span><span class="p">(</span><span class="n">layer_id</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">layer_id</span> <span class="o">==</span> <span class="s2">&quot;Background&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_style_layers</span><span class="p">():</span>
            <span class="n">layer_type</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">layer_type</span> <span class="o">!=</span> <span class="s2">&quot;symbol&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_paint_property</span><span class="p">(</span>
                    <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_type</span><span class="si">}</span><span class="s2">-opacity&quot;</span><span class="p">,</span> <span class="n">opacity</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_paint_property</span><span class="p">(</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="s2">&quot;icon-opacity&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_paint_property</span><span class="p">(</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="s2">&quot;text-opacity&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">:</span>
        <span class="n">layer_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">][</span><span class="s2">&quot;layer&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
        <span class="n">prop_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_type</span><span class="si">}</span><span class="s2">-opacity&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">][</span><span class="s2">&quot;opacity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opacity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">style_dict</span><span class="p">:</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">style_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span>
        <span class="n">layer_type</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
        <span class="n">prop_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_type</span><span class="si">}</span><span class="s2">-opacity&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;paint&quot;</span> <span class="ow">in</span> <span class="n">layer</span><span class="p">:</span>
            <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;paint&quot;</span><span class="p">][</span><span class="n">prop_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">opacity</span>

    <span class="k">if</span> <span class="n">layer_type</span> <span class="o">!=</span> <span class="s2">&quot;symbol&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_paint_property</span><span class="p">(</span><span class="n">layer_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_type</span><span class="si">}</span><span class="s2">-opacity&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_paint_property</span><span class="p">(</span><span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;icon-opacity&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_paint_property</span><span class="p">(</span><span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;text-opacity&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_paint_property" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_paint_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_paint_property" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Set a paint property for a layer.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier of the layer.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>Name of the paint property to set.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>value</code></td>
        <td><code>Any</code></td>
        <td><p>Value to set for the property.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_paint_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set a paint property for a layer.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Unique identifier of the layer.</span>
<span class="sd">        name: Name of the paint property to set.</span>
<span class="sd">        value: Value to set for the property.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setPaintProperty&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_pitch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_pitch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pitch</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_pitch" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Set the map pitch (tilt).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>pitch</code></td>
        <td><code>float</code></td>
        <td><p>Map tilt in degrees (0-60).</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_pitch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the map pitch (tilt).</span>

<span class="sd">    Args:</span>
<span class="sd">        pitch: Map tilt in degrees (0-60).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">pitch</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_projection" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">projection</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_projection" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Set the map projection.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>projection</code></td>
        <td><code>Dict[str, Any]</code></td>
        <td><p>Projection configuration dictionary.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">projection</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the map projection.</span>

<span class="sd">    Args:</span>
<span class="sd">        projection: Projection configuration dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Store projection in persistent state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_projection</span> <span class="o">=</span> <span class="n">projection</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setProjection&quot;</span><span class="p">,</span> <span class="n">projection</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_sidebar_content" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_sidebar_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_sidebar_content" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Replaces all content in the sidebar (except the toggle button).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>content</code></td>
        <td><code>Union[widgets.VBox, List[widgets.Widget]]</code></td>
        <td><p>The new content for the sidebar.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_sidebar_content</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replaces all content in the sidebar (except the toggle button).</span>

<span class="sd">    Args:</span>
<span class="sd">        content (Union[widgets.VBox, List[widgets.Widget]]): The new content for the sidebar.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">set_sidebar_content</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_sidebar_width" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_sidebar_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_sidebar_width" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Dynamically updates the sidebar's minimum and maximum width.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>min_width</code></td>
        <td><code>int</code></td>
        <td><p>New minimum width in pixels. If None, keep current.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>max_width</code></td>
        <td><code>int</code></td>
        <td><p>New maximum width in pixels. If None, keep current.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_sidebar_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dynamically updates the sidebar&#39;s minimum and maximum width.</span>

<span class="sd">    Args:</span>
<span class="sd">        min_width (int, optional): New minimum width in pixels. If None, keep current.</span>
<span class="sd">        max_width (int, optional): New maximum width in pixels. If None, keep current.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_container</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">set_sidebar_width</span><span class="p">(</span><span class="n">min_width</span><span class="p">,</span> <span class="n">max_width</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_style" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_style" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Set the map style.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>style</code></td>
        <td><code>Union[str, Dict[str, Any]]</code></td>
        <td><p>Map style as URL string or style object dictionary.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the map style.</span>

<span class="sd">    Args:</span>
<span class="sd">        style: Map style as URL string or style object dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">style</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setStyle&quot;</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_terrain" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_terrain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;https://elevation-tiles-prod.s3.amazonaws.com/terrarium/</span><span class="si">{z}</span><span class="s1">/</span><span class="si">{x}</span><span class="s1">/</span><span class="si">{y}</span><span class="s1">.png&#39;</span><span class="p">,</span> <span class="n">exaggeration</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tile_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;terrarium&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="o">=</span><span class="s1">&#39;terrain-dem&#39;</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_terrain" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add terrain visualization to the map.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>source</code></td>
        <td><code>str</code></td>
        <td><p>URL template for terrain tiles. Defaults to AWS elevation tiles.</p></td>
        <td><code>&#39;https://elevation-tiles-prod.s3.amazonaws.com/terrarium/{z}/{x}/{y}.png&#39;</code></td>
      </tr>
      <tr>
        <td><code>exaggeration</code></td>
        <td><code>float</code></td>
        <td><p>Terrain exaggeration factor. Defaults to 1.0.</p></td>
        <td><code>1.0</code></td>
      </tr>
      <tr>
        <td><code>tile_size</code></td>
        <td><code>int</code></td>
        <td><p>Tile size in pixels. Defaults to 256.</p></td>
        <td><code>256</code></td>
      </tr>
      <tr>
        <td><code>encoding</code></td>
        <td><code>str</code></td>
        <td><p>Encoding for the terrain tiles. Defaults to "terrarium".</p></td>
        <td><code>&#39;terrarium&#39;</code></td>
      </tr>
      <tr>
        <td><code>source_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier for the terrain source. Defaults to "terrain-dem".</p></td>
        <td><code>&#39;terrain-dem&#39;</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_terrain</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://elevation-tiles-prod.s3.amazonaws.com/terrarium/</span><span class="si">{z}</span><span class="s2">/</span><span class="si">{x}</span><span class="s2">/</span><span class="si">{y}</span><span class="s2">.png&quot;</span><span class="p">,</span>
    <span class="n">exaggeration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">tile_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;terrarium&quot;</span><span class="p">,</span>
    <span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;terrain-dem&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add terrain visualization to the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        source: URL template for terrain tiles. Defaults to AWS elevation tiles.</span>
<span class="sd">        exaggeration: Terrain exaggeration factor. Defaults to 1.0.</span>
<span class="sd">        tile_size: Tile size in pixels. Defaults to 256.</span>
<span class="sd">        encoding: Encoding for the terrain tiles. Defaults to &quot;terrarium&quot;.</span>
<span class="sd">        source_id: Unique identifier for the terrain source. Defaults to &quot;terrain-dem&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Add terrain source</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span>
        <span class="n">source_id</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;raster-dem&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tiles&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">source</span><span class="p">],</span>
            <span class="s2">&quot;tileSize&quot;</span><span class="p">:</span> <span class="n">tile_size</span><span class="p">,</span>
            <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="n">encoding</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>

    <span class="c1"># Set terrain on the map</span>
    <span class="n">terrain_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span> <span class="s2">&quot;exaggeration&quot;</span><span class="p">:</span> <span class="n">exaggeration</span><span class="p">}</span>

    <span class="c1"># Store terrain configuration in persistent state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_terrain</span> <span class="o">=</span> <span class="n">terrain_config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setTerrain&quot;</span><span class="p">,</span> <span class="n">terrain_config</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_three_tileset_height" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_three_tileset_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tileset_id</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_three_tileset_height" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Adjust the height offset applied to a 3D Tiles dataset.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_three_tileset_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tileset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjust the height offset applied to a 3D Tiles dataset.&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span>
        <span class="s2">&quot;setThreeTilesetHeight&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">tileset_id</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">height</span><span class="p">}</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_visibility" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_visibility" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Set the visibility of a layer.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier of the layer.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>visible</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the layer should be visible.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the visibility of a layer.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Unique identifier of the layer.</span>
<span class="sd">        visible: Whether the layer should be visible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if this is a marker group</span>
    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">:</span>
        <span class="n">layer_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">layer_type</span> <span class="o">==</span> <span class="s2">&quot;marker-group&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">][</span><span class="s2">&quot;visible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">visible</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;setMarkerGroupVisibility&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>
            <span class="k">return</span>

    <span class="k">if</span> <span class="n">visible</span><span class="p">:</span>
        <span class="n">visibility</span> <span class="o">=</span> <span class="s2">&quot;visible&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">visibility</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>

    <span class="k">if</span> <span class="n">layer_id</span> <span class="o">==</span> <span class="s2">&quot;Background&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_style_layers</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_layout_property</span><span class="p">(</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="s2">&quot;visibility&quot;</span><span class="p">,</span> <span class="n">visibility</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_layout_property</span><span class="p">(</span><span class="n">layer_id</span><span class="p">,</span> <span class="s2">&quot;visibility&quot;</span><span class="p">,</span> <span class="n">visibility</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_dict</span><span class="p">[</span><span class="n">layer_id</span><span class="p">][</span><span class="s2">&quot;visible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_layer_controls</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.set_zoom" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zoom</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.set_zoom" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Set the map zoom level.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>zoom</code></td>
        <td><code>float</code></td>
        <td><p>Zoom level (typically 0-20).</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zoom</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the map zoom level.</span>

<span class="sd">    Args:</span>
<span class="sd">        zoom: Zoom level (typically 0-20).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span> <span class="o">=</span> <span class="n">zoom</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_zoom</span> <span class="o">=</span> <span class="n">zoom</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.show" class="doc doc-heading">
<code class="highlight language-python"><span class="n">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sidebar_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_width</span><span class="o">=</span><span class="mi">360</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="mi">360</span><span class="p">,</span> <span class="n">sidebar_content</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.show" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Displays the map with an optional sidebar.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>sidebar_visible</code></td>
        <td><code>bool</code></td>
        <td><p>Whether the sidebar is visible. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>min_width</code></td>
        <td><code>int</code></td>
        <td><p>Minimum width of the sidebar in pixels. Defaults to 250.</p></td>
        <td><code>360</code></td>
      </tr>
      <tr>
        <td><code>max_width</code></td>
        <td><code>int</code></td>
        <td><p>Maximum width of the sidebar in pixels. Defaults to 300.</p></td>
        <td><code>360</code></td>
      </tr>
      <tr>
        <td><code>sidebar_content</code></td>
        <td><code>Optional[Any]</code></td>
        <td><p>Content to display in the sidebar. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional keyword arguments.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>None</code></td>
      <td><p>None</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">sidebar_visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">min_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">360</span><span class="p">,</span>
    <span class="n">max_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">360</span><span class="p">,</span>
    <span class="n">sidebar_content</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays the map with an optional sidebar.</span>

<span class="sd">    Args:</span>
<span class="sd">        sidebar_visible (bool): Whether the sidebar is visible. Defaults to False.</span>
<span class="sd">        min_width (int): Minimum width of the sidebar in pixels. Defaults to 250.</span>
<span class="sd">        max_width (int): Maximum width of the sidebar in pixels. Defaults to 300.</span>
<span class="sd">        sidebar_content (Optional[Any]): Content to display in the sidebar. Defaults to None.</span>
<span class="sd">        **kwargs (Any): Additional keyword arguments.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Container</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">sidebar_visible</span><span class="o">=</span><span class="n">sidebar_visible</span><span class="p">,</span>
        <span class="n">min_width</span><span class="o">=</span><span class="n">min_width</span><span class="p">,</span>
        <span class="n">max_width</span><span class="o">=</span><span class="n">max_width</span><span class="p">,</span>
        <span class="n">sidebar_content</span><span class="o">=</span><span class="n">sidebar_content</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.to_html" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Anymap Export&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s1">&#39;100%&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s1">&#39;600px&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.to_html" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Export the map to a standalone HTML file with DeckGL layers.</p>
<p>This method extends the base to_html method to include DeckGL layer state.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>filename</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional filename to save the HTML. If None, returns HTML string.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>title</code></td>
        <td><code>str</code></td>
        <td><p>Title for the HTML page.</p></td>
        <td><code>&#39;Anymap Export&#39;</code></td>
      </tr>
      <tr>
        <td><code>width</code></td>
        <td><code>str</code></td>
        <td><p>Width of the map container as CSS string.</p></td>
        <td><code>&#39;100%&#39;</code></td>
      </tr>
      <tr>
        <td><code>height</code></td>
        <td><code>str</code></td>
        <td><p>Height of the map container as CSS string.</p></td>
        <td><code>&#39;600px&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional arguments passed to the HTML template.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>HTML string content of the exported map.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_html</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Anymap Export&quot;</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;100%&quot;</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;600px&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Export the map to a standalone HTML file with DeckGL layers.</span>

<span class="sd">    This method extends the base to_html method to include DeckGL layer state.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename: Optional filename to save the HTML. If None, returns HTML string.</span>
<span class="sd">        title: Title for the HTML page.</span>
<span class="sd">        width: Width of the map container as CSS string.</span>
<span class="sd">        height: Height of the map container as CSS string.</span>
<span class="sd">        **kwargs: Additional arguments passed to the HTML template.</span>

<span class="sd">    Returns:</span>
<span class="sd">        HTML string content of the exported map.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the current map state</span>
    <span class="n">map_state</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">,</span>
        <span class="s2">&quot;zoom&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">,</span>
        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span>
        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">height</span><span class="p">,</span>
        <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">,</span>
        <span class="s2">&quot;_layers&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="p">),</span>
        <span class="s2">&quot;_sources&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sources</span><span class="p">),</span>
        <span class="s2">&quot;_controls&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">),</span>
        <span class="s2">&quot;_terrain&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_terrain</span><span class="p">),</span>
        <span class="s2">&quot;_deckgl_layers&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">),</span>  <span class="c1"># Include DeckGL layers</span>
        <span class="c1"># Include recorded JS calls so we can faithfully reconstruct dynamic elements</span>
        <span class="s2">&quot;_js_calls&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_js_calls</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># Add class-specific attributes</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">):</span>
        <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;style&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;bearing&quot;</span><span class="p">):</span>
        <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;bearing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;pitch&quot;</span><span class="p">):</span>
        <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;pitch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;antialias&quot;</span><span class="p">):</span>
        <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;antialias&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">antialias</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_draw_data&quot;</span><span class="p">):</span>
        <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;_draw_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_draw_data</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_terra_draw_data&quot;</span><span class="p">):</span>
        <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;_terra_draw_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_terra_draw_data</span><span class="p">)</span>
    <span class="c1"># Persist Geoman data if available</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;geoman_data&quot;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;geoman_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geoman_data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Best-effort; skip if not serializable</span>
            <span class="k">pass</span>
    <span class="c1"># Extract last requested fitBounds to guarantee initial viewport in export</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">last_fit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_js_calls</span><span class="p">:</span>  <span class="c1"># type: ignore[attr-defined]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">call</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">call</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;fitBounds&quot;</span><span class="p">:</span>
                <span class="n">last_fit</span> <span class="o">=</span> <span class="n">call</span>
        <span class="k">if</span> <span class="n">last_fit</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">last_fit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;args&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;_initial_fit_bounds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">map_state</span><span class="p">[</span><span class="s2">&quot;_initial_fit_bounds_options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="c1"># Non-fatal if inspection fails</span>
        <span class="k">pass</span>

    <span class="c1"># Generate HTML content</span>
    <span class="n">html_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_html_template</span><span class="p">(</span><span class="n">map_state</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Save to file if filename provided</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">html_content</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.toggle_geoman_control" class="doc doc-heading">
<code class="highlight language-python"><span class="n">toggle_geoman_control</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.toggle_geoman_control" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Toggle the Geoman draw control toolbar between collapsed and expanded states.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">toggle_geoman_control</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Toggle the Geoman draw control toolbar between collapsed and expanded states.&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;toggleGeomanControl&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.update_deckgl_layer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_deckgl_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.update_deckgl_layer" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Update a DeckGL layer's data or properties.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>layer_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier of the DeckGL layer to update.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>data</code></td>
        <td><code>Union[List[Dict], Dict[str, Any]]</code></td>
        <td><p>New data for the layer. If None, data is not updated.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>props</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>New or updated properties for the layer.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Additional layer properties to update.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_deckgl_layer</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">layer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">props</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update a DeckGL layer&#39;s data or properties.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_id: Unique identifier of the DeckGL layer to update.</span>
<span class="sd">        data: New data for the layer. If None, data is not updated.</span>
<span class="sd">        props: New or updated properties for the layer.</span>
<span class="sd">        **kwargs: Additional layer properties to update.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">layer_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DeckGL layer &#39;</span><span class="si">{</span><span class="n">layer_id</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>

    <span class="c1"># Get current layer config</span>
    <span class="n">current_layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span><span class="p">)</span>
    <span class="n">layer_config</span> <span class="o">=</span> <span class="n">current_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Update data if provided</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

    <span class="c1"># Update properties if provided</span>
    <span class="k">if</span> <span class="n">props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">current_props</span> <span class="o">=</span> <span class="n">layer_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;props&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">props</span><span class="p">:</span>
            <span class="n">current_props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">current_props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Process the updated props to handle lambda functions</span>
        <span class="n">layer_config</span><span class="p">[</span><span class="s2">&quot;props&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_deckgl_props</span><span class="p">(</span><span class="n">current_props</span><span class="p">)</span>

    <span class="c1"># Store updated config</span>
    <span class="n">current_layers</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_deckgl_layers</span> <span class="o">=</span> <span class="n">current_layers</span>

    <span class="c1"># Send to JavaScript</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;updateDeckGLLayer&quot;</span><span class="p">,</span> <span class="n">layer_config</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.update_html" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_id</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">bg_color</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.update_html" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Update an existing HTML control.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>control_id</code></td>
        <td><code>str</code></td>
        <td><p>The control ID used when adding the HTML control</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>html</code></td>
        <td><code>str</code></td>
        <td><p>New HTML string to display</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>bg_color</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional new background color for the HTML container</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_html</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">control_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">html</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">bg_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update an existing HTML control.</span>

<span class="sd">    Args:</span>
<span class="sd">        control_id: The control ID used when adding the HTML control</span>
<span class="sd">        html: New HTML string to display</span>
<span class="sd">        bg_color: Optional new background color for the HTML container</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Update persistent state</span>
    <span class="n">control_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;html_</span><span class="si">{</span><span class="n">control_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">control_key</span> <span class="ow">in</span> <span class="n">current_controls</span><span class="p">:</span>
        <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">][</span><span class="s2">&quot;options&quot;</span><span class="p">][</span><span class="s2">&quot;html&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">html</span>
        <span class="k">if</span> <span class="n">bg_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">current_controls</span><span class="p">[</span><span class="n">control_key</span><span class="p">][</span><span class="s2">&quot;options&quot;</span><span class="p">][</span><span class="s2">&quot;bgColor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bg_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="n">current_controls</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;updateHTML&quot;</span><span class="p">,</span> <span class="n">control_key</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">bg_color</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.update_three_light" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_three_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">light_id</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cast_shadow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shadow_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sun_options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.update_three_light" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Update properties of an existing Three.js light.</p>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_three_light</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">light_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">intensity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cast_shadow</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">shadow_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sun_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update properties of an existing Three.js light.&quot;&quot;&quot;</span>

    <span class="n">update_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">light_id</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
    <span class="k">if</span> <span class="n">intensity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intensity</span>
    <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>
    <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
    <span class="k">if</span> <span class="n">cast_shadow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;castShadow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast_shadow</span>
    <span class="k">if</span> <span class="n">shadow_options</span><span class="p">:</span>
        <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;shadowOptions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shadow_options</span>
    <span class="k">if</span> <span class="n">sun_options</span><span class="p">:</span>
        <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;sunOptions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sun_options</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;updateThreeLight&quot;</span><span class="p">,</span> <span class="n">update_config</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="anymap.maplibre.MapLibreMap.update_three_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_three_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_id</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#anymap.maplibre.MapLibreMap.update_three_model" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Update properties of an existing 3D model.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>model_id</code></td>
        <td><code>str</code></td>
        <td><p>Unique identifier of the model to update.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>position</code></td>
        <td><code>Optional[List[float]]</code></td>
        <td><p>Optional new position as [x, y, z].</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>scale</code></td>
        <td><code>Union[float, List[float]]</code></td>
        <td><p>Optional new scale. Can be a single number or [x, y, z] list.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>rotation</code></td>
        <td><code>Optional[List[float]]</code></td>
        <td><p>Optional new rotation in radians as [x, y, z].</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">update_three_model</span><span class="p">(</span><span class="s1">&#39;my_model&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>anymap/maplibre.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_three_model</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">scale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">rotation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update properties of an existing 3D model.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_id: Unique identifier of the model to update.</span>
<span class="sd">        position: Optional new position as [x, y, z].</span>
<span class="sd">        scale: Optional new scale. Can be a single number or [x, y, z] list.</span>
<span class="sd">        rotation: Optional new rotation in radians as [x, y, z].</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; m.update_three_model(&#39;my_model&#39;, scale=200, rotation=[0, 1.57, 0])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">update_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">model_id</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>
    <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span>
    <span class="k">if</span> <span class="n">rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">update_config</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotation</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call_js_method</span><span class="p">(</span><span class="s2">&quot;updateThreeModel&quot;</span><span class="p">,</span> <span class="n">update_config</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="July 4, 2025 04:36:02 UTC"><span class="timeago" datetime="2025-07-04T04:36:02+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="July 4, 2025 04:36:02 UTC">2025-07-04</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="July 4, 2025 04:36:02 UTC"><span class="timeago" datetime="2025-07-04T04:36:02+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="July 4, 2025 04:36:02 UTC">2025-07-04</span>
  </span>

    
    
    
  </aside>





                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 - 2025 Qiusheng Wu
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.top", "search.highlight", "search.share"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="../js/timeago.min.js"></script>
      
        <script src="../js/timeago_mkdocs_material.js"></script>
      
    
  </body>
</html>